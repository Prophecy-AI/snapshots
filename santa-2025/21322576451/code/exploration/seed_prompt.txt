# Santa 2025 - Christmas Tree Packing Challenge - Evolved Strategy

## Current Status
- Best CV score: 70.624381 from exp_000 (baseline)
- Best LB score: N/A (no submissions yet - MUST SUBMIT TO VERIFY)
- Target: 68.901319 | Gap to target: 1.723 points (2.50%)

## Response to Evaluator
The evaluator's feedback is TRUSTWORTHY. Key points addressed:

1. **Submit to LB immediately**: AGREED. This is critical validation. With 100 submissions available and 0 used, we must verify the local score matches LB.

2. **Compile and run C++ optimizers**: AGREED. The gap of 1.723 points requires C++ optimization. Python is too slow for the millions of iterations needed.

3. **Ensemble approach**: AGREED. Different solutions may have different strengths for different N values. Creating an ensemble by selecting the best valid configuration for each N could improve the baseline.

4. **Focus on small N values**: PARTIALLY AGREE. While small N has highest leverage per-unit improvement (N=1-10 contributes 6.1% of score), the mid-range N values (N=11-100) contribute 45.7% of total score. A balanced approach is needed.

## Data Understanding
- Reference notebooks: `exploration/evolver_loop1_analysis.ipynb`
- Score breakdown by N range:
  - N=1-10: 4.33 (6.1%) - N=1 already at theoretical minimum
  - N=11-50: 14.70 (20.8%) - HIGH PRIORITY for optimization
  - N=51-100: 17.61 (24.9%) - HIGH PRIORITY for optimization
  - N=101-150: 17.14 (24.3%) - Medium priority
  - N=151-200: 16.84 (23.8%) - Medium priority

## Key Techniques from Top Kernels

### 1. Fractional Translation (CRITICAL)
From `jonathanchan_santa25-ensemble-sa-fractional-translation`:
- Move trees by very small amounts: 0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001
- Try all 8 directions for each step size
- Accept only if no overlap AND score improves
- This fine-tuning can squeeze out the last few decimal places

### 2. C++ SA Optimizer (sa_v1_parallel.cpp)
Key parameters:
- `-n 15000-20000` iterations per N
- `-r 5-80` restarts
- Allocate more iterations to small N (1-50) where improvements have larger impact
- Uses OpenMP for parallelization

### 3. Ensemble Approach
From multiple kernels:
- Collect solutions from multiple sources (snapshots, kernels, etc.)
- For each N, select the configuration with the lowest SÂ²/n score
- Validate no overlaps before accepting

### 4. Global Squeeze
- Scale all trees toward centroid by factor 0.9995 to 0.98
- Repair overlaps after squeeze
- Accept if score improves

## Recommended Approaches (Priority Order)

### IMMEDIATE (Experiment 002):
1. **SUBMIT BASELINE TO LB** - Verify score matches 70.624381
2. **Compile C++ optimizer** from snapshot:
   ```bash
   cp /home/nonroot/snapshots/santa-2025/21222392487/code/bbox3.cpp /home/code/
   g++ -O3 -march=native -fopenmp -std=c++17 -o bbox3 bbox3.cpp
   ```
3. **Run bbox3 on current submission**:
   ```bash
   cp /home/submission/submission.csv /home/code/submission.csv
   ./bbox3 -n 5000 -r 64
   ```

### NEXT (Experiment 003):
1. **Implement fractional translation** in Python or C++
2. **Create ensemble** from all available pre-optimized submissions
3. **Focus optimization on N=11-100** where most score contribution is

### LATER (Experiments 004+):
1. **Backward propagation** - improve smaller N by removing trees from larger N
2. **fix_direction** - optimize global rotation of each configuration
3. **Multi-seed SA** with different starting points

## What NOT to Try
- Python-based optimization for millions of iterations (too slow)
- Focusing only on N=1 (already at theoretical minimum)
- Random search without SA temperature schedule

## Validation Notes
- Always check for overlaps using Shapely with high precision
- Verify score calculation matches LB (should be exact for optimization problems)
- Use the validated scoring function from `experiments/001_baseline/baseline.ipynb`

## Available Resources
- Pre-compiled bbox3: `/home/nonroot/snapshots/santa-2025/21222392487/code/bbox3`
- Pre-compiled sa_fast_v2: `/home/nonroot/snapshots/santa-2025/21222392487/code/sa_fast_v2`
- Best pre-optimized submissions in `/home/nonroot/snapshots/santa-2025/21222392487/code/submission_candidates/`
- C++ source code in `/home/code/research/kernels/jazivxt_why-not/`

## Success Criteria
- Beat target score of 68.901319
- Gap to close: 1.723 points (2.50%)
- This requires approximately 1.2% reduction in average side length across all N
