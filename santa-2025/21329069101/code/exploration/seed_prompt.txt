# Santa 2025 - Evolved Strategy (Loop 1)

## Current Status
- Best CV score: 70.6761 from 001_baseline
- Best LB score: 70.6761 (PERFECT CV-LB alignment!)
- Target: 68.894234 | Gap to target: 1.78 points (2.5%)
- Submissions used: 1/100 (97 remaining)

## CV-LB Relationship Analysis
- Perfect alignment: CV = LB (gap = 0.0000)
- This means our local scoring is ACCURATE
- Any CV improvement should translate directly to LB improvement

## Response to Evaluator
The evaluator correctly identified:
1. **Baseline is solid** - Score verified, per-N analysis done ✓
2. **bbox3 binary available but not used** - AGREED, this is the next step
3. **Lattice approach for large N** - AGREED, but analysis shows small N has MORE impact
4. **Small N optimization** - CRITICAL! N=1-10 contribute ~4 points, with 35-63% waste

**Key insight from my analysis:** The evaluator suggested lattice for large N, but my per-N analysis shows:
- N=1 alone contributes 0.66 (with 63% waste!)
- N=1-10 total contributes ~4 points
- Large N (100-200) already has only 28-30% waste
- **SMALL N OPTIMIZATION HAS MORE POTENTIAL THAN LARGE N**

## Key Findings from Analysis

### Per-N Score Contribution (Top 10)
| N | Side | Contribution | Efficiency | Waste |
|---|------|--------------|------------|-------|
| 1 | 0.813 | 0.661 | 1.51 | 63.3% |
| 2 | 0.950 | 0.451 | 2.22 | 55.0% |
| 3 | 1.142 | 0.435 | 2.30 | 53.5% |
| 4 | 1.291 | 0.417 | 2.40 | 51.7% |
| 5 | 1.444 | 0.417 | 2.40 | 51.7% |

### Available Resources
- **bbox3 binary**: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
- **Best baseline**: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa-2025.csv` (70.676)
- **All other CSVs score the same or worse** (verified)

### Kernel Insights
1. **bbox3.cpp** (from why-not kernel):
   - Complex number vector coordination
   - Fluid dynamics-inspired movement
   - Hinge pivot optimization
   - Global boundary tension
   - Aggressive overlap repair cycles
   - Multi-phase: 2min → 10min → 20min runs

2. **Lattice crystallization patterns**:
   - Blue Phase: Trees pointing up (0° ± 90°)
   - Pink Phase: Trees pointing down (180° ± 90°)
   - These interlock efficiently for large N

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Exhaustive Search for N=1**
N=1 contributes 0.661 with 63% waste. Current solution uses 45° rotation.
- Try ALL angles from 0° to 360° in 0.01° increments
- The tree is asymmetric, so optimal angle may not be exactly 45°
- Potential gain: If we reduce waste from 63% to 50%, save ~0.1 points

### 2. **[HIGH PRIORITY] Optimize N=2-10 with Exhaustive Search**
- For N=2: Try all combinations of 2 tree positions and angles
- For N=3-10: Use simulated annealing with LONG runs
- These contribute ~3.4 points total with 35-55% waste
- Potential gain: 0.3-0.5 points

### 3. **[MEDIUM PRIORITY] Run bbox3 with Multi-Phase Optimization**
Following the bbox3-runner kernel pattern:
```bash
# Phase A: Short runs to find promising settings
./bbox3 -n 1000 -r 30  # 2 min
./bbox3 -n 1500 -r 60  # 2 min

# Phase B: Medium runs on top candidates
./bbox3 -n 2000 -r 90  # 10 min

# Phase C: Long runs on best
./bbox3 -n 3000 -r 120 # 20 min
```

### 4. **[LOWER PRIORITY] Lattice Approach for Large N**
- Large N already efficient (28-30% waste)
- Implement lattice generator for N >= 50
- Blue/Pink phase interlocking pattern

## Implementation Plan for Next Experiment

### Experiment 002: Small N Exhaustive Optimization
1. **N=1 Exhaustive Search**:
   - Test all angles 0-360° in 0.01° increments
   - Find the angle that minimizes bounding box side
   - Expected: Find optimal angle, potentially save 0.05-0.1 points

2. **N=2-5 Grid Search**:
   - For each N, try many configurations
   - Use scipy.optimize for fine-tuning
   - Expected: Save 0.1-0.2 points

3. **Combine with baseline for N>10**:
   - Keep baseline solutions for N>10
   - Replace N=1-10 with optimized solutions

### Validation
- Check for overlaps using Shapely
- Verify score calculation matches baseline methodology
- Submit to verify LB alignment

## What NOT to Try
- ❌ Simple ensemble (all CSVs score ~70.676)
- ❌ Short optimization runs (already at local optimum)
- ❌ fix_direction alone (causes precision loss)
- ❌ Random search without intelligent initialization

## SUBMISSION STRATEGY
- Remaining submissions: 97 (ABUNDANT!)
- **SUBMIT AFTER EVERY EXPERIMENT** - LB feedback is free information
- Even if experiment fails, submit to learn what doesn't work

## Technical Notes
- Tree area: 0.2425 square units
- Theoretical minimum for N=1: side = 0.4924 (if perfect packing)
- Current N=1: side = 0.8132 (63% waste)
- Coordinates must be in [-100, 100]
- Values prefixed with 's' in submission CSV
