# Santa 2025 - Christmas Tree Packing Challenge - Loop 4 Strategy

## Current Status
- Best CV score: 70.647327 from exp_000 (001_baseline)
- Best LB score: 70.6473 (CONFIRMED - matches CV exactly!)
- Target: 68.919154 | Gap to target: 1.728 points (2.4%)
- Submissions used: 3/100 (89 remaining)

## CV-LB Calibration
- CV = 70.647327, LB = 70.647327 → Perfect match!
- Local scoring is 100% accurate and we can trust CV

## CRITICAL: Response to Evaluator

The evaluator has now recommended the 3-phase bbox3 optimization approach **THREE TIMES** and it has NOT been implemented. I FULLY AGREE with this assessment:

1. **Ensemble approaches are PROVEN INEFFECTIVE** - exp_001, exp_002, exp_003 all show ~0.000021 improvement (0.00003% of the 1.73 point gap)
2. **All public solutions are at the SAME local optimum** - Combining them yields no benefit
3. **The only path forward is ACTIVE OPTIMIZATION with compute time**

The evaluator is correct that the next experiment MUST implement extended bbox3 optimization. No more ensemble experiments.

## Key Insights from Kernel Analysis

### yongsukprasertsuk kernel (369 votes) - THE META-STRATEGY
The 3-phase approach:
- **Phase A (1-2 hours)**: 2 min runs with n=[1000,1200,1500,1800,2000], r=[30,60,90]
  - Track which (n, r) combinations show any improvement
  - Select top 6 candidates
- **Phase B (30-60 min)**: 10 min runs on top 3-5 candidates
- **Phase C (30-60 min)**: 20 min runs on best 2 candidates
- **fix_direction**: Rotation tightening after each phase
- **repair_overlaps**: Validate and fix overlaps before saving

### jonathanchan kernel (175 votes) - C++ Parallel SA
- Uses C++ parallel optimizer with OpenMP
- Includes `fractional_translation` function for micro-adjustments (0.001, 0.0005, etc.)
- Runs SA with translations on all N values in parallel

### Key Parameters from Kernels
- bbox3 parameters: n (iterations), r (radius)
- SA parameters: si (iterations), nr (number of restarts)
- Typical values: n=1000-5000, r=30-120, si=15000-20000, nr=5-80

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY - MUST DO]** Implement 3-Phase bbox3 Optimization

This is the ONLY path forward. The evaluator has recommended this THREE times.

**Implementation:**
1. Start with current best submission (70.647327)
2. **Phase A (1-2 hours)**: Run bbox3 with varied parameters:
   - n_values = [1000, 1500, 2000, 3000, 5000]
   - r_values = [30, 60, 90, 120]
   - Timeout = 2-5 minutes each
   - Track which (n, r) combinations show any improvement
3. **Phase B (30-60 min)**: Run longer (10 min) on top 3-5 candidates
4. **Phase C (30-60 min)**: Run longest (20 min) on best 2 candidates
5. Apply fix_direction (rotation tightening) after each phase
6. Validate no overlaps before saving

**Expected outcome:** The target of 68.919 IS achievable. Teams have achieved scores in the 67-68 range. The key is to invest COMPUTE TIME.

### 2. **[ALTERNATIVE]** Implement C++ Parallel SA Optimizer

If bbox3 doesn't yield improvements, try the jonathanchan C++ optimizer:
- Compile sa_v1_parallel.cpp with OpenMP
- Run with -n 15000 -r 5 (or higher)
- Includes fractional_translation for micro-adjustments

### 3. **[FALLBACK]** Target Specific N Values

If global optimization doesn't work, target specific N values:
- N=21-200 contributes 62.59 points (88.6% of total)
- Focus on N values with worst packing efficiency
- Run longer optimization on those specific configurations

## What NOT to Try
- ❌ More ensemble experiments (proven ineffective - 0.000021 improvement)
- ❌ Downloading more pre-optimized solutions (all at same local optimum)
- ❌ Short bbox3 runs (100-500 iterations) - already proven ineffective
- ❌ Micro-optimizations when we're 1.7 points from target

## Technical Notes
- bbox3 binary is compiled at `/home/code/exploration/datasets/bbox3`
- 26 threads available for parallel optimization
- Scoring is calibrated (CV = LB)
- Rotation angles can be any value (normalized modulo 360)

## SUBMISSION STRATEGY
- Remaining submissions: 89
- Submit after this experiment? **YES** - we have abundant submissions and need LB feedback
- Even if the score doesn't improve, submit to verify the optimization approach

## Time Budget
- Total budget: ~35 hours remaining
- Phase A: 1-2 hours
- Phase B: 30-60 min
- Phase C: 30-60 min
- Total for 3-phase approach: 2-4 hours

**START THE 3-PHASE BBOX3 OPTIMIZATION NOW. This is the ONLY path forward.**
