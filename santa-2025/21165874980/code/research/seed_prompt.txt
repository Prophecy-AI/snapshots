# Santa 2025 - Christmas Tree Packing Challenge - Loop 7 Strategy

## Current Status
- Best CV score: 70.647327 from exp_000 (001_baseline)
- Best LB score: 70.6473 (CONFIRMED - matches CV exactly!)
- Target: 68.919154 | Gap to target: 1.728 points (2.4%)
- Submissions used: 4/100 (89 remaining - ABUNDANT!)

## CV-LB Calibration
- CV = 70.647327, LB = 70.647327 → Perfect match!
- This means our local scoring is accurate and we can trust CV

## Response to Evaluator - CRITICAL AGREEMENT

The evaluator is **100% CORRECT**. I made a fundamental error in my analysis:

**WRONG**: Comparing raw zaburo scores (88.33) to optimized baseline (70.65)
**CORRECT**: Zaburo solutions need to be OPTIMIZED with sa_v1_parallel BEFORE comparison

The zaburo approach's value is that it provides **DIFFERENT STARTING POINTS** that might land in **DIFFERENT BASINS OF ATTRACTION** when optimized. The raw score of 88.33 is irrelevant - what matters is where the zaburo solutions end up AFTER optimization.

**The pattern of failure in experiments 4-6:**
- Experiment 4: Ran bbox3 but it produced invalid solutions (overlaps)
- Experiment 5: Validated baseline but didn't try new approaches
- Experiment 6: Generated zaburo solutions but **DIDN'T OPTIMIZE THEM**

**THE FIX**: Complete the pipeline by optimizing zaburo solutions with sa_v1_parallel.

## Key Insights from Research

### 1. The Complete Pipeline (jonathanchan kernel)
The winning approach has THREE steps:
1. **Generate/Ensemble initial solutions** from multiple sources
2. **Optimize with sa_v1_parallel** (SA + local search + fractional translation)
3. **Ensemble the results** - pick best per N

The sa_v1_parallel optimizer includes:
- Simulated annealing with translations
- Local search (ls_v3)
- **Fractional translation** with steps [0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001]
- Per-N optimization: N≤20 gets 1.5x iterations, N≤50 gets 1.3x

### 2. Tessellation-Based SA (egortrushin kernel)
For large N, create grid arrangements with nt=[nx, ny] trees:
- SA optimizes the translation distances (dx, dy)
- "Tree deletion" technique: optimize N+k trees, delete k worst to get N
- This creates fundamentally different configurations

### 3. The sa_v1_parallel Optimizer is Available
Located at: `/home/code/exploration/datasets/sa_v1_parallel`
Usage: `./sa_v1_parallel -i input.csv -n 15000 -r 5`
- `-n`: SA iterations (default 20000)
- `-r`: Number of restarts (default 80)

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Optimize Baseline with sa_v1_parallel

Run sa_v1_parallel on the current baseline to see if fractional translation can squeeze out improvements:

```bash
cd /home/code/exploration/datasets
./sa_v1_parallel -i submission.csv -n 20000 -r 10
```

The fractional translation step might find improvements the bbox3 optimizer missed.

### 2. **[HIGH PRIORITY]** Generate and Optimize Zaburo Solutions

If the zaburo solutions weren't saved, regenerate them and optimize:
1. Generate zaburo grid-based solutions for N=1-200
2. Save to CSV format
3. Run sa_v1_parallel on them
4. Compare OPTIMIZED zaburo scores to baseline
5. Create ensemble: pick best per N

### 3. **[MEDIUM PRIORITY]** Generate Random Initial Configurations

If zaburo and baseline optimization don't help:
- Generate random initial placements for each N
- Optimize with sa_v1_parallel
- Ensemble with baseline

### 4. **[MEDIUM PRIORITY]** Perturbed Baseline

Add random perturbations to baseline, optimize to escape local optimum:
- Perturb positions by ±0.1
- Perturb angles by ±10°
- Optimize with sa_v1_parallel

## What NOT to Try
- ❌ Comparing raw/unoptimized scores to optimized baseline
- ❌ Running bbox3 (produces overlapping trees that fail Kaggle validation)
- ❌ Simple ensembles without optimization (already proven ineffective)
- ❌ Concluding an approach doesn't work without completing the full pipeline

## Validation Notes
- CV scheme: Calculate bounding box side² / N for each N, sum over N=1-200
- Always validate with Shapely before submission (check for overlaps)
- CV matches LB exactly, so trust local scoring

## SUBMISSION STRATEGY
- Remaining submissions: 89 (ABUNDANT!)
- **SUBMIT after EVERY experiment** - LB feedback is free information
- Even if worse than baseline, submit to learn what doesn't work
- Only skip submission if the file would be INVALID (overlaps)

## Critical Reminder
**DO NOT conclude that an approach doesn't work based on raw/unoptimized scores.**
**The optimization step is CRITICAL.**

The target of 68.919 IS achievable. Top performers have scores in the 67-68 range. The key is to:
1. Generate DIFFERENT initial configurations (zaburo, random, perturbed)
2. OPTIMIZE them with a proper optimizer (sa_v1_parallel)
3. ENSEMBLE the results to capture any improvements