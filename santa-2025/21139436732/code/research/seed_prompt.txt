# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 1)

## Current Status
- Best CV score: 164.924 from exp_000 (001_baseline)
- Best LB score: N/A (no submissions yet)
- Target: 68.922808 | Gap to target: ~96 points (2.4x worse)

## Response to Evaluator

The evaluator's feedback is **CRITICAL and CORRECT**. Key points:

1. **Technical verdict: TRUSTWORTHY** - The C++ pipeline works correctly.

2. **Evaluator's top priority: WRONG STARTING POINT** - I fully agree. The sample_submission.csv (score 173.65) is a terrible starting point. Top kernels start from pre-computed baselines around 69-70.

3. **Key concerns raised:**
   - Starting from sample_submission (2.5x worse than competitive baselines) - **AGREED, CRITICAL**
   - Under-resourced optimization (n=50, r=5 vs n=1000-2000, r=30-90) - **AGREED**
   - Missing fix_direction rotation optimization - **AGREED**
   - Missing backward propagation - **AGREED**

**My response:** The evaluator is completely right. We need to fundamentally change our approach:
- Generate a MUCH better initial solution using grid-based patterns (score ~88)
- Apply backward propagation to improve smaller configs (score ~74-75)
- Run C++ optimizer for MUCH longer with proper parameters
- Apply rotation optimization (fix_direction)

## Data Understanding

Reference notebooks:
- `research/kernels/zaburo_88-32999-a-well-aligned-initial-solution/` - Grid-based initialization achieving 88.33
- `research/kernels/crodoc_74-75-backpacking-christmas-trees/` - Backward propagation achieving 74.75
- `research/kernels/jazivxt_why-not/why-not.ipynb` - bbox3.cpp optimizer
- `research/kernels/saspav_santa-submission/santa-submission.ipynb` - Combined approach with fix_direction

Key patterns to exploit:
1. **Grid-based initialization**: Trees arranged in alternating rows (0° and 180°) with optimal (n_even, n_odd) combinations
2. **Backward propagation**: Good n=200 solution → good n=199, 198, ... by removing boundary trees
3. **Rotation optimization**: Find optimal rotation angle for entire configuration to minimize bounding box
4. **Long optimization runs**: 3-9 hours with n=1000-2000, r=30-90

## Recommended Approaches (Priority Order)

### PRIORITY 1: Generate Better Initial Solution (CRITICAL)
**Why:** Current baseline (164.92) is 2.4x worse than target. No amount of local optimization can bridge this gap efficiently.

**Implementation:**
1. Implement grid-based initialization from zaburo kernel:
   - Arrange trees in alternating rows (0° and 180° rotations)
   - Search for optimal (n_even, n_odd) combinations for each n
   - Expected score: ~88.33

2. Apply backward propagation from crodoc kernel:
   - Start from n=200, work backward to n=1
   - For each n, try removing each tree and keep best result
   - Expected score: ~74-75

### PRIORITY 2: Run C++ Optimizer with Proper Parameters
**Why:** Current run used n=50, r=5 (~10 min). Top kernels use n=1000-2000, r=30-90 (3-9 hours).

**Implementation:**
1. Start from the improved baseline (~74-75)
2. Run bbox3 optimizer with:
   - n=1000-2000 iterations
   - r=30-60 restarts
   - Runtime: 1-3 hours minimum
3. Save intermediate results and iterate

### PRIORITY 3: Apply Rotation Optimization (fix_direction)
**Why:** This technique finds optimal rotation angle to minimize bounding box. Used by all top kernels.

**Implementation:**
1. For each configuration, get convex hull of all tree vertices
2. Use scipy.optimize.minimize_scalar to find optimal rotation angle (0-90°)
3. Apply rotation to all trees in configuration
4. Verify no overlaps after rotation

### PRIORITY 4: Ensemble Best Solutions
**Why:** Different approaches may find different local optima. Combining them can improve overall score.

**Implementation:**
1. Load all CSV solutions (baseline, optimized, etc.)
2. For each n, pick the configuration with smallest bounding box
3. Create ensemble submission

## What NOT to Try
- ❌ Starting from sample_submission.csv (too far from competitive)
- ❌ Short optimization runs (< 1 hour)
- ❌ Hyperparameter tuning before having a good baseline
- ❌ Complex techniques before basic ones are working

## Validation Notes
- Score calculation: sum of (side_length^2 / n) for n=1 to 200
- Lower is better
- No overlaps allowed (touching is OK)
- Use Shapely with STRtree for efficient collision detection

## Concrete Next Steps for Executor

1. **Experiment 002: Grid-Based Initialization**
   - Implement `find_best_trees(n)` function from zaburo kernel
   - Generate initial solution for all n=1 to 200
   - Calculate score (expected ~88.33)

2. **Experiment 003: Backward Propagation**
   - Start from grid-based solution
   - Implement backward propagation (n=200 down to n=1)
   - Calculate score (expected ~74-75)

3. **Experiment 004: Long C++ Optimization**
   - Start from backward-propagated solution
   - Run bbox3 optimizer with n=2000, r=60 for 2+ hours
   - Apply fix_direction rotation optimization
   - Target score: less than 70

## Key Insight from Top Kernels

The top kernels achieve scores around 68-70 by:
1. Starting from a well-structured baseline (grid pattern)
2. Applying backward propagation
3. Running C++ optimizer for hours
4. Applying rotation optimization
5. Iterating multiple times

The sample_submission.csv is NOT a competitive starting point - it's just a format example. We MUST generate a better initial solution first.