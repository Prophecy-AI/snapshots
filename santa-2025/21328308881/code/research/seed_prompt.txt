# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.6761 from exp_000 (baseline)
- Best LB score: 70.6761 (confirmed - CV=LB gap is 0.0000)
- Target: 68.894234 | Gap to target: 1.78 points (2.6%)
- **STUCK AT LOCAL OPTIMUM**: 2 experiments with identical scores (70.676102)

## ⚠️ CRITICAL: WE ARE STUCK AT A LOCAL OPTIMUM ⚠️

Both experiments produced IDENTICAL scores (70.676102):
- exp_000: baseline (pre-optimized santa-2025.csv)
- exp_001: bbox3 with -n 10000 -r 64 (190 seconds) - ZERO improvement

**The baseline is at an EXTREMELY tight local optimum.**

## Key Findings from Analysis (Loop 2)

1. **N=1 is at theoretical minimum** - 45 degrees, score 0.661250 - NO improvement possible
2. **Baseline N=100 uses only 4 unique angles** (65° and 245°) - highly structured
3. **All 30 pre-optimized CSVs are dominated by baseline** for ALL N values
4. **Small N (1-15) have lowest efficiency** but contribute most to score
5. **Gap of 1.78 points requires ~2.5% improvement** across all N
6. **Simple constructive approaches (zaburo) are MUCH WORSE** than baseline

## Public Kernel Status
- **Baseline established**: santa-2025.csv at 70.6761
- **Top kernels identified**: 
  - saspav/santa-submission (497 votes) - uses bbox3 + shake_public
  - smartmanoj/santa-claude (378 votes) - tree_packer_v21.cpp
  - yongsukprasertsuk/santa-2025-best-keeping-bbox3-runner (369 votes) - phased bbox3
  - jazivxt/why-not (352 votes) - bbox3.cpp source
  - jonathanchan/santa25-ensemble-sa-fractional-translation (176 votes) - ensemble + SA

## Response to Evaluator

The evaluator correctly identified:
1. **bbox3 run was too short** (190 seconds) - top kernels run for HOURS
2. **Lattice approach was too naive** - need optimized 2-tree base configuration
3. **No perturbation strategy** - need to escape local optima
4. **No submission made** - we have 99 submissions remaining, USE THEM

**Evaluator's key recommendation**: Run bbox3 for MUCH LONGER (30-60 minutes minimum)

**My response**: I agree with the evaluator. The 190-second run was insufficient. However, I also note that:
- The bbox3 binary from snapshots requires GLIBC 2.34 (system has 2.31)
- We successfully compiled bbox3 from source in exp_001
- We should try MUCH longer runs AND different approaches

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Run bbox3 for MUCH LONGER (30-60 minutes)
The evaluator is right - 190 seconds is insufficient. Top kernels run for HOURS.

**Implementation:**
```bash
cd /home/code/experiments/003_bbox3_long_run
cp /home/code/experiments/002_bbox3_extended/bbox3 .
cp /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa-2025.csv submission.csv
./bbox3 -n 50000 -r 256  # Run for ~30-60 minutes
```

**Expected outcome**: If the baseline is truly at a local optimum, even long runs may not help. But we need to verify this.

### 2. **[HIGH PRIORITY]** Try Perturbation + Optimization
The strategy mentions perturbation to escape local optima:
- Perturb the baseline by adding random noise (0.1-0.3) to positions/angles
- Run bbox3 on the perturbed configuration
- This might help escape the local optimum

### 3. **[HIGH PRIORITY]** Try shake_public optimizer (from saspav kernel)
The saspav kernel uses a DIFFERENT optimizer called `shake_public`. This might:
- Use different optimization techniques
- Escape local optima that bbox3 can't

### 4. **[MEDIUM PRIORITY]** Implement Proper Lattice Approach for Large N
The egortrushin approach is more sophisticated:
- Start with 2 base trees in optimized configuration
- Use translation vectors (dx, dy) to create grid
- Optimize base configuration AND translation vectors jointly

### 5. **[MEDIUM PRIORITY]** Focus on Specific N Values
Some N values might have more room for improvement:
- N=2 to N=15 have lowest efficiency
- Try exhaustive search for small N
- Try different structural approaches for specific N

## What NOT to Try (CONFIRMED DEAD ENDS)
- ❌ Simple ensemble (santa-2025.csv dominates all N values)
- ❌ Short optimization runs (local optimum is too tight)
- ❌ Backward propagation (no improvements found)
- ❌ N=1 optimization (already at theoretical minimum)
- ❌ Simple lattice/grid patterns (much worse than baseline)
- ❌ zaburo constructive approach (much worse than baseline)

## SUBMISSION STRATEGY
- Remaining submissions: 99
- **SUBMIT AGGRESSIVELY** - we have abundant submissions
- Submit after EVERY experiment to get LB feedback
- Even if score is same, it confirms CV=LB

## NEXT EXPERIMENT: 003_bbox3_long_run

**Goal**: Run bbox3 for 30-60 minutes to see if longer optimization can escape the local optimum.

**Steps**:
1. Create experiment folder: `experiments/003_bbox3_long_run`
2. Copy compiled bbox3 from exp_001
3. Copy baseline submission
4. Run bbox3 with `-n 50000 -r 256` (target: 30-60 minutes)
5. Calculate score
6. Submit to get LB feedback

**Alternative if bbox3 still finds no improvement**:
- Try perturbation before optimization
- Try shake_public optimizer
- Try fundamentally different approach (genetic algorithm, constraint programming)

## Technical Resources
- Compiled bbox3: `/home/code/experiments/002_bbox3_extended/bbox3`
- Pre-optimized CSV: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa-2025.csv`
- Kernel code: `/home/code/research/kernels/`
