# Santa 2025 - Christmas Tree Packing: Evolved Seed Prompt (Loop 1)

## Current Status
- Best CV score: 70.627582 from exp_000 (001_baseline)
- Best LB score: N/A (no submissions yet this run)
- Historical best LB: 70.630478 (from past runs)
- Target: 68.901319 | Gap to target: 1.726 points (2.51%)

## CV-LB Relationship Analysis
- **CRITICAL**: CV = LB exactly (no distribution shift)
- This is a PURE OPTIMIZATION problem, not a prediction problem
- CV is 100% reliable - any CV improvement translates directly to LB improvement
- No need for distribution-shift strategies - focus purely on finding better packings

## Response to Evaluator
- Technical verdict: TRUSTWORTHY - baseline correctly established
- Evaluator's top priority: **Run bbox3 optimizer on baseline**
- I AGREE with this recommendation, but with a critical modification:
  - Past runs show bbox3 produces OVERLAPPING trees that fail validation
  - Must implement REPAIR strategy: run bbox3, validate each N, replace invalid with baseline
  - Even if only 10-20% of N values improve, that's progress toward target

## Data Understanding
- Reference notebooks: `exploration/evolver_loop1_analysis.ipynb`, `experiments/001_baseline/baseline.ipynb`
- Key patterns:
  1. **Score formula**: sum(side_lengthÂ²/n) for n=1 to 200
  2. **Small N has HIGH LEVERAGE**: 0.1 side reduction at N=1 saves 0.108 points vs 0.008 at N=200
  3. **Score breakdown**: N=1-10 (4.33), N=11-20 (3.72), N=21-50 (10.98), N=51-100 (17.61), N=101-150 (17.14), N=151-200 (16.84)
  4. **Baseline sources**: saspav_best (178 N values), best_snapshot (19), bucket_of_chump (2), better_ensemble (1)

## Recommended Approaches (Priority Order)

### 1. **bbox3 with REPAIR Strategy** (HIGHEST PRIORITY)
Run bbox3 optimizer on baseline, then validate each N with Shapely:
- If valid AND better than baseline: keep
- If invalid OR worse: replace with baseline
- Expected: Even 10-20 improved N values = 0.1-0.3 point improvement

Command: `./bbox3 -i submission.csv -o optimized.csv -n 5000 -r 50`

### 2. **Focus on Small N (1-20)**
Small N has 10x higher leverage per side-length improvement:
- N=1 contributes 0.66 to score (side ~0.81)
- N=2 contributes 0.45 (side ~0.95)
- N=3 contributes 0.43 (side ~1.14)
- Exhaustive search or manual optimization for N=1-5
- SA with many restarts for N=6-20

### 3. **Asymmetric Solutions**
Discussion thread "Why the winning solutions will be Asymmetric" (38 votes) suggests:
- Symmetric patterns are suboptimal
- Winning solutions break symmetry
- Try random perturbations of symmetric baseline

### 4. **Longer Optimization Runs**
Past runs used short timeouts (minutes). Try:
- bbox3 with n=10000, r=100 (30+ minutes)
- SA with very slow cooling (hours)
- Multiple independent runs, ensemble best results

### 5. **BackPacking (Backward Iteration)**
From crodoc kernel "BackPacking Christmas Trees":
- Start from N=200, iterate backward
- If N-1 config is worse than removing worst tree from N config, use that
- Propagates good large configs to smaller sizes

## What NOT to Try
- **Zaburo grid initialization**: Tried, 25% worse than baseline (88.33 vs 70.65)
- **Pure random restart SA**: Tried, random configs much worse than baseline
- **Tessellation patterns**: Tried, grid patterns don't compete
- **Rotation tightening alone**: Baseline already rotation-optimized

## Validation Notes
- **CV scheme**: Calculate score locally using Shapely for overlap detection
- **Overlap check**: Use STRtree for efficient spatial queries
- **Precision**: Use Decimal with 25 digits precision to avoid floating-point errors
- **Submission format**: Coordinates prefixed with 's' (e.g., "s0.123456")

## Key Files
- Binaries: `/home/code/bbox3`, `/home/code/sa_fast_v2`
- Baseline: `/home/submission/submission.csv`
- Pre-optimized sources: `/home/code/preoptimized/`
- Public kernels: `/home/code/research/kernels/`

## Expected Score Progression
- Current: 70.627582
- After bbox3+REPAIR: ~70.5-70.6 (0.05-0.1 improvement)
- After small N focus: ~70.3-70.5 (0.1-0.2 improvement)
- After asymmetric optimization: ~70.0-70.3 (0.2-0.3 improvement)
- Target: 68.901319 (requires 1.73 total improvement)

## Critical Success Factors
1. **REPAIR strategy**: Always validate and replace invalid solutions
2. **Focus on small N**: Highest leverage for score improvement
3. **Long runs**: Give optimizers time to escape local optima
4. **Ensemble**: Combine best results from multiple approaches
5. **Submit early**: Get LB feedback to confirm CV-LB alignment
