# Santa 2025 - Christmas Tree Packing Challenge: Evolved Seed Prompt (Loop 3)

## Current Status
- Best CV score: 70.627582 from valid_baseline (0 overlaps)
- Best LB score: N/A (no submissions yet - 0/100 used)
- Target: 68.896973 | Gap to target: 1.73 points (2.51%)

## CRITICAL ISSUE RESOLVED
**All previous submission candidates had 116-120 overlapping N values and would be REJECTED by Kaggle.**

We now have a **VALID baseline** with 0 overlaps:
- Score: 70.627582
- Built from: best_snapshot (187 N), saspav_best (10 N), bucket_of_chump (2 N), better_ensemble (1 N)
- Location: `/home/code/preoptimized/optimal_valid_baseline.csv`

## CV-LB Relationship Analysis
- **CV = LB exactly** for this competition (pure optimization, no distribution shift)
- This is NOT a machine learning problem - it's a combinatorial optimization problem
- The challenge is finding better packings, not generalization

## Response to Evaluator
- Technical verdict was **UNRELIABLE** - the evaluator correctly identified that all submission candidates had overlaps
- Evaluator's top priority: **FIX THE BASELINE FIRST** - **DONE** ✓
- Key concerns raised:
  1. Baseline has 120 overlaps - **FIXED** by creating optimal_valid_baseline.csv with 0 overlaps
  2. Current submission candidate is invalid - **FIXED** with new valid baseline
  3. No LB submissions yet - **STILL TRUE** - should submit to verify
- Evaluator recommended: After fixing baseline, run sa_fast_v2 with longer runs and focus on small N values

## Data Understanding
- Reference notebooks: `exploration/evolver_loop3_analysis.ipynb`
- Key patterns:
  - N=1 is already at theoretical minimum (0.813173 at 45°)
  - Small N (1-10) contribute 5.6% of total score but are hard to improve
  - The baseline is at a STRONG LOCAL OPTIMUM
  - sa_fast_v2 produces many invalid (overlapping) solutions - MUST use REPAIR strategy

## Key Findings from Analysis
1. **Valid baseline created**: 70.627582 with 0 overlaps
2. **sa_fast_v2 results**: Found 22 valid improvements across 6 seeds, but 116/200 solutions were invalid
3. **REPAIR strategy is essential**: Always replace invalid solutions with valid baseline
4. **Fractional translation** (from jonathanchan kernel): Very fine-grained moves can help
5. **Backward propagation** (from crodoc kernel): Use n-config to improve (n-1)-config

## Recommended Approaches (Priority Order)

### Priority 1: Submit Valid Baseline to Kaggle
We have 100 submissions available and 0 used. Submit the valid baseline to:
1. Verify it's accepted by Kaggle (no overlaps)
2. Establish ground truth LB score
3. Confirm CV = LB for this competition

### Priority 2: Run sa_fast_v2 with VALID Baseline and REPAIR Strategy
The previous runs used an invalid baseline. Now run with the valid baseline:
1. Copy `/home/code/preoptimized/optimal_valid_baseline.csv` to `submission1.csv`
2. Run sa_fast_v2 with multiple seeds
3. Apply REPAIR strategy: keep only valid improvements, replace invalid with baseline
4. Iterate until no more improvements found

Key parameters:
- Multiple seeds: 42, 123, 456, 789, 1234, 5678, 9999, etc.
- Default iterations: 3.5M (can try longer)
- Always validate for overlaps before accepting

### Priority 3: Focus on Small N Values (High Leverage)
Score contribution by N range:
- N=1-10: 4.33 points (6.1% of total)
- N=11-20: 3.72 points (5.3% of total)
- N=21-50: 10.98 points (15.5% of total)

Small N improvements have 10-20x more impact than large N improvements.
Consider specialized optimization for N=1-50.

### Priority 4: Implement Backward Propagation
From crodoc kernel:
1. Start from n=200
2. For each n from 200 down to 2:
   - Take the n-config
   - Remove the tree that touches the boundary
   - Check if resulting (n-1) config is better than current best for (n-1)
   - If yes, update

### Priority 5: Try bbox3 with REPAIR Strategy
bbox3 produces many invalid solutions but might find some valid improvements.
Always apply REPAIR strategy after running.

## What NOT to Try
- **Submitting without validation**: Always check for overlaps first
- **Using invalid baseline**: All optimization must start from valid baseline
- **Ignoring REPAIR strategy**: Optimizers produce many invalid solutions

## Validation Notes
- Always check for overlaps before accepting any solution
- Use REPAIR strategy: keep valid improvements, replace invalid with baseline
- Score = sum(side_length^2 / n) for n=1 to 200
- Valid submission must have 0 overlapping N values

## Technical Notes
- Valid baseline: `/home/code/preoptimized/optimal_valid_baseline.csv`
- sa_fast_v2 reads from submission1.csv, writes to submission2.csv
- Collision detection uses "touch allowed" semantics (touching is OK, overlapping is not)

## Files to Reference
- `/home/code/preoptimized/optimal_valid_baseline.csv` - Valid baseline with 0 overlaps
- `/home/code/sa_fast_v2` - C++ SA optimizer (already compiled)
- `/home/code/bbox3` - C++ bbox optimizer (produces many invalid solutions)
- `/home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/` - Fractional translation
- `/home/code/research/kernels/crodoc_85-25-neon-tree-visualizer-with-optimizer/` - Visualizer

## Experiment Naming Convention
- exp_004: Submit valid baseline to Kaggle for verification
- exp_005: sa_fast_v2 with valid baseline and REPAIR strategy
- exp_006: Backward propagation implementation
- exp_007: Fractional translation implementation
