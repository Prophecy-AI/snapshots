# Santa 2025 - Christmas Tree Packing Challenge - Evolved Seed Prompt

## Current Status
- Best CV score: 70.743774 from exp_000 (001_baseline_preoptimized)
- Best LB score: N/A (no submissions yet)
- Target: 68.922808 | Gap to target: 1.82 points (2.6% improvement needed)
- Submissions: 0/100 used, 100 remaining

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **NO** - only downloaded pre-optimized baseline
- Top kernels identified:
  1. `jazivxt/why-not` - bbox3 optimizer (291 votes)
  2. `smartmanoj/santa-claude` - tree_packer + backward propagation (372 votes)
  3. `jonathanchan/santa25-ensemble-sa-fractional-translation` - Ensemble + SA (174 votes)
  4. `saspav/santa-submission` - bbox3 runner with fix_direction (410 votes)
- Kernels we've implemented: None (only downloaded baseline)
- Kernels still to implement: ALL of the above

## Response to Evaluator
The evaluator correctly identified that:
1. **No optimization has been run yet** - only a baseline download
2. **No LB submission** - need to verify local scoring matches LB
3. **Time budget not utilized** - 2100 minutes available

I fully agree with the evaluator's assessment. The baseline is established, but the real optimization work hasn't started. The next experiment MUST:
1. Submit the baseline to establish LB score (use 1 of 100 submissions)
2. Extract and compile bbox3.cpp from the why-not kernel
3. Run actual optimization loops

## Key Optimization Tools Available

### 1. bbox3 C++ Optimizer (HIGHEST PRIORITY)
**Source:** `/home/code/research/kernels/jazivxt_why-not/why-not.ipynb`

Features:
- Complex Number Vector Coordination
- Fluid Dynamics simulation
- Hinge Pivot moves
- Density Gradient Flow
- Global Boundary Tension
- OpenMP parallelization

**Compilation:**
```bash
g++ -O3 -fopenmp -march=native -std=c++17 -o bbox3 bbox3.cpp
```

**Usage:** `./bbox3 -n <iterations> -r <radius>`

### 2. tree_packer C++ Optimizer
**Source:** `/home/code/research/kernels/smartmanoj_santa-claude/santa-claude.ipynb`

Features:
- Simulated Annealing (SA) with temperature scheduling
- Swap move operator
- Multi-angle restarts
- Squeeze operation
- Compaction
- Local search

**Compilation:**
```bash
g++ -O3 -fopenmp -march=native -std=c++17 -o tree_packer tree_packer.cpp
```

### 3. Backward Propagation (bp.cpp)
Goes from N=200 down to N=2, removing boundary-touching trees to improve smaller configurations.

**Usage:** `./bp input.csv output.csv`

### 4. Ensemble Approach
**Source:** `/home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/`

Key insight: For each N (1-200), pick the best configuration from multiple optimization runs. This allows combining the best results from different optimizers.

### 5. fix_direction (Rotation Optimization)
Post-processing step that optimizes the global rotation of each configuration using scipy.optimize.minimize_scalar.

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Submit Baseline to LB
- Submit exp_000 to verify local score matches LB
- This establishes our baseline and calibrates CV-LB relationship
- Uses 1 of 100 submissions

### 2. **[HIGH PRIORITY]** Extract and Run bbox3 Optimizer
1. Extract bbox3.cpp from `/home/code/research/kernels/jazivxt_why-not/why-not.ipynb`
2. Compile with OpenMP
3. Run optimization:
   - Short run: `./bbox3 -n 2000 -r 60` (verify it works)
   - Medium run: `./bbox3 -n 5000 -r 128`
   - Long run: `./bbox3 -n 10000 -r 256`
4. Apply fix_direction post-processing
5. Validate no overlaps and score

### 3. **[HIGH PRIORITY]** Run tree_packer + Backward Propagation
1. Extract tree_packer.cpp and bp.cpp from santa-claude kernel
2. Compile both
3. Run: `./tree_packer -n 5000 -r 128`
4. Run: `./bp submission.csv submission.csv`
5. Apply fix_direction

### 4. **[MEDIUM PRIORITY]** Ensemble Multiple Runs
For each N from 1 to 200:
- Compare configurations from bbox3, tree_packer, and baseline
- Keep the one with smallest bounding box side length
- Merge into final submission

### 5. **[MEDIUM PRIORITY]** Targeted Optimization
Focus on configurations with highest score contribution:
- Large N values (150-200) contribute most to total score
- Optimize these specifically with longer runs

## What NOT to Try
- Starting from sample_submission.csv (scores ~114, too far from target)
- Running optimization without first establishing LB baseline
- Skipping overlap validation (submissions with overlaps are rejected)

## Validation Notes
- Score formula: `score = Σ(s_n² / n)` for n=1 to 200, where s_n is bounding box side length
- Lower is better
- No overlapping trees allowed
- Use Shapely's STRtree for efficient overlap detection

## Time Budget
- Total: 2100 minutes available
- Suggested allocation:
  - Experiment 2: 30 min (extract, compile, short optimization runs)
  - Experiment 3: 60 min (medium optimization runs)
  - Experiment 4: 120 min (long optimization runs)
  - Experiment 5: 60 min (ensemble and targeted optimization)

## SUBMISSION STRATEGY
- Remaining submissions: 100
- **Submit after EVERY experiment** - we have abundant submissions
- LB feedback is free information - USE IT!
