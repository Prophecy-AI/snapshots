# Santa 2025 - Christmas Tree Packing Challenge - Loop 2 Strategy

## Current Status
- Best CV score: 70.676102 from exp_000 (baseline)
- Best LB score: 70.676102 (submitted, CV-LB gap: 0.0000 - perfect calibration!)
- Target: 68.890873 | Gap to target: 1.785 points (2.59%)
- Submissions remaining: 93/100

## Key Findings from Analysis

### 1. Better Baseline Available
- Best snapshot found: 70.627569 (snapshot 21329069570)
- This is 0.049 points better than current baseline
- **FIRST PRIORITY: Use this better baseline**

### 2. Per-N Score Analysis
- Small N values (1-10) contribute disproportionately to total score
- N=1 alone contributes 0.66 points (0.94% of total)
- Theoretical minimum (perfect packing): 49.125
- Current packing efficiency: 69.51%
- Need to improve efficiency to ~71.2% to hit target

### 3. Techniques from Top Kernels
From saspav/santa-submission and jonathanchan kernels:
1. **Ensemble approach** - Collect best per-N solutions from multiple sources
2. **fix_direction** - Optimize rotation angle for entire configuration
3. **shake_public/bbox3** - C++ SA optimizers
4. **fractional_translation** - Micro-adjustments (0.001 to 0.00001 step sizes)
5. **SA with translations** - Simulated annealing with position perturbations

### 4. Research Insights
- Top competitors use SA with C++ optimization, NOT neural networks
- Strategy: N<58 use chaotic SA packing, N>58 use crystalline/lattice packing
- The 'shake' approach dominates (high temp random, low temp micro-adjust)
- Fractional translation is critical for final refinement

## Response to Evaluator

The evaluator correctly identified:
1. **Better baseline available** - Agreed, will use 70.627569 snapshot
2. **No code infrastructure** - Will create reusable utils.py
3. **Per-N analysis not actionable** - Now have detailed breakdown, will target worst N values
4. **Jostle algorithm suggestion** - Research shows SA dominates, but Jostle could be complementary

Key disagreement: The evaluator suggests implementing Jostle from scratch. However, research shows that:
- SA with C++ optimization is what top competitors use
- The gap (1.79 points) is too large for Python-only approaches
- We should focus on ensemble + better baseline first

## Recommended Approaches (Priority Order)

### EXPERIMENT 1: Better Baseline + Ensemble (HIGH PRIORITY)
**Goal:** Improve from 70.676 to ~70.55 by using better sources

1. Use the 70.627569 snapshot as new baseline
2. Scan ALL snapshots for best per-N solutions
3. Create ensemble by selecting best per-N from all sources
4. Validate no overlaps for each N

Expected improvement: 0.05-0.15 points

### EXPERIMENT 2: Implement Python-based Fractional Translation
**Goal:** Squeeze additional 0.01-0.05 points from ensemble

1. For each N, try micro-translations (0.001, 0.0005, 0.0001 step sizes)
2. For each tree, try 8 directions (N, S, E, W, NE, NW, SE, SW)
3. Accept if bounding box shrinks and no overlap
4. Repeat until no improvement

### EXPERIMENT 3: Rotation Optimization (fix_direction)
**Goal:** Optimize global rotation angle for each N

1. For each N configuration, find optimal rotation angle
2. Use convex hull of all trees to find angle that minimizes bounding box
3. Apply rotation to all trees simultaneously

### EXPERIMENT 4: Small N Optimization (N=1-20)
**Goal:** These contribute disproportionately to score

1. For N=1: Verify optimal angle is 45° (diagonal orientation)
2. For N=2-10: Try exhaustive search with fine rotation grid
3. For N=11-20: Use SA with more iterations

## What NOT to Try
- ❌ Neural network approaches (research shows SA dominates)
- ❌ Reinforcement learning (fails on this problem type)
- ❌ Running bbox3/shake_public longer (already at local optimum)
- ❌ Pure Python SA (too slow for meaningful improvement)

## Validation Notes
- CV-LB gap is 0.0000 - scoring is perfectly calibrated
- Always validate no overlaps before submission
- Use Shapely with high precision for collision detection

## SUBMISSION STRATEGY
- Remaining submissions: 93 (ABUNDANT!)
- Submit after EVERY experiment for LB feedback
- Even small improvements are valuable for understanding what works

## Specific Instructions for Executor

### For Experiment 1 (Better Baseline + Ensemble):
```python
# 1. Load best snapshot
best_path = '/home/nonroot/snapshots/santa-2025/21329069570/code/code/solutions/submission_70.627569.csv'

# 2. Scan all snapshots for per-N best solutions
# 3. For each N, select configuration with lowest score
# 4. Validate no overlaps
# 5. Create ensemble submission
```

### Key Files to Reference:
- `/home/code/research/kernels/saspav_santa-submission/santa-submission.ipynb` - Ensemble approach
- `/home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/` - SA + fractional translation
- `/home/nonroot/snapshots/santa-2025/21329069570/code/code/solutions/submission_70.627569.csv` - Best available baseline

### Code Infrastructure to Create:
Create `/home/code/utils.py` with:
- ChristmasTree class (15-vertex polygon)
- Score calculation function
- Overlap detection function
- Submission I/O functions
