# Santa 2025 - Christmas Tree Packing Challenge - Loop 7 Strategy

## Current Status
- Best CV score: 70.615788 from exp_005 (ensemble)
- Best LB score: 70.676102 (baseline only - all ensemble submissions FAILED)
- Target: 68.888293 | Gap to target: 1.79 points (2.6%)
- Submissions remaining: 93/100

## ⚠️ CRITICAL ISSUE: ENSEMBLE APPROACH IS BROKEN ⚠️

**5 consecutive ensemble submissions have failed Kaggle validation with overlap errors:**
- exp_001: "Overlapping trees in group 002"
- exp_002: "Overlapping trees in group 003"
- exp_004: "Overlapping trees in group 060"
- exp_005: "Overlapping trees in group 126"

**Root cause:** Our local overlap detection doesn't match Kaggle's exactly. Even using Kaggle's exact code (from the metric notebook), we find overlaps in the BASELINE that Kaggle accepts. There's some numerical precision issue we can't resolve.

**CONCLUSION:** The ensemble approach is a dead end. We cannot reliably validate submissions locally.

## Response to Evaluator

The evaluator correctly identified that exp_005 needed to be submitted. It was submitted and FAILED with "Overlapping trees in group 126". The evaluator's suggestions about fix_direction and multi-phase bbox3 are valid, but we have a more fundamental problem: we cannot create valid ensemble submissions.

The evaluator's key insight is correct: "The gap to target (1.727 points) is still substantial, but we haven't exhausted the standard techniques yet." However, the standard ensemble technique is broken for us.

## Strategy Pivot Required

**STOP trying to fix the ensemble approach. It's a dead end.**

The only submission that passes Kaggle validation is the baseline (70.676102). We need to:
1. Accept that we can only submit configurations that are IDENTICAL to known-good sources
2. Find better source configurations from snapshots/kernels
3. OR implement a fundamentally different optimization approach

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Find Better Snapshot Sources**
The baseline came from a snapshot. There may be better snapshots we haven't found.

```python
# Search ALL snapshots for the best per-N configurations
# But ONLY use configurations that are IDENTICAL to their source
# (no mixing configurations from different sources for the same N)

import os
import glob

snapshot_dir = '/home/nonroot/snapshots/santa-2025/'
all_csvs = glob.glob(f'{snapshot_dir}/**/*.csv', recursive=True)

# For each snapshot, calculate its total score
# Find the snapshot with the best total score
# Use that ENTIRE snapshot as our submission (no mixing)
```

### 2. **[HIGH PRIORITY] Run bbox3 on Baseline to Generate New Configurations**
Instead of mixing configurations, run bbox3 on the baseline to generate a NEW complete solution.

```bash
# Run bbox3 with aggressive parameters
./bbox3 -i baseline.csv -o optimized.csv -n 100000 -r 100

# This generates a complete new solution that should be internally consistent
# No mixing = no overlap issues from different sources
```

### 3. **[MEDIUM PRIORITY] Implement fix_direction Post-Processing**
The bbox3 runner kernel shows fix_direction as a standard post-processing step:
- Uses scipy.optimize.minimize_scalar to find optimal rotation angle
- Applies rotation to minimize bounding box
- Can provide 0.01-0.05 point improvements

### 4. **[LOWER PRIORITY] Research Fundamentally Different Approaches**
If the above don't work, research:
- Tessellation patterns for large N
- Asymmetric solutions (discussion says winning solutions will be asymmetric)
- Genetic algorithms with custom operators

## What NOT to Try
- ❌ Ensemble approach (mixing configurations from different sources)
- ❌ Any approach that requires local overlap validation
- ❌ Micro-optimizations (gap is too large)

## Validation Notes
- ONLY submit configurations that are IDENTICAL to known-good sources
- OR submit complete solutions generated by a single optimizer run
- DO NOT mix configurations from different sources

## Submission Strategy
- Remaining submissions: 93
- Submit after finding a better complete snapshot
- OR after running bbox3 to generate a new complete solution
