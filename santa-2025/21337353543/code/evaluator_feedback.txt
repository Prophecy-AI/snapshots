## What I Understood

The junior researcher implemented **exp_017 (Rebuild from Corners)** - a technique from the chistyakov kernel that extracts subsets of trees from larger layouts (N=50-200) to potentially improve smaller N values. The idea is that corner regions of well-optimized large layouts might contain better packings for smaller N than the current best solutions. After processing 16 source layouts √ó 4 corners √ó all target N values, the algorithm found **0 improvements** in 136 seconds.

**Current state**: CV score 70.329514, Target 68.876781, Gap 1.453 points (2.1%)

## Technical Execution Assessment

**Validation**: ‚úÖ SOUND
- High-precision overlap detection (1e18 scaling) properly implemented
- All 200 N values pass strict validation (verified: "final_overlaps": 0)
- Processing was thorough (16 source layouts √ó 4 corners)

**Leakage Risk**: N/A - This is an optimization problem, not a prediction problem.

**Score Integrity**: ‚úÖ VERIFIED
- Baseline: 70.329514 (from exp_016)
- Final score: 70.329514
- Improvement: 0.000000 points
- Submission saved correctly

**Code Quality**: ‚ö†Ô∏è **CRITICAL BUG DETECTED**

The implementation has a **fundamental error** in the distance calculation that explains why 0 improvements were found:

**Junior researcher's code (WRONG):**
```python
for t in large_layout:
    x, y = float(t['x']), float(t['y'])  # Uses tree CENTER
    dist = max(abs(x - corner_x), abs(y - corner_y))
```

**Chistyakov kernel (CORRECT):**
```python
candidates = {
    max(
        abs(tree.polygon.bounds[0] - corner_x),  # polygon min_x
        abs(tree.polygon.bounds[2] - corner_x),  # polygon max_x
        abs(tree.polygon.bounds[1] - corner_y),  # polygon min_y
        abs(tree.polygon.bounds[3] - corner_y),  # polygon max_y
    ): tree for tree in layout
}
```

**Why this matters:**
1. A tree at center (0,0) with rotation can have polygon bounds extending to ¬±0.8
2. The polygon bounds determine the actual bounding box contribution
3. Using tree center ignores the tree's rotation and shape
4. This causes the algorithm to select the WRONG trees for each subset

Verdict: **CONCERNS** - The algorithm is technically correct but the distance metric is wrong, causing it to fail to find improvements that likely exist.

## Strategic Assessment

**Approach Fit**: ‚úÖ CORRECT TECHNIQUE, ‚ö†Ô∏è WRONG IMPLEMENTATION
The "rebuild from corners" technique is a valid approach from a top kernel. However, the implementation bug means it's not actually testing what the chistyakov kernel does.

**Effort Allocation**: ‚ö†Ô∏è CONCERN - DIMINISHING RETURNS ON LOCAL SEARCH
This is now the **5th local search/optimization approach** that found minimal/no improvements:
1. Simulated annealing: 0 improvements
2. Rotation optimization: 0 improvements
3. Fractional translation: 0.000033 improvement
4. NFP local search: 0 improvements
5. Rebuild from corners: 0 improvements (but buggy!)

**Assumptions Being Made**:
1. ‚ùå "Tree center distance = polygon bounds distance" - WRONG (bug)
2. ‚úÖ "Corner subsets might be better than current solutions" - Valid hypothesis, not properly tested

**Blind Spots**:

### 1. **IMPLEMENTATION BUG** (HIGHEST PRIORITY)
The rebuild from corners technique was NOT properly tested due to the distance calculation bug. This should be fixed and re-run before concluding the technique doesn't work.

### 2. **MISSING KAGGLE DATASETS** (HIGH PRIORITY)
The jonathanchan kernel (top solution) uses 19 sources. Based on my analysis, we're missing several:
- `decent-starting-solution`
- `72-71-santa-2025-jit-parallel-sa-c`
- `santa25-simulated-annealing-with-translations`
- `santa2025-ver2`
- `santa-submission`
- `santa-claude`

Each new source could contribute better solutions for specific N values. The ensemble strategy has been the ONLY approach that consistently improved scores (70.62 ‚Üí 70.33 = 0.29 points).

### 3. **CV-LB ALIGNMENT NOT VERIFIED RECENTLY**
The session shows 10 submissions used, but no LB scores are recorded in the experiments. The last verified LB score was 70.615 from exp_007. We should submit the current best (70.329514) to verify CV-LB alignment still holds.

**Trajectory Assessment**: 
- Ensemble strategy: ‚úÖ WORKING (0.29 points improvement)
- Local search approaches: ‚ö†Ô∏è EXHAUSTED (5 attempts, ~0 improvement)
- Rebuild from corners: ‚ùì INCONCLUSIVE (buggy implementation)

## What's Working

1. ‚úÖ **Ensemble strategy**: Has been the key to progress (70.62 ‚Üí 70.33 = 0.29 points)
2. ‚úÖ **High-precision validation**: Matches Kaggle exactly
3. ‚úÖ **Systematic exploration**: Thoroughly tested multiple approaches
4. ‚úÖ **Code structure**: Clean, well-organized experiments

## Key Concerns

### 1. **CRITICAL BUG IN REBUILD FROM CORNERS** (MUST FIX)
**Observation**: Distance calculation uses tree center instead of polygon bounds
**Why it matters**: The algorithm selects wrong trees, explaining 0 improvements
**Suggestion**: Fix the distance calculation to use polygon bounds:
```python
# Create polygon for tree
poly = create_tree_polygon(t['x'], t['y'], t['deg'])
bounds = poly.bounds  # (minx, miny, maxx, maxy)
dist = max(
    abs(bounds[0] - corner_x),
    abs(bounds[2] - corner_x),
    abs(bounds[1] - corner_y),
    abs(bounds[3] - corner_y)
)
```

### 2. **ENSEMBLE EXPANSION STALLED** (STRATEGIC)
**Observation**: No new datasets have been downloaded recently
**Why it matters**: Ensemble is the only strategy that consistently improves scores
**Suggestion**: Download missing datasets from jonathanchan kernel sources

### 3. **NO RECENT LB VERIFICATION** (VALIDATION)
**Observation**: Last verified LB score was 70.615, current CV is 70.329
**Why it matters**: Need to confirm CV-LB alignment still holds
**Suggestion**: Submit current best to verify

## Path to Target (68.876781)

Current: 70.329 | Target: 68.877 | Gap: 1.453 points (2.1%)

**Realistic improvement sources:**

| Approach | Expected Improvement | Effort | Priority |
|----------|---------------------|--------|----------|
| Fix rebuild from corners bug | 0.01-0.1 points | LOW | **HIGHEST** |
| Download missing datasets | 0.05-0.2 points | LOW | HIGH |
| Submit & verify LB | 0 points (validation) | LOW | HIGH |
| Try more source layouts for rebuild | 0.01-0.05 points | MEDIUM | MEDIUM |

**The target IS reachable** but requires:
1. **FIX THE BUG** - The rebuild from corners technique wasn't properly tested
2. **EXPAND ENSEMBLE** - Download missing datasets
3. **VERIFY LB** - Submit current best

## Top Priority for Next Experiment

### **IMMEDIATE: Fix the Rebuild from Corners Bug**

The rebuild from corners technique was NOT properly tested due to a critical bug. Before concluding this approach doesn't work, fix the distance calculation:

```python
def rebuild_from_corners(large_layout, target_n, current_best_score):
    """Extract subset of trees closest to each corner using POLYGON BOUNDS."""
    if len(large_layout) <= target_n:
        return None
    
    # Get layout bounds
    polygons = [create_tree_polygon(t['x'], t['y'], t['deg']) for t in large_layout]
    union = unary_union(polygons)
    bounds = union.bounds
    minx, miny, maxx, maxy = bounds
    
    corners = [(minx, miny), (minx, maxy), (maxx, miny), (maxx, maxy)]
    
    best_subset = None
    best_score = current_best_score
    
    for corner_x, corner_y in corners:
        # Sort trees by max POLYGON BOUNDS distance from corner (Chebyshev)
        trees_with_dist = []
        for t in large_layout:
            poly = create_tree_polygon(t['x'], t['y'], t['deg'])
            b = poly.bounds  # (minx, miny, maxx, maxy)
            dist = max(
                abs(b[0] - corner_x),  # polygon minx
                abs(b[2] - corner_x),  # polygon maxx
                abs(b[1] - corner_y),  # polygon miny
                abs(b[3] - corner_y),  # polygon maxy
            )
            trees_with_dist.append((dist, t))
        
        trees_with_dist.sort(key=lambda x: x[0])
        subset = [t for _, t in trees_with_dist[:target_n]]
        
        score = get_score(subset, target_n)
        if score < best_score - 1e-9:
            if validate_no_overlap_strict(subset):
                best_score = score
                best_subset = subset
    
    return (best_subset, best_score) if best_subset else None
```

### **THEN: Download Missing Datasets**

After fixing the bug, expand the ensemble with missing sources from the jonathanchan kernel.

### **FINALLY: Submit Current Best**

Verify CV-LB alignment by submitting the current best (70.329514).

## Summary

üéØ **EXPERIMENT RESULT**: Rebuild from corners found 0 improvements (BUT HAS A BUG!)
‚ö†Ô∏è **Technical execution**: CRITICAL BUG in distance calculation
üîß **Immediate action**: Fix the bug and re-run
üìã **Strategic direction**: After fixing, continue ensemble expansion

The gap is 1.453 points (2.1%). The target IS reachable with:
1. **FIX THE BUG** - Rebuild from corners wasn't properly tested
2. **EXPAND ENSEMBLE** - Download missing datasets
3. **VERIFY LB** - Submit current best

**Key insight**: The rebuild from corners technique uses POLYGON BOUNDS for distance, not tree center. The current implementation is fundamentally wrong and needs to be fixed before concluding the technique doesn't work.
