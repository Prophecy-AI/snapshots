## Current Status
- Best CV score: 70.365091 from exp_010 (safe ensemble)
- Best LB score: 70.365091 (exp_010 - PASSED Kaggle validation)
- Target: 68.878195 | Gap to target: 1.49 points (2.1%)

## Submission Log
| Exp | Approach | CV | LB | Notes |
|-----|----------|----|----|-------|
| 001 | valid_baseline | 70.615 | 70.615 | First valid submission |
| 002 | backward_prop | 70.615 | 70.615 | No improvement |
| 010 | safe_ensemble | 70.365 | 70.365 | ✅ BEST VALID - passed Kaggle |
| 013 | selective_threshold | 70.342 | FAILED | Overlap in N=89 |
| 015 | bbox3_aggressive | 70.365 | pending | Only 0.000045 improvement |

## What We've Learned
1. **Local optimum**: bbox3, SA, fractional translation all give < 0.001 improvement
2. **External data is key**: saspav santa-2025.csv scores 70.331 (better than our 70.365!)
3. **Mega-ensemble potential**: Combining sources gives 70.353 (0.012 improvement)
4. **MIN_IMPROVEMENT=0.001 is critical**: Smaller improvements fail Kaggle validation

## Response to Evaluator
The evaluator correctly identified that:
1. bbox3 parameters were not logged - we need to run with explicit -n and -r flags
2. External data sources are limited - I've now downloaded 4 more datasets
3. The 0.000045 improvement is too small to submit

**Key insight from analysis**: The saspav santa-2025.csv dataset (updated Jan 26) has 71 N values better than our exp_010, with total potential improvement of 0.037 points. This is the path forward.

## ⛔ FORBIDDEN (WILL BE REJECTED)
- bbox3, sa_fast, eazy_optimizer with default parameters - FORBIDDEN
- Improvements < 0.001 per N value - WILL FAIL KAGGLE
- Submitting without strict overlap validation - WILL FAIL KAGGLE

## ✅ NEXT EXPERIMENT: MEGA-ENSEMBLE FROM EXTERNAL DATA

**CRITICAL**: The saspav dataset (70.331) is BETTER than our exp_010 (70.365)!

### Step 1: Create mega-ensemble
```python
sources = {
    'exp_010': '/home/code/experiments/010_safe_ensemble/submission.csv',
    'saspav': '/home/code/external_data/saspav_csv/santa-2025.csv',
    'bucket_of_chump': '/home/code/external_data/bucket_of_chump/submission.csv',
    '70.378': '/home/code/external_data/chistyakov/70.378875862989_20260126_045659.csv',
}

# For each N, pick the best valid solution with improvement > 0.001
MIN_IMPROVEMENT = 0.001  # CRITICAL: smaller improvements fail Kaggle
```

### Step 2: Validate strictly
```python
from decimal import Decimal, getcontext
getcontext().prec = 30
SCALE = 10**18

def validate_no_overlap_strict(trees):
    # Use integer arithmetic with SCALE=10^18 for precision
    # This matches Kaggle's validation
```

### Step 3: Run bbox3 with PROPER parameters
```bash
# Top kernels use:
./bbox3 -n 2000 -r 60  # 2000 iterations, 60 restarts
# NOT just ./bbox3 with defaults!
```

### Step 4: Apply fix_direction rotation tightening
```python
from scipy.optimize import minimize_scalar
from scipy.spatial import ConvexHull

def fix_direction(trees):
    # Get convex hull of all tree polygons
    # Find rotation angle that minimizes bounding box
    # Apply rotation to all trees
```

## Expected Outcome
- Mega-ensemble from external data: 70.353 (improvement of 0.012)
- After bbox3 with proper parameters: potentially 70.34-70.35
- After fix_direction: potentially 70.33-70.34

## What NOT to Try
- Running bbox3 with default parameters (already tried, only 0.000045 improvement)
- Improvements < 0.001 per N (will fail Kaggle validation)
- SA/fractional translation on existing solutions (already at local optimum)

## Key Files
- External data: /home/code/external_data/saspav_csv/santa-2025.csv (BEST external)
- Current best: /home/code/experiments/010_safe_ensemble/submission.csv
- bbox3 binary: /home/code/experiments/bbox3

## SUBMIT AFTER CREATING MEGA-ENSEMBLE
Even if CV is only 70.353, SUBMIT IT to get LB feedback!
We have 96 submissions remaining - use them!
