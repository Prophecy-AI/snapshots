# Santa 2025 - Evolved Seed Prompt (Loop 1)

## Current Status
- Best CV score: 70.676102 from valid submission (santa-2025-csv/santa-2025.csv)
- Best LB score: N/A (previous submission failed due to overlaps)
- Target: 68.894234 | Gap to target: 1.781868

## CRITICAL LESSON LEARNED
The previous submission FAILED because it had overlapping trees that our validation missed.
- The official metric uses `scale_factor = Decimal('1e18')` for high precision
- Our initial validation used lower precision and missed 9 overlapping groups
- **ALWAYS validate with the exact metric method before submitting**

## Response to Evaluator
The evaluator correctly identified that:
1. The bbox3 optimizer is available and should be used
2. Better pre-optimized submissions may exist in snapshots
3. We need to submit to verify local score matches LB

However, the evaluator missed that the snapshot submission had OVERLAPPING TREES that would fail validation. This is now fixed - we found a valid submission with score 70.676102.

## Valid Submissions Found (VERIFIED NO OVERLAPS)
1. **santa-2025-csv/santa-2025.csv**: score=70.676102 ← BEST, currently in /home/submission/
2. chistyakov/submission_best.csv: score=70.926150
3. telegram/71.97.csv: score=71.972027
4. santa25-public/submission_JKoT2.csv: score=72.489348

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Submit the valid baseline to get LB feedback
- We have a valid submission with score 70.676102
- Submit to verify local score matches LB
- This establishes our baseline for improvement

### 2. **[HIGH PRIORITY]** Run bbox3 optimizer on the valid submission
- bbox3 is available at /home/code/bbox3
- Run with parameters: `./bbox3 -n 3000 -r 60`
- **CRITICAL**: After optimization, validate with metric precision before submitting

### 3. **[MEDIUM PRIORITY]** Fix overlapping configurations in better submissions
- The snapshot submission (70.615745) is better but has 9 overlapping groups
- Could potentially fix these overlaps and get a better score
- Overlapping groups: 004, 018, 025, 031, 042, 048, 066, 070, 126

### 4. **[MEDIUM PRIORITY]** Implement rotation optimization (fix_direction)
- Optimize global rotation angle to minimize bounding box
- Apply to all configurations after SA optimization

## What NOT to Try
- ❌ Submitting without metric-precision validation
- ❌ Using the snapshot submission directly (has overlaps)
- ❌ Low-precision overlap checking

## Validation Code (MUST USE)
```python
from decimal import Decimal, getcontext
from shapely import affinity
from shapely.geometry import Polygon
from shapely.strtree import STRtree

getcontext().prec = 25
scale_factor = Decimal('1e18')

# Use ChristmasTreeMetric class from official metric
# Check: poly.intersects(other) and not poly.touches(other)
```

## SUBMISSION STRATEGY
- Remaining submissions: 98
- Submit after this experiment? **YES** - we need LB feedback on the valid baseline
- Then continue optimizing with bbox3

## Key Files
- Valid submission: /home/submission/submission.csv (score 70.676102)
- bbox3 optimizer: /home/code/bbox3
- Official metric: research/kernels/metric_santa-2025-metric/santa-2025-metric.ipynb
