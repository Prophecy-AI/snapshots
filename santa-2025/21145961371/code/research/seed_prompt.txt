# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 5)

## Current Status
- Best CV score: 70.676102 from exp_000 (baseline)
- Best LB score: 70.676102 (confirmed via 2 submissions)
- Target: 68.919154 | Gap to target: 1.757 points (2.55%)
- Submissions remaining: 93 (ABUNDANT - submit after every experiment!)

## CV-LB Relationship
- CV matches LB exactly (gap: 0.000002)
- Our scoring function is accurate
- No distribution shift concerns - this is an optimization problem

## Response to Evaluator Feedback

The evaluator correctly identified critical issues with experiment 005:

1. **bbox3 was run with insufficient iterations**: We used -n 10000 -r 16 (160k total iterations), but the seshurajup kernel uses -n 50000 -r 80 (4M iterations). This is 25x fewer iterations than needed.

2. **Lattice configs were NOT optimized**: We compared raw lattice placements to optimized baseline. The egortrushin kernel shows that lattice configs are STARTING POINTS that must be optimized with SA. Without optimization, lattice configs are 2-4x worse than baseline.

3. **The parallel SA optimizer hasn't been tried**: The seshurajup kernel has a sophisticated C++ optimizer (sa_v1_parallel.cpp) with:
   - Multi-threaded optimization (OpenMP)
   - Population-based approach (maintains 3 best solutions)
   - Fractional translation refinement
   - Multiple generations of optimization
   
**I AGREE with the evaluator's assessment.** We need to:
1. Extract and compile sa_v1_parallel.cpp from the seshurajup kernel
2. Run it with proper parameters (-n 50000 -r 80)
3. Let it run for multiple generations

## What's Been Tried (All Failed)
1. **exp_000**: Baseline from pre-optimized CSV - 70.676102
2. **exp_001**: Full ensemble from 30 CSVs - same score (overlap error on submission)
3. **exp_002**: Deletion cascade - no improvement
4. **exp_003**: Random initialization - much worse (7x worse for N=10)
5. **exp_004**: bbox3 (too short) + lattice (no SA) - no improvement

## Key Insight: The Baseline is at a STRONG Local Optimum
All experiments confirm that the pre-optimized solutions are at a very strong local optimum:
- Local search (bbox3) cannot escape it
- Deletion cascade cannot improve it
- Random initialization produces much worse results
- Simple lattice patterns are 2-4x worse

## CRITICAL: What Hasn't Been Tried Yet

### 1. **HIGHEST PRIORITY: Parallel SA Optimizer from Seshurajup Kernel**
The sa_v1_parallel.cpp has sophisticated features we haven't used:
- `sa_v3()`: Simulated annealing with proper temperature schedule
- `ls_v3()`: Local search with 300 iterations
- `fractional_translation()`: Fine-grained position refinement (150 iterations)
- `opt_v3()`: Multi-restart with population of 3 best solutions
- OpenMP parallelization across N values

**Implementation:**
```bash
# Step 1: Extract C++ code from notebook (it's in a %%writefile cell)
# Step 2: Compile with OpenMP
g++ -O3 -march=native -std=c++17 -fopenmp -o sa_v1_parallel sa_v1_parallel.cpp

# Step 3: Run on baseline with proper parameters
./sa_v1_parallel -i baseline.csv -o optimized.csv -n 50000 -r 80

# Step 4: Let it run for multiple generations (the code has an endless loop)
```

### 2. **HIGH PRIORITY: Egortrushin Lattice + SA Approach**
The egortrushin kernel shows how to properly use lattice initialization:
- Create 2 initial trees with specific positions and angles
- SA optimizes the translation parameters (dx, dy) and angles
- This explores DIFFERENT SOLUTION BASINS than the baseline

**Key insight**: The SA doesn't just place trees on a grid - it OPTIMIZES the grid parameters.

### 3. **MEDIUM PRIORITY: Longer bbox3 Runs**
If the parallel SA doesn't work, try bbox3 with proper parameters:
- At least -n 50000 -r 80 (4M iterations)
- Multiple generations
- Different random seeds

## Recommended Approaches (Priority Order)

1. **[HIGHEST PRIORITY]** Extract and run sa_v1_parallel.cpp from seshurajup kernel
   - This is the most sophisticated optimizer available
   - It achieved 71.78 score (worse than our baseline, but it was starting from a different point)
   - The key is the fractional_translation refinement

2. **[HIGH PRIORITY]** Implement egortrushin lattice + SA for large N (72, 100, 144, 156, 196, 200)
   - SA optimizes translation parameters, not just places trees
   - This explores different solution basins

3. **[MEDIUM PRIORITY]** Run bbox3 with 50k+ iterations and 80+ rounds
   - Our previous run was 25x too short

## What NOT to Try
- ❌ Random initialization without optimization (produces much worse results)
- ❌ Lattice initialization without SA optimization (2-4x worse)
- ❌ bbox3 with fewer than 50,000 iterations (insufficient)
- ❌ Deletion cascade (already tried, no improvement)
- ❌ Ensemble of pre-optimized solutions (all converge to same optimum)

## Validation Notes
- CV matches LB exactly - our scoring function is accurate
- Use %.18f precision when saving CSV to avoid overlap errors
- Always verify no overlaps before submission

## SUBMISSION STRATEGY
- Remaining submissions: 93 (ABUNDANT!)
- Submit after EVERY experiment to get LB feedback
- LB feedback is free information - use it!
