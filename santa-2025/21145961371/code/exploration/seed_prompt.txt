# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 1)

## Current Status
- Best CV score: 70.676102 from exp_000 (001_baseline)
- Best LB score: 70.6761 (submitted and verified)
- Target: 68.919154 | Gap to target: 1.757 points (2.55%)
- CV-LB Gap: ~0 (scoring is accurate)

## Response to Evaluator

The evaluator correctly identified:
1. **Baseline established correctly** at 70.676102 with no overlaps
2. **Local search yields minimal improvement** - bbox3, SA, backward propagation all give ~0 improvement on pre-optimized solutions
3. **Deletion cascade should be highest priority** - generates novel small-N configurations
4. **Per-N analysis needed** - small N values contribute disproportionately

**I agree with all recommendations.** The LB submission confirms our scoring is accurate (CV-LB gap ≈ 0).

## Key Insights from Research

### From Top Kernels:
1. **Ensemble approach** (jonathanchan kernel) - Combines best per-N from 15+ sources
2. **SA with fractional translation** - Fine-tune with steps as small as 0.00001
3. **Backward iteration (BackPacking)** - Propagate good configs from large N to small N
4. **Multiple restarts** - Different initial configurations explore different basins

### Available Resources:
- **30 pre-optimized CSVs** in /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/
- **Key sources**: bucket-of-chump, santa25-public (16 files), telegram (72.49.csv, 71.97.csv)
- **bbox3 C++ optimizer** already compiled
- **Research kernels** with SA, ensemble, backpacking code

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Full Ensemble from ALL Sources**
The current baseline may not be using all available sources. Create a comprehensive ensemble:
```python
sources = [
    '/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bucket-of-chump/',
    '/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa25-public/',
    '/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/telegram/',
    '/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/chistyakov/',
    '/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/blended/',
]
# For each N, select the configuration with smallest bounding box
```
Expected improvement: 0.1-0.3 points if sources aren't fully combined yet.

### 2. **[HIGH PRIORITY] Deletion Cascade Algorithm**
Generate better small-N configurations by removing trees from large-N configs:
```python
for n in range(200, 1, -1):
    config = best_configs[n]
    for i in range(n):
        new_config = remove_tree(config, i)
        new_score = calculate_bbox_score(new_config, n-1)
        if new_score < best_configs[n-1].score:
            best_configs[n-1] = new_config
```
Expected improvement: 0.15-0.3 points for small N values.

### 3. **[HIGH PRIORITY] SA with Fractional Translation**
Apply fine-grained optimization to the ensemble:
- Use step sizes: 0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001
- Try 8 directions: N, S, E, W, NE, NW, SE, SW
- Focus on boundary trees (those defining the bounding box)
Expected improvement: 0.05-0.1 points.

### 4. **[MEDIUM PRIORITY] Multi-Start Random for Small N (N=1-20)**
Small N contributes disproportionately:
- N=1: 0.661 (almost 1% of total)
- N=1-10: 6.1% of total
- N=1-50: 26.9% of total

Run 100+ random restarts for each small N, then SA optimize.

### 5. **[MEDIUM PRIORITY] Grid/Lattice Initialization for Large N**
For N > 100, try crystalline packing patterns:
- Hexagonal lattice
- Square lattice with alternating orientations
- Run SA to refine after initialization

## What NOT to Try
- ❌ Running bbox3 on pre-optimized solutions (yields 0 improvement)
- ❌ More SA iterations on existing solutions without new initialization
- ❌ Simple corner extraction (only 0.0006 improvement)

## SUBMISSION STRATEGY
- Remaining submissions: 94
- **Submit after EVERY experiment** - We have abundant submissions
- LB feedback is free information - USE IT!

## Validation Notes
- Score = sum of (side²/N) for N=1 to 200
- No overlaps allowed (touching is OK)
- CV-LB gap is ~0, so CV is reliable
- Use Shapely STRtree for efficient collision detection

## Next Experiment: 002_full_ensemble
1. Load ALL 30 CSV files from preoptimized directory
2. For each N=1 to 200, select configuration with smallest bounding box
3. Apply fix_direction rotation optimization
4. Calculate total score
5. Submit if improved over baseline
