# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.6761 from exp_000 (001_baseline)
- Best LB score: 70.6761 (verified - CV=LB gap is 0.0000)
- Target: 68.919154 | Gap to target: 1.757 points (2.55%)

## CV-LB Relationship Analysis
- Only 1 submission so far, but CV=LB exactly
- Local score calculation is perfectly accurate
- We can trust local optimization results

## Response to Evaluator
The evaluator correctly identified:
1. **bbox3 can be compiled from source** - DONE! Compiled successfully.
2. **N=1 optimization** - Verified: N=1 is ALREADY optimal at 45 degrees (score=0.6612). No improvement possible here.
3. **Long optimization runs needed** - Agreed. This is the key next step.

The evaluator's top priority was "COMPILE AND RUN THE OPTIMIZER" - I agree this is the right approach.

## Key Findings from Analysis

### Score Distribution
- N=1 contributes 0.6612 (highest single contributor) - ALREADY OPTIMAL
- N=2-15 contribute ~5.8 points total - LOW EFFICIENCY (37-65%)
- Small N values have the most room for improvement

### Packing Efficiency (lower = more room for improvement)
- N=1: 37.1% (but already optimal at 45°)
- N=2: 54.5%
- N=3: 56.5%
- N=4-5: ~59%
- N=6-7: ~61%

### Available Resources
- bbox3 optimizer: COMPILED and ready at /home/code/bbox3
- Pre-optimized baseline: /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa-2025.csv (70.6761)
- Jonathan Chan kernel: Has sophisticated SA + fractional translation + multi-generation approach

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Run bbox3 Optimizer with Long Parameters**
The baseline is at a local optimum. We need to run the optimizer for HOURS to escape.

```bash
cd /home/code
cp /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa-2025.csv ./input.csv
./bbox3 -n 10000 -r 128 input.csv output.csv
```

Start with medium run (10-30 min) to verify it works, then run longer.

### 2. **[HIGH PRIORITY] Implement Jonathan Chan's SA + Fractional Translation**
The kernel at research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation shows:
- SA with perturb, local search, fractional translation
- Multi-generation optimization with population-based search
- Key insight: fractional_translation() gives micro-improvements after SA

Extract and compile the C++ optimizer from this kernel.

### 3. **[MEDIUM PRIORITY] Focus on Small N (2-15) Optimization**
These have lowest efficiency and highest score contribution:
- Try exhaustive search for N=2, N=3 (small enough to brute force)
- For N=2: Try all angle combinations in 1° increments
- For N=3: Try systematic placement patterns

### 4. **[MEDIUM PRIORITY] Ensemble from Multiple Sources**
The Jonathan Chan kernel shows how to ensemble:
- Take best N from multiple pre-optimized files
- Run SA on the ensemble
- Apply fractional translation

### 5. **[LOWER PRIORITY] Tessellation for Large N**
For N >= 58, tessellation patterns may work better than random optimization.
But this is lower priority since large N contributes less to score.

## What NOT to Try
- N=1 optimization (already optimal at 45°)
- Simple ensemble without optimization (all files converge to same local optimum)
- Short optimization runs (< 5 minutes) - won't escape local optimum
- Micro-optimizations on pre-optimized submission

## Technical Notes
- bbox3 uses OpenMP: check threads with `nproc` (likely 2-4 available)
- Score formula: Σ(s_n²/n) for n=1 to 200
- Tree geometry: 15-vertex polygon, area=0.2456
- Coordinates must be in [-100, 100]

## Submission Strategy
- Remaining submissions: 90 (abundant!)
- Submit after EVERY experiment to get LB feedback
- Even if score doesn't improve, LB feedback is valuable

## Validation Notes
- CV scheme: Calculate total score using Shapely for polygon geometry
- CV=LB gap is 0.0000, so local scores are trustworthy
