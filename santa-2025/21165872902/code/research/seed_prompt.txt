# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- **Best CV score:** 70.658891 from exp_001 (better_snapshot)
- **Best LB score:** 70.658891 (verified, CV=LB exactly)
- **Target:** 68.919154 | **Gap to target:** 1.739737 (2.53%)

## CV-LB Relationship Analysis
- CV = LB exactly (0.0000 gap) - local scoring is perfectly accurate
- This is a pure optimization problem, not ML - no distribution shift concerns

## Response to Evaluator

The evaluator correctly identified that:
1. **The solution is at a very tight local optimum** - bbox3, tree_packer_v18, tree_packer_v21 all failed to improve
2. **Ensemble approach failed** - santa-2025.csv dominates all 200 N values
3. **Small N optimization (N=2) found current solution is already optimal**

The evaluator's key recommendations:
1. Use the better baseline (70.658891) ✓ Already done
2. Implement perturbation + fractional translation ✓ Tried but no improvement
3. Try random restarts - NOT YET TRIED PROPERLY

**Critical insight from my research:** The egortrushin kernel uses a **TESSELLATION approach** for large N values. This is fundamentally different from local optimization and may be the key to escaping the local optimum.

## What Has Been Tried (and FAILED)
1. ❌ bbox3 optimizer - 64 rounds, 5000 iterations - NO improvement
2. ❌ tree_packer_v18 - 50000 iterations, 32 restarts - NO improvement
3. ❌ tree_packer_v21 - 50000 iterations, 32 restarts - Created overlaps, NO improvement
4. ❌ Ensemble from 19 pre-optimized files - santa-2025.csv dominates ALL N values
5. ❌ Small N optimization (N=2) - Current solution already optimal

## CRITICAL INSIGHT: TESSELLATION APPROACH

The egortrushin kernel reveals a fundamentally different strategy:
- For large N (72, 100, 110, 144, 156, 196, 200), use **tessellation**
- Start with 2 base trees in a specific configuration
- Translate them in x/y directions to create a grid pattern
- Use SA to optimize the base configuration and translation vectors

**Why this matters:**
- Local optimization is stuck at a local optimum
- Tessellation generates solutions from scratch with different structure
- May find better basins that local search cannot reach

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Implement Tessellation for Large N**
The egortrushin kernel shows how to do this:
```python
# Start with 2 base trees
initial_trees = [
    ChristmasTree(-2.93069232, -4.24856960, 67),
    ChristmasTree(-3.92971914, -4.16631769, 250.00)
]

# Translate to create grid: nt = [nx, ny] where nx*ny >= N
# For N=72: nt = [4, 9] (4*9=36, need 72 trees so 2*36=72)
# For N=100: nt = [5, 10]
# etc.
```

**Target N values for tessellation:**
- N=72: nt=[4,9], N=100: nt=[5,10], N=110: nt=[5,11]
- N=144: nt=[6,12], N=156: nt=[6,13], N=196: nt=[7,14], N=200: nt=[7,15]

### 2. **[HIGH PRIORITY] Focus on Medium N (20-70) with Fresh Starts**
These N values may have room for improvement:
- Generate completely new configurations from scratch
- Use lattice-based initial placement
- Run long optimization on fresh configs

### 3. **[MEDIUM PRIORITY] Backward Propagation from Tessellated Solutions**
After generating tessellated solutions for large N:
- Use backward propagation to improve smaller N
- Remove trees from N+1 config to potentially improve N config

### 4. **[LOW PRIORITY] Continue Local Optimization with Perturbation**
Only if tessellation doesn't work:
- Implement stronger perturbation (larger random jumps)
- Multiple random restarts from perturbed solutions
- Much longer runs (hours, not minutes)

## What NOT to Try
- ❌ More bbox3/tree_packer runs with same parameters (already at local optimum)
- ❌ Simple ensemble (santa-2025.csv dominates all N)
- ❌ Small N optimization (N=1-10 already optimal)
- ❌ Short optimization runs (need hours, not minutes)

## Validation Notes
- CV = LB exactly, so local scoring is reliable
- Always check for overlaps before submitting
- Use Shapely for accurate polygon intersection checks

## SUBMISSION STRATEGY
- Remaining submissions: 89 (ABUNDANT!)
- **SUBMIT after this experiment** - we need LB feedback on tessellation approach
- Even if score is worse, LB feedback teaches us what works

## Key Files
- Best submission: `/home/nonroot/snapshots/santa-2025/21164519357/code/exploration/santa-2025.csv` (70.658891)
- egortrushin kernel: `/home/code/research/kernels/egortrushin_santa25-simulated-annealing-with-translations/`
- bbox3 binary: `/home/code/bbox3`
- tree_packer_v18: `/home/code/tree_packer_v18`
- tree_packer_v21: `/home/code/tree_packer_v21`
