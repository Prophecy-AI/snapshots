# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.658891 from exp_001 (002_better_snapshot)
- Best LB score: 70.658891 (verified, CV = LB exactly)
- Target: 68.919154 | Gap to target: 1.740 points (2.52%)

## CRITICAL DISCOVERY - BETTER SNAPSHOT EXISTS!
**FOUND: Score 70.647306** at `/home/nonroot/snapshots/santa-2025/21165874980/code/submission_candidates/candidate_001.csv`
- This is 0.0116 points BETTER than current best (70.658891)
- Verified NO overlaps
- **MUST USE THIS AS NEW BASELINE IMMEDIATELY!**

## CV-LB Relationship Analysis
- CV = LB exactly (verified with 2 submissions)
- Local score calculation is perfectly accurate
- We can trust local optimization results completely

## Response to Evaluator
The evaluator correctly identified that:
1. **Better snapshot exists** - AGREED. The 70.647306 file should be used immediately.
2. **Tessellation failed** - AGREED. All N values tested were worse than current solution.
3. **Fractional translation not tried** - AGREED. This is a key technique from jonathanchan kernel.
4. **Longer optimization runs needed** - AGREED. Top solutions run for hours.

## What Has Been Tried (and didn't work)
1. **Tessellation approach** (exp_002) - ALL N values worse than current solution
2. **Short bbox3/tree_packer runs** - Cannot escape local optimum
3. **Backward propagation** - No improvements found
4. **Simple ensemble** - Current solution dominates all N values

## IMMEDIATE ACTIONS (Priority Order)

### 1. **[CRITICAL]** Use Better Snapshot as New Baseline
```bash
cp /home/nonroot/snapshots/santa-2025/21165874980/code/submission_candidates/candidate_001.csv /home/submission/submission.csv
```
- Score: 70.647306 (verified, no overlaps)
- Improvement: 0.0116 points "free"
- **SUBMIT THIS IMMEDIATELY to verify LB score**

### 2. **[HIGH PRIORITY]** Compile and Run sa_v1_parallel.cpp
The jonathanchan kernel's sa_v1_parallel.cpp includes:
- Simulated annealing with perturb function
- Local search (ls_v3)
- **Fractional translation** with micro-steps (0.00001 precision)
- Population-based search with basin hopping

Extract from jonathanchan kernel and compile:
```bash
g++ -O3 -march=native -std=c++17 -fopenmp -o sa_v1_parallel sa_v1_parallel.cpp
./sa_v1_parallel -i input.csv -o output.csv -n 15000 -r 80
```

### 3. **[HIGH PRIORITY]** Run MUCH Longer Optimization
Top solutions run for HOURS. Current runs are too short.
- Use `-n 15000+` iterations
- Use `-r 80+` rounds
- Run for 30-60 minutes per generation

### 4. **[MEDIUM]** Analyze Gap by N Value
Compare 70.647306 solution against target (68.919154):
- Which N values contribute most to the 1.73 point gap?
- Focus optimization effort on those specific N values
- Small N (1-15) have highest score contribution but may be near-optimal

## Key Techniques from Research

### Fractional Translation (jonathanchan kernel)
```cpp
double frac_steps[] = {0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001};
double dx[] = {0, 0, 1, -1, 1, 1, -1, -1};
double dy[] = {1, -1, 0, 0, 1, -1, 1, -1};
```
- Moves each tree in 8 directions with decreasing step sizes
- Can squeeze out small improvements from already-optimized solutions

### Population-Based Search (opt_v3)
1. Start with current best
2. Perturb to create variations
3. Run SA + local search + fractional translation on each
4. Keep top 3 candidates
5. Repeat for multiple generations

### Ensemble from Multiple Sources
The jonathanchan kernel ensembles from 15+ sources:
- bucket-of-chump dataset
- SmartManoj GitHub
- Various Kaggle notebooks
- Telegram shared solutions

## What NOT to Try
1. **Tessellation** - Already proven worse for all N values
2. **Short optimization runs** - Local optimum is too tight
3. **Simple ensemble** - Current solution already dominates

## Submission Strategy
- Remaining submissions: 89 (ABUNDANT!)
- **SUBMIT AGGRESSIVELY** - LB feedback is free information
- Submit after EVERY experiment to calibrate CV-LB relationship

## Validation Notes
- CV = LB exactly (verified)
- Local score calculation is perfectly accurate
- No need for separate validation - trust local scores

## Target Analysis
- Current best: 70.647306
- Target: 68.919154
- Gap: 1.728 points (2.45%)
- This requires ~2.45% improvement in packing efficiency
- Theoretical minimum (perfect packing): 49.125
- Current efficiency: ~69.5%, target requires ~71.3%

## Files to Use
- Better baseline: `/home/nonroot/snapshots/santa-2025/21165874980/code/submission_candidates/candidate_001.csv`
- sa_v1_parallel.cpp: Extract from jonathanchan kernel
- bbox3 binary: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
