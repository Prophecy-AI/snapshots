# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- **Best CV score:** 70.647306 (from snapshot 21165874980/candidate_001.csv)
- **Best LB score:** 70.658891 (exp_002 - but we have a BETTER local score now!)
- **Target:** 68.919154 | **Gap to target:** 1.728 points (2.51%)
- **Submissions remaining:** 88/100

## CRITICAL: Use the Better Baseline!
The better snapshot at `/home/nonroot/snapshots/santa-2025/21165874980/code/submission_candidates/candidate_001.csv` scores **70.647306** (verified, no overlaps). This is 0.0116 points better than the current LB best (70.658891).

**FIRST ACTION:** Submit this better baseline to verify LB score!

## CV-LB Relationship Analysis
- CV-LB gap is exactly 0.0000 for all submissions
- Local scoring is perfectly accurate
- We can trust local optimization results completely

## Response to Evaluator
The evaluator correctly identified:
1. **Better snapshot not being used** - AGREED. The 70.647306 solution should be our new baseline.
2. **Tessellation failed** - CONFIRMED. All N values were worse than current solution.
3. **Optimization strategies not aggressive enough** - PARTIALLY AGREE. But the solution is at a very tight local optimum.

**Key insight from analysis:** The better snapshot (70.647306) dominates the current best (70.658891) for ALL N values where they differ. There are no regressions. This means we should use it as our new baseline.

## What Has Been Tried (and didn't work)
1. **Tessellation approach** - ALL N values worse than current solution
2. **bbox3 optimizer** - Cannot improve pre-optimized solution
3. **tree_packer_v18/v21** - Creates overlaps or no improvement
4. **Ensemble from snapshots** - Better solutions have overlaps (invalid)
5. **Backward propagation** - No improvements found

## Gap Analysis by N Range
```
N=  1- 10: 4.3291 (6.1% of total)
N= 11- 20: 3.7263 (5.3% of total)
N= 21- 50: 10.9844 (15.6% of total)
N= 51-100: 17.6279 (25.0% of total)
N=101-150: 17.1366 (24.3% of total)
N=151-200: 16.8430 (23.8% of total)
```

## Recommended Approaches (Priority Order)

### 1. **[IMMEDIATE]** Submit the Better Baseline (70.647306)
- Copy `/home/nonroot/snapshots/santa-2025/21165874980/code/submission_candidates/candidate_001.csv` to submission
- Submit to verify LB score
- This is a FREE 0.0116 point improvement

### 2. **[HIGH PRIORITY]** Super-Fast SA with Translations (jiweiliu kernel)
The `jiweiliu/super-fast-simulated-annealing-with-translations` kernel uses:
- Numba JIT compilation for speed
- Grid-based translation approach
- SA optimization of seed positions and translation vectors
- This is fundamentally different from local optimization

**Implementation:**
- Fetch and adapt the kernel code
- Run on the better baseline
- Focus on large N values (51-200) where most score comes from

### 3. **[HIGH PRIORITY]** Rebuild from Corners (chistyakov kernel)
The `chistyakov/new-simple-fix-rebuild-large-layout-from-corners` kernel:
- Takes a large N layout
- Extracts subsets from corners
- Can find better solutions for smaller N values

**Implementation:**
- For each large N (e.g., 111, 150, 200)
- Extract trees from each corner
- Check if resulting (N-k) configuration beats stored solution

### 4. **[MEDIUM PRIORITY]** Fractional Translation Optimization
The jonathanchan kernel uses fractional_translation with steps:
[0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001]

This fine-grained optimization can squeeze out small improvements from already-optimized solutions.

### 5. **[MEDIUM PRIORITY]** Focus on High-Improvement N Values
From the comparison, these N values had the biggest improvements in the better snapshot:
- N=128: +0.0027
- N=94: +0.0022
- N=157: +0.0012
- N=14: +0.0009
- N=11: +0.0008

These might have more room for improvement with targeted optimization.

## What NOT to Try
- ❌ Tessellation approach (already failed for all N)
- ❌ Simple ensemble from snapshots (better solutions have overlaps)
- ❌ Short optimization runs (solution is at tight local optimum)
- ❌ Standard SA parameters (cannot escape local optimum)

## Submission Strategy
- **Remaining submissions:** 88
- **Submit after this experiment?** YES - submit the better baseline immediately!
- With 88 submissions remaining, we should submit after EVERY experiment

## Validation Notes
- CV scheme: Calculate score for all N=1-200
- CV-LB gap: Exactly 0.0000 (perfect accuracy)
- Overlap check: Required for all solutions

## Key Resources
- Better baseline: `/home/nonroot/snapshots/santa-2025/21165874980/code/submission_candidates/candidate_001.csv`
- Super-fast SA kernel: `research/kernels/jiweiliu_super-fast-simulated-annealing-with-translations/`
- Rebuild from corners kernel: `research/kernels/chistyakov_new-simple-fix-rebuild-large-layout-from-corners/`
- jonathanchan ensemble kernel: `research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/`