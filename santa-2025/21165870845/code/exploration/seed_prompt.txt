# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- **Best CV score**: 70.676102 from exp_000 (001_baseline)
- **Best LB score**: N/A (no submissions yet)
- **Target**: 68.919154 | **Gap to target**: 1.756948 (2.55%)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **NO** - We only have the pre-optimized CSV
- Top kernels identified:
  1. `saspav/santa-submission` (444 votes) - Uses bbox3 + fix_direction
  2. `yongsukprasertsuk/santa-2025-best-keeping-bbox3-runner` (369 votes) - 3-hour bbox3 runner
  3. `jazivxt/why-not` (303 votes) - bbox3 optimizer source
- Kernels we've implemented: None (just loaded pre-optimized CSV)
- **NEXT STEP**: Submit baseline to get LB feedback, then run bbox3 optimization

## Response to Evaluator
The evaluator correctly identified:
1. **Submit baseline first** - Agreed. We have 91 submissions remaining, should verify CV-LB correlation.
2. **N=1 is already at 45 degrees** - Confirmed via analysis. No improvement possible for N=1.
3. **Lattice approach not implemented** - This is the key untried technique for large N.
4. **Pre-optimized solution is near-optimal** - The gap of 1.76 points requires fundamentally different approaches.

## Key Findings from Analysis
1. **N=1 is optimal**: Already at 45 degrees (bbox=0.813173). No improvement possible.
2. **Lowest efficiency N values**: N=1-10 have the worst packing efficiency (1.5-2.6 trees/unit area)
3. **Score breakdown**: N=1-10: 4.33, N=11-50: 14.71, N=51-100: 17.64, N=101-150: 17.14, N=151-200: 16.85
4. **Theoretical minimum**: ~0.289 contribution per tree (vs current ~0.35 average)
5. **All pre-optimized CSVs score the same or worse** - santa-2025.csv is the best at 70.676102

## Recommended Approaches (Priority Order)

### 1. **[IMMEDIATE]** Submit Baseline to Kaggle
- We have 91 submissions remaining
- Need to verify CV-LB correlation before investing in optimization
- This is FREE information - use it!

### 2. **[HIGH PRIORITY]** Run bbox3 Optimizer with Long Runs
The top kernels use bbox3 with:
- `-n 1000-2000` iterations
- `-r 30-90` rounds
- Multiple phases (short → medium → long)
- fix_direction post-processing to tighten bounding boxes

**Implementation**: Use the bbox3 binary from preoptimized folder:
```bash
chmod +x /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3
./bbox3 -n 2000 -r 60
```

### 3. **[HIGH PRIORITY]** Lattice/Grid-Based Approach for Large N
For N >= 58, lattice patterns can achieve tighter packings:
- Start with 2 base trees in specific configuration
- Translate in x and y directions to create grid
- Key N values: 72, 100, 110, 144, 156, 196, 200

### 4. **[MEDIUM PRIORITY]** Exhaustive Angle Search for Small N (2-10)
- N=1 is already optimal
- For N=2-10, try exhaustive search over rotation angles
- These have highest per-tree score contribution

### 5. **[MEDIUM PRIORITY]** Asymmetric Solutions
- Discussion insight: Asymmetric solutions outperform symmetric ones
- New N=22 asymmetric config achieves <0.36 normalized area
- Try handcrafted asymmetric layouts for specific N values

## What NOT to Try
- ❌ Optimizing N=1 (already at 45 degrees, optimal)
- ❌ Simple ensemble (santa-2025.csv dominates all N values)
- ❌ Short optimization runs (<5 minutes) - need hours
- ❌ Backward propagation (already tried, no improvement)

## Technical Details

### bbox3 Optimizer
Located at: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
Key parameters:
- `-n`: Number of iterations (1000-2000 recommended)
- `-r`: Number of rounds (30-90 recommended)

### Submission Format
```csv
id,x,y,deg
001_0,s0.0,s0.0,s90.0
002_0,s0.0,s0.0,s90.0
002_1,s0.202736,s-0.511271,s90.0
```
- Values prefixed with 's' to preserve precision
- Coordinates must be in range [-100, 100]

### Tree Geometry
- 15 vertices
- Height: 1.0 (from -0.2 to 0.8)
- Width: 0.7 at base
- Single tree area: 0.245625 square units

## SUBMISSION STRATEGY
- Remaining submissions: 91
- **Submit after this experiment? YES** - We have abundant submissions
- LB feedback is FREE information - use it to calibrate CV-LB relationship

## Validation Notes
- CV scheme: Calculate score as Σ(s²/n) for n=1 to 200
- No overlapping trees allowed (Kaggle rejects overlapping submissions)
- Use Shapely polygon intersection checks for validation
