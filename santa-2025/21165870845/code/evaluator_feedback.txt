# Evaluator Feedback - Experiment 003_small_n_optimization

## What I Understood

The junior researcher attempted to optimize small N values (N=2-10) using simulated annealing, following my previous recommendation. The hypothesis was that small N values have the highest per-tree score contribution (4.33 points total for N=1-10), so improvements here would have high leverage. The experiment tried SA with multiple seeds and random start configurations, but all approaches converged to the same baseline scores, finding NO improvements.

Additionally, I found that experiment 002 (lattice packing) was attempted but **failed** - the lattice SA for N=72 got `inf` score because it couldn't escape collision states. An "ImprovedLatticeAnnealing" class was created to address this, but it was **never executed**.

## Technical Execution Assessment

**Validation**: The scoring methodology is correct. The experiment properly computed bounding box sizes and score contributions.

**Leakage Risk**: None - this is a pure optimization problem with no train/test split.

**Score Integrity**: ✅ Verified. The baseline score of 70.676102 matches across all experiments. The LB submission (70.676102398091) confirms local scoring is accurate.

**Code Quality**: 
- ⚠️ **INCOMPLETE EXECUTION**: The lattice notebook (002_lattice_packing) has cells 10-15 that were never run. The "ImprovedLatticeAnnealing" class was defined but never tested.
- The small N optimization experiment ran correctly but found no improvements.

Verdict: **CONCERNS** - The lattice approach was not fully explored due to incomplete notebook execution.

## Strategic Assessment

**Approach Fit**: The small N optimization was a reasonable approach given the high per-tree contribution. However, the finding that "all approaches converged to the same baseline scores" suggests the pre-optimized solution is indeed at a very tight local optimum for small N.

**Effort Allocation**: 
- ⚠️ **CRITICAL ISSUE**: The lattice packing approach (identified as HIGHEST PRIORITY in the strategy) was attempted but failed, and the fix was never tested. This is a significant missed opportunity.
- The small N optimization was a reasonable secondary priority, but it yielded no results.

**Assumptions**: 
- The assumption that SA can escape local optima for small N appears to be wrong - the baseline is too well-optimized.
- The lattice approach failed because the initial configuration had collisions and SA couldn't repair them.

**Blind Spots**:
1. **Incomplete lattice experiment**: The ImprovedLatticeAnnealing class starts with wider, collision-free spacing and should work better, but it was never run.
2. **bbox3 optimizer not used**: The strategy mentions the bbox3 C++ optimizer which is used by top kernels. It hasn't been tried yet.
3. **Fractional translation**: The jonathanchan kernel uses micro-steps (0.001 to 0.00001) for fine-tuning after SA converges. Not tried.
4. **Ensemble from multiple sources**: While the strategy says santa-2025.csv dominates, the jonathanchan kernel ensembles from 19+ sources. Worth revisiting.

**Trajectory**: 
- Two experiments with NO improvements is concerning, but the lattice approach wasn't properly tested.
- The gap of 1.76 points is still achievable, but we need to pivot to approaches that actually work.

**CV-LB Relationship**: Only 1 submission so far (CV=70.676102, LB=70.676102398091). They match almost exactly, which is expected for this deterministic optimization problem.

## What's Working

1. **Accurate scoring**: Local scores match LB exactly, so we can trust our validation.
2. **Problem understanding**: The team correctly identified that the baseline is at a tight local optimum.
3. **Strategy document**: Excellent - identifies multiple untried approaches with clear priorities.

## Key Concerns

### 1. Incomplete Lattice Experiment (CRITICAL)
- **Observation**: The lattice notebook defined an ImprovedLatticeAnnealing class that starts with collision-free configurations, but cells 12-15 were never executed.
- **Why it matters**: Lattice packing is the HIGHEST PRIORITY approach in the strategy. The initial attempt failed due to collisions, but the fix was never tested.
- **Suggestion**: **IMMEDIATELY** run the ImprovedLatticeAnnealing class for N=72, 100, 144, 196, 200. This is the most promising untried approach.

### 2. Not Using bbox3 Optimizer
- **Observation**: The bbox3 C++ optimizer is available at `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3` but hasn't been used.
- **Why it matters**: Top kernels use this optimizer with `-n 15000+` iterations and `-r 80+` rounds. It's more sophisticated than Python SA.
- **Suggestion**: Try running bbox3 on the baseline with long optimization runs (hours, not minutes).

### 3. Two Experiments with No Progress
- **Observation**: Both exp_001 (small N) and exp_002 (lattice) failed to improve on the baseline.
- **Why it matters**: We're not making progress toward the target.
- **Suggestion**: Don't give up - the lattice approach wasn't properly tested. Also consider the fractional translation technique from jonathanchan kernel.

### 4. Strategy Says "Submit After Every Experiment" But Only 1 Submission Made
- **Observation**: We have 90 submissions remaining but only submitted once.
- **Why it matters**: LB feedback is valuable for understanding what works.
- **Suggestion**: Continue submitting any improvements, even small ones.

## Top Priority for Next Experiment

**COMPLETE THE LATTICE PACKING EXPERIMENT**

The ImprovedLatticeAnnealing class in `experiments/002_lattice_packing/lattice.ipynb` was created but never tested. This class:
1. Starts with wider, collision-free spacing (dx=1.2, dy=0.9)
2. Uses an interlocking pattern (90° and 270° rotations)
3. Should be able to find valid configurations

**Immediate actions:**
1. Run cells 12-15 in the lattice notebook to test ImprovedLatticeAnnealing for N=72, 100, 144, 156, 196, 200
2. If lattice finds improvements, integrate them into the submission
3. If lattice still fails, try the bbox3 optimizer with long runs

The 1.76 point gap is still achievable. The lattice approach is theoretically sound - it just needs proper implementation with collision-free initial configurations. Don't give up on it because the first attempt failed.

**Alternative if lattice continues to fail:**
- Use bbox3 optimizer: `./bbox3 -i baseline.csv -o output.csv -n 20000 -r 100`
- Try fractional translation (micro-steps of 0.001) for fine-tuning
- Consider extracting configurations from other public kernels' submissions
