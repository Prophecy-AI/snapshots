# Santa 2025 - Evolved Strategy (Loop 1)

## Current Status
- Best CV score: 70.676102 from exp_000 (baseline)
- Best LB score: 70.676102 (CV = LB, perfect match!)
- Target: 68.919154 | Gap to target: 1.756948 (2.55%)

## CV-LB Relationship Analysis
- Only 1 submission so far, but CV = LB exactly
- This is an optimization problem, not ML - CV should always equal LB
- No distribution shift concerns

## Response to Evaluator
The evaluator correctly identified:
1. ✅ Baseline is solid and correctly scored
2. ✅ N=1 is already at optimal 45 degrees (verified in analysis)
3. ✅ Lattice approach is the key untried technique
4. ✅ Small N values have highest per-tree impact

The evaluator's recommendation to "submit baseline first" was followed - LB confirmed at 70.676102.

## CRITICAL FINDINGS FROM ANALYSIS

### Ensemble is USELESS
- Analyzed 30 CSV files from all available sources
- santa-2025.csv dominates ALL N values (199/200 best from ensemble.csv which is same)
- NO improvement possible from existing CSVs
- **Must generate NEW solutions, not ensemble existing ones**

### Score Breakdown (where to focus)
- N=1-10: 4.33 points (highest per-tree, but N=1 already optimal)
- N=11-50: 14.71 points
- N=51-100: 17.64 points (largest contribution)
- N=101-150: 17.14 points
- N=151-200: 16.85 points

### Lowest Efficiency N Values (most room for improvement)
- N=1: 37% efficiency (but already optimal angle)
- N=2-10: 54-65% efficiency
- Small N values have lowest packing efficiency

## RECOMMENDED APPROACHES (Priority Order)

### 1. **[HIGHEST PRIORITY]** Implement Lattice/Translation Approach
From egortrushin kernel - this is the KEY untried approach:
- Start with 2 base trees in specific configuration
- Translate in x and y directions to create grid pattern
- Use SA to optimize base configuration
- Key N values: 72 (4x9x2), 100 (5x10x2), 110 (5x11x2), 144 (6x12x2), 156 (6x13x2), 196 (7x14x2), 200 (from 210)

**Implementation steps:**
1. Define 2 base trees with positions (x1, y1, a1) and (x2, y2, a2)
2. Define translation vectors (dx, dy) for x and y directions
3. Generate N trees by translating base trees
4. Use SA to optimize: base positions, translation vectors, angles
5. For N not exactly nx*ny*2, take first N trees from larger grid

### 2. **[HIGH PRIORITY]** Run bbox3 C++ Optimizer with Long Iterations
The bbox3 optimizer is available at:
`/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`

Run with aggressive parameters:
- `-n 20000+` iterations (vs short runs)
- `-r 100+` rounds
- Multiple random seeds

### 3. **[HIGH PRIORITY]** Implement Fractional Translation Post-Processing
From jonathanchan kernel:
- After SA converges, apply micro-translations (0.001 to 0.00001 steps)
- Move each tree in 8 directions with decreasing step sizes
- This squeezes out final improvements

### 4. **[MEDIUM PRIORITY]** Exhaustive Angle Search for Small N (2-10)
- For N=2-10, try exhaustive search over rotation angles
- Use 0.1 degree increments initially, then refine
- These have highest per-tree impact after N=1

### 5. **[MEDIUM PRIORITY]** Asymmetric Configurations
- Discussion insight: Asymmetric solutions outperform symmetric ones
- Try handcrafted asymmetric layouts for specific N values
- Break the usual symmetric grid patterns

## Technical Resources

### bbox3 Optimizer
Location: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
Usage: `./bbox3 -i input.csv -o output.csv -n <iterations> -r <rounds>`

### Tree Geometry
```python
TX = [0, 0.125, 0.0625, 0.2, 0.1, 0.35, 0.075, 0.075, -0.075, -0.075, -0.35, -0.1, -0.2, -0.0625, -0.125]
TY = [0.8, 0.5, 0.5, 0.25, 0.25, 0, 0, -0.2, -0.2, 0, 0, 0.25, 0.25, 0.5, 0.5]
```
- Tree height: 1.0 (from -0.2 to 0.8)
- Tree width: 0.7
- Single tree area: 0.245625

### Submission Format
```csv
id,x,y,deg
001_0,s0.0,s0.0,s45.0
002_0,s0.0,s0.0,s90.0
002_1,s0.202736,s-0.511271,s90.0
```

## What NOT to Try
- ❌ Ensemble from existing CSVs (santa-2025.csv dominates all)
- ❌ Short optimization runs (already tried, no improvement)
- ❌ Backward propagation (already tried, no improvement)
- ❌ Optimizing N=1 (already at optimal 45 degrees)

## SUBMISSION STRATEGY
- Remaining submissions: 90
- **SUBMIT AFTER EVERY EXPERIMENT** - we have abundant submissions
- LB feedback is free information - use it!

## Validation Requirements
1. No overlapping trees (Kaggle rejects overlapping submissions)
2. Use high-precision arithmetic to avoid floating-point errors
3. Validate with Shapely polygon intersection checks before submission

## Expected Improvement Potential
- Lattice packing for large N: ~0.5-1.0 points
- Small N optimization (N=2-10): ~0.2-0.3 points
- Asymmetric configurations: ~0.2-0.3 points
- Fractional translation: ~0.1-0.2 points
- Total potential: ~1.0-1.8 points (enough to reach target!)