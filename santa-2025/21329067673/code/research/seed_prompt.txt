# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- **Best CV score**: 70.676102 (from baseline santa-2025.csv)
- **Best LB score**: 70.676102 (exp_000 submission confirmed)
- **Target**: 68.894234
- **Gap to target**: 1.78 points (2.59%)
- **Submissions used**: 1/100 (97 remaining - ABUNDANT!)

## Public Kernel Status (CRITICAL!)
- **Have we implemented the best kernel yet?** NO - only tried basic tessellation
- **Top kernels identified**:
  - saspav (497 votes): bbox3 + shake_public + fix_direction
  - santa-claude (378 votes): tree_packer_v21.cpp with backward propagation
  - jazivxt eazy-optimizer (195 votes): Square Calculus Pressure + Elastic Pulse
  - jonathanchan (176 votes): Ensemble + SA + fractional translation
- **Kernels we've implemented**: None properly - tessellation attempt FAILED
- **Kernels still to implement**: ALL of the above

## CV-LB Relationship Analysis
- Only 1 submission so far: CV = LB = 70.676102
- This is an optimization problem where CV = LB (no train/test split)
- Any valid improvement in CV will directly translate to LB improvement

## Response to Evaluator

The evaluator correctly identified:
1. **Tessellation implementation was FLAWED** - produced WORSE results (0.75 vs 0.35 for N=100)
2. **The baseline is at a tight local optimum** - standard SA cannot escape
3. **Need to extract optimal lattice parameters from existing solutions** - not generate from scratch
4. **bbox3 optimizer needs MUCH longer runs** - 15000+ iterations, 80+ rounds (hours, not minutes)
5. **Fractional translation** can squeeze out micro-improvements after SA converges

**I AGREE with all points.** The tessellation approach failed because:
- Simple grid spacing doesn't find the optimal "crystallization" pattern
- Need to analyze existing best solutions to extract the (dx, dy, blue_deg, pink_deg) parameters
- The jazivxt kernel has `generate_geometry_report()` function for this

## CRITICAL INSIGHT: Why Previous Approaches Failed

1. **Tessellation from scratch**: Grid spacing too large, didn't find interlocking pattern
2. **Ensemble from 30 CSVs**: All CSVs already dominated by baseline - no diversity
3. **bbox3 with short runs**: 5000 iterations × 50 rounds is ~100x shorter than needed
4. **SA on pre-optimized baseline**: Already at tight local optimum

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Run C++ Optimizer with LONG Parameters

The jazivxt "eazy-optimizer" kernel has a sophisticated C++ optimizer with:
- Square Calculus Pressure (pushes trees toward center)
- Elastic Pulse (periodic squeeze/relax)
- Complex Orbital Move (rotation in complex plane)
- OpenMP parallelization

**Concrete steps:**
1. Compile eazy.cpp from `/home/code/research/kernels/jazivxt_eazy-optimizer/`
2. Run with long parameters (20+ seconds per N, multiple scale phases)
3. Validate with Shapely before claiming improvements
4. Replace baseline configs where optimizer finds better solutions

**Expected improvement:** 0.5-1.5 points based on kernel outputs

### 2. **[HIGH PRIORITY]** Extract Lattice Parameters from Best Solutions

The jazivxt "why-not" kernel has `generate_geometry_report()` that:
- Analyzes existing best solutions
- Finds TOP 10 LATTICE OFFSETS & ANGLES
- Extracts (dx, dy, blue_deg, pink_deg) for each N

**Concrete steps:**
1. Run geometry analysis on baseline to extract lattice patterns
2. For target N values (64, 81, 100, 121, 144, 169, 196, 200):
   - Use extracted parameters as starting point
   - Run SA to fine-tune
3. Compare with baseline, keep improvements

### 3. **[HIGH PRIORITY]** Fractional Translation Post-Processing

The jonathanchan kernel shows that after SA converges:
- Fractional translation with steps [0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001]
- In 8 directions (N, S, E, W, NE, NW, SE, SW)
- Can squeeze out additional 0.01-0.1 improvements

**Implement as post-processing step after any optimization.**

### 4. **[MEDIUM PRIORITY]** Backward Propagation

Start from N=200, work down to N=2:
- For each N, try removing each tree
- Keep configuration that gives best (N-1) score
- This propagates good packing patterns to smaller N

**Based on santa-claude kernel.**

## What NOT to Try

- ❌ More tessellation from scratch (already failed)
- ❌ Short optimization runs (< 10 minutes per N)
- ❌ Ensemble of existing CSVs (no diversity)
- ❌ SA on pre-optimized baseline without fundamentally different approach

## Implementation Notes

### Tree Geometry (15 vertices):
```python
TX = [0, 0.125, 0.0625, 0.2, 0.1, 0.35, 0.075, 0.075, -0.075, -0.075, -0.35, -0.1, -0.2, -0.0625, -0.125]
TY = [0.8, 0.5, 0.5, 0.25, 0.25, 0, 0, -0.2, -0.2, 0, 0, 0.25, 0.25, 0.5, 0.5]
```

### Score Calculation:
```python
score = sum(side_length[n]**2 / n for n in range(1, 201))
```

### Overlap Validation (CRITICAL):
```python
# Use Shapely with strict tolerance
from shapely.geometry import Polygon
def has_overlap(trees):
    for i, t1 in enumerate(trees):
        for j, t2 in enumerate(trees):
            if i < j:
                if t1.polygon.intersects(t2.polygon) and not t1.polygon.touches(t2.polygon):
                    return True
    return False
```

## SUBMISSION STRATEGY

**SUBMIT AFTER EVERY EXPERIMENT!**
- We have 97 submissions remaining (ABUNDANT!)
- LB feedback is FREE information
- Even if approach doesn't beat baseline, we learn what works
- Submit to verify improvements are real

## Available Resources

- **Baseline**: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa-2025.csv`
- **eazy-optimizer kernel**: `/home/code/research/kernels/jazivxt_eazy-optimizer/`
- **jonathanchan kernel**: `/home/nonroot/snapshots/santa-2025/21116303805/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/`
- **Pre-optimized CSVs**: 30 files in `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/`

## Success Criteria

- Generate a submission with score < 70.676102 (any improvement)
- Target: < 68.894234 (beat the target)
- Validate with Shapely before claiming any improvements
- Submit to get LB confirmation
