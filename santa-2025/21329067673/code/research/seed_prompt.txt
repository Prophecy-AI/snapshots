# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.615745 from strict ensemble (experiments/005_ensemble)
- Best LB score: 70.676059 (exp_002 - eazy optimizer)
- Target: 68.891380 | Gap to target: 1.72 points (2.50%)
- **CRITICAL**: exp_003 (eazy_long_run) was REJECTED due to overlaps in group 013!

## ⚠️ CRITICAL ISSUE: ENSEMBLE NEVER SUBMITTED!
The strict ensemble (70.615745) is 0.06 points better than baseline but was NEVER SUBMITTED!
- File: /home/code/experiments/005_ensemble/submission_ensemble_strict.csv
- Validated with Shapely - NO overlaps
- **IMMEDIATE ACTION**: Submit this ensemble to get LB feedback!

## CV-LB Relationship Analysis
- CV = LB exactly (within floating point precision) for this optimization problem
- No distribution shift - any valid improvement in CV directly translates to LB
- The eazy optimizer produces INVALID submissions (overlaps Kaggle detects but Shapely doesn't)

## Response to Evaluator
The evaluator correctly identified that:
1. **Local optimization is stuck** - 4 experiments produced only 0.000430 improvement total
2. **The eazy optimizer is unsafe** - it corrupts coordinates causing Kaggle rejection
3. **We need fundamentally different approaches** - not parameter tweaks

I agree with all points. The key insight is that the strict ensemble (70.615745) was NEVER SUBMITTED despite being 0.06 points better than baseline. This must be submitted immediately.

## Approaches Tried (and their outcomes)
1. **Baseline** (70.676102) - Pre-optimized CSV, accepted by Kaggle
2. **Tessellation** (70.676102) - WORSE than baseline for large N
3. **bbox3 optimizer** - NO improvement, stuck at local optimum
4. **eazy optimizer** (70.675672) - Small improvement but REJECTED by Kaggle (overlaps)
5. **Strict ensemble** (70.615745) - 0.06 improvement, NEVER SUBMITTED!

## Recommended Approaches (Priority Order)

### 1. [IMMEDIATE] Submit the strict ensemble
```bash
cp /home/code/experiments/005_ensemble/submission_ensemble_strict.csv /home/submission/submission.csv
```
This is 0.06 points better than baseline and has been validated with Shapely.

### 2. [HIGH PRIORITY] Run backward propagation (deletion cascade)
The chistyakov kernel uses this approach:
- Start from N=200, work down to N=2
- For each N, try removing each tree
- Keep the configuration that gives best (N-1) score
- This propagates good packing patterns to smaller N

### 3. [HIGH PRIORITY] Focus on small N (1-20)
Small N values have worst efficiency:
- N=1: 37.1% efficiency (0.66 score contribution)
- N=2: 54.5% efficiency (0.45 score contribution)
- N=3: 56.5% efficiency (0.43 score contribution)

These contribute disproportionately to total score. Even small improvements here have big impact.

### 4. [MEDIUM PRIORITY] Run long SA with safe optimizer
The eazy optimizer is unsafe. Use bbox3 or shake_public instead:
```bash
./bbox3 -i submission.csv -o submission_new.csv -n 50000 -r 100
./shake_public --input=submission.csv --output=submission.csv
```
Run for HOURS, not minutes.

### 5. [MEDIUM PRIORITY] Genetic algorithm with diverse population
- Create population of 10-20 different solutions
- Use crossover: swap partial solutions between candidates
- Use mutation: rotate/translate clusters
- This can escape local optima by exploring different basins

## What NOT to Try
- ❌ eazy optimizer - produces overlaps Kaggle rejects
- ❌ Simple tessellation - produces worse results than baseline
- ❌ More iterations on same optimizer - stuck at local optimum
- ❌ Parameter tweaks - need fundamentally different approach

## Validation Notes
- ALWAYS validate with Shapely before submission
- Use intersection.area > 1e-10 threshold for overlap detection
- The eazy optimizer produces overlaps that Shapely misses - avoid it!
- CV = LB for this problem (no distribution shift)

## SUBMISSION STRATEGY
- Remaining submissions: 96
- **SUBMIT IMMEDIATELY**: The strict ensemble (70.615745) has never been submitted!
- After that, submit every valid improvement
- LB feedback is FREE information - use it!
