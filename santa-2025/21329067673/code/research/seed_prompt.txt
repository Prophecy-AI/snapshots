# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.615745 from ensemble_strict.csv (NEVER SUBMITTED!)
- Best LB score: 70.676059 (from exp_002)
- Target: 68.891380 | Gap to target: 1.72 points (2.50%)
- Last submission (exp_003) was REJECTED due to overlaps from eazy optimizer

## CRITICAL ISSUE: The eazy optimizer corrupts coordinates!
The eazy C++ optimizer introduces tiny coordinate changes that cause overlaps Kaggle detects but Shapely doesn't. Submission 004_eazy_long_run was rejected with "Overlapping trees in group 013". DO NOT use eazy optimizer for submissions.

## CV-LB Relationship Analysis
- CV = LB exactly (within floating point precision) for this optimization problem
- No distribution shift - any valid improvement in CV directly translates to LB
- The challenge is finding VALID configurations (no overlaps)

## Response to Evaluator
The evaluator correctly identified that:
1. We're stuck at a local optimum - 4 experiments with only 0.000430 total improvement
2. Local optimization cannot close the 1.78-point gap
3. We need fundamentally different approaches

**CRITICAL FINDING**: The ensemble_strict.csv (70.615745) was NEVER SUBMITTED! This is 0.060 points better than baseline and has NO overlaps. This should be submitted immediately.

**ADDITIONAL FINDING**: The ensemble improved 157 N values, proving that better configurations EXIST in other sources. The top improvements were at N=54 (0.005), N=57 (0.0045), N=87 (0.0039).

## Recommended Approaches (Priority Order)

### 1. [IMMEDIATE] Submit ensemble_strict.csv
- Score: 70.615745 (0.060 better than baseline)
- Validated: NO overlaps
- Path: /home/code/experiments/005_ensemble/submission_ensemble_strict.csv
- This should be submitted NOW to get LB feedback

### 2. [HIGH PRIORITY] Implement Backward Propagation (Deletion Cascade)
The chistyakov kernel uses this approach:
- Start from N=200, work down to N=2
- For each N, try removing each tree
- Keep the configuration that gives best (N-1) score
- This propagates good packing patterns to smaller N

```python
# Pseudocode from chistyakov kernel
for group_id_main in range(200, 2, -1):
    candidate_tree_list = dict_of_tree_list[group_id_main].copy()
    while len(candidate_tree_list) > 1:
        best_tree_idx_to_delete = None
        for idx in range(len(candidate_tree_list)):
            # Try deleting this tree
            temp_list = [t for i, t in enumerate(candidate_tree_list) if i != idx]
            side_length = get_side_length(temp_list)
            if side_length < best_side_length:
                best_side_length = side_length
                best_tree_idx_to_delete = idx
        # Delete the best tree
        del candidate_tree_list[best_tree_idx_to_delete]
```

### 3. [HIGH PRIORITY] Run SA for HOURS, not minutes
The jonathanchan kernel runs for 80+ rounds with 15000+ iterations. Our experiments only ran for minutes. Try:
```bash
timeout 7200 ./sa_v1_parallel -i submission_best.csv -n 50000 -r 100
```

### 4. [MEDIUM PRIORITY] Focus on Small N (1-20)
Small N values have worst packing efficiency:
- N=1: 37.1% efficiency
- N=2: 54.5% efficiency
- N=3: 56.5% efficiency
- N=4-5: ~59% efficiency

These contribute disproportionately to total score. Try:
- Branch-and-bound for exact solutions
- Exhaustive search of rotation angles
- Manual optimization using the interactive editor

### 5. [MEDIUM PRIORITY] Genetic Algorithm with Crossover
Instead of optimizing one solution, evolve a population:
- Start with diverse initial configurations
- Crossover: swap partial solutions between candidates
- Mutation: rotate/translate clusters
- Selection: keep best valid configurations

## What NOT to Try
- ❌ eazy optimizer - corrupts coordinates, causes Kaggle rejection
- ❌ More SA iterations on current configurations - stuck at local optimum
- ❌ Tessellation for large N - already tried, WORSE than baseline
- ❌ bbox3 optimizer - already tried, NO improvement

## Validation Notes
- ALWAYS validate with Shapely before submission
- Use strict overlap detection: intersection.area > 1e-15
- The eazy optimizer passes local validation but fails Kaggle validation

## SUBMISSION STRATEGY
- Remaining submissions: 96 (ABUNDANT!)
- Submit ensemble_strict.csv IMMEDIATELY
- Submit after EVERY experiment that produces a valid file
- LB feedback is FREE information - USE IT!
