# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.676059 from exp_003 (eazy_optimizer)
- Best LB score: 70.676059 (CV = LB exactly, as expected for optimization)
- Target: 68.892266 | Gap to target: 1.78 points (2.59%)
- Submissions used: 2/100 (96 remaining)

## CV-LB Relationship Analysis
- CV = LB exactly (this is an optimization problem, not ML)
- No distribution shift - the score is deterministic
- Improving CV directly improves LB

## Response to Evaluator

The evaluator correctly identified that:
1. **Local optimization is STUCK** - 3 experiments with only 0.000043 total improvement
2. **Need fundamentally different approach** - SA/bbox3/eazy cannot close a 2.59% gap
3. **Tessellation approach was flawed** in exp_002 - produced WORSE results

**Key insight from evaluator**: The target score of 68.892266 IS achievable (it's on the leaderboard). The question is: what configurations achieve it?

**My analysis confirms**:
- External CSVs (santa25-public, bucket-of-chump, telegram) are ALL WORSE than baseline (70.9-72.9 vs 70.676)
- Baseline is already the best available from public sources
- We need to find BETTER configurations, not optimize existing ones

## Key Findings from Analysis

1. **Gap to target**: 1.78 points - need to capture only 8.3% of theoretical improvement potential
2. **Worst efficiency N values**: N=1 (37%), N=2 (54%), N=3 (56%)
3. **Large N (51-200) contributes 73%** of total score - high leverage area
4. **Lattice pattern confirmed**: Large N uses alternating blue (~70°) and pink (~250°) trees

## Recommended Approaches (Priority Order)

### 1. [HIGHEST PRIORITY] Run C++ Optimizers for HOURS, not minutes

The evaluator noted that top solutions run for HOURS. Our experiments ran for only 5-10 minutes.

**Concrete action**:
```bash
# Run sa_v1_parallel for 2+ hours
./sa_v1_parallel -i submission_best.csv -n 50000 -r 100

# Run eazy optimizer for 2+ hours with longer time per N
./eazy -i submission_best.csv -o submission_eazy.csv -t 60  # 60 seconds per N
```

### 2. [HIGH PRIORITY] Implement Proper Tessellation for Large N

The jazivxt kernel has `generate_geometry_report()` that extracts optimal lattice parameters:
- dx, dy offsets between blue and pink trees
- Blue angle (~70°) and Pink angle (~250°)

**Concrete action**:
1. Run `generate_geometry_report()` on baseline to extract lattice parameters
2. Use these parameters to create tessellations for N >= 50
3. Compare tessellation score vs baseline for each N
4. Keep whichever is better

### 3. [HIGH PRIORITY] Focus on Small N (1-10) - Worst Efficiency

Small N values have worst efficiency but contribute 6.1% of score:
- N=1: 37% efficiency (0.66 score contribution)
- N=2: 54% efficiency (0.45 score contribution)
- N=3: 56% efficiency (0.43 score contribution)

**Concrete action**:
1. For N=1-10, try exhaustive rotation search (0.1° increments)
2. For N=2-5, try different tree arrangements (not just optimizing existing)
3. Use branch-and-bound or constraint programming for small N

### 4. [MEDIUM PRIORITY] Backward Propagation (Deletion Cascade)

The chistyakov kernel shows this approach:
- Start from N=200, work down to N=2
- For each N, try removing each boundary-touching tree
- Keep the configuration that gives smallest side length for N-1

**Concrete action**:
```python
for n in range(200, 1, -1):
    boundary_trees = get_bbox_touching_tree_indices(config[n])
    for tree_idx in boundary_trees:
        candidate = remove_tree(config[n], tree_idx)
        if score(candidate) < score(config[n-1]):
            config[n-1] = candidate
```

## What NOT to Try

1. ❌ More SA/bbox3/eazy with same parameters - already at local optimum
2. ❌ Ensemble from external sources - they're all WORSE than baseline
3. ❌ Simple grid tessellation - produces worse results (exp_002 showed this)
4. ❌ Parameter tweaks on existing optimizers - won't close 2.59% gap

## Validation Notes

- CV = LB for this problem (deterministic optimization)
- Always validate for overlaps using Shapely before submission
- Use high precision (Decimal with 25+ digits) for coordinates

## SUBMISSION STRATEGY

- Remaining submissions: 96
- **SUBMIT AFTER EVERY EXPERIMENT** - LB feedback is free information
- Even if worse than baseline, submit to learn what doesn't work
