# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.615745 (strict ensemble, candidate_004.csv) - NEVER SUBMITTED
- Best LB score: 70.676059 (exp_002, eazy optimizer short run)
- Target: 68.891380 | Gap to target: 1.72 points (2.5%)
- Submissions used: 3/100 (97 remaining)

## CRITICAL ISSUES IDENTIFIED

### 1. exp_003 was REJECTED by Kaggle
The eazy optimizer (70.675672) was rejected with "Overlapping trees in group 013" even though Shapely validation passed locally. **DO NOT use eazy optimizer outputs for submission.**

### 2. Strict Ensemble Never Submitted
The strict ensemble (70.615745) is 0.06 points better than baseline and has NO overlaps. It's in candidate_004.csv but was NEVER submitted. **SUBMIT THIS IMMEDIATELY.**

### 3. Stuck at Local Optimum
4 experiments have produced only 0.0004 improvement total. Local optimization cannot close the 1.72 point gap. Need fundamentally different approach.

## Response to Evaluator

The evaluator correctly identified:
1. **Local optimization is futile** - 4 experiments, 0.0004 improvement. Agreed.
2. **Need fundamentally different configurations** - The target score (68.891380) exists on LB, so better configurations ARE possible.
3. **Run SA for HOURS, not minutes** - Valid suggestion, but eazy optimizer outputs have overlap issues.
4. **Implement backward propagation** - The Chistyakov kernel approach. Worth trying.

**Where I disagree:**
- Running sa_v1_parallel for hours won't help if we're at a local optimum. The issue isn't optimization time, it's that we need DIFFERENT starting configurations.

## Recommended Approaches (Priority Order)

### 1. [IMMEDIATE] Submit the Strict Ensemble
The strict ensemble (70.615745) has NO overlaps and is better than any submitted score. Submit it NOW to get LB feedback.

```bash
cp /home/code/experiments/005_ensemble/submission_ensemble_strict.csv /home/submission/submission.csv
```

### 2. [HIGH PRIORITY] Implement Backward Propagation (Deletion Cascade)
From Chistyakov kernel - start from N=200, work down to N=2:
- For each N, try deleting each tree that touches the bounding box
- Keep the deletion that gives best (N-1) score
- This propagates good packing patterns to smaller N

Key insight: This finds DIFFERENT configurations, not just optimizes existing ones.

### 3. [HIGH PRIORITY] Random Restarts with Different Initial Configurations
For each N, generate 10-100 random initial configurations:
- Random positions within a reasonable bounding box
- Random rotations (0-360 degrees)
- Run SA on each
- Keep the best result

This can escape the current local optimum by starting from different basins.

### 4. [MEDIUM PRIORITY] Genetic Algorithm with Crossover
- Population of 50-100 solutions per N
- Crossover: swap partial solutions between candidates
- Mutation: rotate/translate individual trees
- Selection: keep best solutions
- This explores fundamentally different regions of solution space

### 5. [RESEARCH] Study What Top Teams Do
The target score (68.891380) is achievable. What techniques do top teams use?
- Read discussions about "67 score achievement" and "The score of our group"
- What configurations do they use for large N?
- What's special about their approach?

## What NOT to Try
- ❌ Running eazy optimizer longer (outputs have overlap issues)
- ❌ More iterations of bbox3/SA on current configurations (stuck at local optimum)
- ❌ Parameter tuning on existing optimizers (won't escape local optimum)
- ❌ Ensembling external CSVs (all worse than baseline)

## Technical Notes

### Overlap Detection
Kaggle's validation is STRICTER than Shapely. The eazy optimizer introduces subtle coordinate issues that Kaggle catches but Shapely doesn't. Always use original baseline coordinates or validated ensemble outputs.

### Score Breakdown (from strict ensemble)
- N=1-10: 4.33 (6.1% of total)
- N=11-50: 14.70 (20.8%)
- N=51-100: 17.61 (24.9%)
- N=101-150: 17.13 (24.2%)
- N=151-200: 16.84 (23.8%)

Small N values have worst efficiency but limited improvement potential. Large N values (100+) contribute 48% of total score.

### Theoretical Minimum
The theoretical minimum score is ~49.13 (if all trees could be packed at 100% efficiency). Current score is 70.62, so we're at ~70% of theoretical minimum. Target (68.89) requires ~71% efficiency.

## Validation Requirements
- Always validate with Shapely before submission
- Check for overlaps with intersection area > 1e-10
- Use Decimal precision for coordinates
- Prefix coordinates with 's' in submission CSV

## SUBMISSION STRATEGY
With 97 submissions remaining, submit after EVERY experiment:
1. Submit strict ensemble (70.615745) immediately
2. Submit any new approach that produces valid (no overlap) results
3. LB feedback is FREE information - use it!
