# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.615745 from exp_004 (simple ensemble)
- Best LB score: 70.676059 from exp_002 (eazy optimizer)
- Target: 68.891380 | Gap to target: 1.72 points (2.44%)
- Submissions used: 4/100 (96 remaining)

## CRITICAL: Previous Submission Failed
- exp_004 (005_strict_ensemble) was REJECTED with "Overlapping trees in group 003"
- The failed submission had N=3 coordinates from a different source
- Current submission (006_safe_ensemble) uses baseline N=3 which was accepted
- **MUST SUBMIT** the current submission to verify it works

## CV-LB Relationship Analysis
- Submission 1: CV = 70.676102, LB = 70.676102 (baseline)
- Submission 2: CV = 70.676059, LB = 70.676059 (eazy optimizer)
- Submission 3: CV = 70.675672, LB = REJECTED (overlaps from eazy)
- Submission 4: CV = 70.615745, LB = REJECTED (overlaps in N=3)

CV = LB exactly for valid submissions. This is a deterministic optimization problem.
The challenge is ensuring submissions are VALID (no overlaps).

## Response to Evaluator
The evaluator correctly identified that:
1. The strict ensemble (70.615745) was never submitted - FIXED, now in submission.csv
2. The ensemble only scanned 4 directories - ADDRESSED, but more directories have invalid data
3. Backward propagation hasn't been tried - AGREED, this is a promising approach

The current submission uses baseline coordinates for N=3 (which was accepted) instead of
the alternative coordinates that caused the rejection. This should pass validation.

## Key Insights
1. **Overlap validation is critical**: Kaggle's validation is stricter than Shapely
2. **Baseline is safe**: The baseline (70.676102) was accepted by Kaggle
3. **Ensemble improvements are valid**: 162 N values improved over baseline
4. **Gap is still large**: 1.72 points (2.44%) to reach target

## Recommended Approaches (Priority Order)

### 1. **HIGHEST PRIORITY: Submit current ensemble (70.615745)**
The current submission uses baseline N=3 and should be valid.
Submit immediately to verify it works on Kaggle.

### 2. **HIGH PRIORITY: Long-running SA on valid ensemble**
Once we have a valid submission, run the C++ optimizer (sa_v1_parallel) for HOURS:
- Start from the valid ensemble (70.615745)
- Run with 15000+ iterations, 80+ rounds
- This is what top kernels do (jonathanchan)

### 3. **MEDIUM PRIORITY: Backward propagation (deletion cascade)**
From chistyakov kernel:
- Start from N=200, work down to N=2
- For each N, try removing each tree that touches the bounding box
- Keep the deletion that gives best (N-1) score
- This propagates good packing patterns to smaller N

### 4. **RESEARCH: Fundamentally different approaches**
The gap is 1.72 points - micro-optimization won't close it.
Need to research:
- No-fit polygon (NFP) for O(1) overlap checks
- Genetic algorithms with custom crossover
- Constraint programming approaches
- What do top leaderboard teams do differently?

## What NOT to Try
- ❌ eazy optimizer - introduces subtle coordinate issues that Kaggle rejects
- ❌ Configurations from unknown sources without validation
- ❌ Any approach that changes coordinates without strict overlap checking

## Validation Notes
- Always use Shapely with threshold 1e-15 for overlap detection
- Always verify N=3 matches baseline (known to be accepted)
- Test on Kaggle early - our local validation may miss issues

## SUBMISSION STRATEGY
- Remaining submissions: 96
- Submit after EVERY experiment to get LB feedback
- The current submission (70.615745) should be submitted IMMEDIATELY
