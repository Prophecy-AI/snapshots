# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.615745 from ensemble approach
- Best LB score: 70.676059 (from exp_002, eazy optimizer - but exp_003 failed due to overlaps)
- Target: 68.891380 | Gap to target: 1.72 points (2.50%)

## CRITICAL FINDINGS

### 1. The eazy C++ optimizer introduces overlaps that Kaggle detects but Shapely doesn't
- Submission 004_eazy_long_run was REJECTED with "Overlapping trees in group 013"
- Local Shapely validation PASSED but Kaggle validation FAILED
- The optimizer modifies coordinates slightly, causing precision issues
- **DO NOT use eazy optimizer output directly for submissions**

### 2. Ensemble from multiple sources gives improvement
- Collected best configurations from 46 CSV files across snapshots
- Strict validation (checking ALL N values for overlaps) is essential
- Ensemble score: 70.615745 vs baseline 70.676102 (improvement: 0.060)

### 3. Local optimization is stuck at local optimum
- 4 experiments with SA/eazy optimizers produced only 0.0004 improvement
- The baseline is at a very tight local optimum
- Need fundamentally different approach to close the 1.72 point gap

## Response to Evaluator
The evaluator correctly identified that:
1. Local optimization cannot close the 1.78 point gap - CONFIRMED
2. The eazy optimizer was run for too short - we ran longer but still only got 0.0004 improvement
3. We need fundamentally different configurations, not better-optimized versions

The evaluator's suggestion to run sa_v1_parallel for HOURS is worth trying, but given the eazy optimizer's overlap issues, we need to be careful with C++ optimizers.

## Recommended Approaches (Priority Order)

### 1. [HIGHEST PRIORITY] Submit the ensemble result
- Score: 70.615745 (improvement of 0.060 from baseline)
- Validated with Shapely - no overlaps
- This is our best valid submission so far

### 2. [HIGH PRIORITY] Run sa_v1_parallel with STRICT validation
The jonathanchan kernel uses:
```bash
./sa_v1_parallel -i submission.csv -o output.csv -n 15000 -r 5
```
But we need to:
- Run for HOURS, not minutes
- Validate output with Shapely before submission
- If overlaps detected, fall back to input

### 3. [MEDIUM PRIORITY] Backward propagation
From jonathanchan kernel:
- Start from N=200, work down to N=2
- For each N, try removing each tree
- Keep the configuration that gives best (N-1) score
- This propagates good packing patterns to smaller N

### 4. [MEDIUM PRIORITY] Rotation optimization
- For each N, optimize the rotation angle of the entire configuration
- Use scipy.optimize.minimize_scalar to find optimal angle
- This can squeeze out small improvements

### 5. [RESEARCH] Tessellation approach for large N
- For N >= 58, use grid-based placement with blue/pink tree pattern
- Lattice parameters: dx=0.25, dy=0.04, Blue angle=63.4°, Pink angle=243.4°
- This is a fundamentally different approach that might escape local optima

## What NOT to Try
- Running eazy optimizer without strict validation (causes overlaps)
- Short SA runs (< 1 hour) - they don't find improvements
- Simple parameter tweaks on existing optimizers

## Validation Notes
- ALWAYS validate with Shapely before submission
- Use tolerance of 1e-15 for overlap detection
- Check ALL N values, not just small N
- If Shapely passes but Kaggle rejects, the optimizer is corrupting coordinates

## Key Files
- /home/code/experiments/005_ensemble/submission_ensemble_strict.csv - Best valid submission
- /home/code/experiments/003_long_sa/submission_best.csv - Baseline (accepted by Kaggle)
- /home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/ - Reference kernel
