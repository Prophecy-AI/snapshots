# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.676102 from exp_000 (001_baseline)
- Best LB score: N/A (no submissions yet)
- Target: 68.894234 | Gap to target: 1.78 points (2.59%)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **NO** - We only loaded a pre-optimized CSV
- Top kernels identified:
  1. jonathanchan/santa25-ensemble-sa-fractional-translation (176 votes) - Ensemble + SA + Fractional Translation
  2. jazivxt/why-not (352 votes) - bbox3 with fluid dynamics, lattice crystallization
  3. yongsukprasertsuk/santa-2025-best-keeping-bbox3-runner (369 votes) - bbox3 runner
  4. chistyakov/santa-2025-simple-optimization-new-slow-version (128 votes) - Simple SA
- Kernels we've implemented: **NONE** - only loaded pre-optimized CSV
- Kernels still to implement: **ALL OF THEM**
- **CRITICAL**: We must implement actual optimization, not just load pre-optimized solutions!

## Score Breakdown Analysis
From baseline analysis:
- N=1-10: 4.33 (6.1% of score) - Small N, high per-tree contribution
- N=11-50: 14.71 (20.8% of score)
- N=51-100: 17.64 (25.0% of score)
- N=101-150: 17.14 (24.3% of score)
- N=151-200: 16.85 (23.8% of score)

**Key insight**: Large N (51-200) contributes ~73% of total score. Tessellation for large N is highest priority.

## Response to Evaluator
The evaluator correctly identified:
1. **Tessellation not implemented** - This is the HIGHEST PRIORITY. The jazivxt kernel shows "blue" (upward) and "pink" (downward) tree phases in a grid pattern.
2. **No C++ optimizer usage** - bbox3 binary is available but not used
3. **No backward propagation** - Starting from N=200 and working down could help
4. **Pre-optimized solution is at tight local optimum** - Standard SA won't help

I AGREE with the evaluator's assessment. The next experiment MUST implement tessellation/lattice approach for large N values.

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Implement Tessellation/Lattice for Large N (N >= 58)
The tessellation approach is fundamentally different from SA on existing solutions:
- Start with 2 base trees: "blue" (upward ~0°) and "pink" (downward ~180°)
- Define translation vectors (dx, dy) to create a grid pattern
- For N trees, use grid of size ceil(sqrt(N)) x ceil(sqrt(N))
- Alternate between blue and pink trees in checkerboard pattern
- Use SA to optimize: base positions, rotation angles, translation vectors

**Target N values**: 64, 81, 100, 121, 144, 169, 196, 200 (perfect squares and large N)

**Implementation approach**:
```python
def tessellation_pack(N, blue_tree, pink_tree, dx, dy):
    trees = []
    grid_size = ceil(sqrt(N))
    for i in range(grid_size):
        for j in range(grid_size):
            if len(trees) >= N:
                break
            # Checkerboard pattern
            if (i + j) % 2 == 0:
                base = blue_tree
            else:
                base = pink_tree
            x = base.x + i * dx
            y = base.y + j * dy
            trees.append(ChristmasTree(x, y, base.angle))
    return trees
```

### 2. **[HIGH PRIORITY]** Run C++ Optimizer (bbox3) for Long Duration
The bbox3 binary is available in snapshots. Run with:
- `-n 15000+` iterations
- `-r 80+` rounds
- Use OpenMP parallelization (26 threads available)
- Run for HOURS, not minutes

### 3. **[HIGH PRIORITY]** Backward Propagation (Deletion Cascade)
Start from N=200, work down to N=2:
```python
for n in range(200, 1, -1):
    for tree_to_remove in range(n):
        candidate = remove_tree(config[n], tree_to_remove)
        if score(candidate) < score(config[n-1]):
            config[n-1] = candidate
```

### 4. **[MEDIUM PRIORITY]** Ensemble from Multiple Sources
The jonathanchan kernel shows how to combine best configs from multiple sources:
- For each N, take configuration with smallest side length
- Validate for overlaps before combining
- Sources: bucket-of-chump, telegram, santa25-public, etc.

## What NOT to Try (Already Failed in Previous Runs)
1. Short optimization runs (< 10 minutes) - local optimum too tight
2. Simple ensemble without validation - overlaps cause rejection
3. Standard SA on pre-optimized solutions - already at tight local optimum
4. fix_direction without precision handling - causes precision loss

## Technical Requirements
1. **High precision arithmetic**: Use Decimal with 20+ decimal places
2. **Overlap detection**: Use Shapely with STRtree
3. **Coordinate format**: Prefix with 's' (e.g., "s0.123456789012345678901234")
4. **Validation**: Always check for overlaps before submission

## SUBMISSION STRATEGY
- Remaining submissions: **98** (ABUNDANT!)
- **SUBMIT AFTER EVERY EXPERIMENT** - LB feedback is free information
- Even if score is worse than baseline, submit to learn what doesn't work
- This is a pure optimization problem: CV = LB (no distribution shift)

## Next Experiment: Tessellation Implementation
1. Implement tessellation packing for N >= 64
2. Start with simple grid pattern (blue/pink alternating)
3. Optimize translation vectors (dx, dy) using SA
4. Compare against baseline for each N
5. If better, replace those N values in submission
6. Submit to get LB feedback

## Available Resources
- Pre-optimized submissions: `/home/nonroot/snapshots/santa-2025/*/code/preoptimized/`
- bbox3 binary: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
- Research kernels: `/home/code/research/kernels/`
- jonathanchan kernel: `/home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/`
