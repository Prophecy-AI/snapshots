# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 2)

## Current Status
- Best CV score: 70.734327 from exp_001 (002_extended_optimization)
- Best LB score: 70.734327 (CV = LB perfectly, as expected for deterministic optimization)
- Target: 68.931058 | Gap to target: 1.803 (2.55%)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **PARTIALLY** - We've used tree_packer_v21 but NOT the periodic structure approach
- Top kernels identified:
  - egortrushin/santa25-improved-sa-with-translations (periodic structures for large N)
  - jonathanchan/santa25-ensemble-sa-fractional-translation (ensemble + SA)
  - smartmanoj/santa-claude (backward propagation)
- Kernels we've implemented: tree_packer_v21, backward propagation, fractional translation
- Kernels still to implement: **PERIODIC STRUCTURE OPTIMIZATION (egortrushin approach)**

## CV-LB Relationship Analysis
- CV = LB perfectly (both 70.7343) for both submissions
- This is expected for deterministic optimization - no distribution shift
- The gap must be closed through ALGORITHMIC INNOVATION, not model tuning

## Response to Evaluator
The evaluator correctly identified that:
1. Standard SA/local search cannot escape the local optimum (45 min with aggressive settings found nothing)
2. The santa-2025.csv is already the BEST for all N values - no ensemble improvement possible
3. We need a STRATEGIC PIVOT to periodic/crystalline structures

I fully agree with the evaluator's assessment. The key insight is:
- **For N >= 58, use PERIODIC STRUCTURES** (egortrushin approach)
- This treats large N as tiled unit cells, optimizing the unit cell parameters
- This explores a fundamentally different part of the solution space

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Implement Periodic Structure Optimization
**Why:** Large N (>=58) contributes 49.17 points (69.52% of total). Even 5% improvement = 2.46 points saved.

**What to implement:**
- Port the egortrushin SimulatedAnnealing class from Python to C++ for speed
- Key parameters: `nt = [rows, cols]` for unit cell tiling
- Optimize: translations between unit cells, rotation of all trees in unit cell
- Focus on N values with nice factorizations: 60, 64, 72, 80, 100, 120, 144, 180, 200

**Implementation approach:**
```cpp
// Periodic structure: N = rows * cols trees
// Unit cell has 1 tree, tiled rows x cols times
// Optimize: tx, ty (translation between cells), angle (rotation of all trees)
struct PeriodicConfig {
    int rows, cols;  // nt = [rows, cols]
    double tx, ty;   // translation vector
    double angle;    // rotation of all trees
    double base_x, base_y;  // position of first tree
};
```

### 2. **[HIGH PRIORITY]** Run Optimization for MUCH Longer
**Why:** The jonathanchan kernel runs for hours with multiple generations. 45 minutes is not enough.

**What to do:**
- Run the periodic SA for 2-4 hours
- Use multiple random seeds (10+) and keep best
- Focus compute on worst-performing N values

### 3. **[MEDIUM PRIORITY]** Targeted Small N Optimization
**Why:** Small N (1-20) contribute disproportionately to score. N=1 alone is 0.66 (0.93% of total).

**What to do:**
- For N=1: Exhaustively search all angles (0.01 degree increments)
- For N=2-10: Run very long SA with many restarts
- For N=11-20: Use aggressive SA with high temperature

### 4. **[LOWER PRIORITY]** Ensemble from Multiple Seeds
**Why:** Different random seeds may find different local optima.

**What to do:**
- Run optimization from 10+ different random initial configurations
- For each N, keep the best result across all seeds
- This is especially useful for medium N (20-57)

## What NOT to Try
- ❌ More iterations of standard SA on current configuration (already exhausted)
- ❌ Ensemble from public submissions (santa-2025.csv is already best for all N)
- ❌ Backward propagation alone (already tried, no improvement)
- ❌ Fractional translation alone (already tried, 1 tiny improvement)

## Validation Notes
- CV = LB for this deterministic problem
- Score calculation: sum(side^2 / n) for n=1 to 200
- Validate no overlaps before submission

## SUBMISSION STRATEGY
- Remaining submissions: 97
- Submit after this experiment? **YES** - we have abundant submissions
- LB feedback is free information - use it to calibrate progress

## Key Code Reference
The egortrushin kernel uses this structure:
```python
class SimulatedAnnealing:
    def __init__(self, trees, nt, T0, T1, n_iter, ...):
        self.nt = nt  # [rows, cols] for periodic structure
        # Translations determined via SA updates
        # All trees in unit cell rotated by same angle
```

The key innovation is treating large N as a TILED PATTERN rather than independent trees.
This allows finding configurations that standard SA cannot reach.

## Expected Outcome
- Implement periodic structure optimization for N >= 58
- Run for 2+ hours with multiple seeds
- Target: Improve large N scores by 3-5%
- Expected score improvement: 1.5-2.5 points
- This should bring us close to or below the target of 68.931