# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 2)

## Current Status
- Best CV score: 70.734327 from exp_001 (002_extended_optimization)
- Best LB score: 70.734327 (verified)
- Target: 68.931058 | Gap to target: 1.803 points (2.55%)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **PARTIALLY** - We've run tree_packer_v21 and various optimizers
- Top kernels identified:
  - jonathanchan: Ensemble + SA + fractional translation (scores ~70.7)
  - egortrushin: Periodic SA with translations (for large N)
  - smartmanoj: Backward propagation
- Kernels we've implemented: tree_packer_v21, backward propagation, fractional translation, aggressive SA
- **CRITICAL FINDING**: santa-2025.csv is already the BEST for 155/200 N values. Ensemble doesn't help!

## CV-LB Relationship Analysis
- CV = LB perfectly (this is a deterministic optimization problem, not ML)
- No distribution shift - the problem is purely computational

## Response to Evaluator
The evaluator correctly identified that:
1. Standard SA/local search is stuck in a deep local optimum
2. The starting submission is already extensively optimized
3. We need a **strategic pivot** to periodic/crystalline structures

I agree with this assessment. The ensemble analysis confirms that no public submission beats santa-2025.csv for any N value. We must generate NEW, better configurations through algorithmic innovation.

## Key Findings from Analysis
1. **Ensemble is blocked**: santa-2025.csv is best for 155/200 N values. No improvement possible from existing public submissions.
2. **Gap analysis**: Need to save 1.803 points. Worst 20 N values contribute 8.08 points (11.4% of total). Need ~22% improvement on worst 20 OR ~2.5% across all N.
3. **Small N dominates**: N=1,2,3 alone contribute 1.55 points (2.2% of total). These are the highest-impact targets.
4. **Periodic structures**: egortrushin kernel shows that for large N (≥58), periodic tiled structures can be superior.

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Implement Periodic SA with Translations (egortrushin approach)**
The egortrushin kernel uses a fundamentally different approach:
- Create a "unit cell" of 2 trees with specific positions and angles
- Tile this unit cell in x and y directions (e.g., nt=[4,5] = 20 unit cells = 40 trees)
- Optimize translation vectors and tree positions/angles within the unit cell
- This can find configurations that standard SA cannot reach

**Implementation:**
```python
# Key parameters from egortrushin kernel:
config = {
    "params": {
        "nt": [4, 5],  # Number of tiles in x, y directions
        "Tmax": 1.0,
        "Tmin": 0.001,
        "nsteps": 100000,
        "nsteps_per_T": 100,
        "cooling": "exponential",
        "alpha": 0.99,
        "position_delta": 0.1,
        "angle_delta": 10.0,
        "delta1": 0.01,  # Translation delta
    }
}
```

Target N values: 20, 24, 28, 32, 35, 40, 42, 48, 56, 63, 70, 72, 77, 80, 88, 96, 100, 110, 120, 144, 156, 196, 200

### 2. **[HIGH PRIORITY] Optimize Small N Values (1-15) with Exhaustive Search**
Small N values contribute disproportionately to score:
- N=1: 0.661 (0.93% of total) - Find optimal single tree rotation
- N=2: 0.451 (0.64% of total) - Try all angle combinations
- N=3: 0.435 (0.61% of total) - Exhaustive search feasible

For N=1: The optimal angle is 45° (minimizes bounding box for symmetric tree)
For N=2-5: Use grid search over angles + SA refinement

### 3. **[MEDIUM PRIORITY] Run jonathanchan sa_v1_parallel for MUCH Longer**
The jonathanchan kernel runs for hours with multiple generations. Our 45-minute run may not be enough.
- Run with `-n 50000 -r 100` for several hours
- Use multiple random seeds
- Focus on worst-performing N values

### 4. **[MEDIUM PRIORITY] Implement Per-Tree Rotation Optimization**
After SA, optimize each tree's rotation angle individually while keeping positions fixed.
This is a 1D optimization per tree that can squeeze out small improvements.

### 5. **[LOW PRIORITY] Try Different Initial Configurations**
Generate completely random initial configurations and optimize from scratch.
The current approach always starts from santa-2025.csv which may be in a local optimum basin.

## What NOT to Try
- ❌ More ensemble from public submissions (already best for all N)
- ❌ Standard SA with same settings (already tried, no improvement)
- ❌ Backward propagation alone (already tried, no improvement)
- ❌ Reinforcement learning (known to fail on this problem)

## Validation Notes
- CV = LB for this problem (deterministic optimization)
- Always validate no overlaps before submission
- Score calculation: score = Σ(s_n² / n) for n=1 to 200

## SUBMISSION STRATEGY
- Remaining submissions: 98
- **Submit after EVERY experiment** - we have abundant submissions
- LB feedback is free information - USE IT!

## Technical Notes
- bbox3 binary requires GLIBC 2.34 (unavailable) - use tree_packer_v21 instead
- Compile C++ with: `g++ -O3 -march=native -std=c++17 -fopenmp -o optimizer optimizer.cpp`
- Use 96 threads for parallel optimization

## Next Experiment: 003_periodic_sa
Implement the egortrushin periodic SA approach for large N values (≥20).
Focus on N values that are products of small integers (20, 24, 28, 32, etc.) where periodic structures work best.

Expected improvement: 0.5-1.0 points if periodic structures find better configurations for large N.
