# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 1)

## Current Status
- Best CV score: 70.734327 from exp_000 (001_baseline_tree_packer_v21)
- Best LB score: N/A (no submissions yet)
- Target: 68.931058 | Gap to target: 1.803 (2.62%)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **PARTIALLY** - We used tree_packer_v21 but with modest settings
- Top kernels identified:
  1. Santa-submission (saspav) - uses bbox3 + fix_direction
  2. Santa Claude (smartmanoj) - uses tree_packer_v21 + backward propagation
  3. [Santa25] Ensemble + SA + Fractional Translation (jonathanchan) - combines multiple sources
  4. Santa25 Simulated Annealing with Translations (egortrushin) - grid-based SA
- Kernels we've implemented: tree_packer_v21 with -n 2000 -r 30 (too modest)
- **CRITICAL ISSUE**: bbox3 binary requires GLIBC 2.34 but system has GLIBC 2.31. Cannot use pre-compiled bbox3.

## Key Technical Findings
1. **Per-N Analysis**: Small N values (1-15) contribute disproportionately to score. Top 10 worst N values contribute 6.1% of total. N=1 alone = 0.66 (0.93% of total).
2. **Need ~2.5% improvement** across all N to beat target
3. **tree_packer_v21 compiled and works** - can use with more aggressive settings
4. **Ensemble approach is key** - top kernels combine best configs from multiple sources for each N

## Response to Evaluator
The evaluator correctly identified:
1. **Settings too modest**: -n 2000 -r 30 is insufficient. Agree - need -n 10000+ -r 256+
2. **bbox3 not used**: Correct, but we discovered bbox3 requires GLIBC 2.34 which is unavailable. Must rely on tree_packer_v21.
3. **Backward propagation not implemented**: Agree - this is a key technique to implement
4. **Per-N analysis needed**: Done - identified N=1-15 as worst performers

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Run tree_packer_v21 with AGGRESSIVE settings
Since bbox3 is unavailable, maximize tree_packer_v21:
```bash
./tree_packer_v21 -n 10000 -r 256  # Much longer runs
```
Run for 1-2 hours minimum. The current submission is already at a local optimum for modest settings.

### 2. **[HIGH PRIORITY]** Implement Ensemble Approach
The jonathanchan kernel shows the key insight: **for each N, pick the BEST configuration from multiple sources**.
- Download multiple pre-optimized submissions from different kernels
- For each N=1 to 200, compare scores and keep the best
- This alone can improve score significantly

### 3. **[HIGH PRIORITY]** Implement Backward Propagation
From santa-claude kernel:
```
For N from 200 down to 2:
    For each tree in configuration N:
        Try removing that tree
        If resulting (N-1) config is better than stored best for (N-1):
            Update stored best
```
This propagates good configurations from larger N to smaller N.

### 4. **[MEDIUM PRIORITY]** Implement Fractional Translation Polish
From jonathanchan kernel - very fine position adjustments:
```cpp
double frac_steps[] = {0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001};
```
Apply after main optimization to squeeze out final improvements.

### 5. **[MEDIUM PRIORITY]** Apply fix_direction with Multiple Passes
Current implementation uses 2 passes. Try 5+ passes for better rotation optimization.

### 6. **[LOWER PRIORITY]** Focus on Worst N Values
N=1 through N=15 contribute disproportionately. Consider:
- Manual optimization for N=1 (optimal is 45° rotation, score ~0.66)
- Extra optimization iterations for small N

## Implementation Strategy for Next Experiment

### Experiment 002: Extended Optimization + Ensemble
1. **Download additional pre-optimized submissions**:
   - bucket-of-chump/submission.csv (already have)
   - santa-2025-csv/santa-2025.csv (already have)
   - Try to get more from other kernel datasets

2. **Run tree_packer_v21 with aggressive settings**:
   ```bash
   ./tree_packer_v21 -n 10000 -r 128  # Start with this
   ```
   
3. **Implement ensemble**: For each N, compare all available submissions and keep best

4. **Apply fix_direction with 5 passes**

5. **Implement backward propagation**

6. **Apply fractional translation polish**

Expected improvement: 1-2 points (from 70.73 to ~69)

## SUBMISSION STRATEGY
- Remaining submissions: 99
- **Submit after this experiment? YES** - We have abundant submissions and need LB feedback to calibrate CV-LB relationship

## What NOT to Try
- Trying to run bbox3 (GLIBC incompatibility)
- Modest optimization settings (-n < 5000)
- Single-source approaches (ensemble is key)

## Validation Notes
- Score = Σ(s²/n) for n=1 to 200
- Validate no overlaps before submission
- Use Shapely for collision detection
