# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 1)

## Current Status
- Best CV score: 70.7343 from exp_000 (001_baseline_tree_packer_v21)
- Best LB score: 70.7343 (CV = LB perfectly - expected for deterministic optimization)
- Target: 68.931058 | Gap to target: 1.803 points (2.55%)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **PARTIALLY** - We have the starting submission but bbox3 binary doesn't work (GLIBC 2.34 required, system has 2.31)
- Top kernels identified:
  1. Santa-submission (saspav) - uses bbox3 + fix_direction
  2. Santa Claude (smartmanoj) - tree_packer_v21 + backward propagation
  3. Ensemble + SA + Fractional Translation (jonathanchan) - **KEY APPROACH**
  4. Best-Keeping bbox3 Runner (yongsukprasertsuk) - 3-hour optimization pipeline
- Kernels we've implemented: tree_packer_v21 (compiled), fix_direction
- **CRITICAL BLOCKER**: bbox3 binary requires GLIBC 2.34, cannot use directly

## CV-LB Relationship Analysis
- CV = LB exactly (gap: 0.0000) - This is expected for deterministic optimization problems
- No distribution shift concerns - this is pure optimization, not prediction

## Response to Evaluator
The evaluator correctly identified that:
1. **bbox3 is unavailable** - GLIBC incompatibility confirmed. Must use tree_packer_v21 or implement SA in Python
2. **Optimization settings too modest** - Agreed. Need -n 10000+ -r 100+ for extended runs
3. **Backward propagation not implemented** - Agreed. This is a key technique from santa-claude kernel
4. **Per-N analysis needed** - DONE. Found worst 20 N values contribute 11.4% of total score

**Key insight from analysis**: The current submission (70.7343) is identical to santa-2025.csv. All other public datasets I found score WORSE:
- bucket-of-chump: 70.7507
- SmartManoj GitHub: 70.7438
- telegram-public: 71.97, 72.49
- santa25-public best: 70.926

This means **our starting point is already the best publicly available submission**. To beat the target, we need to:
1. Run extended optimization with tree_packer_v21 (much longer runs)
2. Implement fractional translation (very fine position adjustments)
3. Implement backward propagation (use N config to improve N-1)
4. Focus on worst-performing N values

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Extended tree_packer_v21 Optimization
Since bbox3 is unavailable, run tree_packer_v21 with aggressive settings:
```bash
./tree_packer_v21 -n 10000 -r 100  # Much longer than baseline
```
Then apply fix_direction with 3+ passes.

### 2. **[HIGH PRIORITY]** Implement Fractional Translation
From jonathanchan kernel - very fine position adjustments:
```cpp
double frac_steps[] = {0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001};
// For each tree, try moving in 8 directions by these tiny amounts
// Accept if bounding box shrinks
```
This can squeeze out small improvements after main optimization.

### 3. **[HIGH PRIORITY]** Implement Backward Propagation
From santa-claude kernel:
```
For N from 200 down to 2:
    For each tree in config[N]:
        Try removing that tree
        If resulting (N-1) config is better than stored best for (N-1):
            Update stored best for (N-1)
```
This propagates improvements from larger N to smaller N.

### 4. **[MEDIUM PRIORITY]** Focus on Worst N Values
Per-N analysis shows:
- N=1 to N=20 contribute most to score
- Worst 20 N values = 11.4% of total score
- Improving worst 20 by 20% would save 1.615 points (nearly enough!)

Target specific N values with extra optimization iterations.

### 5. **[MEDIUM PRIORITY]** Implement Python SA for Small N
For N < 20, implement simulated annealing in Python:
- Small N = small search space = Python is fast enough
- Can use more sophisticated moves (per-tree rotation, swaps)

## What NOT to Try
- Using bbox3 binary (GLIBC incompatible)
- Downloading more public datasets (all score worse than our current)
- Multi-seed ensembles (premature - need to improve single-run first)

## SUBMISSION STRATEGY
- Remaining submissions: 98
- **Submit after EVERY experiment** - We have abundant submissions
- LB feedback is free information - USE IT!

## Validation Notes
- CV = LB for this problem (deterministic optimization)
- Always validate no overlaps before submission
- Use fix_direction after every optimization run

## Technical Notes
- tree_packer_v21 is compiled and working at /home/code/experiments/001_baseline/tree_packer_v21
- fix_direction code is in the baseline notebook
- Starting submission: /home/code/datasets/santa-2025-csv/santa-2025.csv (score: 70.7343)
