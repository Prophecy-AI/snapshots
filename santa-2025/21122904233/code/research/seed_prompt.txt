# Santa 2025 - Evolved Strategy (Loop 3)

## Current Status
- **Best CV**: 121.04 (Heavy Rotation 20k)
- **Target**: 68.92
- **Gap**: ~52 points
- **Approach**: C++ Optimization (SA + BP) + Python Rotation

## Critical Insight: The "BP Loop"
Research and code analysis reveal that **Backward Propagation (BP)** is the primary engine for improvement.
- `bp` (standalone) and `tree_packer` (internal Phase 2) both do the same thing: try to improve `N-1` by removing a tree from `N`.
- The current pipeline runs `Pack -> Rotate -> BP` **once**.
- **The Winning Strategy**: Run this loop **continuously**.
    - `Pack` finds good local optima for `N`.
    - `Rotate` squeezes them further.
    - `BP` transfers these gains to `N-1`.
    - `Pack` then re-optimizes `N-1` (which is now better) and `N` (to find new candidates for BP).

## Recommended Approach: "Infinite Loop"
Create a Python script `run_infinite_loop.py` that runs for a fixed duration (e.g., 1 hour).

**Loop Logic:**
1. **Load Best Submission** (warm start).
2. **Phase A: Exploration (Pack)**
   - Run `tree_packer` with moderate iterations (e.g., 10k).
   - This explores the landscape for all N.
3. **Phase B: Squeeze (Rotate)**
   - Run `optimize_rotation` (Python) to tighten all N.
   - This creates "room" that BP can exploit.
4. **Phase C: Exploitation (BP)**
   - Run `bp` (standalone).
   - This propagates gains downwards.
5. **Save & Repeat**.

**Key Change**: Instead of one long run, do **many short runs** of `tree_packer` interleaved with `Rotate` and `BP`. This allows `BP` to harvest gains more frequently.

## Implementation Details
- **Notebook**: `experiments/003_infinite_loop/run_loop.ipynb`
- **Script**: Implement the loop in Python inside the notebook.
- **Time Limit**: Set the loop to run for ~55 minutes (leaving time for validation).
- **Rotation**: Reuse the `optimize_rotation` logic from Loop 2.
- **Binaries**: Reuse `tree_packer` and `bp` from `experiments/002_heavy_rotation/`.

## Response to Evaluator
- **Evaluator**: "The pipeline Pack -> Rotate -> BP is good, but it needs to be a loop."
- **Response**: Agreed. Loop 3 will implement exactly this: a continuous loop of Pack-Rotate-BP for the full duration.
- **Evaluator**: "20k iterations is still too low."
- **Response**: By looping, we will accumulate iterations. 10 loops of 10k = 100k effective iterations, but with BP mixing in between.

## Validation
- Check `submission.csv` score after each loop.
- Ensure no overlaps (the tools guarantee this, but verify).
