# Christmas Tree Packing Optimization - Seed Prompt (Loop 3)

## Current Status
- Best CV score: 70.682741 from exp_002 (003_preoptimized_baseline_with_overlap_repair)
- Best LB score: 70.682741 (verified - perfect CV-LB alignment!)
- Target: 68.922808 | Gap to target: 1.76 points (2.5%)

## CV-LB Relationship Analysis
- **Perfect alignment**: CV = LB (gap: 0.0000)
- This is an OPTIMIZATION problem, not a prediction problem
- No distribution shift - what we compute locally IS the LB score
- All improvements in CV will directly translate to LB improvements

## Response to Evaluator

The evaluator correctly identified that:
1. ✅ The pivot to pre-optimized baseline was correct (70.68 vs 88.14 from scratch)
2. ✅ The gap is now small (1.76 points = 2.5%) and achievable
3. ⚠️ bbox3 optimizer didn't improve because baseline is at local optimum
4. ⚠️ Optimization time was insufficient - need hours, not minutes

**Key insight from evaluator**: The jonathanchan kernel has a DIFFERENT optimizer (C++ SA with fractional translation) that could escape local optima. This is fundamentally different from bbox3.

## What's Been Tried (and Results)
1. **Greedy placement** (exp_000): Score 164.09 - too far from target
2. **Grid baseline + bbox3** (exp_001): Score 88.14 - better but still far
3. **Pre-optimized baseline** (exp_002): Score 70.68 - close to target!
   - bbox3 optimizer: No improvement (already at local optimum)
   - fix_direction rotation: No improvement (already rotation-optimized)
   - Backward propagation: Tiny improvement (0.0017 points)
   - Ensemble of CSVs: Tiny improvement (0.003 points)

## Key Findings from Analysis
1. **Worst-performing N values are small N (1-15)**: N=1 scores 0.661, N=2 scores 0.451
2. **Improving worst 20 N by 10% only saves 0.81 points** - not enough to close 1.76 gap
3. **Need broader improvements across ALL N values**
4. **best_ensemble.csv scores 70.676 (better than our 70.683) but has 12 overlaps**

## Available Pre-optimized CSVs (Scores)
- santa-2025.csv: 70.68 (12 overlaps)
- best_ensemble.csv: 70.676 (12 overlaps) 
- ensemble.csv: 70.676 (13 overlaps)
- submission.csv: 70.677 (11 overlaps)
- chistyakov/submission_best.csv: 70.93 (0 overlaps)
- telegram/71.97.csv: 71.97 (0 overlaps)
- telegram/72.49.csv: 72.49 (0 overlaps)

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Compile and Run jonathanchan C++ SA Optimizer
The jonathanchan kernel has a sophisticated C++ optimizer with:
- **opt_v3**: Multi-start SA with population of 3
- **fractional_translation**: Fine-grained position adjustments (0.001 down to 0.00001 step sizes)
- **ls_v3**: Local search

This is FUNDAMENTALLY DIFFERENT from bbox3 and could escape local optima.

**Implementation steps:**
1. Extract sa_v1_parallel.cpp from the jonathanchan kernel
2. Compile with: `g++ -O3 -march=native -std=c++17 -fopenmp -o sa_v1_parallel sa_v1_parallel.cpp`
3. Run: `./sa_v1_parallel -i submission.csv -o output.csv -n 15000 -r 5`
4. Run for multiple generations (the code has built-in multi-generation support)

### 2. **[HIGH PRIORITY]** Create Better Ensemble with Overlap Repair
For each N from 1-200:
1. Load ALL available CSVs (including best_ensemble.csv which has better scores)
2. For each N, pick the configuration with lowest score that has NO overlaps
3. If best config has overlap, use next-best overlap-free config
4. This could improve score by combining best of all sources

### 3. **[MEDIUM PRIORITY]** BackPacking Approach (from crodoc kernel)
Backward iteration from N=200 to N=1:
1. Start with best N=200 configuration
2. For each N from 199 down to 1:
   - Try removing each tree from N+1 configuration
   - If resulting N-config is better than current best for N, use it
3. This propagates good packing patterns from larger to smaller N

### 4. **[MEDIUM PRIORITY]** Extended Multi-Phase Optimization
If jonathanchan optimizer shows promise, run extended optimization:
- Phase A: 15 runs × 2 min = 30 min (explore parameter space)
- Phase B: 3 runs × 10 min = 30 min (medium refinement)  
- Phase C: 2 runs × 20 min = 40 min (deep optimization)
- Total: ~100 min minimum

## What NOT to Try
- ❌ More bbox3 runs (baseline is at local optimum for this optimizer)
- ❌ More fix_direction rotation (already rotation-optimized)
- ❌ Building from scratch (pre-optimized baselines are much better)
- ❌ Simple backward propagation (only found 0.0017 improvement)

## SUBMISSION STRATEGY
- **Remaining submissions: 93** (abundant!)
- **Submit after EVERY experiment** - LB feedback is free information
- This is an optimization problem with perfect CV-LB alignment
- Every improvement in CV will directly translate to LB improvement

## Validation Notes
- Score = Σ(side_length² / N) for N=1 to 200
- Lower is better
- Must have NO overlaps for valid submission
- CV = LB for this problem (no distribution shift)

## Technical Notes
- C++ compiler available: g++ 9.4.0
- OpenMP available for parallel optimization
- Pre-optimized CSVs in: /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/
- jonathanchan kernel code in: /home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/