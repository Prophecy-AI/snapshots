# Christmas Tree Packing Optimization - Evolved Seed Prompt (Loop 2)

## Current Status
- Best CV score: 88.14 from exp_001 (grid baseline + bbox3)
- Best LB score: N/A (no submissions yet - MUST SUBMIT!)
- Target: 68.922808 | Gap to target: 19.22 points (27.9% worse)

## CRITICAL DISCOVERY: Pre-optimized Baselines Available!
The evaluator correctly identified pre-optimized CSVs that are MUCH better than our current score:

| Baseline | Score | Overlaps | Gap to Target |
|----------|-------|----------|---------------|
| **chistyakov/submission_best.csv** | **70.93** | **0** | **2.01 points** |
| santa-2025.csv | 70.68 | 12 | 1.76 points |
| 71.97.csv | 71.97 | 0 | 3.05 points |
| 72.49.csv | 72.49 | 0 | 3.57 points |
| Our grid+bbox3 | 88.14 | 0 | 19.22 points |

**The chistyakov baseline at 70.93 is overlap-free and only 2.01 points from target!**

## Response to Evaluator
The evaluator was 100% correct. We wasted optimization effort on the grid baseline (88.14) when pre-optimized baselines scoring 70.93 were available. This is a MASSIVE shortcut.

**Key insight:** The gap from 70.93 to 68.92 is only 2.01 points (2.9% improvement needed). This is achievable with:
1. bbox3 multi-phase optimization
2. Backward propagation
3. Per-N targeted optimization

## Recommended Approaches (Priority Order)

### 1. **[CRITICAL - DO FIRST]** Use Pre-optimized Baseline
```bash
cp /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/chistyakov/submission_best.csv /home/code/experiments/003_preoptimized/baseline.csv
```
- Score: 70.93 (verified, no overlaps)
- Gap to target: only 2.01 points!

### 2. **[HIGH PRIORITY]** Multi-Phase bbox3 Optimization
Run on the 70.93 baseline:
- Phase A: Multiple 2-minute runs with n=5000, r=30,60,90,120
- Phase B: 10-minute runs on best candidates
- Phase C: 20-minute runs on best few
- Apply fix_direction after each phase

### 3. **[HIGH PRIORITY]** Backward Propagation
From smartmanoj kernel - for N=200 down to N=2:
- Try removing boundary-touching trees from N config
- Check if resulting (N-1) config is better than current best for N-1
- This can improve many N values simultaneously

### 4. **[MEDIUM PRIORITY]** Repair Overlaps in santa-2025.csv
The santa-2025.csv scores 70.68 (better than chistyakov) but has 12 overlaps.
- Identify which N values have overlaps
- Replace those with configurations from chistyakov or 71.97.csv
- This could give us a better starting point

### 5. **[MEDIUM PRIORITY]** Ensemble Best Configurations
For each N from 1 to 200:
- Compare scores from: chistyakov, 71.97.csv, 72.49.csv, our grid+bbox3
- Take the best configuration for each N
- This creates an optimal ensemble

### 6. **[LOWER PRIORITY]** Per-N Targeted Optimization
Identify N values with worst efficiency (highest S²/N):
- Run longer bbox3 optimization on those specific N values
- Focus compute on high-impact configurations

## What NOT to Try
- ❌ More optimization on grid baseline (88.14) - dead end, too far from target
- ❌ Building from scratch - pre-optimized baselines are much better
- ❌ Short bbox3 runs - need longer runs for meaningful improvement

## Validation Notes
- CV scheme: Calculate total score = Σ(S²/N) for N=1 to 200
- Always validate for overlaps before submission
- Use Shapely STRtree for efficient collision detection

## SUBMISSION STRATEGY
- Remaining submissions: 94
- **SUBMIT IMMEDIATELY** after using pre-optimized baseline
- We need LB feedback to calibrate CV-LB relationship
- With 94 submissions, we can afford to submit frequently

## Next Experiment: 003_preoptimized_baseline
1. Copy chistyakov/submission_best.csv as starting point
2. Verify score is 70.93 and no overlaps
3. Run multi-phase bbox3 optimization (Phase A: 2min x 4, Phase B: 10min x 2, Phase C: 20min x 1)
4. Apply fix_direction after each phase
5. Run backward propagation
6. Submit best result

Expected score: 69-70 (should be very close to target!)

## File Locations
- Pre-optimized baselines: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/`
- bbox3 binary: `/home/code/experiments/002_grid_baseline/bbox3`
- Current best submission: `/home/submission/submission.csv` (88.14)