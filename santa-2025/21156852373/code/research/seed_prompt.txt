# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.676102 from exp_000 (001_baseline)
- Best LB score: 70.676102 (verified - CV matches LB exactly!)
- Target: 68.919154 | Gap to target: 1.756948 (2.5%)
- Submissions used: 1/100 (99 remaining - ABUNDANT!)

## CV-LB Relationship Analysis
- Only 1 submission so far, but CV = LB exactly (70.676102)
- This is an optimization problem, not ML - CV should match LB perfectly
- No distribution shift concerns - just need to find better packings

## Response to Evaluator
The evaluator correctly identified that:
1. ✓ Baseline is solid - score verified, no overlaps, N=1 at optimal 45°
2. ✓ Need to start LONG optimization runs IMMEDIATELY
3. ✓ Multiple parallel strategies needed (bbox3, tree_packer, lattice, fix_direction)
4. ✓ Small N values (1-15) have worst efficiency - focus optimization there

**Key insight from evaluator**: The pre-optimized submission is at a VERY TIGHT local optimum. Short runs (minutes) find NO improvements. Top solutions run for HOURS.

## Key Research Findings

### 1. SYMMETRIC SOLUTIONS ARE KEY (from discussions)
- Forcing symmetric layouts dramatically shrinks search space
- Top competitors use symmetry-enforcing tricks as core part of algorithm
- Symmetric solutions achieve smaller bounding boxes AND reduce compute time

### 2. 3-Phase Optimization Strategy (from best-keeping-bbox3-runner)
- **Phase A**: Short runs (2min each, n=1000-2000, r=30-90) to find promising settings
- **Phase B**: Medium runs (10min each) on top candidates
- **Phase C**: Long runs (20min each) on best few
- Apply fix_direction + overlap repair after EACH phase

### 3. Fractional Translation (from ensemble kernel)
- After SA optimization, apply tiny fractional moves (0.001 to 0.00001)
- Try 8 directions for each tree
- This squeezes out final improvements

### 4. Ensemble Strategy (from jonathanchan kernel)
- Combine best configurations from MULTIPLE sources:
  - bucket-of-chump dataset
  - telegram shared solutions
  - santa25-public dataset
  - Multiple kernel outputs
- For each N, keep the configuration with smallest bounding box

## Available Resources
- Pre-compiled bbox3 at `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
- Pre-optimized santa-2025.csv (current baseline)
- Multiple CSV sources in snapshots for ensemble
- C++ source code for tree_packer_v21, sa_v1_parallel

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Run Extended bbox3 Optimization
```bash
# Copy bbox3 and start long optimization
cp /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3 /home/code/
cp /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa-2025.csv /home/code/current.csv
cd /home/code
./bbox3 -n 15000 -r 80 < current.csv > optimized.csv 2>&1
```
Run for 1-2 hours minimum. The gap of 1.76 points requires extended compute time.

### 2. **[HIGH PRIORITY]** Implement fix_direction Post-Processing
After any optimization run:
- Use convex hull to find optimal rotation angle for each N
- Apply rotation to minimize bounding box
- This can yield small but consistent improvements

### 3. **[HIGH PRIORITY]** Build Ensemble from Multiple Sources
Collect best configurations from:
- `/home/nonroot/snapshots/santa-2025/*/code/preoptimized/*.csv`
- For each N, keep the configuration with smallest s_n²/n contribution

### 4. **[MEDIUM PRIORITY]** Compile and Run tree_packer_v21
Alternative optimizer with different search strategy:
- Swap moves between trees
- Multi-angle restarts
- Higher temperature SA

### 5. **[MEDIUM PRIORITY]** Focus on Small N Values
- N=1 contributes 0.661 to score (highest single contribution)
- N=1-15 have lowest efficiency (1.5-2.6 trees/unit area)
- Even small improvements here have outsized impact

## What NOT to Try
- Short optimization runs (< 30 minutes) - won't find improvements
- Simple parameter tweaks without extended runtime
- Backward propagation alone (already tried in previous experiments)

## SUBMISSION STRATEGY
- Remaining submissions: 99 (ABUNDANT!)
- Submit after EVERY experiment that produces a valid submission
- LB feedback is free - USE IT!

## Validation Notes
- Score = Σ(s_n²/n) for n=1 to 200
- Lower is better
- No overlaps allowed (use Shapely for validation)
- CV should match LB exactly for this optimization problem