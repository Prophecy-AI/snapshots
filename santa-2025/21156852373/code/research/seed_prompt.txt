# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.659944 from exp_001 (002_extended_optimization)
- Best LB score: 70.676102 (from exp_000 baseline submission)
- Target: 68.919154 | Gap to target: 1.74 points (2.5%)

## CRITICAL INSIGHT: LOCAL OPTIMUM TRAP

**The baseline is at a VERY TIGHT LOCAL OPTIMUM.**

Evidence:
- bbox3 ran 80 rounds with ZERO improvement (score stayed at exactly 70.676102)
- tree_packer_v21 ran 5000 iterations, 32 restarts - ZERO improvement
- Eazy optimizer - ZERO improvement
- fix_direction rotation optimization - ZERO improvement
- Ensemble from 23 CSV files - ZERO improvement (baseline dominates all N values)

**CONCLUSION: Standard optimizers CANNOT escape this local optimum.**

## Response to Evaluator

The evaluator correctly identified that:
1. The current optimization approach has definitively failed (80 rounds, 0 improvement)
2. A PIVOT is needed to fundamentally different approaches
3. Key unexplored directions: symmetric solutions, lattice-based packing, perturbed restarts

I agree with all these points. The next experiment MUST try a fundamentally different approach.

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Build Valid Ensemble with Overlap Repair**

A previous snapshot achieved 70.559 by ensembling 40 snapshots, but it had overlaps.
The approach is sound - different snapshots have better configurations for specific N values.

**Implementation:**
1. Scan ALL 809 CSV files across all snapshots
2. For each N, find the configuration with smallest bounding box
3. **CRITICAL**: Validate NO overlaps before accepting
4. If overlap detected, fall back to baseline for that N
5. This could recover some of the 0.1 point improvement

### 2. **[HIGH PRIORITY] Symmetric Solutions (42 upvotes discussion)**

The discussion "Symmetric solutions that are apparently optimal" has 42 upvotes.
Forcing symmetric layouts dramatically shrinks search space while still covering optimal region.

**Implementation:**
- For each N, try forcing mirror symmetry across x-axis, y-axis, or both
- For perfect squares (4, 9, 16, 25, 36, 49, 64, 81, 100, 121, 144, 169, 196), try grid-based symmetric layouts
- Use symmetry to reduce the optimization problem size

### 3. **[HIGH PRIORITY] Lattice-Based Approach for Large N**

For large N values (72, 100, 110, 144, 156, 196, 200), grid-based placement can be fundamentally tighter.

**Implementation:**
- Start with two base trees and translate them in x and y directions
- Parameters: nx × ny grid where nx*ny >= N
- This generates crystalline/lattice packings different from random optimization

### 4. **[MEDIUM PRIORITY] Targeted Small N Optimization**

Small N values have worst efficiency and highest score contribution:
- N=1: 0.661 (highest single contribution)
- N=2: 0.437
- N=3: 0.435
- N=4: 0.411

**Implementation:**
- N=1: Exhaustive angle search 0-90° (verify 45° is truly optimal)
- N=2-10: Try all reasonable symmetric configurations
- These contribute disproportionately to score

### 5. **[MEDIUM PRIORITY] Perturbed Restarts with Significant Noise**

Add significant noise (0.1-0.5 units) to current solution, then re-optimize.

**Implementation:**
- Perturb all tree positions by random amount (0.1-0.5 tree widths)
- Run bbox3 or tree_packer_v21 on perturbed solution
- Keep best result
- Repeat with different perturbation seeds

## What NOT to Try

- ❌ More rounds of bbox3/tree_packer_v21 on the baseline (proven to not work)
- ❌ Simple ensemble without overlap validation (produces invalid solutions)
- ❌ fix_direction alone (already applied, no improvement)
- ❌ Short optimization runs (need hours, not minutes)

## Validation Notes

- Always validate NO overlaps before accepting a solution
- Use the scoring function: Σ(s_n² / n) for n=1 to 200
- Lower score is better
- Target: 68.919154

## Key Resources

### C++ Optimizers (already compiled)
- `/home/code/bbox3_compiled` - Main optimizer
- `/home/code/tree_packer_v21` - Alternative optimizer

### Pre-optimized Solutions
- `/home/code/current.csv` - Baseline (70.676102, valid)
- 809 CSV files across `/home/nonroot/snapshots/santa-2025/`

### Kernels
- `research/kernels/jazivxt_eazy-optimizer/` - Eazy optimizer with Square Calculus Pressure
- `research/kernels/saspav_santa-submission/` - fix_direction post-processing
- `research/kernels/crodoc_74-75-backpacking-christmas-trees/` - Backward iteration approach

## SUBMISSION STRATEGY

- Remaining submissions: 99
- **Submit after EVERY experiment** - we have abundant submissions
- LB feedback tells us what ACTUALLY works
- Even small improvements are worth submitting to calibrate CV-LB relationship
