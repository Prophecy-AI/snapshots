# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.676102 from ensemble.csv (overlap-free)
- Best LB score: N/A (first submission failed due to overlaps in best_ensemble.csv)
- Target: 68.919154 | Gap to target: 1.756948 points

## CRITICAL FIX NEEDED
The first submission failed with "Overlapping trees in group 040". Analysis revealed:
- `best_ensemble.csv` has overlaps detected by Kaggle validation
- `ensemble.csv` and `santa-2025.csv` are OVERLAP-FREE with score 70.676102
- **USE `ensemble.csv` as the baseline** - it's verified overlap-free

## Problem Overview
This is a 2D geometric packing optimization problem. The goal is to pack Christmas tree-shaped polygons into the smallest possible square bounding box for configurations of N=1 to N=200 trees.

**Metric:** score = Σ(side_n² / n) for n=1 to 200 (lower is better)
**Target Score:** 68.919154
**Current Best Overlap-Free:** 70.676102 (ensemble.csv)
**Gap to Target:** ~1.76 points improvement needed

## Tree Geometry
Each tree is a 15-vertex polygon with:
- Tip at (0, 0.8)
- Three tiers of branches at y=0.5, 0.25, 0.0
- Trunk at bottom (y=-0.2)
- Width: 0.7 at base, 0.4 at middle, 0.25 at top
- Trunk width: 0.15

**CRITICAL**: Use Decimal precision with scale_factor = Decimal('1e15') for polygon calculations to match Kaggle validation.

## Available Pre-optimized Solutions (Overlap Status)
| File | Score | Overlaps |
|------|-------|----------|
| ensemble.csv | 70.676102 | ✅ None |
| santa-2025.csv | 70.676102 | ✅ None |
| best_ensemble.csv | 70.676102 | ❌ Group 040 |
| bucket-of-chump/submission.csv | 70.676501 | ❌ Groups 12,54,63,116,134,170 |
| submission_70_926149550346.csv | 70.926150 | ✅ None |
| telegram/71.97.csv | 71.97 | ❌ Groups 114,178,199 |

## Response to Evaluator
The evaluator correctly identified that:
1. The bbox3 C++ optimizer should be used - this is the core optimization engine
2. Small N values (1-10) contribute ~4 points and have improvement potential
3. Multiple solutions should be ensembled by taking best N from each source

**Key insight from analysis**: The submission failed because best_ensemble.csv has overlaps that Kaggle detects but our local validation missed. The fix is to use ensemble.csv which is verified overlap-free.

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Submit overlap-free baseline
- Copy ensemble.csv directly to submission (no modifications)
- This establishes a verified LB score baseline
- Score: 70.676102

### 2. **[HIGH PRIORITY]** Run bbox3 C++ optimizer
The bbox3 optimizer is at `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
- Copy to working directory and make executable
- Run with parameters: `./bbox3 -n 1500 -r 60` (1500 iterations, 60 restarts)
- The optimizer reads submission.csv and writes improved submission.csv
- After bbox3, apply fix_direction rotation optimization
- Validate no overlaps before submitting

### 3. **[MEDIUM PRIORITY]** Create ensemble of best N from multiple sources
- For each N=1 to 200, compare scores across all overlap-free solutions
- Take the configuration with smallest bounding box for each N
- This can combine strengths of different optimization runs

### 4. **[MEDIUM PRIORITY]** Focus on small N optimization
- N=1 contributes 0.661 to score (side=0.8132)
- N=2 contributes 0.451 to score (side=0.9495)
- N=3 contributes 0.435 to score (side=1.1420)
- Small N values are more tractable for exhaustive/near-exhaustive search
- Consider backward propagation: remove trees from N+1 to get better N

## What NOT to Try
- Using best_ensemble.csv directly (has overlaps)
- Modifying coordinates without preserving full precision (causes overlaps)
- Saving with Python's default float precision (use string format with 's' prefix)

## Validation Notes
- Always validate for overlaps before submitting
- Use the exact tree geometry from the getting-started notebook
- Use Decimal precision with scale_factor = 1e15 for calculations
- Preserve full string precision when saving (don't round floats)

## SUBMISSION STRATEGY
- Remaining submissions: 95
- Submit after this experiment? **YES** - we need to establish a verified LB baseline
- The overlap-free ensemble.csv should score ~70.676 on LB

## Key Files
- Baseline: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/ensemble.csv`
- bbox3 optimizer: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
- Kernel reference: `/home/code/research/kernels/yongsukprasertsuk_santa-2025-best-keeping-bbox3-runner/`
