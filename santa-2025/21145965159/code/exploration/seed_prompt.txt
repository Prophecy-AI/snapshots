# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.676102 from exp_000 (001_baseline)
- Best LB score: N/A (no submissions yet)
- Target: 68.919154 | Gap to target: 1.756948

## Response to Evaluator
The evaluator correctly identified that:
1. **fix_direction on pre-optimized solution yields no improvement** - the baseline was already rotation-optimized
2. **bbox3 C++ optimizer is available but not being used** - this is the core optimization engine
3. **Multiple solution sources exist that should be ensembled** - bucket-of-chump, telegram, santa25-public
4. **Small N values (1-10) contribute disproportionately** - ~4 points from just 10 configurations

I agree with all these points. The next experiment should:
1. **Create an ensemble** of all available pre-optimized solutions (take best N from each source)
2. **Run bbox3 optimizer** on the ensemble to further improve
3. **Submit to get LB feedback** - we have 95 submissions remaining

## Key Resources Available
1. **bbox3 C++ optimizer**: `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bbox3`
   - Usage: `./bbox3 -n <iterations> -r <restarts>` (e.g., -n 1500 -r 60)
   - Reads/writes submission.csv in current directory
   
2. **Pre-optimized solutions**:
   - `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/best_ensemble.csv` (score ~70.676)
   - `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/bucket-of-chump/submission.csv`
   - `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/telegram/*.csv`
   - `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/santa25-public/*.csv` (multiple versions)
   - `/home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/chistyakov/`

3. **Kernel techniques**:
   - Ensemble: Take best configuration for each N from multiple sources
   - SA + fractional translation (from jonathanchan kernel)
   - fix_direction rotation optimization
   - Overlap repair using donor solutions

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Create Ensemble from All Sources**
Combine all available pre-optimized solutions by taking the best configuration for each N:
```python
# For each N from 1 to 200:
#   - Calculate score for that N from each source
#   - Keep the configuration with lowest score
```
This should immediately improve the baseline without any optimization.

### 2. **[HIGH PRIORITY] Run bbox3 Optimizer**
After creating the ensemble:
```bash
cp ensemble.csv submission.csv
./bbox3 -n 1500 -r 60  # ~2-3 min run
```
The bbox3 optimizer performs simulated annealing and can find improvements.

### 3. **[MEDIUM PRIORITY] Focus on Small N Values**
Small N values contribute disproportionately to the score:
- N=1: 0.661 (optimal is 0.5 with 45° rotation)
- N=2: 0.451
- N=3: 0.435

For N=1, the optimal solution is known: x=0, y=0, deg=45 (gives side=√0.5 ≈ 0.707, score=0.5)
Current N=1 score is 0.661, so there's 0.161 improvement possible just from N=1!

### 4. **[MEDIUM PRIORITY] Apply fix_direction After bbox3**
After bbox3 optimization, apply fix_direction to tighten bounding boxes.

## What NOT to Try
- Running fix_direction alone on pre-optimized solutions (already done, no improvement)
- Building solutions from scratch (pre-optimized solutions are better starting points)

## Validation Notes
- Score = Σ(side²/N) for N=1 to 200 (lower is better)
- Must validate no overlaps before submission
- Use Shapely for polygon geometry

## SUBMISSION STRATEGY
- Remaining submissions: 95
- **Submit after this experiment? YES** - we need LB feedback to calibrate
- With 95 submissions, we should submit frequently to get real feedback

## Next Experiment: 002_ensemble_bbox3
1. Load all pre-optimized solutions
2. Create ensemble (best N from each source)
3. Fix N=1 to optimal (x=0, y=0, deg=45)
4. Run bbox3 optimizer
5. Apply fix_direction
6. Validate no overlaps
7. Calculate score and submit
