# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.675457 from corner_extraction ensemble (overlap-free)
- Best verified LB score: 70.676102 (ensemble.csv)
- Target: 68.919154 | Gap to target: 1.756303 points (2.55%)
- Submissions remaining: 93

## CRITICAL ISSUE: Overlap Detection Mismatch
The eazy optimizer submission FAILED with "Overlapping trees in group 003" despite our local Shapely validation showing NO overlaps. This is a **precision mismatch** between:
- Our local validation (Shapely with float64)
- Kaggle's validation (likely Decimal with higher precision)

**The eazy optimizer modified tree 003_0:**
- Baseline: (1.123656, 0.781102, 111.125132°)
- Eazy: (1.143369, 0.819464, 112.872681°)

This small change created an overlap that Kaggle detected but we missed.

## Response to Evaluator
The evaluator correctly identified:
1. ✅ The eazy optimizer achieved the FIRST ACTUAL IMPROVEMENT (0.000624)
2. ✅ But the submission FAILED due to overlaps
3. ✅ The improvement rate is too slow (need 2800x more improvement)
4. ✅ We need fundamentally different approaches

**Key insight**: The eazy optimizer DOES find improvements, but introduces precision issues. We need to either:
1. Use more robust optimizers that don't create overlaps
2. Validate with higher precision before submitting
3. Try fundamentally different approaches

## Available Overlap-Free Solutions
| File | Score | Status |
|------|-------|--------|
| ensemble.csv | 70.676102 | ✅ Verified on LB |
| corner_extraction.csv | 70.675510 | ✅ Overlap-free |
| corner+ensemble ensemble | 70.675457 | ✅ Overlap-free |

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Submit corner_extraction ensemble
- Score: 70.675457 (improvement of 0.000645 over baseline)
- Verified overlap-free by local validation
- This is a SAFE improvement that should work on LB
- **SUBMIT THIS FIRST** to verify it works

### 2. **[HIGH PRIORITY]** Try bbox3 optimizer from "why-not" kernel
The bbox3 optimizer uses different techniques than eazy:
- Complex Number Vector Coordination
- Fluid Dynamics simulation
- Hinge Pivot optimization
- Density Gradient Flow
- Global Boundary Tension
- Dynamic Scaling and Overlap Repair

This may be more robust and find different improvements.

### 3. **[HIGH PRIORITY]** Implement backward propagation
From the backpacking kernel:
- Start from N=200 and work backward to N=1
- When a smaller N has worse score than a larger N, copy the larger configuration and drop trees
- This propagates good packing patterns from large N to small N

### 4. **[MEDIUM PRIORITY]** Focus on small N optimization
From analysis:
- N=1 contributes 0.661 to score (side=0.8132)
- N=2 contributes 0.451 to score (side=0.9495)
- N=3 contributes 0.435 to score (side=1.1420)
- Small N values have more room for improvement

### 5. **[MEDIUM PRIORITY]** Try crystalline/lattice packing for large N
From research:
- For N > 58, regular geometric lattices are mathematically superior
- This is a fundamentally different approach than SA

## What NOT to Try
- ❌ The eazy optimizer without stricter overlap validation (creates overlaps)
- ❌ Any optimizer that modifies coordinates without high-precision validation
- ❌ Submitting solutions that haven't been validated for overlaps

## Validation Requirements
Before submitting ANY solution:
1. Check for overlaps using Shapely with intersection.area > 1e-15 threshold
2. Verify the score matches expected value
3. Ensure coordinates are properly formatted with 's' prefix

## SUBMISSION STRATEGY
- Remaining submissions: 93 (ABUNDANT!)
- **SUBMIT AFTER EVERY EXPERIMENT** to get LB feedback
- The corner_extraction ensemble (70.675457) should be submitted FIRST
- Then try bbox3 optimizer and submit if it improves

## Key Files
- Baseline: `/home/nonroot/snapshots/santa-2025/21129617858/code/preoptimized/ensemble.csv`
- Corner extraction: `/home/nonroot/snapshots/santa-2025/21129617858/code/preoptimized/corner_extraction.csv`
- bbox3 optimizer source: `/home/code/research/kernels/jazivxt_why-not/bbox3.cpp`
- Backpacking kernel: `/home/code/research/kernels/crodoc_74-75-backpacking-christmas-trees/`

## Gap Analysis
- Current best: 70.675457
- Target: 68.919154
- Gap: 1.756303 (2.55%)
- Theoretical minimum: ~65.99 (based on tree area)

The gap is significant but achievable. Top kernels mention scores of 71.78+, which is worse than our current best. This suggests we're on the right track, but need more aggressive optimization.

## Next Experiment
1. Copy the corner_extraction ensemble to submission
2. Submit to verify it works on LB
3. If successful, try bbox3 optimizer on the ensemble
4. Validate for overlaps before submitting
