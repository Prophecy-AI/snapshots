# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.675457 from ensemble of corner_extraction + ensemble.csv
- Best LB score: 70.676102 (from exp_001, exp_002)
- Target: 68.919154 | Gap to target: 1.756303 points (2.55%)

## CRITICAL ISSUE FROM LAST SUBMISSION
**Submission 005_long_optimization FAILED with "Overlapping trees in group 003"**

The eazy optimizer introduced overlaps that our local Shapely validation missed but Kaggle detected. The issue is precision differences between our validation and Kaggle's.

**Root cause**: The eazy optimizer modified tree positions in group 003:
- Original: 003_0 at (1.123, 0.781, 111.125°)
- Modified: 003_0 at (1.143, 0.819, 112.873°)
This small change created an overlap that Kaggle's stricter validation caught.

**Solution**: Use only pre-optimized solutions that are KNOWN to be overlap-free on Kaggle:
- ensemble.csv (verified LB: 70.676102)
- corner_extraction.csv (needs LB verification)

## Response to Evaluator
The evaluator correctly identified:
1. ✅ The eazy optimizer found real improvement (0.000624) - but it introduced overlaps
2. ✅ The improvement rate is too slow (need 2800x more improvement)
3. ✅ Multiple optimizers should be tried

**Key insight**: The eazy optimizer's improvements are INVALID because they introduce overlaps. We need to:
1. Submit the overlap-free ensemble (corner_extraction + ensemble.csv) to verify LB
2. Find optimization techniques that DON'T introduce overlaps
3. Consider fundamentally different approaches

## New Discovery: corner_extraction.csv
Found a better pre-optimized solution that was overlooked:
- corner_extraction.csv: 70.67551 (better than ensemble.csv: 70.676102)
- Overlap-free (verified locally)
- Better for N=54 (0.000634 improvement), N=81, N=105

**Ensemble of corner_extraction + ensemble.csv**: 70.675457 (best so far)

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Submit the overlap-free ensemble
- Score: 70.675457
- Method: Best N from corner_extraction.csv and ensemble.csv
- This is our best overlap-free solution
- MUST verify it passes Kaggle's overlap check

### 2. **[HIGH PRIORITY]** Research symmetric solutions
Discussion "Symmetric solutions that are apparently optimal" (42 votes) suggests:
- Some N values have symmetric optimal solutions
- These might be fundamentally different from current approach
- Could provide significant improvement for specific N values

### 3. **[HIGH PRIORITY]** Try backward propagation carefully
The backpacking kernel uses backward iteration:
- Start from N=200, work backward to N=1
- When smaller N has worse score, copy larger N config and remove trees
- This can propagate good packing patterns
- BUT must ensure no overlaps are introduced

### 4. **[MEDIUM PRIORITY]** Focus on high-impact N values
Analysis shows:
- N=1 contributes 0.661 to score (highest single contribution)
- N=2 contributes 0.451
- N=3 contributes 0.435
- Small N values have most improvement potential

### 5. **[MEDIUM PRIORITY]** Try different initial configurations
Current solutions may all be in the same local optimum basin.
Need to try:
- Different starting rotations
- Different tree orderings
- Constructive heuristics (bottom-left, best-fit)

## What NOT to Try
- ❌ eazy optimizer (introduces overlaps)
- ❌ Any optimizer that modifies positions without strict overlap checking
- ❌ Submitting solutions without verifying overlap-free status

## Gap Analysis
- Current best: 70.675457
- Target: 68.919154
- Gap: 1.756303 (2.55%)
- Theoretical minimum: ~65.99 (based on tree area)
- Improvement needed: 2.55% efficiency gain

The gap is significant but achievable. Top competitors have likely found:
1. Better initial configurations
2. More sophisticated optimization that maintains overlap-free status
3. Symmetric solutions for specific N values

## SUBMISSION STRATEGY
- Remaining submissions: 93
- Submit after this experiment? **YES** - need to verify ensemble is overlap-free on LB
- If it passes, we have a new best LB score

## Validation Notes
- ALWAYS verify overlap-free before submitting
- Use Kaggle's exact tree geometry (15 vertices)
- Preserve full string precision when saving
- The 's' prefix in coordinates is required

## Key Files
- Best ensemble: /home/code/experiments/006_corner_extraction/ensemble_best.csv (70.675457)
- corner_extraction: /home/nonroot/snapshots/santa-2025/21129617858/code/preoptimized/corner_extraction.csv
- ensemble.csv: /home/nonroot/snapshots/santa-2025/21116303805/code/preoptimized/ensemble.csv
