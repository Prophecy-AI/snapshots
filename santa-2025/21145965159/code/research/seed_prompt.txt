# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.659944 from snapshot ensemble (NEW - just discovered!)
- Best LB score: 70.675457 (from exp_006)
- Target: 68.919154 | Gap to target: 1.740790 (2.53%)

## CRITICAL: NEW BETTER BASELINE FOUND!
We discovered a better overlap-free solution in the snapshots:
- **New best: 70.659944** (snapshot 21145961371)
- Previous best: 70.675457
- Improvement: 0.0155 points

This solution is already copied to `/home/submission/submission.csv` and ready for submission.

## Response to Evaluator
The evaluator correctly identified that we've been running bbox3 for too short (28 min vs 3-11 hours for top kernels). However, the more immediate opportunity is:

1. **SUBMIT THE NEW BASELINE FIRST** - We have a 0.0155 improvement ready to submit
2. **THEN run extended optimization** on this better baseline

The evaluator's recommendation to run for hours is correct, but we should first capture the easy win from the better snapshot.

## CV-LB Relationship Analysis
- All 4 successful submissions show CV = LB exactly (this is a pure optimization problem)
- No distribution shift - what we compute locally is what Kaggle computes
- The only risk is overlaps (precision mismatch between local Shapely and Kaggle)

## Key Insights from Research

### 1. Top Kernels Run for HOURS, Not Minutes
- **saspav kernel**: 11.7 HOURS budget
- **bbox3 runner kernel**: 3 HOURS budget with 3-phase approach
- Our runs: Only 28 minutes total

### 2. The 3-Phase Approach (from bbox3 runner kernel)
- Phase A: 15 combinations × 2 min = 30 min (coarse search)
- Phase B: Top 3 candidates × 10 min = 30 min (medium runs)
- Phase C: Top 2 candidates × 20 min = 40 min (long runs)
- Total: ~100 minutes minimum

### 3. Overlap Repair Mechanism
The saspav kernel has a clever overlap repair:
- After optimization, check for overlaps
- Replace overlapping groups with known-good versions from baseline
- This allows aggressive optimization without risking LB failure

### 4. Multiple Optimizer Types
- **bbox3**: Simulated annealing with translations
- **eazy optimizer**: Complex orbital moves, square calculus pressure, pulsing factor
- Running both in sequence may escape different local optima

## Recommended Approaches (Priority Order)

### 1. **[IMMEDIATE]** Submit the new baseline (70.659944)
- This is a 0.0155 improvement over our previous best
- Already overlap-free and ready to submit
- Get LB confirmation before further optimization

### 2. **[HIGH PRIORITY]** Run extended bbox3 optimization (2+ hours)
- Use the new baseline (70.659944) as starting point
- Implement full 3-phase approach from bbox3 runner kernel
- Apply fix_direction after each phase
- Use overlap repair mechanism

### 3. **[HIGH PRIORITY]** Run eazy optimizer for extended time
- The eazy optimizer showed improvement in exp_005
- Run with all 4 scale phases (1e-3, 1e-5, 1e-7, 1e-9)
- Increase iterations per phase (1M+ instead of 250k)

### 4. **[MEDIUM PRIORITY]** Ensemble multiple optimization runs
- Run bbox3 from different starting points
- Run eazy optimizer from different starting points
- Take best N from each run

## What NOT to Try
- Short optimization runs (< 1 hour) - we've proven these don't help
- Building solutions from scratch - pre-optimized solutions are much better
- Ignoring the overlap repair mechanism - it's essential for safe submissions

## Validation Notes
- CV = LB exactly for this problem (no distribution shift)
- The only failure mode is overlaps
- Use strict overlap checking (threshold 1e-15) before submission
- If overlaps detected, replace with known-good groups

## SUBMISSION STRATEGY
- Remaining submissions: 91
- **SUBMIT IMMEDIATELY** - We have a better solution ready!
- Then continue with extended optimization experiments