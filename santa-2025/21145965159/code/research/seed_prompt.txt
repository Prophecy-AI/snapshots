# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.659959 from candidate_007 (saspav_latest baseline)
- Best LB score: 70.675457 (exp_004 - corner_extraction ensemble)
- Target: 68.919154 | Gap to target: 1.740805 (2.46%)

## CRITICAL: BETTER BASELINE FOUND!
We discovered a better pre-optimized solution in the snapshots:
- **candidate_007**: 70.659959 (overlap-free, ready for submission)
- This is 0.0155 better than our previous best LB of 70.675457
- **MUST SUBMIT THIS IMMEDIATELY** to get LB feedback

## Response to Evaluator
The evaluator correctly identified that we've been running bbox3 for too short a time (28 minutes vs 3+ hours for top kernels). However, the more immediate issue is that we found a BETTER BASELINE that hasn't been submitted yet. We should:
1. Submit the better baseline (70.659959) to get LB feedback
2. Then implement the full 3-phase bbox3 runner approach with 3+ hour budget

## Key Insights from Research

### 1. The bbox3 Runner Kernel (yongsukprasertsuk)
This kernel implements a sophisticated 3-phase approach:
- **Phase A**: 15 combinations (n=1000-2000, r=30-90) × 2 min each = 30 min
- **Phase B**: Top 3 candidates × 10 min each = 30 min
- **Phase C**: Top 2 candidates × 20 min each = 40 min
- Total: ~100 minutes of optimization
- Includes fix_direction rotation optimization after each phase
- Includes overlap repair by replacing bad groups from donor file

### 2. The saspav Kernel
- Uses fix_direction to optimize rotation of each group
- Has overlap repair mechanism: replaces overlapping groups from known-good solution
- Runs for 11.7 hours total

### 3. Overlap Repair Mechanism
When overlaps are detected:
1. Identify which groups have overlaps
2. Replace those groups with groups from a known-good donor file
3. Re-run fix_direction to tighten
This allows aggressive optimization while maintaining validity

## Recommended Approaches (Priority Order)

### 1. **[IMMEDIATE]** Submit candidate_007 (70.659959)
- This is our best overlap-free solution
- 0.0155 better than current best LB
- Will give us valuable LB feedback

### 2. **[HIGH PRIORITY]** Implement Full 3-Phase bbox3 Runner
Create a new experiment that runs the full 3-phase approach:
```python
# Phase A: 15 combinations × 2 min = 30 min
n_values = [1000, 1200, 1500, 1800, 2000]
r_values = [30, 60, 90]
timeout_A = 120  # 2 min each

# Phase B: Top 3 candidates × 10 min = 30 min
timeout_B = 600  # 10 min each

# Phase C: Top 2 candidates × 20 min = 40 min
timeout_C = 1200  # 20 min each
```

After each phase:
1. Run fix_direction to optimize rotation
2. Check for overlaps
3. Repair overlaps by replacing bad groups from donor file
4. Keep best solution

### 3. **[HIGH PRIORITY]** Ensemble Multiple Pre-optimized Solutions
We found multiple solutions in snapshots with different scores:
- 70.574661 (has overlaps - needs repair)
- 70.575009 (has overlaps - needs repair)
- 70.586631 (has overlaps - needs repair)
- 70.659959 (overlap-free - current best)

Strategy: For each solution with overlaps, repair them using the overlap repair mechanism, then ensemble the best N from each source.

### 4. **[MEDIUM PRIORITY]** Focus on Small N Values
Analysis shows N=1-10 have low efficiency (0.47-0.82) vs best efficiency of 0.83.
- N=1 alone contributes 0.661 to score
- Potential improvement of 0.33 points if improved to average efficiency
- Consider exhaustive search for small N values

## What NOT to Try
- Short bbox3 runs (< 1 hour) - already proven ineffective
- Simple parameter variations without the full 3-phase approach
- Solutions with overlaps without repair mechanism

## Validation Notes
- Use strict overlap threshold (1e-15) for local validation
- Kaggle validation is even stricter - some solutions pass local but fail LB
- Always verify overlap-free before submission
- CV = LB exactly when overlaps are avoided (this is a pure optimization problem)

## SUBMISSION STRATEGY
- Remaining submissions: 92
- **SUBMIT candidate_007 IMMEDIATELY** - it's our best overlap-free solution
- After LB feedback, continue with 3-phase bbox3 optimization
