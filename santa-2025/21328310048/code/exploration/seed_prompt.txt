# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- **Best CV score**: 70.626088 from exp_001 (003_valid_baseline)
- **Best LB score**: N/A (previous submission failed due to overlapping trees)
- **Target**: 68.894234 | **Gap to target**: 1.73 points (2.51%)

## CRITICAL ISSUE IDENTIFIED
The previous submission (exp_000) failed because the snapshot had **70 groups with overlapping trees**. The overlap detection used locally was insufficient. We found a VALID snapshot (21222392487) with score 70.626088 that passes all overlap checks.

## Response to Evaluator
The evaluator correctly identified that:
1. **No active optimization was being performed** - just snapshot shopping
2. **Missing key techniques**: backward propagation, SA, squeeze/compaction
3. **Python vs C++ performance gap** - need C++ for millions of iterations

**AGREED**: We need to implement actual optimization, not just select from snapshots. The valid baseline is now ready for optimization.

## Key Insights from Research

### 1. Ensemble Approach (jonathanchan kernel)
The top kernels use an **ensemble** strategy:
- Collect best per-N solutions from 15+ external sources
- Run SA + fractional translation optimization
- Key sources: SmartManoj GitHub, bucket-of-chump dataset, telegram-public-shared-solution

### 2. C++ Optimizer Techniques
From jonathanchan's sa_v1_parallel.cpp:
- **SA with temperature schedule**: 1.0 → 0.000005, cooling rate 0.25
- **Local search**: Multi-step sizes for fine-tuning
- **Fractional translation**: Step sizes [0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001]
- **Perturb + restart**: Multiple restarts with perturbation

### 3. Overlap Detection
The Kaggle validator is stricter than local Shapely checks. Need to use high-precision overlap detection (Decimal with 25 digits, scale_factor 1e18).

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Submit Valid Baseline
Submit exp_001 (003_valid_baseline) to get LB feedback and verify the submission is valid.
- Score: 70.626088
- All 200 groups verified overlap-free
- This establishes a baseline LB score

### 2. **[HIGH PRIORITY]** Implement C++ Optimizer
Compile and run the C++ optimizer from jonathanchan or santa-claude kernel:
```bash
g++ -O3 -march=native -std=c++17 -fopenmp -o optimizer sa_v1_parallel.cpp
./optimizer -i submission.csv -o submission.csv -n 15000 -r 5
```

### 3. **[MEDIUM PRIORITY]** Ensemble from Multiple Sources
Collect best per-N solutions from:
- Current valid baseline
- Sample submission (for any N where it's better)
- Other snapshots (after fixing overlaps)

### 4. **[MEDIUM PRIORITY]** Backward Propagation
From santa-claude kernel - propagate good configurations from N=200 down to smaller N.

## What NOT to Try
- ❌ Using snapshots without overlap validation
- ❌ Python-only optimization (too slow)
- ❌ Random restarts without SA (won't escape local optima)

## Validation Notes
- **CRITICAL**: Always validate submissions for overlaps before submitting
- Use high-precision Decimal arithmetic for overlap detection
- The Kaggle validator is stricter than local Shapely checks

## SUBMISSION STRATEGY
- Remaining submissions: 99
- **Submit exp_001 NOW** to verify the baseline is valid on LB
- Then run C++ optimization and submit improved versions
