# Santa 2025 - Christmas Tree Packing Challenge Seed Prompt

## Current Status
- Best CV score: 70.659437 from exp_004 (clean ensemble)
- Best LB score: 70.659958 (exp_002 - clean ensemble)
- Target: 68.919154 | Gap to target: 1.74 points (2.53%)
- Submissions used: 4/100 (96 remaining)

## Critical Analysis

### What We've Tried (All Failed to Improve)
1. **Simulated Annealing** - Converges to same local optimum
2. **Genetic Algorithm** - Converges to baseline scores for all N=2-10
3. **Lattice Construction** - 20-60% worse than baseline
4. **Bottom-left Beam Search** - Produces worse results
5. **C++ Optimizer (sa_v1_parallel)** - No improvement on pre-optimized solutions (CONFIRMED in loop 5)
6. **Fractional Translation** - Minimal improvement (0.000009 for N=2)
7. **Overlap Fixing** - Overlaps too large to fix with perturbations

### Key Finding: The Source Gap
- **Top kernels use 19+ sources** (datasets + notebooks)
- **We have ~7 unique sources** (all converge to ~70.66)
- **The gap is DATA, not ALGORITHM** - we don't have access to the better solutions that top teams have

### Overlapping Snapshot Analysis (CONFIRMED in loop 5)
- Snapshot 21145966992 has score 70.572798 (0.087 better)
- BUT all 67 improved N values have OVERLAPS
- **0 clean improvements available** from any snapshot

## Response to Evaluator

The evaluator correctly identified that:
1. The C++ optimizer hasn't been applied - **DONE: No improvement (confirmed 0.000000)**
2. The overlapping snapshot should be exploited - **DONE: All improvements have overlaps, cannot use**
3. Novel approaches haven't been tried - **AGREE: This is the path forward**

The evaluator's suggestions were sound but our analysis confirms:
- C++ optimizer: 0.000000 improvement on current best
- Clean configs from overlapping snapshot: 0 available (all 67 have overlaps)

## The Real Problem

We are at a **data ceiling**, not an algorithm ceiling:
- All 40+ snapshots converge to ~70.66
- All public sources we have access to score 70.66-72.5
- Top kernels achieve 68.5-69.5 by having access to 19+ sources (many private/shared)
- Without access to better source data, we cannot improve through optimization

## Recommended Approaches (Priority Order)

### 1. **HIGHEST PRIORITY: Translation-based Grid Construction**
From egortrushin kernel - this is a CONSTRUCTIVE approach that builds solutions from scratch:

```python
# For N = nx * ny trees:
# Place trees at positions (i*dx + offset_x, j*dy + offset_y) 
# with alternating angles for i=0..nx-1, j=0..ny-1
# Try different dx, dy, and angle patterns

def create_grid_config(nx, ny, dx, dy, angle1, angle2):
    """Create a grid of nx*ny trees with alternating angles"""
    trees = []
    for i in range(nx):
        for j in range(ny):
            x = i * dx
            y = j * dy
            angle = angle1 if (i + j) % 2 == 0 else angle2
            trees.append((x, y, angle))
    return trees
```

Key insight: The egortrushin kernel successfully used this for N=72, 100, 110, 144, 156, 196, 200.

### 2. **HIGH PRIORITY: Backward Propagation (BackPacking)**
From crodoc kernel - use larger N configurations to improve smaller N:
- Start from N=200, iterate backward to N=1
- For each N, try removing each tree from N+1 config and keep best result
- This can propagate good patterns from large to small N

### 3. **MEDIUM PRIORITY: Exhaustive Search for Small N**
For N=2-10 (worst efficiency, 37-65%), try exhaustive/random search:
- These contribute 6.1% of score but have worst efficiency
- Even small improvements here could help

### 4. **EXPERIMENTAL: Different Angle Patterns**
Current solutions use 68° and 248° predominantly. Try:
- 45° and 225° (diagonal)
- 0° and 180° (vertical)
- 90° and 270° (horizontal)
- Mixed patterns

## What NOT to Try
- More SA/GA variations on pre-optimized solutions (proven ineffective)
- Ensemble from existing snapshots (all converge to same score)
- Fixing overlapping configurations (overlaps too large)
- C++ optimizer on current best (already tested, 0 improvement)

## Validation Notes
- CV scheme: Direct scoring (sum of side²/N for N=1-200)
- Overlap checking: Required before submission
- Format: 's' prefix on all x, y, deg values

## SUBMISSION STRATEGY
- Remaining submissions: 96
- Submit after EVERY experiment that produces a valid submission
- We need LB feedback to calibrate our approaches
- Even if score doesn't improve, LB data is valuable

## Concrete Next Experiment: 006_grid_construction

Implement the translation-based grid construction approach:

1. **For each N from 1 to 200:**
   - Find all factor pairs (nx, ny) where nx * ny = N
   - For each factor pair, try multiple grid configurations:
     - Different spacings (dx, dy) from 0.4 to 0.8
     - Different angle patterns (68/248, 45/225, 0/180, etc.)
   - Score each configuration and keep the best

2. **Ensemble with current best:**
   - For each N, compare grid construction score with current best
   - Use whichever is better

3. **Apply SA refinement:**
   - Run SA on the grid-constructed solutions to refine them
   - This might find nearby better optima

Expected outcome: Grid construction might find different local optima for some N values, especially those with nice factor decompositions (like N=100=10×10, N=144=12×12, etc.).