# Santa 2025 - Evolved Seed Prompt (Loop 2)

## Current Status
- Best CV score: 70.659958 from clean ensemble
- Best LB score: N/A (both submissions failed - format issues and overlaps)
- Target: 68.919154 | Gap to target: 1.74 points (2.5% improvement needed)
- Submissions remaining: 98

## CRITICAL ISSUE DISCOVERED
**Submission failed with "Overlapping trees in group 002"**

Analysis revealed:
1. Many snapshots (14 of 41) contain overlapping trees
2. Our ensemble picked configurations from snapshots with overlaps
3. Local scoring doesn't check for overlaps, but Kaggle does
4. Only 26 snapshots are "clean" (no overlaps in any group)

**Clean snapshots identified:**
20952569566, 20970671503, 20984924920, 20992150197, 21086827828, 21104669204, 21105319338, 21108486172, 21116303805, 21117626902, 21121776553, 21121942239, 21122904233, 21123763369, 21129619422, 21129622493, 21139436611, 21139436684, 21139436695, 21139436707, 21139436732, 21145961371, 21145968755, 21156851249, 21156852373, 21156853393

## Response to Evaluator
The evaluator correctly identified:
1. **Ensemble approach has limited upside** - Confirmed. Clean ensemble score (70.659958) equals best single clean snapshot.
2. **No constructive algorithms implemented** - Still true. Need to implement.
3. **C++ optimizers not leveraged** - Still true. Need to compile and run.
4. **Small N values are expensive** - N=1-10 contributes 4.29 points (6.1% of total).

I agree with the evaluator's assessment. The ensemble from snapshots has been exhausted - we need NEW solutions, not recombination of existing ones.

## Key Insights from Research

### From jonathanchan kernel:
1. **Fractional translation** - Very small step moves (0.001 to 0.00001) in 8 directions
2. **SA + local search + fractional translation** pipeline
3. **N=1 optimal** at (0, 0, 45°) with score 0.661250 (already achieved)
4. **Ensemble from 15+ sources** - We only have 26 clean snapshots

### From analysis:
- Best clean snapshot: 21156851249 with score 70.659958
- Clean ensemble provides NO improvement over best single snapshot
- Need fundamentally different approach to generate NEW solutions

## Recommended Approaches (Priority Order)

### 1. IMMEDIATE: Submit Clean Ensemble
- Clean ensemble saved to /home/submission/submission.csv
- Verified: 0 overlapping groups
- Score: 70.659958
- This establishes a valid baseline on LB

### 2. HIGH PRIORITY: Compile and Run C++ Optimizer
Extract and compile the C++ optimizer from jonathanchan kernel:
```bash
# Extract sa_v1_parallel.cpp from the notebook
# Compile: g++ -O3 -march=native -std=c++17 -fopenmp -o sa_v1_parallel sa_v1_parallel.cpp
# Run: ./sa_v1_parallel -i submission.csv -o submission_optimized.csv -n 15000 -r 5
```

Key features:
- Fractional translation with tiny steps
- SA with temperature schedule (1.0 → 0.000005)
- Local search with 8-directional moves
- Multi-restart with population of 3

### 3. Implement Overlap-Checked Optimization
Any new optimization must check for overlaps:
```python
def check_overlap(tree1, tree2):
    return tree1.intersects(tree2) and not tree1.touches(tree2)
```

### 4. Focus on Worst-Performing N Values
Per-N analysis shows:
- N=1: 0.661250 (optimal)
- N=2-10: ~0.38-0.45 each (room for improvement?)
- Large N (150-200): ~0.33-0.34 each

### 5. Try Different Starting Configurations
The C++ optimizer can start from random configurations:
- Multi-start with random initialization
- Perturb existing solutions and re-optimize
- Try different angle distributions

## What NOT to Try
- Ensemble from snapshots (exhausted - no improvement possible)
- Using snapshots with overlaps (will fail submission)
- Local search without overlap checking

## Validation Notes
- MUST check for overlaps before submission
- All values MUST have 's' prefix
- Use score_submission.py for local scoring
- Add overlap checking to any optimization code

## Files and Paths
- Clean submission: /home/submission/submission.csv (verified no overlaps)
- Clean snapshots list: see above
- C++ optimizer source: research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/
- Scoring script: /home/code/score_submission.py

## SUBMISSION STRATEGY
- We have 98 submissions remaining - ABUNDANT!
- Submit the clean ensemble IMMEDIATELY to get LB feedback
- Then focus on C++ optimizer to generate new solutions