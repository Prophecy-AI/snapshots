# Santa 2025 - Christmas Tree Packing Challenge

## Current Status
- Best CV score: 70.734327 from exp_000 (baseline_precomputed)
- Best LB score: 70.734327 (submitted, CV = LB perfectly)
- Target: 68.931058 | Gap to target: 1.803269 (2.62% improvement needed)

## CRITICAL INSIGHT: Target is BELOW Current Leaderboard Leader!
- Current LB leader: 71.19 (terry_u16)
- Our target: 68.931058
- **The target requires beating the BEST public score by ~2.3 points!**
- This means we need techniques BEYOND what's publicly available

## Public Kernel Status
- Have we implemented the best kernel yet? **PARTIALLY** - We have pre-computed solutions but NOT the optimization tools
- Top kernels identified:
  1. Santa Claude (372 votes) - Has C++ optimizer source code (tree_packer_v21.cpp, bp.cpp)
  2. Santa-submission (386 votes) - Uses bbox3 binary + fix_direction
  3. Ensemble + SA + Fractional Translation (174 votes) - Advanced SA with fractional moves
- Kernels we've implemented: Pre-computed solution download only
- Kernels still to implement: **C++ optimizer compilation and execution**

## CV-LB Relationship Analysis
- CV = LB exactly (70.734327 = 70.734327)
- This is expected for an optimization problem - no train/test split
- Local scoring is accurate - we can trust CV scores

## Response to Evaluator
The evaluator correctly identified:
1. **C++ optimizer not attempted** - This is the TOP PRIORITY. The source code is available.
2. **fix_direction rotation optimization showed no improvement** - Solution already well-optimized
3. **No active optimization was attempted** - Only evaluation was done

I agree with the evaluator's assessment. The key insight is that:
- Pre-computed solutions are already well-optimized (70.73)
- We need to run active optimization to improve further
- The C++ tools (tree_packer_v21 and bp.cpp) are the primary path forward
- **BUT** even the best public kernels only achieve ~71.19, so we need MORE

## Key Analysis Findings
1. **Gap is 2.62%** - Need to improve by 1.8 points
2. **Small n values contribute most** - n=1 alone contributes 0.661250
3. **Ensemble doesn't help** - kaggle_santa2025 is best for 199/200 configurations
4. **C++ compiler works** - g++ 9.4.0 with OpenMP support available
5. **Target is HARDER than current LB leader** - Need novel techniques

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Compile and Run C++ Optimizer
The Santa Claude kernel contains complete C++ source code for:
- `tree_packer_v21.cpp` (a.cpp) - Main optimizer with simulated annealing, local search, squeeze
- `bp.cpp` - Backward propagation to improve smaller configs from larger ones

**Steps:**
```bash
# Extract a.cpp from Santa Claude kernel
# Compile with OpenMP
g++ -O3 -march=native -std=c++17 -fopenmp -o tree_packer_v21 a.cpp

# Run optimization (start with shorter runs to verify it works)
./tree_packer_v21 -n 5000 -r 16

# Compile and run backward propagation
g++ -O3 -std=c++17 -o bp bp.cpp
./bp submission.csv optimized.csv
```

### 2. **[HIGH PRIORITY]** Implement Fractional Translation Optimization
From the Ensemble + SA kernel, fractional translation uses very fine steps:
- Steps: 0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001
- 8-directional moves (N, S, E, W, NE, NW, SE, SW)
- This can squeeze out additional improvements after SA

### 3. **[HIGH PRIORITY]** Run Multiple Optimization Iterations
The top kernels run optimization in loops:
- Run SA → Local Search → Fractional Translation
- Save best solution, use as input for next iteration
- Repeat until no improvement

### 4. **[MEDIUM PRIORITY]** Focus on Small n Values
The worst configurations are n=1,2,3,4,5,6,7,8,9,15:
- n=1: Score 0.661250 - Optimal is 45° rotation (already optimal)
- n=2-10: Combined score ~3.9 - Local search could help

### 5. **[RESEARCH PRIORITY]** Study What Top Competitors Do Differently
Since target is below LB leader, we need novel techniques:
- Check discussions for hints about advanced techniques
- Look for asymmetric solutions (mentioned in discussions)
- Consider custom optimization algorithms

## What NOT to Try
- More ensemble combinations (already evaluated 21 sources, no improvement)
- fix_direction rotation optimization (already attempted, no improvement)
- Starting from scratch with greedy algorithms (pre-computed solutions are much better)
- Simple hyperparameter tuning (need fundamental improvements)

## Validation Notes
- CV scheme: Calculate total score = Σ(side_length² / n) for n=1 to 200
- Overlap validation: Use Shapely with STRtree for efficient collision detection
- Precision: Use high-precision Decimal arithmetic (30 digits) for coordinates

## SUBMISSION STRATEGY
- Remaining submissions: 99
- Submit after EVERY experiment - we have abundant submissions
- LB feedback is free information - USE IT!

## Technical Notes
- bbox3 binary fails due to GLIBC_2.34 requirement (system has older version)
- C++ compiler (g++ 9.4.0) works with -O3 -fopenmp flags
- Tree shape: 15-vertex polygon with tip at (0, 0.8), trunk at y=-0.2
- Scoring: score = Σ(side_length² / n) for n=1 to 200 (lower is better)

## C++ Source Code Location
The C++ source code is in the Santa Claude kernel at:
`/home/code/research/kernels/smartmanoj_santa-claude/santa-claude.ipynb`

Extract the code from cells containing:
- `%%writefile a.cpp` - Main optimizer (tree_packer_v21)
- `%%writefile bp.cpp` - Backward propagation

The Ensemble + SA kernel at:
`/home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/`
Contains advanced SA with fractional translation.
