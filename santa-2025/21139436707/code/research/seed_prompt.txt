# Christmas Tree Packing Optimization - Evolved Seed Prompt (Loop 1)

## Current Status
- Best CV score: 162.2 from exp_000 (baseline greedy + squeeze + rotation)
- Best LB score: N/A (no submissions yet)
- Target: 68.922808 | Gap to target: 93.3 (2.35x improvement needed)

## Response to Evaluator
- Technical verdict was TRUSTWORTHY. The baseline is correctly implemented.
- Evaluator's top priority: **CRITICAL PIVOT NEEDED** - compile and run C++ optimizers from public kernels.
- Key concerns raised: 
  1. Greedy approach fundamentally cannot reach target (2.35x gap)
  2. Missing key techniques: simulated annealing, swap moves, backward propagation
  3. Computational intensity too low (top solutions run for hours)
  4. Not leveraging public kernels' C++ code
- **I FULLY AGREE with the evaluator.** The greedy approach is a dead end. We must pivot to C++ optimizers.

## Critical Discovery
**C++ compilation with OpenMP is available!** (g++ 9.4.0, 26 CPU cores)
- We CAN compile and run tree_packer_v21.cpp and bbox3.cpp from public kernels
- This is the path to the target score

## Data Understanding
- Reference notebooks: See `exploration/eda.ipynb` for tree geometry
- Tree: 15-vertex polygon, ~1.0 height, 0.7 max width
- Score = Σ(side²/n) for n=1 to 200, lower is better
- Key insight: Boundary-touching trees define the bounding box

## Recommended Approaches (PRIORITY ORDER)

### 1. **IMMEDIATE: Compile and Run C++ tree_packer_v21** (HIGHEST PRIORITY)
The smartmanoj kernel contains complete C++ code for tree_packer_v21 with:
- Simulated Annealing with high temperature
- Swap moves (exchange positions of two trees)
- Multi-angle restarts
- Squeeze/Compaction
- Local Search (8-directional moves + rotation)
- Backward Propagation

**Implementation steps:**
1. Extract the full C++ code from `/home/code/research/kernels/smartmanoj_santa-claude/santa-claude.ipynb`
2. Compile with: `g++ -O3 -march=native -std=c++17 -fopenmp -o tree_packer_v21 tree_packer_v21.cpp`
3. Run on current baseline submission
4. Apply backward propagation pass

**Expected score:** 70-80 range (based on kernel descriptions)

### 2. **ALTERNATIVE: Compile and Run bbox3.cpp**
The jazivxt kernel contains bbox3.cpp with:
- Complex Number Vector Coordination
- Fluid Dynamics inspired movement
- Hinge Pivot rotation
- Density Gradient Flow
- Global Boundary Tension
- Aggressive Overlap Repair (MTV approximation)

**Implementation steps:**
1. Extract C++ code from `/home/code/research/kernels/jazivxt_why-not/why-not.ipynb`
2. Compile with OpenMP
3. Run multi-phase optimization (Phase A: 2min, Phase B: 10min, Phase C: 20min)

### 3. **FALLBACK: Implement Python Simulated Annealing**
If C++ compilation fails, implement SA in Python with:
- Swap moves (exchange positions of two trees)
- Multi-angle restarts (try 4 initial angles: 0, 45, 90, 135)
- Higher iteration counts (1000+ per configuration)
- Focus on boundary-touching trees

## What NOT to Try
- ❌ More greedy placement variations (fundamentally limited)
- ❌ Simple squeeze/compaction improvements (marginal gains)
- ❌ Hyperparameter tuning of current approach (wrong direction)
- ❌ Any approach that doesn't include SA, swap moves, or C++ optimization

## Validation Notes
- CV scheme: Calculate score = Σ(side²/n) for all 200 configurations
- Validate no overlaps before accepting any solution
- The target of 68.9 is achievable - public kernels demonstrate this

## Key Code Locations
- tree_packer_v21 C++: `/home/code/research/kernels/smartmanoj_santa-claude/santa-claude.ipynb` (cell with `%%writefile a.cpp`)
- bbox3 C++: `/home/code/research/kernels/jazivxt_why-not/why-not.ipynb` (cell with `%%writefile bbox3.cpp`)
- Backward propagation C++: Same smartmanoj notebook (cell with `%%writefile bp.cpp`)

## Success Criteria
1. Compile C++ optimizer successfully
2. Run on baseline submission
3. Achieve score < 100 (first milestone)
4. Apply backward propagation
5. Achieve score < 70 (target)

## Time Budget
- We have 26 CPU cores and ~35 hours remaining
- C++ optimizer can run for 1-2 hours per iteration
- Multiple iterations possible with different parameters