# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.659437 from exp_002 (003_eazy_optimizer)
- Best LB score: 70.6594 (from 3 submissions)
- Target: 68.919154 | Gap to target: 1.74 points (2.5%)
- Submissions used: 3/100 (97 remaining)

## CRITICAL INSIGHT FROM WEB RESEARCH

**Top teams achieving sub-69 scores use HYBRID STRATEGIES:**
1. **N < 58**: Simulated Annealing for chaotic/unstructured packings
2. **N >= 58**: CRYSTALLINE/LATTICE packing (mathematically superior for large N)

**Our current approach only uses SA-based optimization for ALL N values.**
This is why we're stuck at 70.66 while top teams are at 68.92.

## Response to Evaluator

The evaluator correctly identified:
1. **NO LB submissions recorded** - We need to submit to get LB feedback
2. **Construction heuristic limitations** - Fixed 0°/180° angles too restrictive
3. **Paradigm exhaustion** - 11 experiments, 9 consecutive zero-improvement

**Key disagreement**: The evaluator suggests the target may be unreachable. I REJECT this conclusion. The target IS reachable - we just haven't tried the right approach yet.

**The missing piece**: We've been optimizing existing solutions, not building fundamentally different topologies. Top teams use CRYSTALLINE LATTICE packing for large N, which we haven't implemented.

## Score Distribution Analysis
- N=1-10: 6.13% of score
- N=11-25: 7.91% of score  
- N=26-50: 12.92% of score
- N=51-100: 24.95% of score
- N=101-150: 24.26% of score
- N=151-200: 23.84% of score

**Large N (51-200) contributes 73% of total score!**
This is where crystalline lattice packing should provide the biggest gains.

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Implement True Double-Lattice Packing for Large N**

The Kuperberg double-lattice construction finds optimal packing by:
1. Choosing two linearly independent lattice vectors u and v
2. Placing trees at lattice points with alternating orientations (0° and 180°)
3. Optimizing u, v to maximize packing density

**Implementation:**
```cpp
// For each N >= 58:
// 1. Start with base lattice vectors
double u_x = 0.5, u_y = 0.0;  // Horizontal spacing
double v_x = 0.25, v_y = 0.43;  // Diagonal spacing (hexagonal-ish)

// 2. Generate lattice positions
for (int i = 0; i < rows; i++) {
    for (int j = 0; j < cols; j++) {
        double x = i * u_x + j * v_x;
        double y = i * u_y + j * v_y;
        double angle = ((i + j) % 2 == 0) ? 0.0 : 180.0;
        // Place tree at (x, y, angle)
    }
}

// 3. Optimize u, v using gradient descent or SA
// 4. Trim to exactly N trees, keeping best subset
```

### 2. **[HIGH PRIORITY] Strip Packing First, Then Square**

Instead of optimizing for square directly:
1. Pack trees into a rectangular strip (minimize width for fixed height)
2. Adjust aspect ratio to approach square
3. This explores different topologies than direct square optimization

### 3. **[MEDIUM PRIORITY] Genetic Algorithm with Topology Crossover**

Current SA only perturbs positions. GA can exchange entire tree arrangements:
1. Population of different topologies
2. Crossover: swap tree subsets between solutions
3. Mutation: local SA optimization
4. Selection: keep best configurations

### 4. **[SUBMIT IMMEDIATELY] Get LB Feedback**

We have 97 submissions remaining. Submit current best to:
1. Verify CV-LB alignment
2. Establish baseline for future comparisons
3. Use LB feedback to guide strategy

## What NOT to Try
- ❌ More SA optimization on existing solutions (exhausted)
- ❌ More fractional translation (exhausted)
- ❌ More random restarts (exhausted)
- ❌ NFP construction with fixed angles (already tried, failed)
- ❌ Ensemble of public CSVs (already at best combination)

## Validation Notes
- Score = Σ(side²/n) for n=1 to 200
- No overlapping trees allowed
- Coordinates must be in [-100, 100]
- Values must be prefixed with 's' in submission

## Key Code Resources
- bbox3 optimizer: `/home/code/research/kernels/jazivxt_why-not/`
- SA optimizer: `/home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/`
- Getting started: `/home/code/research/kernels/inversion_santa-2025-getting-started/`

## SUBMISSION STRATEGY
- Remaining submissions: 97
- Submit after EVERY experiment - LB feedback is free information
- We have abundant submissions - USE THEM!

## The Path to Victory

1. **Implement crystalline lattice packing for N >= 58** (73% of score)
2. **Keep current SA-optimized solutions for N < 58** (27% of score)
3. **Combine into hybrid solution**
4. **Submit and iterate based on LB feedback**

The target of 68.919154 IS achievable. We just need to use the right technique for large N values.
