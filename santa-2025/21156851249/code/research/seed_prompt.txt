# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.659437 from exp_002 (003_eazy_optimizer)
- Best LB score: 70.659437 (CV = LB exactly, deterministic problem)
- Target: 68.919154 (current #1 on leaderboard, team 'shr')
- Gap to target: 1.74 points (2.46%)
- Submissions used: 3/100 (97 remaining)

## CV-LB Relationship Analysis
- This is a DETERMINISTIC optimization problem, not ML
- CV = LB exactly (no gap, no distribution shift)
- The challenge is purely about finding better packing configurations

## Response to Evaluator
The evaluator correctly identified that:
1. **Diminishing returns**: exp_001 improved by 0.000465, exp_002 by only 0.000056
2. **Local optimum trap**: All local search methods (SA, rebuild from corners, eazy-optimizer) are converging to the same basin
3. **Gap is structural**: 1.74 points cannot be closed by micro-optimizations

I AGREE with the evaluator's assessment. The current approach of incrementally optimizing pre-optimized CSVs is EXHAUSTED. We need a fundamentally different approach.

## Key Insights from Research

### Leaderboard Analysis
- #1: shr with 68.919154 (our target)
- #2: KiRaRe with 68.921561
- Gap between #1 and #2 is only 0.002 points
- Our score (70.66) would rank around #50-100

### What Top Teams Must Have
The top teams are 2.5% better than public baselines. This suggests:
1. **Different packing patterns** - Not just optimized versions of public CSVs
2. **Better small N solutions** - N=1-20 contribute disproportionately to score
3. **Novel construction methods** - Building from scratch, not optimizing existing

### Techniques NOT Yet Tried
1. **Exhaustive search for small N** (N=1-12) - These are small enough for near-exhaustive search
2. **Constraint programming** (OR-Tools, MILP) - For exact solutions on small N
3. **Random initialization + long optimization** - Start from scratch, not from pre-optimized
4. **Lattice-based construction** - For large N (N>100), crystalline patterns may be optimal
5. **Asymmetric solutions** - Discussion suggests symmetric solutions are exhausted

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Exhaustive Search for Small N (N=1-12)
Small N values contribute most to score and have the most room for improvement:
- N=1: Already optimal at 45 degrees (verified)
- N=2-12: Small enough for grid search over positions and angles
- Try all combinations of angles (0-360 in 1-degree steps) and positions

**Implementation:**
```python
def exhaustive_search_small_n(n, angle_step=1, position_step=0.01):
    best_score = float('inf')
    best_config = None
    
    for angles in itertools.product(range(0, 360, angle_step), repeat=n):
        for positions in generate_positions(n, position_step):
            config = create_config(positions, angles)
            if not has_overlap(config):
                score = calc_score(config)
                if score < best_score:
                    best_score = score
                    best_config = config
    
    return best_config
```

### 2. **[HIGH PRIORITY]** Random Initialization + Long Optimization
Instead of optimizing pre-optimized CSVs, generate NEW starting configurations:
- Random positions and angles
- Run SA/eazy-optimizer for much longer (hours, not minutes)
- Keep best of multiple random starts

### 3. **[HIGH PRIORITY]** Run bbox3 with Extended Parameters
The bbox3 binary is available but hasn't been run with very long iterations:
```bash
./bbox3 -n 1000000 -r 512  # Much longer than previous attempts
```

### 4. **[MEDIUM PRIORITY]** Focus on N Values with Lowest Efficiency
Analysis shows N=2, N=1, N=4, N=3 have lowest packing efficiency:
- These are the hardest to optimize but have most room for improvement
- Try specialized optimization for these specific N values

### 5. **[MEDIUM PRIORITY]** Asymmetric Solutions
From discussion "Why the winning solutions will be Asymmetric":
- Symmetric solutions have been explored extensively
- Breaking symmetry could unlock new basins
- Try perturbing symmetric solutions to break symmetry

## What NOT to Try
- More SA iterations on current baseline (exhausted)
- More C++ optimizers on current baseline (exhausted)
- Ensemble of pre-optimized CSVs (all at same local optimum)
- Micro-optimizations (0.00005 improvements won't close 1.74 gap)

## SUBMISSION STRATEGY
- Remaining submissions: 97
- Submit after EVERY experiment that produces a valid improvement
- LB feedback is free - USE IT!
- Even small improvements should be submitted to track progress

## Validation Notes
- Score = Σ(s_n² / n) for n=1 to 200
- Lower is better
- No overlaps allowed (submission rejected if overlaps)
- CV = LB exactly (deterministic problem)

## Files Available
- Current best: /home/submission/submission.csv (score: 70.659437)
- bbox3 binary: /home/code/exploration/datasets/bbox3
- Pre-optimized CSVs: /home/code/exploration/datasets/
- C++ optimizers: eazy.cpp, bbox3.cpp in research/kernels/

## Next Experiment Recommendation
**Experiment 004: Exhaustive Search for Small N**

Focus on N=2-6 first (highest score contribution, smallest search space):
1. For each N, try all angle combinations (0-360 in 5-degree steps)
2. For each angle combination, optimize positions with gradient descent
3. Keep best configuration found
4. Compare with current baseline

Expected outcome: If we can improve N=2-6 by even 1% each, that's ~0.05 points improvement.
