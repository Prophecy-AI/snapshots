# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.659942 from snapshot (010_safe_ensemble)
- Best LB score: 70.6600 (baseline submission)
- Target: 68.919154 (TOP leaderboard score, team 'shr')
- Gap to target: 1.74 points (2.5% improvement needed)

## CRITICAL INSIGHT: Target is #1 on Leaderboard!
The target score (68.919154) is the CURRENT TOP SCORE on the leaderboard. This means:
1. Only ONE team has achieved this score
2. The gap from public baseline (~70.66) to winning score is ~1.74 points
3. This is NOT a trivial optimization - it requires novel techniques

## Public Kernel Status
- **Best public kernels score ~70.66** (same as our baseline)
- Top kernels identified:
  - saspav/santa-submission (441 votes) - baseline source
  - smartmanoj/santa-claude (373 votes) - fractional translation
  - yongsukprasertsuk/santa-2025-best-keeping-bbox3-runner (369 votes) - bbox3 runner
  - jazivxt/why-not (298 votes) - bbox3 optimizer
  - jazivxt/eazy-optimizer (128 votes) - C++ optimizer with calculus pressure
  - chistyakov/new-simple-fix-rebuild-large-layout-from-corners (117 votes) - **KEY TECHNIQUE**

## Response to Evaluator
The evaluator correctly identified:
1. ✅ Baseline submitted and LB matches CV (70.66) - DONE
2. ✅ Snapshots scanned - found 70.659942 (tiny improvement, 0.000016)
3. ⚠️ All "better" solutions in snapshots have OVERLAPS and would be rejected
4. ⚠️ The gap to target (1.74 points) is HUGE - requires novel approach

## Key Findings from Analysis
1. **All snapshot solutions with scores < 70.55 have overlaps** - they would be rejected
2. **The best VALID solution found is 70.659942** - only 0.000016 better than baseline
3. **Target 68.919154 is the #1 leaderboard score** - achieved by team 'shr'
4. **Public kernels all converge to ~70.66** - local optimum trap

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Implement "Rebuild from Corners" Technique
From chistyakov kernel - extract subsets from larger N solutions to find better smaller N:
```python
# For each large N layout, check all 4 corners
# Sort trees by distance from corner
# Rebuild smaller layouts from closest trees
# This can find better solutions for smaller N
```
This technique can find improvements that local search misses.

### 2. **[HIGH PRIORITY]** Run Eazy Optimizer with Long Iterations
The jazivxt/eazy-optimizer uses:
- Square Calculus Pressure (gradient-based boundary push)
- Elastic Pulse (periodic squeeze/relax)
- Complex Orbital Moves
- Multi-scale optimization (1e-3, 1e-5, 1e-7, 1e-9)

Compile and run with extended time budget.

### 3. **[HIGH PRIORITY]** Implement bbox3 with Aggressive Repair
The bbox3 binary can fix overlaps instead of rejecting them:
```bash
chmod +x bbox3
./bbox3 -n 100000 -r 256  # Very long run
```
Then apply fix_direction to tighten bounding boxes.

### 4. **[MEDIUM PRIORITY]** Try Different Starting Configurations
Instead of optimizing the pre-optimized baseline:
- Generate random starting configurations
- Use lattice patterns for large N
- Try asymmetric solutions (per discussion "Why winning solutions will be Asymmetric")

### 5. **[MEDIUM PRIORITY]** Ensemble Best-per-N from Multiple Sources
Create ensemble by taking best solution for each N from:
- Baseline CSV
- Snapshot solutions
- Kernel outputs
- Rebuild-from-corners outputs

## What NOT to Try
- ❌ More SA iterations on baseline (already at local optimum)
- ❌ Small mutations (proven ineffective in 12+ prior experiments)
- ❌ Simple ensembling without new techniques (baseline wins for all N)

## Validation Requirements
- **CRITICAL**: Check for overlaps before submission!
- Many "better" scores have overlaps and would be rejected
- Use Shapely STRtree for efficient overlap checking

## Submission Strategy
- Remaining submissions: 99
- Submit after EVERY experiment with valid (no overlap) improvement
- LB feedback is free - use it to calibrate

## Next Experiment: 002_rebuild_from_corners
Implement the chistyakov "rebuild from corners" technique:
1. Load the best baseline CSV
2. For each N from 200 down to 2:
   - For each of 4 corners of the bounding box
   - Sort trees by distance from corner
   - Check if subset forms better solution for smaller N
3. Save improved solutions
4. Verify no overlaps
5. Submit if improvement found