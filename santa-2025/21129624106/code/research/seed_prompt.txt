# Santa 2025 Seed Prompt

## Problem Definition
Pack $N$ identical "Christmas Tree" polygons ($N \in [1, 200]$) into the smallest possible square bounding box.
**Metric:** Minimize $\sum_{n=1}^{200} \frac{s_n^2}{n}$, where $s_n$ is the side length of the square bounding box for $n$ trees.
**Constraints:** No overlaps.

## Tree Geometry
The tree is a 15-point polygon defined by these coordinates (relative to center):
```python
TX = [0, 0.125, 0.0625, 0.2, 0.1, 0.35, 0.075, 0.075, -0.075, -0.075, -0.35, -0.1, -0.2, -0.0625, -0.125]
TY = [0.8, 0.5, 0.5, 0.25, 0.25, 0, 0, -0.2, -0.2, 0, 0, 0.25, 0.25, 0.5, 0.5]
```

## Current Status
- Best CV score: 77.66 (Dense Lattice + Circular Crop)
- Target: ~69
- Gap: ~8.6 points
- **Critical Insight:** The current lattice density (0.8728) is excellent, but the circular crop wastes ~21.5% of the area when placed in a square box.
- **Evaluator Feedback:** "Implement Square Crop Lattice Initialization." The evaluator correctly identified that sorting by $x^2 + y^2$ creates a circle, while sorting by $\max(|x|, |y|)$ creates a square.
- **Analysis Confirmation:** Analysis shows that switching to Square Crop (Chebyshev distance) improves the theoretical score for N=200 from 0.3461 to 0.2823 (per tree metric).

## Response to Evaluator
- **Technical Verdict:** TRUSTWORTHY.
- **Evaluator's Top Priority:** "Implement 'Square Crop' Lattice Initialization."
- **My Action:** AGREED and VALIDATED. I will implement the Square Crop strategy immediately.
- **Key Concerns:**
    - `tree_packer_v21` input parsing: I have verified that `atof` stops at `s` and returns 0. I have patched `tree_packer_v21.cpp` to correctly handle the `s` prefix by skipping it. This is a critical fix.

## Recommended Approaches
Priority-ordered list:

1.  **Square Crop Lattice Initialization (HIGHEST PRIORITY)**
    - **Why:** Theoretical improvement of ~20% by matching the crop shape to the bounding box.
    - **How:**
        - Modify `lattice_generator_v2.py` to sort candidates by `max(abs(p['x']), abs(p['y']))` (Chebyshev distance).
        - Ensure the lattice is centered before cropping? No, generate a large grid, sort by distance to center, then take top N.
        - **Crucial:** The lattice vectors are rotated. The "square" should be aligned with the *bounding box axes*, not the lattice axes. Sorting by `max(|x|, |y|)` achieves this.

2.  **Fix Input Parsing in C++ Solver**
    - **Why:** The solver was likely treating all initial positions as (0,0) or garbage because of the `s` prefix.
    - **How:** I have already patched `tree_packer_v21.cpp` to check for `s` or `S` and skip it. This must be used in the next experiment.

3.  **Refine Lattice Parameters?**
    - **Status:** The current density 0.8728 is very high. I will stick with these parameters (`v1`, `v2`, `offset`) for now.

## What NOT to Try
- **Circular Crop:** Proven to be suboptimal for a square container.
- **Random Initialization:** Dead end.

## Validation Notes
- **Score Expectation:** The score should drop significantly (below 70, possibly beating the target).
- **Visual Check:** The initial submission (before packing) should look like a square block of trees, not a circle.
