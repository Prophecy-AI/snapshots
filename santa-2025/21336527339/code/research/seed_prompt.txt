# Christmas Tree Packing - Strategic Seed Prompt (Loop 4)

## Current Status
- Best CV score: 70.615744 from ensemble (exp_004 pending)
- Best LB score: 70.647327 (exp_002, exp_003)
- Target: 68.887744 | Gap to target: 1.727 points (2.4%)

## CV-LB Relationship
- CV = LB PERFECTLY (confirmed by exp_002 and exp_003)
- No distribution shift - local validation is 100% reliable
- We can trust CV scores completely

## Response to Evaluator
The evaluator correctly identified that:
1. The baseline is at a strong local optimum - bbox3, sa_fast_v2, and fix_direction all failed
2. The path forward is ENSEMBLE - combining best solutions from multiple sources
3. The jonathanchan kernel approach (15+ sources) is the winning strategy

I've now implemented the ensemble approach:
- Scanned 87 valid snapshots
- Found 4 invalid snapshots with overlaps (21016257921, 21129625840, 21145966992, 21337353626)
- Built ensemble from 83 valid snapshots
- Achieved 70.615744 (0.032 improvement from baseline 70.647327)

## Key Findings from Analysis
1. **Best single snapshot (21145966992) has 72 overlaps** - can't be used directly
2. **Valid ensemble score: 70.615744** (0.032 better than baseline)
3. **Top contributing snapshots:**
   - 21222390477: 101 N values
   - 21336527339: 39 N values, 0.022 improvement
   - 21331543270: 21 N values, 0.007 improvement
   - 21328310479: 17 N values

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Submit ensemble (exp_004)
The ensemble submission is ready at `/home/submission/submission.csv`:
- Score: 70.615744 (CV)
- Improvement: 0.032 from baseline
- Verified: NO OVERLAPS
- Submit immediately to get LB feedback

### 2. **[HIGH PRIORITY]** Apply fractional translation to ensemble
The jonathanchan kernel uses very small step movements (0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001) in 8 directions. This can squeeze out additional improvements:
```python
# For each N configuration:
# 1. Try moving each tree by tiny amounts in 8 directions
# 2. Keep if score improves and no overlaps
# 3. Repeat with smaller step sizes
```

### 3. **[MEDIUM PRIORITY]** Run SA optimization on ensemble
Use the C++ optimizer (a.cpp from jonathanchan kernel) on the ensemble:
- Input: ensemble submission
- Parameters: -n 150000 -r 32
- This can find local improvements the ensemble missed

### 4. **[MEDIUM PRIORITY]** Generate new diverse solutions
The ensemble is limited by the diversity of snapshots. Generate new solutions:
- Run bbox3/sa_fast with different random seeds
- Try different initial configurations
- Add to ensemble pool

### 5. **[LOWER PRIORITY]** Target specific N values
The largest gaps are at small N values:
- N=5: 0.023 improvement potential
- N=2: 0.013 improvement potential
- N=56: 0.011 improvement potential
Focus optimization effort on these specific N values.

## What NOT to Try
- ❌ Running bbox3/sa_fast on baseline again (already tried, no improvement)
- ❌ fix_direction on baseline (already optimally rotated)
- ❌ Using invalid snapshots (21145966992 has overlaps)

## Validation Notes
- CV = LB perfectly - trust local validation
- Always verify no overlaps before submission
- Use Shapely with proper tolerance (1e-12)

## Submission Strategy
- Remaining submissions: 91
- Submit ensemble (exp_004) immediately
- Submit after each improvement
- LB feedback is free - use it!

## Gap Analysis
- Current best: 70.615744
- Target: 68.887744
- Gap: 1.727 points (2.4%)
- Need ~2.4% improvement to reach target

The ensemble approach gave us 0.032 points. We need ~54x more improvement.
This suggests we need:
1. More diverse solution sources
2. Better optimization on each N
3. Novel algorithms for specific N values
