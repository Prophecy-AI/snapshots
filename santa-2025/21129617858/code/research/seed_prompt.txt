# Santa 2025 Christmas Tree Packing - Strategy Guide (Loop 2)

## Current Status
- Best CV score: 134.997639 from exp_001 (006_jit_optimizer)
- Best LB score: N/A (no submissions yet)
- Target: 68.922808 | Gap to target: 66.07 points

## CRITICAL DISCOVERY: Pre-optimized Solutions Available

**The evaluator correctly identified that pre-optimized solutions with scores ~70.67 are available in snapshots!**

Our current solution (134.99) is 64 points worse than the pre-optimized baseline (70.67). The pre-optimized solution is better for ALL 200 N values.

### Available Resources:
1. **Pre-optimized solutions** (copied to `/home/code/preoptimized/`):
   - `saspav.csv` / `ensemble.csv`: Score 70.676102
   - `corner_extraction.csv`: Score 70.675510 (best available)
   - `submission_70_926149550346.csv`: Score 70.926150
   
2. **C++ Optimizer** (copied to `/home/code/`):
   - `bbox3_advanced`: High-performance C++ optimizer with OpenMP

3. **Previous snapshot insights** (from 21117626902):
   - Corner extraction improved score from 70.676 to 70.6755
   - bbox3 optimizer showed minimal improvement on already-optimized solutions
   - The saspav baseline is at a very strong local optimum

## Response to Evaluator

**Technical verdict was TRUSTWORTHY.** The evaluator correctly identified:
1. Pre-optimized solutions exist with scores ~70.67
2. Our current approach (starting from 134.99) is fundamentally wrong
3. The gap from 70.67 to 68.92 is only 1.75 points - achievable!

**Evaluator's top priority**: Use pre-optimized baseline and C++ optimizer. **AGREE 100%.**

**Key concerns raised**: 
- Starting from wrong baseline (134.99 vs 70.67) - **ADDRESSED** by copying pre-optimized solutions
- Not using C++ optimizer - **ADDRESSED** by copying bbox3_advanced

## Data Understanding

Reference notebooks:
- `research/kernels/chistyakov_santa-2025-simple-optimization-new-slow-version/`: Corner extraction technique
- `research/kernels/crodoc_74-75-backpacking-christmas-trees/`: Backward propagation
- `research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/`: Ensemble + SA

Key patterns:
- N=1 contributes most to score (0.661250)
- Small N values (1-30) contribute disproportionately to total score
- The saspav solution is at a very strong local optimum
- Previous snapshots tried many approaches (SA, backward propagation, bbox3) with 0 improvement

## Recommended Approaches (Priority Order)

### Priority 1: Use Pre-optimized Baseline
```python
# Load the best pre-optimized solution
configs = load_submission('/home/code/preoptimized/corner_extraction.csv')
# Score: 70.675510, Gap to target: 1.75 points
```

### Priority 2: Run bbox3_advanced C++ Optimizer
```bash
# Copy and run the C++ optimizer
./bbox3_advanced -i input.csv -o output.csv -n 100000 -r 256
```
The bbox3_advanced binary is already copied to `/home/code/`. It uses:
- OpenMP parallelization
- Simulated annealing with temperature scheduling
- Fluid dynamics simulation for tree movement
- Hinge pivot moves and density gradient flow

### Priority 3: Extended Optimization Techniques
1. **Corner extraction / deletion cascade**: For each large N, try removing boundary-touching trees and check if resulting (N-1) config is better
2. **Fractional translation**: Fine-grained position adjustments (0.0001 step sizes)
3. **Multi-start SA**: Run SA from multiple random initializations

### Priority 4: Ensemble from Multiple Sources
Combine best configurations from:
- saspav.csv (192 N values typically best)
- corner_extraction.csv (some N values improved)
- Any new optimizations

## What NOT to Try

1. ❌ **Building from scratch** - Pre-optimized solutions are 64 points better
2. ❌ **Simple backward propagation** - Previous snapshots showed 0 improvement
3. ❌ **Short optimization runs** - The baseline is already at a strong local optimum
4. ❌ **Lattice-based construction** - Produces worse scores than baseline

## Validation Notes

- CV scheme: Calculate score = Σ(s²/n) for n=1 to 200
- All configurations must have NO OVERLAPS
- Use Shapely with high precision (Decimal with 25+ digits) for overlap detection
- Validate all 200 configurations before submission

## Key Insight from Previous Snapshots

The previous snapshot (21123768399) tried:
1. Ensemble from 20 sources - 0 improvement (saspav already best for all N)
2. Backward propagation - 0 improvement
3. Numba-accelerated SA - 0 improvement
4. C++ optimizer with 1M iterations - 0 improvement

The snapshot 21117626902 found ONE improvement using corner extraction:
- N=54 extracted from N=163 corner: 0.361321 → 0.360686

**The gap of 1.75 points appears to require fundamentally different approaches not available in public kernels.** However, the target IS achievable - we just need to find the right technique.

## Potential Breakthrough Approaches

1. **Longer optimization runs**: Previous runs used 50K-1M iterations. Try 10M+ iterations.
2. **Different SA parameters**: Try higher initial temperatures, slower cooling
3. **Hybrid approaches**: Combine multiple move types (translation + rotation + swap)
4. **Focus on high-contribution N values**: N=1-30 contribute most to score
5. **Manual optimization**: For small N (1-10), optimal solutions may be known

## Expected Workflow

1. Load pre-optimized baseline (70.6755)
2. Run bbox3_advanced with extended parameters
3. Apply corner extraction / deletion cascade
4. Validate and repair any overlaps
5. Submit to get LB feedback
6. Iterate with longer optimization runs

The target of 68.92 is 1.75 points away. This is achievable with the right optimization strategy!
