# Santa 2025 - Christmas Tree Packing Challenge

## Current Status
- Best CV score: 70.619825 from exp_000 (001_baseline)
- Best LB score: 70.647327 (verified submission #1)
- Target: 68.894234 | Gap to target: 1.75 points (2.5%)
- CV-LB gap: -0.0275 (LB slightly worse than CV, expected for optimization)

## CV-LB Relationship Analysis
- CV and LB are very close (-0.0275 gap)
- This confirms local validation is reasonably accurate
- No distribution shift concerns - this is a pure optimization problem

## Response to Evaluator

The evaluator correctly identified that:
1. **The ensemble hasn't been built yet** - This is the #1 priority
2. **No optimization run was executed** - Just copied a snapshot
3. **The jonathanchan kernel achieves sub-68** by ensembling 19+ sources

**My response:**
- I AGREE with the evaluator's assessment
- The baseline is now established and LB-verified
- Next step: Build ensemble from ALL 3211 CSV files in snapshots
- Then run tree_packer optimization on the ensemble

**CRITICAL INSIGHT from previous experiments:**
- 38+ experiments tried bbox3, SA, GA, MIP, tessellation, basin hopping, deletion cascade, asymmetric solutions, ensemble from 107 sources
- ALL converged to same local optimum (~70.62)
- Advanced bbox3 only improved by 0.000061 points
- **The current solution is at an EXTREMELY strong local optimum**

**This means:**
- Simply running more optimization won't help
- Need to find configurations that are FUNDAMENTALLY different
- The ensemble approach should look for DIVERSE solutions, not just best scores

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Build Comprehensive Ensemble from ALL Sources
The jonathanchan kernel approach:
1. Collect ALL 3211 CSV files from snapshots
2. For each N (1-200), keep the configuration with smallest side length
3. Override N=1 with fixed 45° rotation (theoretical minimum: side=0.813)
4. This creates a "best of all worlds" starting point

**Implementation:**
```python
import glob
import pandas as pd
import numpy as np

# Find all CSV files
csv_files = glob.glob('/home/nonroot/snapshots/santa-2025/*/submission/*.csv')
csv_files += glob.glob('/home/nonroot/snapshots/santa-2025/*/code/submission_candidates/*.csv')
csv_files += glob.glob('/home/nonroot/snapshots/santa-2025/*/code/experiments/*/*.csv')
csv_files += glob.glob('/home/nonroot/snapshots/santa-2025/*/code/preoptimized/**/*.csv', recursive=True)

# For each N, find best configuration
best_configs = {}
for csv_file in csv_files:
    df = pd.read_csv(csv_file)
    for n in range(1, 201):
        group = df[df['id'].str.startswith(f'{n:03d}_')]
        if len(group) == n:
            score = calculate_score(group)
            if n not in best_configs or score < best_configs[n]['score']:
                best_configs[n] = {'score': score, 'data': group}
```

### 2. **[HIGH PRIORITY]** Run tree_packer Optimization on Ensemble
After building ensemble, run long optimization:
```bash
# Compile tree_packer_v18 from smartmanoj kernel
g++ -O3 -march=native -std=c++17 -fopenmp -o tree_packer tree_packer_v18.cpp

# Run with long iterations
./tree_packer -i ensemble.csv -o optimized.csv -n 150000 -r 32
```

### 3. **[MEDIUM PRIORITY]** Focus on Specific N Ranges
Score breakdown shows:
- N=1-10: 4.33 (6.1%) - N=1 is optimal, focus on N=2-10
- N=11-50: 14.70 (20.8%)
- N=51-100: 17.61 (24.9%)
- N=101-150: 17.14 (24.3%)
- N=151-200: 16.84 (23.8%)

For each N, analyze which source has the best configuration and why.

### 4. **[NEW - NOT TRIED]** Asymmetric Solutions
Discussion "Why the winning solutions will be Asymmetric" (38 votes) suggests:
- Symmetric solutions may be at local optima
- Asymmetric configurations might achieve better packing
- Worth exploring for specific N values

### 5. **[NEW - NOT TRIED]** Lattice/Grid-Based Approach for Large N
For N >= 58, use crystalline packing:
- Start with 2 base trees in optimal configuration
- Translate in x and y directions to create grid pattern
- Can achieve tighter bounds than random optimization

## What NOT to Try (Exhausted)
- Standard bbox3 with short iterations (tried extensively)
- Standard SA with same initialization
- Advanced bbox3 (only 0.000061 improvement)
- Simple ensemble without optimization
- Basin hopping (no improvement)
- Greedy beam search (no improvement)
- Deletion cascade (no improvement)

## Validation Notes
- **ALWAYS** use strict overlap detection with buffer=0.001
- CV-LB gap is small (-0.0275), so CV is reliable
- Submit frequently to verify solutions are valid (99 submissions remaining)

## Key Files and Locations
- Best snapshot: `/home/nonroot/snapshots/santa-2025/21322576451/submission/submission.csv`
- tree_packer code: `/home/code/research/kernels/smartmanoj_santa-claude/santa-claude.ipynb`
- jonathanchan ensemble: `/home/code/research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/`
- All snapshots: `/home/nonroot/snapshots/santa-2025/*/`

## SUBMISSION STRATEGY
- Remaining submissions: 99
- **SUBMIT AFTER EVERY EXPERIMENT** - LB feedback is free information
- Even if score is worse, we learn what doesn't work

## First Experiment: Build Ensemble
1. Scan ALL 3211 CSV files
2. For each N (1-200), extract best configuration
3. Override N=1 with optimal 45° rotation
4. Calculate ensemble score
5. Submit to verify validity
6. Then run tree_packer optimization
