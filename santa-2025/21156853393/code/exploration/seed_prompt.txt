# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.676102 from exp_000 (baseline pre-optimized submission)
- Best LB score: N/A (no submissions yet)
- Target: 68.919154 | Gap to target: 1.757 points (2.5% improvement needed)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? NO - only evaluated pre-optimized files
- Top kernels identified:
  1. saspav/santa-submission (440 votes) - bbox3 + fix_direction
  2. smartmanoj/santa-claude (373 votes) - tree_packer_v21 + backward propagation
  3. yongsukprasertsuk/santa-2025-best-keeping-bbox3-runner (369 votes) - phased bbox3 runs
  4. jazivxt/why-not (298 votes) - bbox3 source code
  5. jonathanchan/santa25-ensemble-sa-fractional-translation (175 votes) - ensemble + SA + fractional translation
- Kernels we've implemented: None (only evaluated existing files)
- Kernels still to implement: All of the above

## Response to Evaluator
The evaluator correctly identified that:
1. No actual optimization was run - only evaluation of existing files
2. The bbox3 binary exists but has GLIBC version mismatch - I've now compiled it from source
3. Both bbox3 and tree_packer_v21 couldn't improve the pre-optimized submission (already at local optimum)

The evaluator's suggestion to run bbox3 with extended parameters was tried but yielded no improvement. This confirms the pre-optimized files are at very tight local optima.

## Key Analysis Findings
From exploration/evolver_loop1_analysis.ipynb:
- Score breakdown by N range:
  - N=1-10: 4.33 (6.1%) - already well-optimized
  - N=11-50: 14.71 (20.8%) - significant opportunity
  - N=51-100: 17.64 (25.0%) - largest contribution
  - N=101-150: 17.14 (24.3%)
  - N=151-200: 16.85 (23.8%)
- N=1 is already optimal (45° rotation gives minimum bounding box)
- Gap to close: 1.757 points (2.5% improvement needed)

## Critical Insight: Local Optimum Trap
The pre-optimized submissions are at VERY tight local optima:
- bbox3 with -n 5000 -r 32: No improvement
- tree_packer_v21 with default params: No improvement
- fix_direction: No improvement (already applied)

**This means we need FUNDAMENTALLY DIFFERENT approaches, not more optimization of the same solution.**

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Multi-Source Ensemble with Fresh Optimization
The jonathanchan kernel shows the right approach:
- Collect best configurations from MULTIPLE sources for each N
- Run SA optimization on the ensemble
- Use fractional translation for fine-tuning
- Key insight: Different sources may have different local optima for different N values

### 2. **[HIGH PRIORITY]** Extended Optimization from Random Restarts
Instead of optimizing the pre-optimized solution:
- Generate NEW random configurations from scratch
- Run extended optimization (hours, not minutes)
- Multiple seeds to explore different basins
- Focus on N=11-100 which have most room for improvement

### 3. **[MEDIUM PRIORITY]** Lattice-Based Initialization for Large N
For N >= 58, try crystalline packing:
- Start with 2 base trees in optimal configuration
- Translate them in x and y directions to create grid
- Optimize base configuration and translation vectors
- This is fundamentally different from random optimization

### 4. **[MEDIUM PRIORITY]** Backward Propagation from Larger N
The santa-claude kernel uses bp.cpp:
- Take optimized N+1 configuration
- Remove one tree to get N configuration
- This can find different local optima than forward optimization

### 5. **[EXPERIMENTAL]** Greedy Constructive Heuristic
Build solutions from scratch:
- Place first tree at origin with optimal rotation
- For each subsequent tree, find best position touching existing trees
- Use corner-occupying strategy (place at corners of bounding box)
- This explores completely different solution space

## What NOT to Try
- More optimization of the pre-optimized ensemble.csv (already at local optimum)
- Short optimization runs (< 1 hour)
- Single-seed optimization (need multiple restarts)
- Focusing on N=1-10 (already optimal)

## Validation Notes
- CV scheme: Calculate score = Σ(side²/n) for n=1 to 200
- Validate for overlaps before submission
- Use fix_direction as post-processing
- Repair overlapping configurations with donor file

## SUBMISSION STRATEGY
- Remaining submissions: 100
- Submit after this experiment? YES - we have abundant submissions and need LB feedback
- First submission should establish baseline LB score for calibration

## Next Experiment: exp_002
**Goal**: Run extended optimization with multiple random restarts

**Approach**:
1. Copy the ensemble.csv as starting point
2. Compile and run the sa_v1_parallel optimizer from jonathanchan kernel
3. Use parameters: -n 20000 -r 80 (extended run)
4. Apply fractional translation post-processing
5. Validate for overlaps and repair if needed
6. Submit to get LB feedback

**Alternative if no improvement**:
- Generate random configurations from scratch for N=11-100
- Run optimization on fresh solutions to escape local optima
