# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.676102 from exp_000 (baseline)
- Best LB score: 70.676102 (confirmed)
- Target: 68.919154 | Gap to target: 1.756948 (2.49%)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? YES - baseline is from pre-optimized santa-2025.csv
- Top kernels identified: All public kernels produce scores >= 70.676102
- **KEY FINDING**: Baseline is already the BEST across all 30 pre-optimized CSVs in snapshot
- No ensemble improvement possible from existing solutions

## CV-LB Relationship Analysis
- CV = LB for this optimization problem (no train/test split, deterministic scoring)
- No distribution shift - this is pure optimization

## Response to Evaluator
The evaluator correctly identified that:
1. **Lattice approach is fundamentally broken** - starting from scratch produces 3.2x worse results
2. **Fractional translation found zero improvements** - baseline is at a perfect local optimum
3. **Optimization runs were too short** - need HOURS not minutes
4. **Backward propagation not tried** - this is a key technique

I agree with the evaluator's assessment. The baseline is at an extremely tight local optimum. Standard optimization techniques cannot escape it. We need fundamentally different approaches.

## Key Insights from Research
1. **N < 58**: Use Simulated Annealing for unstructured, chaotic packings
2. **N > 58**: Switch to "Crystalline Packing" (regular geometric lattices) which is mathematically superior
3. **Top solutions run for HOURS** with multiple generations and perturbation
4. **LLMs are used to write optimized C++ kernels**, not to solve the puzzle directly

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Run bbox3 optimizer for MUCH LONGER
The current baseline was optimized with short runs. Top solutions run for HOURS:
- `-n 100000 -r 200` (expect 30+ minutes)
- Multiple random seeds (1, 2, 3, 4, 5)
- Population-based approach: keep top 3 solutions, perturb and re-optimize

### 2. **[HIGH PRIORITY]** Implement Backward Propagation
For each N from 200 down to 2:
- Take the N configuration
- Try removing each tree one at a time
- If the resulting (N-1) configuration has smaller bounding box than current (N-1), replace it
- This propagates good packings from larger N to smaller N

### 3. **[HIGH PRIORITY]** Try Different Random Seeds
The current solution might be one local optimum. Different seeds might find different basins:
- Run optimization with seeds 1, 2, 3, 4, 5
- Keep the best result for each N

### 4. **[MEDIUM PRIORITY]** Perturbation + Re-optimization
After each optimization round:
- Randomly perturb the best solution by small amounts (0.01-0.1)
- Re-optimize from the perturbed state
- This helps escape local optima

### 5. **[MEDIUM PRIORITY]** Fix Direction Post-Processing
After optimization, rotate entire configuration to minimize bounding box:
- Use ConvexHull of all tree vertices
- Find optimal rotation angle between 0-90 degrees using minimize_scalar

## What NOT to Try
- ❌ Lattice from scratch (produces 3x worse results)
- ❌ Fractional translation on baseline (found zero improvements)
- ❌ Short optimization runs (< 5 minutes)
- ❌ Ensemble of existing CSVs (baseline already dominates all)

## SUBMISSION STRATEGY
- Remaining submissions: 94
- Submit after this experiment? YES - we have abundant submissions
- LB feedback is free information - use it!

## Validation Notes
- CV = LB for this problem (deterministic scoring)
- Verify no overlaps before submission
- Use full precision (18+ decimal places) in output

## The Gap Analysis
- Current: 70.676102
- Target: 68.919154
- Gap: 1.756948 (2.49%)
- Very Large N (101-200) contributes 48.1% of score - focus optimization here
- Large N (51-100) contributes 25.0% of score
- Medium N (11-50) contributes 20.8% of score
- Small N (1-10) contributes 6.1% of score

## Next Experiment
Run bbox3 optimizer with much longer parameters:
1. Copy baseline to working directory
2. Run `./bbox3 -n 100000 -r 200` (expect 30+ minutes)
3. Apply fix_direction post-processing
4. Verify no overlaps
5. Submit and get LB feedback