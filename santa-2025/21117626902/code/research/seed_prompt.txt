# Santa 2025 Christmas Tree Packing - Seed Prompt (Loop 7)

## Current Status
- Best CV score: 70.676145 from exp_004 (verified_ensemble)
- Best LB score: 70.676145 (exp_003 and exp_004)
- Target: 68.922808 | Gap to target: 1.75 points (2.5% reduction needed)
- Submissions used: 5/100 (91 remaining - ABUNDANT!)

## CRITICAL: Previous Submission Failed
Experiment 006 (corner_extraction) failed with "Overlapping trees in group 040".
**Root cause**: Precision truncation. The code used numpy float64 which truncated 
precision from ~25 decimal places to ~16 decimal places. This caused trees that 
were previously just touching to now overlap.

**LESSON**: When modifying configurations, MUST preserve original string precision.
Do NOT convert to float and back - use string operations to preserve precision.

## Public Kernel Status
- Best kernel implemented: jonathanchan ensemble (70.676)
- Top kernels identified:
  - jiweiliu super-fast SA with translations (claims ~0.15 improvement)
  - sacuscreed guided refinement
  - blueshyy greedy backtracking
- Kernels we've implemented: jonathanchan ensemble, bbox3 optimizer, corner extraction (failed)
- **Kernels still to implement**: jiweiliu deletion cascade, grid-based SA

## Response to Evaluator
The evaluator correctly identified that:
1. Corner extraction yielded only 0.000634 improvement - far below the 1.75 points needed
2. The jiweiliu kernel's deletion cascade technique has NOT been implemented
3. Grid-based initialization with SA hasn't been tried
4. The target of 68.92 is BETTER than the current #1 on the leaderboard (71.19)

I agree with all these points. The deletion cascade is the highest priority technique to implement.

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Implement jiweiliu Deletion Cascade

The jiweiliu kernel has a `deletion_cascade_numba` function that:
- For each N from 200 down to 2, tries removing each tree
- Keeps the deletion that minimizes the bounding box
- Propagates good large configs to smaller sizes
- Claims ~0.15 improvement in ~3 seconds

**CRITICAL**: The kernel code is at:
```
/home/code/research/kernels/jiweiliu_super-fast-simulated-annealing-with-translations/super-fast-simulated-annealing-with-translations.ipynb
```

**Implementation steps**:
1. Extract the deletion cascade code from the jiweiliu kernel
2. Apply it to our current best ensemble (candidate_004.csv)
3. **PRESERVE PRECISION**: Use Decimal or string operations, NOT float64
4. Verify no overlaps before saving

### 2. **[HIGH PRIORITY]** Grid-based SA from jiweiliu kernel

The jiweiliu kernel generates configurations from grid patterns:
- ncols × nrows × 2 trees per cell
- Add extra trees at edges for non-multiple counts
- Run SA optimization on each grid configuration

This generates NOVEL solutions in different basins.

### 3. **[MEDIUM PRIORITY]** Guided Refinement from sacuscreed kernel

The sacuscreed kernel uses guided refinement that can be mixed with SA:
- 71.65 -> 71.46 (super-fast SA)
- 71.46 -> 71.45 (guided refinement)
- 71.45 -> 71.36 (super-fast SA again)

This iterative approach hasn't been tried.

## What NOT to Try
- Corner extraction (already tried, minimal improvement)
- bbox3 optimizer alone (already tried, 0 improvement on ensemble)
- Any approach that truncates precision (causes overlaps)

## Validation Notes
- CV scheme: Deterministic scoring, sum(side^2 / N) for N=1 to 200
- MUST verify no overlaps before submission using Kaggle's exact method
- MUST preserve original string precision (25+ decimal places)

## SUBMISSION STRATEGY
- Remaining submissions: 91 (ABUNDANT!)
- Submit after this experiment? **YES** - we have plenty of submissions
- Submit ONLY if score improves AND no overlaps detected

## Technical Notes

### Precision Preservation
When modifying configurations, use this pattern:
```python
# BAD - truncates precision
xs = np.array([float(x.replace('s', '')) for x in df['x']])
# ... modify xs ...
df['x'] = [f's{x}' for x in xs]  # PRECISION LOST!

# GOOD - preserve original strings for unchanged trees
# Only modify the specific trees that need changing
# Keep original strings for all other trees
```

### Overlap Checking
Use Kaggle's exact method with Decimal precision:
```python
from decimal import Decimal, getcontext
getcontext().prec = 25
# Use ChristmasTree class with Decimal coordinates
```

## Files to Reference
- Current best submission: `/home/submission/submission.csv` (restored to candidate_004)
- jiweiliu kernel: `/home/code/research/kernels/jiweiliu_super-fast-simulated-annealing-with-translations/`
- sacuscreed kernel: `/home/code/research/kernels/sacuscreed_santa2025-solutions-guided-refinement/`
