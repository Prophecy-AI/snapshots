# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 1)

## Current Status
- Best CV score: 70.743774 from exp_000 (001_baseline_preoptimized)
- Best LB score: 70.743774 (CV = LB, deterministic optimization problem)
- Target: 68.922808 | Gap to target: 1.82 points (2.57% reduction needed)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **NO** - only downloaded pre-optimized CSV
- Top kernels identified:
  1. jazivxt/why-not (bbox3 C++ optimizer) - 292 votes
  2. jonathanchan/santa25-ensemble-sa-fractional-translation (ensemble + SA) - 174 votes
  3. crodoc/74-75-backpacking-christmas-trees (backward propagation) - 126 votes
  4. egortrushin/santa25-simulated-annealing-with-translations - 126 votes
- Kernels we've implemented: NONE (just downloaded pre-optimized CSV)
- Kernels still to implement: ALL of the above

**CRITICAL: We have NOT run any actual optimization code yet!**
The baseline is just a downloaded pre-optimized solution. To beat the target, we MUST run optimization.

## Response to Evaluator

The evaluator correctly identified the key issue: **No actual optimization code has been executed yet**. The baseline is just a downloaded pre-optimized solution from SmartManoj's GitHub. The evaluator's recommendations are spot-on:

1. **Compile and run bbox3 C++ optimizer** - This is the primary technique used by top performers
2. **Validate for overlaps** - Done in baseline, no overlaps found
3. **Per-N score breakdown** - Done in analysis, small N values (1-10) contribute disproportionately
4. **Extended optimization time** - The longer it runs, the better the results

I fully agree with the evaluator's assessment. The next experiment MUST involve running actual optimization code.

## Per-N Analysis Results
- Total score: 70.74, Target: 68.92, Gap: 1.82 (2.57% reduction needed)
- Worst N values by score contribution:
  - N=1: 0.661 (0.93% of total) - already optimal at 45°
  - N=2: 0.451 (0.64% of total)
  - N=3: 0.435 (0.61% of total)
  - N=4-10: ~0.38-0.42 each
- Small N values (1-20) contribute disproportionately to total score
- Best performing N values: N=181, N=182, N=156 (around 0.33 each)

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Run bbox3 C++ Optimizer
The bbox3 optimizer from jazivxt/why-not is the key technique used by top performers.

**EXPLICIT COMMANDS:**
```bash
# Extract bbox3.cpp from the kernel
cd /home/code/experiments/002_bbox3_optimizer

# Copy the C++ code from the kernel
# The code is in research/kernels/jazivxt_why-not/why-not.ipynb

# Compile with optimizations
g++ -O3 -march=native -std=c++17 -fopenmp -o bbox3 bbox3.cpp

# Run with high parameters (let it run for hours)
export OMP_NUM_THREADS=$(nproc)
./bbox3 -n 10000 -r 256
```

**Expected improvement**: 1-2 points (enough to beat target)

### 2. **[HIGH PRIORITY]** Ensemble Multiple Solutions
From jonathanchan kernel - combine best configurations from multiple sources for each N.

**EXPLICIT COMMANDS:**
```bash
# Download additional pre-optimized solutions
wget -q https://raw.githubusercontent.com/SmartManoj/Santa-Scoreboard/main/submission.csv -O solution1.csv

# The ensemble code is in:
# research/kernels/jonathanchan_santa25-ensemble-sa-fractional-translation/santa25-ensemble-sa-fractional-translation.ipynb

# For each N, pick the best configuration across all sources
```

**Expected improvement**: 0.5-1 points

### 3. **[MEDIUM PRIORITY]** Backward Propagation
From crodoc/74-75-backpacking-christmas-trees - start from N=200 and propagate good configurations backward.

**Key insight**: Good packing at N=200 often contains good packings for smaller N when trees are removed.

### 4. **[MEDIUM PRIORITY]** Fractional Translation Refinement
From jonathanchan kernel - fine-grained translation with steps:
[0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001]

This can squeeze out additional improvements after SA optimization.

## What NOT to Try
- ❌ More fix_direction rotation tightening (already applied to pre-optimized solution)
- ❌ Downloading more pre-optimized CSVs without running optimization
- ❌ Simple local search without SA (will get stuck in local optima)

## Technical Details

### bbox3 C++ Optimizer Key Features
- Simulated annealing with geometric cooling: T(k+1) = α * T(k), α ≈ 0.95-0.99
- Local search with multiple move types: translation, rotation, swap
- Squeeze/compaction: Move trees toward center to reduce bounding box
- Multi-start optimization with different random seeds
- OpenMP parallelization for multi-core execution

### Simulated Annealing Parameters (from jonathanchan)
```cpp
// sa_v3 parameters
double T0 = 1.0;           // Initial temperature
double T_min = 0.000005;   // Minimum temperature
double alpha = 0.25;       // Cooling rate
double angle_delta = 70.0; // Rotation perturbation
```

### Submission Format
```csv
id,x,y,deg
001_0,s0.0,s0.0,s45.0
002_0,s0.15,s-0.04,s203.6
...
```
- Values prefixed with 's' to preserve precision
- Total rows: 20100 (sum of 1 to 200)

## Validation Checklist
Before submitting:
1. ✓ Check all N=1 to 200 configurations present (20100 rows)
2. ✓ Verify no overlaps in any configuration
3. ✓ Verify all coordinates in [-100, 100]
4. ✓ Verify 's' prefix on all values
5. ✓ Calculate local score and compare to expected

## SUBMISSION STRATEGY
- Remaining submissions: 93
- Submit after this experiment? **YES** - we have abundant submissions
- LB feedback is free information - USE IT!

## Next Experiment: 002_bbox3_optimizer

**Goal**: Run the bbox3 C++ optimizer on the pre-optimized baseline to improve the score.

**Steps**:
1. Extract bbox3.cpp from research/kernels/jazivxt_why-not/why-not.ipynb
2. Compile with: `g++ -O3 -march=native -std=c++17 -fopenmp -o bbox3 bbox3.cpp`
3. Copy pre-optimized submission as input
4. Run optimizer: `./bbox3 -n 10000 -r 64` (start with moderate params, can increase)
5. Apply fix_direction post-processing
6. Validate no overlaps
7. Score and submit

**Expected outcome**: Score improvement of 1-2 points, bringing us close to or below target of 68.92.