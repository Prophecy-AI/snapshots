# Santa 2025 Christmas Tree Packing - Seed Prompt (Loop 5)

## Current Status
- **Best CV score**: 70.676145 from 004_verified_ensemble
- **Best LB score**: 70.6761 (CV = LB exactly - deterministic problem!)
- **Target**: 68.922808 | **Gap**: 1.75 points (2.48% reduction needed)
- **Submissions**: 3/100 used, 92 remaining

## Critical Insight: CV = LB Exactly
This is a **pure optimization problem** with no distribution shift. The score is deterministic.
- What works locally WILL work on leaderboard
- No need for CV-LB gap analysis - they're identical
- Focus 100% on finding better configurations

## Public Kernel Status
- **Best public kernel**: ~70.67 (same as our current best)
- **Target 68.92 is BELOW current #1 on leaderboard (71.19)**
- This means: **We need techniques that don't exist in public kernels!**

## Response to Evaluator
The evaluator correctly identified that:
1. ✅ The ensemble approach is correct and working
2. ✅ Overlap checking is now properly implemented
3. ✅ C++ optimizer achieved 0 improvement - we're at a strong local optimum
4. ✅ The target requires GENERATING better solutions, not finding them

**Key insight from evaluator**: "The target of 68.92 is BETTER than the current #1 on the leaderboard (71.19). This means the target requires solutions that are NOT publicly available."

I agree with this assessment. We need to:
1. Run extended optimization (hours, not minutes)
2. Try fundamentally different approaches (Sparrow, crystalline packing)
3. Focus on worst N values (N=1 to N=20 contribute disproportionately)

## Analysis Results
From exploration/evolver_loop4_lb_feedback.ipynb:
- Top 20 worst N values contribute 8.08 points (11.4% of total)
- Need ~22% improvement on top 20 N values to reach target
- N=1 alone contributes 0.66 points (highest single contribution)
- Small N values (1-20) are high-leverage targets

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Sparrow Optimizer for Small N**
The sparrow kernel uses a Rust-based strip packing optimizer that can find better solutions for specific N values.

```bash
# Clone and build sparrow
git clone https://github.com/SmartManoj/sparrow
cd sparrow
cargo build --release --features=simd,only_final_svg

# Run for N=14 (example from kernel)
# Create input JSON for target N value
# Run: cargo run --release --features=simd,only_final_svg -- -i input.json -t 600 -s 42
```

**Target N values**: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 (highest leverage)

### 2. **[HIGH PRIORITY] Extended C++ Optimization (6+ hours)**
Run bbox3 for extended periods with aggressive parameters:

```bash
cd /home/code/datasets
export OMP_NUM_THREADS=$(nproc)
./bbox3 -i /home/submission/submission.csv -n 25000 -r 256
```

Run for 6+ hours. The jonathanchan kernel mentions running for hours with `-n 15000 -r 80`.

### 3. **[HIGH PRIORITY] Download Additional Datasets**
Check for telegram-public-shared-solution dataset mentioned in jonathanchan kernel:

```bash
kaggle datasets download -d asalhi/telegram-public-shared-solution-for-santa-2025 -p /home/code/datasets/telegram_full
```

### 4. **[MEDIUM PRIORITY] Crystalline/Lattice Packing for Large N**
For N > 58, crystalline/lattice packing is mathematically superior:
- Use PyXtal or similar tools to generate lattice structures
- The "Symmetric solutions that are apparently optimal" discussion mentions this

### 5. **[MEDIUM PRIORITY] Greedy Backtracking from Large N**
The chistyakov kernel "rebuild large layout from corners" approach:
- Take N=200 configuration
- For each corner, sort trees by distance from corner
- Check if subset of K trees has better score than current N=K config
- This can find better small N configs hidden in large N configs

```python
# From chistyakov kernel
for corner_x, corner_y in corners:
    candidates = {max(abs(tree.bounds - corner)): tree for tree in layout}
    candidates = dict(sorted(candidates.items()))
    layout_new = []
    for tree in candidates.values():
        layout_new.append(tree)
        if score(layout_new) < best[len(layout_new)]:
            best[len(layout_new)] = layout_new
```

## What NOT to Try
- ❌ More SA with same parameters (already at local optimum)
- ❌ Simple ensembling of existing sources (already done, no improvement)
- ❌ Short optimization runs (need hours, not minutes)
- ❌ Giving up (target IS achievable!)

## Validation Notes
- CV = LB exactly for this problem
- Always verify no overlaps before submission
- Use shapely STRtree for efficient overlap detection

## Submission Strategy
- **92 submissions remaining** - SUBMIT AGGRESSIVELY!
- Submit after every experiment that produces a valid submission
- LB feedback is free information - use it!

## Key Files
- Current best submission: `/home/submission/submission.csv` (70.676145)
- bbox3 optimizer: `/home/code/datasets/bbox3`
- Sparrow kernel: `/home/code/research/kernels/smartmanoj_sparrow/`
- Chistyakov corner rebuild: `/home/code/research/kernels/chistyakov_new-simple-fix-rebuild-large-layout-from-corners/`

## Expected Outcome
If we can improve the top 20 worst N values by 22%, we reach the target.
Focus on N=1 to N=10 first - these have the highest leverage.
