# Santa 2025 Christmas Tree Packing - Evolved Seed Prompt (Loop 5)

## Current Status
- Best CV score: 70.676145 from exp_004 (verified ensemble)
- Best LB score: 70.676145 (CV = LB exactly - deterministic problem)
- Target: 68.922808 | Gap to target: 1.753 points (2.5%)

## CRITICAL INSIGHT: TARGET IS BELOW PUBLIC LB #1
- Current LB #1: 71.19 (terry_u16)
- Our target: 68.92 (2.27 points BETTER than #1)
- Best public source: 70.676 (santa-2025.csv)
- **NO PUBLIC SOLUTION ACHIEVES THE TARGET**

## What We've Tried (All Hit Same Local Optimum)
1. ✅ Pre-optimized submission (70.74)
2. ✅ bbox3 C++ optimizer with -n 50000 -r 256 (0 improvement)
3. ✅ Ensemble from 17 sources (70.676)
4. ✅ sa_v1_parallel optimizer (0 improvement)
5. ✅ Backward iteration/backpacking (0 improvement)

## Response to Evaluator
The evaluator correctly identified that:
1. The ensemble is at a VERY strong local optimum - all optimizers achieve 0 improvement
2. The target requires GENERATING new solutions, not optimizing existing ones
3. Small N values (1-30) have highest leverage for improvement

I agree with all points. The key insight is that we need to ESCAPE the current local optimum basin, not optimize within it.

## CRITICAL: APPROACHES NOT YET TRIED

### 1. Corner Extraction (chistyakov kernel) - HIGH PRIORITY
From `research/kernels/chistyakov_new-simple-fix-rebuild-large-layout-from-corners/`:
- For each large N configuration (e.g., N=111), look at each corner
- Extract smaller layouts by taking trees closest to that corner
- If the extracted layout is better than current best for that N, save it
- This can find hidden good configurations within larger layouts

### 2. Well-Aligned Grid Packing (zaburo kernel) - HIGH PRIORITY
From `research/kernels/zaburo_88-32999-a-well-aligned-initial-solution/`:
- Generate structured grid packings with alternating row orientations
- Trees in even rows point up (angle=0), odd rows point down (angle=180)
- Offset odd rows by 0.35 (half tree width) for interlocking
- This creates DIFFERENT initial configurations that may lead to different local optima

### 3. Random Restart with Different Seeds - MEDIUM PRIORITY
- Current solutions may all share the same local optimum basin
- Generate 100+ random initial configurations for small N (1-30)
- Run simulated annealing on each
- Keep the best result for each N

### 4. Genetic Crossover - MEDIUM PRIORITY
- Take configurations from different sources
- Swap subsets of trees between configurations
- Optimize the hybrid configurations
- May escape local optima by combining good features

## Recommended Experiment: Corner Extraction + Grid Packing

```python
# Step 1: Implement corner extraction from chistyakov kernel
# For each N from 200 down to 2:
#   For each corner (4 corners):
#     Sort trees by distance from corner
#     Take first M trees (M < N)
#     If this M-tree layout is better than current best for M, save it

# Step 2: Generate well-aligned grid packings from zaburo kernel
# For each N from 1 to 200:
#   Try different grid configurations (n_even, n_odd combinations)
#   Keep the best one

# Step 3: Ensemble all sources including new ones
# For each N, pick the best configuration from:
#   - Current ensemble
#   - Corner-extracted configurations
#   - Grid-packed configurations
```

## Per-N Score Analysis (Worst 10)
| N | Score | % of Total |
|---|-------|------------|
| 1 | 0.661 | 0.94% |
| 2 | 0.451 | 0.64% |
| 3 | 0.435 | 0.62% |
| 5 | 0.417 | 0.59% |
| 4 | 0.417 | 0.59% |
| 7 | 0.400 | 0.57% |
| 6 | 0.400 | 0.57% |
| 9 | 0.387 | 0.55% |
| 8 | 0.385 | 0.55% |
| 15 | 0.379 | 0.54% |

To reach target: Need to improve top 10 by ~40% (0.661 → 0.40 for N=1, etc.)

## SUBMISSION STRATEGY
- Remaining submissions: 91
- Submit after EVERY experiment that produces a valid submission
- LB feedback is free - USE IT!

## What NOT to Try
- ❌ More bbox3/sa_v1_parallel optimization (already at 0 improvement)
- ❌ More backward iteration (already tried, 0 improvement)
- ❌ Ensembling same sources differently (already optimal)

## Validation Notes
- CV = LB exactly (deterministic problem)
- Always check for overlaps before submission
- Use shapely STRtree for efficient overlap checking
