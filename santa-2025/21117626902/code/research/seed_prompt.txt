# Santa 2025 Christmas Tree Packing - Seed Prompt (Loop 4)

## Current Status
- Best CV score: 70.676145 from exp_003 (004_verified_ensemble)
- Best LB score: 70.743774 (from exp_000)
- Target: 68.922808 | Gap to target: 1.75 points (2.5% reduction needed)
- **CRITICAL**: Our target of 68.92 is BETTER than the current #1 on the leaderboard (71.19)!

## Public Kernel Status
- Have we implemented the best kernel yet? **PARTIALLY** - We have ensemble but not extended optimization
- Top kernels identified:
  - jonathanchan/santa25-ensemble-sa-fractional-translation (174 votes) - has sa_v1_parallel C++ optimizer
  - aikhmelnytskyy/manual-tree-shifter-and-checker-sa (135 votes) - has SA with bbox3
  - chistyakov/new-simple-fix-rebuild-large-layout-from-corners (116 votes) - corner extraction technique
- Kernels we've implemented: Basic ensemble from multiple sources
- **CRITICAL GAP**: We have NOT run extended C++ optimization (hours, not minutes)

## CV-LB Relationship Analysis
- Only 2 submissions so far:
  - exp_000: CV=70.743774, LB=70.743774 (exact match!)
  - exp_002: CV=70.676092, LB=ERROR (overlaps)
- CV matches LB exactly for this problem (deterministic scoring)
- The gap to target is NOT a CV-LB issue - it's a pure optimization problem

## Response to Evaluator
The evaluator correctly identified that:
1. The target of 68.92 is BETTER than the current #1 on the leaderboard (71.19)
2. We cannot achieve this by ensembling public sources alone
3. We need to GENERATE better solutions through extended optimization

**I AGREE with the evaluator's assessment.** The key insight is:
- Public sources max out around 70.67
- To reach 68.92, we need to run extended optimization for HOURS
- The sa_v1_parallel C++ optimizer from jonathanchan kernel is now compiled and ready

## Key Analysis Findings
1. **Score breakdown**: Small N values dominate the score
   - N=1: 0.66 (worst)
   - N=2: 0.45
   - N=3: 0.43
   - N=4-5: ~0.42 each
   
2. **Improvement needed**: To reach target, need to improve top 20 worst N values by ~22%

3. **Optimization strategy**: The jonathanchan kernel shows that:
   - sa_v3: simulated annealing with perturb/restart
   - ls_v3: local search with translation/rotation
   - fractional_translation: fine-grained translation with steps [0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001]
   - opt_v3: combines all three techniques

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Run Extended C++ Optimization (6+ hours)
The sa_v1_parallel optimizer is now compiled at `/home/code/experiments/sa_v1_parallel`.

**EXACT COMMANDS TO RUN:**
```bash
mkdir -p /home/code/experiments/005_extended_optimization
cd /home/code/experiments/005_extended_optimization
cp /home/code/experiments/sa_v1_parallel .
cp /home/submission/submission.csv ./input.csv

# Run with high parameters for extended optimization
export OMP_NUM_THREADS=$(nproc)
./sa_v1_parallel -i input.csv -n 25000 -r 128

# The optimizer saves improved solutions to solutions/ directory
# After completion, copy best solution to submission
```

**Expected outcome**: The optimizer will run for several hours, making incremental improvements. Each generation that improves will save a new solution file.

### 2. **[HIGH PRIORITY]** Focus on Small N Values (N=1 to N=20)
Small N values contribute disproportionately to the score. Consider:
- Running targeted optimization on N=1 to N=20 with aggressive parameters
- For N=1, the optimal is a single tree at 45° rotation (score = 0.6612)
- For N=2-10, try different initial configurations and run SA

### 3. **[MEDIUM PRIORITY]** Corner Extraction Technique
From chistyakov kernel: Extract smaller layouts from larger ones by looking at corners.
- For each large N layout, check if any corner subset gives a better small N solution
- This can find improvements for N values where the current solution is suboptimal

### 4. **[MEDIUM PRIORITY]** Download Additional Datasets
The jonathanchan kernel mentions several datasets we may not have:
- telegram-public-shared-solution-for-santa-2025 (full version)
- santa25-public dataset
- Various notebook outputs

## What NOT to Try
- ❌ More ensembling of existing sources (we've already found the best from public sources)
- ❌ Short optimization runs (minutes won't help - need hours)
- ❌ Changing the ensemble logic (the issue is not the ensemble, it's the source quality)

## Validation Notes
- This is a deterministic optimization problem - CV = LB exactly
- No need for cross-validation or train/test split
- Score is computed as sum(side^2/N) for N=1 to 200
- Lower is better

## SUBMISSION STRATEGY
- Remaining submissions: 93
- Submit after this experiment? **YES** - We have abundant submissions and need LB feedback
- The current submission (70.676145) has no overlaps and is ready to submit

## CRITICAL: The Target IS Achievable
The target of 68.92 requires solutions that don't exist publicly yet. But:
1. The problem is pure optimization - better solutions CAN be found
2. Extended optimization runs (hours) can escape local optima
3. The jonathanchan kernel shows the techniques that work
4. We just need to run the optimizer for long enough

**DO NOT GIVE UP.** The target is achievable with extended optimization.
