# Santa 2025 - Evolved Strategy (Loop 4)

## Current Status
- Best CV score: 70.659959 from exp_000 (baseline)
- Best LB score: 70.659959 (confirmed via 2 submissions)
- Target: 68.919154 | Gap to target: 1.74 points (2.46%)
- Submissions used: 2/100 (98 remaining)

## Critical Finding: All Pre-optimized Sources Exhausted
Comprehensive scan of 37 CSV files shows:
- Best single source (saspav santa-2025.csv): 70.659959
- Ensemble from ALL sources provides NO improvement
- Best source wins for 193/200 N values
- The pre-optimized solutions are already at a local optimum

## What Has Been Tried (All Failed)
1. ❌ SA optimization on pre-optimized: 0 improvement
2. ❌ C++ SA optimizer (fractional translation): 0 improvement  
3. ❌ Lattice construction + SA: 85.93 (much worse than 70.66)
4. ❌ Ensemble from 37 sources: Same as best single source
5. ❌ Rotation optimization: 0 improvement

## Response to Evaluator
The evaluator correctly identified that we hadn't explored all pre-optimized sources. I've now comprehensively scanned ALL 37 CSV files in the snapshots directory. The result confirms that:
- The saspav solution (70.659959) is the best available
- It wins for 193/200 N values
- Ensemble provides zero improvement

The evaluator's suggestion to "comprehensively ensemble from all sources" has been implemented and verified - it doesn't help. We need a fundamentally different approach.

## Key Insight: Need Different Optimization Algorithm
The pre-optimized solutions are at a LOCAL OPTIMUM. Standard SA cannot escape it.
Top kernels use fundamentally different approaches:

1. **Eazy Optimizer** (jazivxt/eazy-optimizer):
   - Square potential gradient (pushes toward center)
   - Elastic pulse (periodic squeeze/relax)
   - Complex orbital moves
   - Multi-scale optimization (1e-3 → 1e-9)

2. **bbox3 Optimizer** (can't run due to GLIBC):
   - Multi-phase approach (2min → 10min → 20min runs)
   - fix_direction rotation optimization
   - Overlap repair with donor solutions

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY]** Implement Eazy Optimizer in Python
The Eazy optimizer uses fundamentally different moves:
- Square potential gradient: Push polygons toward center using log-barrier derivatives
- Elastic pulse: Periodic squeeze (0.999999) and relax (1.0000001)
- Complex orbital moves: Rotate positions using complex exponentials
- Multi-scale: Start at 1e-3, progressively refine to 1e-9

```python
def apply_square_pressure(x, y, S, scale):
    """Push toward center using log-barrier gradient"""
    L = S / 2.0
    gx = 1/(L-x) - 1/(L+x)  # Gradient toward center
    gy = 1/(L-y) - 1/(L+y)
    return x - gx * scale * 0.01, y - gy * scale * 0.01

def elastic_pulse(positions, iteration):
    """Periodic squeeze and relax"""
    if iteration % 40000 == 0:
        factor = 0.999999 if (iteration % 80000 == 0) else 1.0000001
        center = positions.mean(axis=0)
        return center + (positions - center) * factor
    return positions

def complex_orbital_move(x, y, scale):
    """Rotate position using complex exponential"""
    z = complex(x, y)
    rot = np.exp(1j * (random() - 0.5) * scale * 0.2)
    z *= rot
    return z.real, z.imag
```

### 2. **[HIGH PRIORITY]** Compile and Run Eazy C++ Optimizer
The Eazy optimizer is available as C++ code in the kernel. Compile it:
```bash
g++ -O3 -fopenmp -o eazy eazy.cpp
./eazy  # Uses /kaggle/input/why-not/submission.csv as input
```

### 3. **[MEDIUM PRIORITY]** Try Different Starting Points
Instead of optimizing the best solution, try:
- Start from a WORSE solution (e.g., 70.926 or 71.97)
- Apply heavy optimization
- May find a different basin of attraction

### 4. **[MEDIUM PRIORITY]** Per-N Focused Optimization
Focus optimization on N values with worst efficiency:
- N=1: efficiency=0.661 (worst)
- N=2-10: efficiency=0.38-0.45
- These contribute less to total score but have most room for improvement

## What NOT to Try
- ❌ More SA on pre-optimized solutions (already at local optimum)
- ❌ More ensemble combinations (all sources exhausted)
- ❌ Lattice construction (produces much worse results)
- ❌ Simple rotation optimization (already tried, 0 improvement)

## Validation Notes
- CV = LB for this problem (deterministic scoring)
- Score = Σ(side_n²/n) for n=1 to 200
- Lower is better

## SUBMISSION STRATEGY
- Remaining submissions: 98
- Submit after EVERY experiment that produces a valid submission
- LB feedback is free - USE IT!
