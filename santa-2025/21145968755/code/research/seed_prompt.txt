# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.659959 (saspav baseline)
- Best LB score: 70.659959 (verified with 2 submissions)
- Target: 68.919154 | Gap to target: 1.74 points (2.5%)
- Submissions: 2/100 used, 93 remaining

## Response to Evaluator

The evaluator correctly identified that we've spent 6 experiments searching for pre-optimized solutions but NOT actively optimizing them. All approaches so far have been:
1. Finding/comparing existing CSVs ✓
2. Testing C++ optimizer on pre-optimized (0 improvement) ✓
3. Lattice construction (worse) ✓
4. Ensemble from valid sources (0 improvement) ✓

**Key insight accepted**: The saspav baseline is at a local optimum. Simple SA cannot escape it. We need FUNDAMENTALLY DIFFERENT optimization techniques.

The evaluator's recommendation to compile and run the Eazy optimizer is the correct next step. This optimizer uses techniques we haven't tried:
- Square potential gradient (pushes toward center)
- Elastic pulse (periodic squeeze/relax)
- Complex orbital moves (rotation in complex plane)
- Multi-scale optimization (1e-3 → 1e-9)
- 250,000 iterations per N with 20-second timeout

## Per-N Analysis (Key Insight)

From analysis:
- N=1 has WORST efficiency (1.86x theoretical) - highest improvement potential
- N=1-10 have poor efficiency but only contribute 5.2% of total score
- N=181-200 have BEST efficiency (~0.93x theoretical)
- Average improvement needed per N: 0.0087 points

**Strategy implication**: Focus optimization on small N values (1-50) where efficiency is worst.

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] Compile and Run Eazy Optimizer**

The Eazy optimizer C++ code is in `/home/code/research/kernels/jazivxt_eazy-optimizer/eazy-optimizer.ipynb`.

Steps:
1. Extract the C++ code from the notebook
2. Compile with: `g++ -O3 -march=native -std=c++17 -fopenmp -o eazy eazy.cpp`
3. Copy saspav baseline to working directory
4. Run the optimizer
5. Validate output has no overlaps
6. Compare score to baseline

Expected runtime: ~20 seconds per N × 200 N values = ~1 hour total

### 2. **[HIGH PRIORITY] If Eazy fails, implement Python version**

Key techniques to implement in Python:
```python
# Square potential gradient - push toward center
def apply_square_pressure(x, y, side, scale):
    L = side / 2.0
    gx = 1/(L - x) - 1/(L + x)  # Gradient toward center
    gy = 1/(L - y) - 1/(L + y)
    return x - gx * scale * 0.01, y - gy * scale * 0.01

# Elastic pulse - periodic squeeze/relax
if iteration % 40000 == 0:
    factor = 0.999999 if iteration % 80000 == 0 else 1.0000001
    # Scale all positions toward/away from centroid

# Complex orbital move
z = complex(x, y)
z *= exp(1j * (random() - 0.5) * scale * 0.2)
x, y = z.real, z.imag
```

### 3. **[MEDIUM PRIORITY] Focus on Small N Values**

If full optimization is too slow, focus on N=1-50 where:
- Efficiency is worst (most room for improvement)
- Fewer trees = faster optimization
- Higher per-N score contribution

### 4. **[BACKUP] Try Different SA Parameters**

The existing sa_v1_parallel may work with different parameters:
- Longer runtime (current may be too short)
- Different temperature schedule
- Different move sizes

## What NOT to Try

1. ❌ More ensemble attempts - saspav wins for all N values
2. ❌ Lattice construction - produces worse scores
3. ❌ Searching for more pre-optimized CSVs - we've scanned 721 files
4. ❌ Simple SA on pre-optimized - confirmed 0 improvement

## Validation Notes

- Always validate submissions have 0 overlaps using Shapely
- Use the overlap checking code from experiment 006
- Score calculation: sum(side²/n) for n=1 to 200

## SUBMISSION STRATEGY

- Remaining submissions: 93 (ABUNDANT!)
- Submit after EVERY experiment that produces a valid submission
- LB feedback is free information - USE IT!

## Technical Notes

### Tree Geometry
```python
TX = [0, 0.125, 0.0625, 0.2, 0.1, 0.35, 0.075, 0.075, -0.075, -0.075, -0.35, -0.1, -0.2, -0.0625, -0.125]
TY = [0.8, 0.5, 0.5, 0.25, 0.25, 0, 0, -0.2, -0.2, 0, 0, 0.25, 0.25, 0.5, 0.5]
```

### Baseline Location
`/home/code/external_data/saspav/santa-2025.csv`

### Eazy Optimizer Location
`/home/code/research/kernels/jazivxt_eazy-optimizer/eazy-optimizer.ipynb`

### Existing C++ Optimizer
`/home/code/experiments/002_cpp_optimizer/sa_v1_parallel`
