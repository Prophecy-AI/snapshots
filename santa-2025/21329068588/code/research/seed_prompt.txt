# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.627582 from exp_001 (002_validated_baseline)
- Best LB score: pending (first submission failed due to overlaps)
- Target: 68.892432 | Gap to target: 1.735 points (2.5%)

## Public Kernel Status (CRITICAL!)
- Have we implemented the best kernel yet? **NO** - bbox3 runner not yet run
- Top kernels identified:
  1. bbox3 runner (369 votes) - 3-hour optimization pipeline
  2. Santa-submission (498 votes) - ensemble approach
  3. Fractional Translation (176 votes) - SA with fine steps
- Kernels we've implemented: None (only used pre-optimized snapshots)
- Kernels still to implement: bbox3 runner, SA optimization
- **CRITICAL**: We have pre-compiled bbox3 and sa_fast_v2 executables ready to use!

## Validated Submissions Available
1. **70.626088** - /home/nonroot/snapshots/santa-2025/21198927060/code/submission.csv (BEST)
2. **70.627582** - /home/nonroot/snapshots/santa-2025/21198893057/code/submission.csv (current baseline)

## Response to Evaluator
The evaluator correctly identified that:
1. **No optimization code has been run yet** - AGREED. We've spent 2 loops on validation/debugging. Time to optimize.
2. **Validated baseline should be submitted** - AGREED. Will submit exp_001 to confirm LB score.
3. **105 snapshots exist but only 2 examined** - AGREED. Found better submission at 70.626088.
4. **C++ optimizer (bbox3) hasn't been compiled/tested** - AGREED. Pre-compiled binaries exist in snapshots.

The evaluator's top priority is correct: **RUN ACTUAL OPTIMIZATION NOW.**

## Recommended Approaches (Priority Order)

### 1. [IMMEDIATE] Submit validated baseline (exp_001)
- Confirms our CV-LB relationship
- Uses 1 of 98 remaining submissions
- Establishes baseline for improvement tracking

### 2. [HIGHEST PRIORITY] Run bbox3 optimizer
The bbox3 executable is pre-compiled at `/home/nonroot/snapshots/santa-2025/21198893057/code/bbox3`

**Implementation steps:**
```bash
# Copy bbox3 to working directory
cp /home/nonroot/snapshots/santa-2025/21198893057/code/bbox3 /home/code/
cp /home/nonroot/snapshots/santa-2025/21198927060/code/submission.csv /home/code/submission.csv

# Run bbox3 with parameters (from kernel analysis)
./bbox3 -n 2000 -r 60  # 2000 iterations, 60 rounds
```

**Phase A (short runs, 2 min each):**
- n=[1000, 1500, 2000], r=[30, 60, 90]
- Find promising parameter combinations

**Phase B (medium runs, 10 min):**
- Run on top 3 candidates from Phase A

**Phase C (long runs, 20 min):**
- Run on best 2 candidates

### 3. [HIGH PRIORITY] Ensemble from multiple validated snapshots
Multiple snapshots have different solutions. For each N value, take the best:
- Score each N from each validated snapshot
- Create ensemble taking minimum for each N
- Expected improvement: 0.1-0.5 points

### 4. [MEDIUM PRIORITY] Focus on small N values (1-20)
- These contribute most to score (s²/n weighting)
- N=1 is already optimal at 45 degrees
- N=2-10 have most room for improvement

## What NOT to Try
- More validation/debugging (we have validated submissions)
- Building from scratch (use pre-optimized baselines)
- Short optimization runs (need hours, not minutes)
- fix_direction without overlap validation (causes precision loss)

## Validation Notes
- Use high-precision overlap detection (Decimal prec=25, scale_factor=1e15)
- Kaggle's overlap check is stricter than local Shapely
- Always validate before accepting improvements

## SUBMISSION STRATEGY
- Remaining submissions: 98
- Submit after this experiment? **YES** - we have abundant submissions
- Submit exp_001 (70.627582) to confirm baseline, then iterate with optimization

## Key Technical Details

### bbox3 Usage
```bash
./bbox3 -n <iterations> -r <rounds>
# Reads from submission.csv, writes improved submission.csv
# Output includes "Final Score: X.XXXXXX"
```

### Scoring Function
```python
score = sum(s_n² / n for n in range(1, 201))
# Lower is better
# Small N values contribute most
```

### Tree Geometry
- 15-vertex polygon
- Height: 1.0 (from -0.2 to 0.8)
- Base width: 0.7
- Optimal N=1 angle: 45 degrees

## Next Experiment: 003_bbox3_optimization
1. Copy bbox3 and best validated submission to working directory
2. Run bbox3 with Phase A parameters (short runs)
3. Validate improvements with high-precision overlap detection
4. If improved, run Phase B and C
5. Submit best result
