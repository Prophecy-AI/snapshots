# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.622435 from exp_003 (004_sa_fast_v2_optimization)
- Best LB score: 70.622435 (VALIDATED - CV-LB gap is ZERO!)
- Target: 68.891380 | Gap to target: 1.731 points (2.51%)

## CV-LB Relationship Analysis
- **CV-LB gap is ZERO** - our local scoring is perfectly calibrated
- This means CV improvements will translate directly to LB improvements
- The challenge is purely algorithmic - we need better solutions, not better validation

## Response to Evaluator

The evaluator correctly identified several key points:

1. **Overlap Risk**: The evaluator warned that candidate_003 might fail due to N=8 overlaps. However, **it PASSED** with LB=70.622435. This is good news - our current solution is valid.

2. **Improvement Rate Concern**: The evaluator noted that 0.003653 points in ~30 minutes is too slow. This is correct - at this rate, closing the 1.73 point gap would take ~14 hours. We need a different approach.

3. **External Source Ensemble**: The evaluator recommended ensembling from external sources. I investigated this thoroughly:
   - Found 2104 potential submission files in snapshots
   - Best ensemble score: 70.523320 (0.099 points better than current)
   - **BUT**: This file has overlaps and would fail Kaggle validation
   - All 209 validated submissions across 105 snapshots show our current 70.622435 is the BEST

4. **Key Insight**: The problem is NOT that we haven't tried ensembling - it's that all better-scoring solutions have overlaps. We need to either:
   a) Find/create overlap-free solutions that score better
   b) Fix the overlaps in the 70.523320 solution
   c) Try fundamentally different optimization approaches

## What We've Learned

1. **bbox3 optimizer**: ZERO improvement - solution is at local optimum for this optimizer
2. **sa_fast_v2 optimizer**: 0.003653 improvement - can escape local optima but too slow
3. **Ensemble from snapshots**: Best files have overlaps, can't use them directly
4. **CV-LB calibration**: Perfect - no distribution shift issues

## Untried Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] sa_v1_parallel Optimizer**
The jonathanchan kernel uses this optimizer with:
- Fractional translation steps: [0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001]
- Population-based optimization (keeps top 3)
- SA + local search + fractional translation

Location: `/home/nonroot/snapshots/santa-2025/21116303805/code/experiments/004_sa_v1_parallel/sa_v1_parallel`

**Action**: Run sa_v1_parallel on our validated submission (70.622435) with aggressive parameters.

### 2. **[HIGH PRIORITY] Fix Overlaps in Better Solutions**
The 70.523320 solution is 0.099 points better but has overlaps. We could:
- Identify which N values have overlaps
- Replace only those N values with our validated solution
- This could give us partial improvement

**Action**: Check which N values in 70.523320 have overlaps, create hybrid solution.

### 3. **[MEDIUM PRIORITY] tree_packer Variants**
Available: tree_packer_v18, tree_packer_v21
These might use different algorithms than SA.

Location: `/home/nonroot/snapshots/santa-2025/21116303805/code/experiments/004_sa_v1_parallel/tree_packer_v18`

### 4. **[MEDIUM PRIORITY] bbox3_advanced**
An advanced version of bbox3 that might escape local optima better.

Location: `/home/nonroot/snapshots/santa-2025/21129617858/code/bbox3_advanced`

### 5. **[RESEARCH] Tessellation for Large N**
Large N values (51-200) contribute 73% of total score. Tessellation approaches might help.
The egortrushin kernel uses tessellation for N values: 72, 100, 110, 144, 156, 196, 200.

## What NOT to Try
- ❌ More bbox3 runs (already proven ZERO improvement)
- ❌ Simple ensemble from snapshots (all better files have overlaps)
- ❌ Running sa_fast_v2 longer (too slow to close gap)

## Recommended Experiment: 005_sa_v1_parallel

```bash
# Copy validated submission
cp /home/submission/submission.csv /home/code/experiments/005_sa_v1_parallel/submission_best.csv

# Copy optimizer
cp /home/nonroot/snapshots/santa-2025/21116303805/code/experiments/004_sa_v1_parallel/sa_v1_parallel ./

# Run with aggressive parameters
./sa_v1_parallel -i submission_best.csv -o submission.csv -n 20000 -r 10
```

## Alternative Experiment: 005_hybrid_ensemble

If sa_v1_parallel doesn't work, try creating a hybrid:
1. Load the 70.523320 solution
2. Check each N for overlaps
3. For N values WITH overlaps, use our validated solution
4. For N values WITHOUT overlaps, use the better solution
5. This should give us partial improvement while staying valid

## Validation Notes
- CV scheme: Direct scoring using numba-optimized bounding box calculation
- CV-LB gap: ZERO (perfect calibration)
- Overlap detection: Use high-precision Decimal/Shapely checks before submission

## SUBMISSION STRATEGY
- Remaining submissions: 96
- **SUBMIT after EVERY experiment** - we have abundant submissions
- LB feedback is free information - USE IT!
