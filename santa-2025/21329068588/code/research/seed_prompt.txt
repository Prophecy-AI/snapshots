# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.622435 from exp_003 (004_sa_fast_v2_optimization)
- Best LB score: 70.622435 (VALIDATED - passes Kaggle overlap detection)
- Target: 68.891380 | Gap to target: 1.731 points (2.45%)
- Submissions used: 6/100 (94 remaining)

## Critical Problem: LOCAL OPTIMUM TRAP

**ALL optimizers tested show ZERO improvement on the validated baseline:**
- bbox3: ZERO improvement
- sa_fast_v2: ZERO improvement (when starting from validated)
- sa_v1_parallel: 0.000011 improvement (essentially zero)

**The validated submission (70.622435) is at a LOCAL OPTIMUM that standard optimizers cannot escape.**

## Response to Evaluator

The evaluator correctly identified that:
1. sa_v1_parallel was untried - I tested it and it gave essentially ZERO improvement (0.000011)
2. The gap (1.73 points, 2.5%) is too large for incremental optimization
3. We need fundamentally different approaches

**Key insight from testing:** The validated submission is already highly optimized. All SA-based optimizers (bbox3, sa_fast_v2, sa_v1_parallel) converge to the same local optimum. We need approaches that generate solutions from scratch or restructure existing solutions.

## Score Distribution Analysis
- N=1-10: 6.1% of total (4.33 points)
- N=11-30: 10.5% of total (7.41 points)
- N=31-57: 13.9% of total (9.80 points)
- N=58-100: 21.4% of total (15.10 points)
- N=101-200: 48.1% of total (33.98 points) ← HIGHEST LEVERAGE

**To reach target: Need 5.09% improvement in large N (101-200) OR 2.45% uniform improvement**

## Overlap Detection Problem (CRITICAL!)
- 4 out of 6 submissions FAILED due to overlaps
- Local overlap detection (even with scale_factor=1e18) doesn't match Kaggle's
- The ONLY safe approach is to use the VALIDATED submission as base
- Any hybrid/ensemble approach risks introducing overlaps that Kaggle detects

## Recommended Approaches (Priority Order)

### 1. **[HIGHEST PRIORITY] BackPacking Approach**
From kernel: crodoc/74-75-backpacking-christmas-trees

**Concept:** Start from N=200 and iterate backward. For each N, if current solution is worse than best seen so far, take first N trees from the best larger configuration.

**Why it might work:** Good packing at N=200 often remains efficient when trees are removed. This can find hidden good solutions without introducing overlaps (since we're just removing trees, not adding).

**Implementation:**
```python
# Start from validated submission
# For each N from 200 down to 1:
#   If current N score > best_seen_score:
#     Take first N trees from best_seen configuration
#     This maintains overlap-free property
```

### 2. **[HIGH PRIORITY] Rebuild from Corners**
From kernel: chistyakov/new-simple-fix-rebuild-large-layout-from-corners

**Concept:** For each large N layout, extract subsets from each corner and check if they form better solutions for smaller N.

**Why it might work:** Large layouts may contain well-packed subregions that are better than current small N solutions.

### 3. **[MEDIUM PRIORITY] Per-N Optimization Focus**
Focus optimization on specific N values with highest potential:
- N=101-200 contribute 48% of score
- Even small improvements here have large impact
- Run longer optimization on these specific N values

### 4. **[RESEARCH] Novel Algorithms**
If above approaches fail, research:
- No-Fit Polygon (NFP) for O(1) collision checks
- Genetic algorithms with custom crossover
- Constraint programming approaches

## What NOT to Try
- ❌ More SA/bbox3 variations (all converge to same local optimum)
- ❌ Hybrid ensemble with external sources (overlap detection mismatch)
- ❌ Running optimizers "longer" (already at local optimum)

## Validation Notes
- CV = LB (perfectly calibrated, no gap)
- ONLY use validated submission (candidate_003.csv) as base
- Any modification must preserve overlap-free property
- Test overlap detection locally before submission

## SUBMISSION STRATEGY
- Remaining submissions: 94 (ABUNDANT!)
- Submit after EVERY experiment that produces valid output
- LB feedback is free information - USE IT!
- Even if approach fails, we learn what doesn't work

## Next Experiment: 008_backpacking
1. Implement BackPacking approach from crodoc kernel
2. Start from validated submission (candidate_003.csv)
3. Iterate N=200 down to N=1
4. For each N, check if taking first N trees from larger config improves score
5. This should be overlap-safe since we're only removing trees
6. Submit result to verify on Kaggle