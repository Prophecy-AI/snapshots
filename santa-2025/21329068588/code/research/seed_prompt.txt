# Santa 2025 - Christmas Tree Packing Optimization

## Current Status
- Best CV score: 70.616068 (006_strict_hybrid - pending submission)
- Best validated LB score: 70.622435 (exp_003, sa_fast_v2)
- Target: 68.891380
- Gap to target: 1.725 points (2.50%)
- Submissions used: 5/100 (95 remaining)

## CRITICAL FIX APPLIED
Previous submission (005_hybrid_ensemble) failed with "Overlapping trees in group 031".
Root cause: Local overlap detection used scale_factor=1e15, missing tiny overlaps.
Fix: Now using scale_factor=1e18 (like saspav kernel) which matches Kaggle's stricter validation.
N=31 now correctly excluded from better solution.

## CV-LB Relationship
- CV = LB (perfect calibration confirmed)
- No distribution shift - this is a pure optimization problem
- The challenge is finding BETTER solutions, not calibration

## Response to Evaluator
The evaluator correctly identified:
1. ✓ N=18 tiny overlap was a risk - and N=31 was the actual failure point
2. ✓ External sources should be explored - but GitHub source (70.743) is WORSE than our best
3. ✓ The 1.725 point gap requires fundamentally different approaches

The evaluator's suggestion to "recover improvements from overlapping N values" is the right direction.
However, the total potential gain from the better solution is only ~0.099 points.
We need 1.725 points - this requires NOVEL approaches, not just better ensembling.

## Key Insight: The Gap Analysis
Score breakdown by N range:
- N=1-10: 4.33 (6.1% of total) - 4 overlaps block 0.04 potential gain
- N=11-30: 7.41 (10.5%) - minimal potential gain
- N=31-57: 9.80 (13.9%) - 9 overlaps block 0.03 potential gain
- N=58-100: 15.10 (21.4%) - 13 overlaps
- N=101-200: 33.98 (48.1%) - 39 overlaps

The largest N values (101-200) contribute 48% of the score!
Even small improvements per-N here would have big impact.

## STRATEGIC PIVOT REQUIRED

### Why Current Approach Won't Reach Target
1. Best available "better" solution only improves by 0.099 points total
2. 68 N values have overlaps, blocking most of that improvement
3. Even with perfect ensembling, we'd only reach ~70.52 (still 1.63 from target)
4. The 1.725 point gap requires ~2.5% improvement - not achievable by ensembling

### What's Needed: Novel Optimization
The target (68.891) represents solutions that are fundamentally better optimized.
Top competitors likely use:
1. **Long-running C++ optimizers** (hours/days, not minutes)
2. **Specialized algorithms for different N ranges**
3. **Tessellation patterns for large N** (N>57)
4. **Custom constructive heuristics** for small N

## Recommended Approaches (Priority Order)

### 1. IMMEDIATE: Submit 006_strict_hybrid to verify fix
- Score: 70.616068
- Should pass Kaggle now (N=31 uses validated solution)
- Establishes new baseline if successful
- File is at /home/submission/submission.csv

### 2. HIGH PRIORITY: Run sa_v1_parallel optimizer
- Different from sa_fast_v2 (which we've tried)
- Uses fractional translation steps: [0.001, 0.0005, 0.0002, 0.0001, 0.00005, 0.00002, 0.00001]
- Population-based optimization (keeps top 3)
- May escape local optima that sa_fast_v2 cannot

### 3. HIGH PRIORITY: Fix overlapping N values
For the 68 N values with overlaps in the better solution:
- Run sa_fast_v2 or sa_v1_parallel starting from better solution positions
- Small perturbations may fix overlaps while preserving most improvement
- Potential gain: up to 0.099 points if all overlaps can be fixed

### 4. MEDIUM PRIORITY: Explore other snapshot solutions
- We've only deeply analyzed one snapshot (21328309254)
- Other snapshots may have different optimized solutions
- Look for solutions that are better for specific N ranges

### 5. RESEARCH: Tessellation for large N
- Chris Deotte's discussion suggests tessellation for N >= 58
- Large N (101-200) contributes 48% of score
- Even 1% improvement here = 0.34 points

## What NOT to Try
- ❌ More bbox3 optimization (already tried, ZERO improvement)
- ❌ Ensemble with external sources (GitHub is worse than our best)
- ❌ Overlap detection with scale_factor < 1e18 (will fail Kaggle)
- ❌ Micro-optimizations (need 1.725 points, not 0.001)

## Validation Notes
- Use scale_factor=1e18 for overlap detection (Kaggle-compatible)
- Always verify against validated solution before submission
- CV = LB (no calibration needed)

## SUBMISSION STRATEGY
- Remaining submissions: 95
- Submit 006_strict_hybrid immediately to verify overlap fix
- Then focus on fundamentally different optimization approaches