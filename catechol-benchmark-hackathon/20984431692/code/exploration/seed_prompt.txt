# Catechol Benchmark Seed Prompt

## 1. Problem Understanding
**Goal:** Predict reaction yields (SM, Product 2, Product 3) for allyl substituted catechol rearrangement in various solvent mixtures.
**Challenge:** Generalization to **unseen solvent mixtures**. The test set contains solvent pairs not seen during training.
**Metric:** Cross-Validation Score (likely MSE or MAE on yields).
**Constraint:** Must use `MLPModel` class structure.

## 2. Data Strategy
**Reference Notebooks:**
- `exploration/eda.ipynb`: Data inspection, target correlations, solvent overlap.

**Key Data Insights:**
- **Small Dataset:** ~1200 rows (full) + ~650 rows (single). High risk of overfitting.
- **Mixture Data:** Solvents A and B with %B.
- **Single Data:** Can be treated as mixture where Solvent A = Solvent B (or %B = 0).
- **Targets:** 3 continuous targets (SM, P2, P3). Sum is approx 1 but not exact.

**Recommendation:**
- **Merge Datasets:** Combine `catechol_full_data_yields.csv` and `catechol_single_solvent_yields.csv`.
- **Unified Format:** Convert single data to mixture format:
  - `SOLVENT A NAME` = `SOLVENT NAME`
  - `SOLVENT B NAME` = `SOLVENT NAME`
  - `SolventB%` = 0.0

## 3. Feature Engineering
**Solvent Descriptors (Crucial):**
Use the provided look-up tables to represent solvents numerically.
- **Physical Properties:** `spange_descriptors_lookup.csv` (13 features).
- **PCA Descriptors:** `acs_pca_descriptors_lookup.csv` (5 features).
- **Fingerprints:** `drfps_catechol_lookup.csv` (2048 features) - *Use with caution due to dimensionality.*

**Mixture Representation:**
For a mixture of Solvent A and Solvent B with ratio $x_B$:
1. **Linear Combination (FDA):** $Feature_{mix} = (1 - x_B) \cdot Feature_A + x_B \cdot Feature_B$
   - Works well for physical properties (e.g., dielectric constant).
2. **Interaction Terms:**
   - $|Feature_A - Feature_B|$ (Difference)
   - $Feature_A \cdot Feature_B$ (Product)
   - These capture non-linear mixing effects.

**Process Conditions:**
- **Normalize:** Standardize `Temperature` and `Residence Time` (Z-score).

## 4. Model Architecture (MLPModel)
Since the template requires an `MLPModel` class, design a robust neural network.
**Recommended Architecture: "Deep Sets" for Mixtures**
Instead of just averaging inputs, learn the representation:
1. **Solvent Encoder (Shared):** A small MLP (e.g., 64->32) that takes raw solvent descriptors (A or B) and outputs a latent vector $h$.
2. **Weighted Aggregation:** $h_{mix} = (1 - x_B) \cdot h_A + x_B \cdot h_B$.
3. **Condition Fusion:** Concatenate $h_{mix}$ with normalized Temperature and Time.
4. **Predictor:** Final MLP (e.g., 32->16->3) to predict yields.

**Why this works:** It allows the model to learn *non-linear* solvent features before mixing, which is more expressive than averaging raw features.

**Regularization:**
- **Dropout:** 0.2-0.5 in hidden layers.
- **Weight Decay:** 1e-4 to 1e-3.
- **Batch Normalization:** Helpful for convergence.

## 5. Validation Strategy
- **Leave-One-Group-Out:** Use `generate_leave_one_ramp_out_splits` from `utils.py`.
- **Metric:** Monitor MSE/MAE on the left-out ramps.
- **Ensembling:** Train 5-10 models with different random seeds and average predictions.

## 6. Advanced Techniques
- **Transfer Learning:** Pre-train on single solvent data, fine-tune on mixtures (if treated separately).
- **Dimensionality Reduction:** If using fingerprints (DRFP), use PCA to reduce to ~20-50 components before feeding to MLP.
- **Physics-Informed Constraints:** Add a loss term to penalize deviations from mass balance (SM + P2 + P3 â‰ˆ 1).
- **Hybrid Features:** Combine PCA descriptors (global properties) with Spange descriptors (physical properties).
