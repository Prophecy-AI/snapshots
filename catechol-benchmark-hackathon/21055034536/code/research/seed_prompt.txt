## Current Status
- Best CV score: ~0.0081 (several exp_049/050/053 variants; best confirmed submission-point CV around 0.0083–0.0087)
- Best LB score (confirmed): 0.0877 (exp_030/exp_068)
- Target: 0.034700 | Gap to target: 0.0530
- Latest attempt: 075_AD_shrinkage_v3_flip_invariant CV=0.008673 but **LB failed to score** (metric error)

## CV-LB Relationship Analysis (structural)
- Prior fit (from loop68/69): **LB ≈ 4.31 * CV + 0.0525** (R²≈0.95)
- Interpretation: persistent **intercept ~0.0525** dominates; we must reduce intercept via OOD/shift handling.
- AD-shrinkage is the correct direction; we need a valid LB datapoint.

## Response to Evaluator
- Technical verdict was **TRUSTWORTHY**. Agree.
- Evaluator’s top priority: **submit AD-v3 once to see if it breaks the CV→LB line**. Agree, but we must fix the submission-format bug first.
- Key concerns raised & response:
  - Full-task distance ignores kinetics → agree; plan v4 adds kinetic vec to distance.
  - Isotonic gate might overfit → agree; if LB doesn’t move, we will simplify to a parametric monotone gate and/or reduce alpha_max / increase tau_q.

## Critical Bug Fix (WHY LB FAILED)
We have a **template violation / evaluator-path mismatch**:
- Official template final cell writes: `submission.to_csv("submission.csv", index=True)`
- Our recent notebooks write: `submission.to_csv("/home/submission/submission.csv", index=True)` and also added prints.
- In a code-competition evaluation, the metric likely loads **`submission.csv` from the working dir**. Writing elsewhere can cause “Evaluation metric raised an unexpected error”.

### Non-negotiable rule for the next notebook
**The last 3 cells must match the official template EXACTLY.**
- Only allowed change: the `model = ...` line in the third-last and second-last cells.
- Therefore:
  - Final cell must write exactly: `submission.to_csv("submission.csv", index=True)`
  - Remove any extra print lines from the final cell.

## Next Experiments (Priority-Ordered)
### 1) exp_076: AD-v3 (flip-invariant) but template-perfect output path
**Goal:** get a scoring LB datapoint for AD-v3.
- Copy `075_AD_shrinkage_v3_flip_invariant` notebook.
- Change NOTHING in last 3 cells except model lines.
- Ensure final cell is identical to template and writes `submission.csv` to working dir.
- Local sanity checks before submit:
  - `submission.csv` exists in CWD after running.
  - No NaNs/inf; targets within [0,1].
  - Row count = 1883; fold counts match.
- Then **SUBMIT** (we need LB evidence).

### 2) exp_077: AD-v4 gate adds kinetics to full distance vector
Only if exp_076 scores but does not improve LB meaningfully.
- Keep base predictor unchanged.
- Change only AD full distance features:
  - `D_full = [blend_embed, pct, pct*(1-pct), ||A-B||, kinetic_vec]`
- Keep canonicalization / flip-invariance.
- Submit if CV is similar and we still need to test intercept shift.

### 3) exp_078: add model-disagreement as an uncertainty feature (OOD indicator)
- Compute per-row std across {GP, MLP, LGBM} predictions (per target) on X.
- Use it to modulate alpha (either append to D_full or direct alpha scaling).

## What NOT to Try
- No more pure tabular tuning (weights, HPO sweeps, multi-seed) until LB <~0.07.
- No more experiments that change only CV while staying on the same CV→LB line.

## Validation Notes
- Keep the official split generators.
- Before logging/submit: verify submission cells instantiate **exactly** the same class used in CV (no wrapper mismatch).
- IMPORTANT: the metric depends on file location. Ensure `submission.csv` is written to the notebook working directory, not `/home/submission/`.
