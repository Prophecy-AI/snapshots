## Current Status
- Best CV score: 0.0081 from exp_049/050/053 (CatBoost+XGBoost)
- Best LB score: 0.0877 from exp_030 (GP+MLP+LGBM ensemble)
- Target: 0.0347 | Gap to target: 0.053 (152.8%)
- Submissions remaining: 3

## CV-LB Relationship Analysis (CRITICAL)
- Linear fit: LB = 4.09 × CV + 0.0546 (R² = 0.96)
- Intercept interpretation: Even at CV=0, expected LB is 0.0546
- Are all approaches on the same line? **YES**
- Required CV for target: (0.0347 - 0.0546) / 4.09 = -0.0049 (IMPOSSIBLE with current line)

**CRITICAL FINDING**: The intercept (0.0546) is HIGHER than the target (0.0347).
The target requires CHANGING THE CV-LB RELATIONSHIP, not just improving CV.

## Response to Evaluator
- Technical verdict was TRUSTWORTHY. The per-class model was correctly implemented.
- Evaluator's top priority: DO NOT SUBMIT exp_121 (CV=0.0167, 107% worse than best).
- Key concerns raised: CV-LB intercept (0.0548) > target (0.0347).
- **I AGREE** with the evaluator's assessment. After 124 experiments, all approaches fall on the same CV-LB line.

## Data Understanding
- Reference notebooks: See `exploration/evolver_loop124_analysis.ipynb` for CV-LB analysis
- Key insight: The benchmark paper achieved MSE 0.0039 using GNN with FULL dataset access
- Our challenge: We predict for UNSEEN solvents (leave-one-out), which is fundamentally harder
- The CV-LB gap represents extrapolation error to unseen solvents

## MANDATORY PIVOT: Approaches That Could Change CV-LB Relationship

### PRIORITY 1: Solvent Similarity-Based Prediction Weighting
**Hypothesis**: If we can identify which training solvents are most similar to the test solvent, we can weight predictions from those solvents more heavily.

**Implementation**:
```python
# Compute Tanimoto similarity between test solvent and all training solvents
from rdkit import Chem
from rdkit.Chem import AllChem, DataStructs

def get_solvent_similarity(test_smiles, train_smiles_list):
    test_fp = AllChem.GetMorganFingerprintAsBitVect(Chem.MolFromSmiles(test_smiles), 2)
    similarities = []
    for train_smiles in train_smiles_list:
        train_fp = AllChem.GetMorganFingerprintAsBitVect(Chem.MolFromSmiles(train_smiles), 2)
        sim = DataStructs.TanimotoSimilarity(test_fp, train_fp)
        similarities.append(sim)
    return similarities

# Weight predictions by similarity to training solvents
# High similarity → trust model prediction
# Low similarity → blend toward population mean
```

### PRIORITY 2: Nearest Neighbor Blending
**Hypothesis**: For test solvents very different from training, use k-NN predictions instead of model predictions.

**Implementation**:
```python
# For each test sample:
# 1. Find k nearest training solvents by Tanimoto similarity
# 2. If max similarity < threshold, use weighted average of k-NN predictions
# 3. If max similarity >= threshold, use model prediction
```

### PRIORITY 3: Ensemble with Different CV-LB Lines
**Hypothesis**: Different model families might have slightly different CV-LB intercepts. Ensemble them to reduce overall intercept.

**Implementation**:
1. Train multiple model families (MLP, LGBM, XGB, CatBoost, GP)
2. For each, compute its individual CV-LB relationship
3. Weight models by their intercept (lower intercept = higher weight)

## What NOT to Try
- ❌ More MLP/LGBM/XGB/CatBoost variants (all on same line)
- ❌ More feature engineering (already tried Spange, DRFP, ACS, Fragprints)
- ❌ Per-class models (made things worse)
- ❌ GroupKFold (gives higher MSE)
- ❌ Multi-seed optimization (too far from target)

## Validation Notes
- CV scheme: Leave-One-Out by solvent (24 folds single, 13 folds full)
- CV-LB relationship: LB = 4.09 × CV + 0.0546 (R² = 0.96)
- Expected LB for best CV (0.0081): 0.0877 (matches actual best LB!)

## IMPORTANT: Model Class Consistency
When implementing any new approach, ALWAYS verify:
1. The model class used for CV computation
2. The model class used in submission cells (last 3 cells)
3. They MUST be the SAME class

## STRATEGIC RECOMMENDATION

**Given 3 submissions remaining and the structural CV-LB gap:**

1. **Implement solvent similarity-based prediction weighting** - This directly addresses the extrapolation problem
2. **If CV improves AND the approach seems fundamentally different, submit to check if it changes the CV-LB line**
3. **If it falls on the same line, submit our best model (exp_030) for final score**

The target IS reachable. The benchmark paper achieved it. We need to find the approach that changes the CV-LB relationship.