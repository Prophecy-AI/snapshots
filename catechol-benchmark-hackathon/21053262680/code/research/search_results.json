{
  "query": "How do you use ChemProp pre-trained molecular property prediction model as a feature extractor for downstream tasks?",
  "results": [
    {
      "title": "ANSWER",
      "text": "Based on the Chemprop documentation (v2.2.x), you can turn a pre\u2011trained Chemprop model into a feature extractor in just a few steps\u202f([Chemprop\u202ffeaturizer demo](https://chemprop.readthedocs.io/en/latest/use_featurizer_with_other_libraries.html);\u202f[Transfer\u2011learning guide](https://chemprop.readthedocs.io/en/latest/transfer_learning.html);\u202f[`load_model`](https://chemprop.readthedocs.io/en/latest/autoapi/chemprop/models/index.html);\u202f[MolGraph featurizer](https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/molgraph_molecule_featurizer.html)):\n\n1. **Install Chemprop (and optional libraries).**  \n   ```python\n   import os\n   if os.getenv(\"COLAB_RELEASE_TAG\"):          # e.g. in Google\u202fColab\n       try: import chemprop\n       except ImportError:\n           !git clone https://github.com/chemprop/chemprop.git\n           %cd chemprop\n           !pip install torch==2.4.0 torchvision==0.19.0 torchaudio==2.4.0 .\n           !pip install dgl -f https://data.dgl.ai/wheels/torch-2.4/repo.html\n           !pip install torch_geometric\n   ```  \n   (install commands from the featurizer demo)\u202f([Result\u202f1]).\n\n2. **Load the pre\u2011trained checkpoint.**  \n   ```python\n   from chemprop import models\n   pretrained_path = \"path/to/checkpoint.pt\"   # e.g. a Chemprop\u2011trained model\n   model = models.load_model(pretrained_path)   # returns an MPNN\u2011based model\n   model.eval()                                 # set to inference mode\n   ```  \n   (`load_model` is the official helper)\u202f([Result\u202f5]).\n\n3. **Freeze the model parameters (optional, to use it strictly as a feature extractor).**  \n   ```python\n   for p in model.parameters():\n       p.requires_grad = False\n   ```\n\n4. **Featurize your molecules into Chemprop\u2019s MolGraph format.**  \n   ```python\n   from chemprop.featurizers.molgraph.molecule import SimpleMoleculeMolGraphFeaturizer\n   from rdkit import Chem\n\n   featurizer = SimpleMoleculeMolGraphFeaturizer()\n   smiles = [\"CCO\", \"c1ccccc1\"]                # replace with your data\n   molgraphs = [featurizer(Chem.MolFromSmiles(s)) for s in smiles]\n   ```  \n   (the MolGraph contains atom features\u202fV, bond features\u202fE, and edge indices)\u202f([Result\u202f6]).\n\n5. **Extract the learned fingerprint (the output of the message\u2011passing network).**  \n   ```python\n   # The model\u2019s forward returns predictions; the hidden representation\n   # can be obtained by calling the internal MPNN directly:\n   fingerprints = [model.mpnn(mg) for mg in molgraphs]   # each is a torch tensor\n   # or, if the model provides a `featurize` helper:\n   # fingerprints = model.featurize(molgraphs)\n   ```  \n   The `MPNN` layer computes the learned molecular embedding that Chemprop uses for prediction\u202f([Result\u202f5]).\n\n6. **Use the embeddings as features for any downstream task.**  \n   ```python\n   import torch.nn as nn\n   downstream = nn.Linear(fingerprints[0].shape[-1], n_classes)   # e.g. classification\n   # train downstream on your labels while keeping the Chemprop encoder frozen\n   ```  \n   This follows the transfer\u2011learning pattern described in the Chemprop transfer\u2011learning notebook\u202f([Result\u202f3]).\n\n7. **(Optional) Convert the MolGraph to DGL or PyTorch\u2011Geometric graphs** if you prefer those frameworks; the demo notebook shows how to pass the same `molgraphs` into DGL/Geometric pipelines\u202f([Result\u202f1]).\n\nThese steps let you reuse a Chemprop pre\u2011trained model to generate fixed\u2011length molecular embeddings, which can then be fed into any downstream machine\u2011learning model.",
      "url": ""
    },
    {
      "title": "Demonstration of using Chemprop featurizer with DGL and PyTorch Geometric \u2014 Chemprop 2.2.0 documentation",
      "text": "<div><article>\n \n <section>\n<h2>Demonstration of using Chemprop featurizer with DGL and PyTorch Geometric<a href=\"#Demonstration-of-using-Chemprop-featurizer-with-DGL-and-PyTorch-Geometric\">#</a></h2>\n<p><a href=\"https://colab.research.google.com/github/chemprop/chemprop/blob/main/examples/use_featurizer_with_other_libraries.ipynb\"></a></p>\n<div><pre><span></span><span># Install chemprop from GitHub if running in Google Colab</span>\n<span>import</span><span> </span><span>os</span>\n<span>if</span> <span>os</span><span>.</span><span>getenv</span><span>(</span><span>\"COLAB_RELEASE_TAG\"</span><span>):</span>\n <span>try</span><span>:</span>\n <span>import</span><span> </span><span>chemprop</span>\n <span>except</span> <span>ImportError</span><span>:</span>\n <span>!</span>git<span> </span>clone<span> </span>https://github.com/chemprop/chemprop.git\n <span>%</span><span>cd</span> chemprop\n <span>!</span>pip<span> </span>install<span> </span><span>torch</span><span>==</span><span>2</span>.4.0<span> </span><span>torchvision</span><span>==</span><span>0</span>.19.0<span> </span><span>torchaudio</span><span>==</span><span>2</span>.4.0\n <span>!</span>pip<span> </span>install<span> </span>.\n <span>!</span>pip<span> </span>install<span> </span>dgl<span> </span>-f<span> </span>https://data.dgl.ai/wheels/torch-2.4/repo.html\n <span>!</span>pip<span> </span>install<span> </span>torch_geometric\n <span>%</span><span>cd</span> examples\n</pre></div>\n</section>\n<section>\n<h2>Import packages<a href=\"#Import-packages\">#</a></h2>\n<div><pre><span></span><span>import</span><span> </span><span>pandas</span><span> </span><span>as</span><span> </span><span>pd</span>\n<span>import</span><span> </span><span>matplotlib.pyplot</span><span> </span><span>as</span><span> </span><span>plt</span>\n<span>import</span><span> </span><span>torch</span>\n<span>from</span><span> </span><span>sklearn.decomposition</span><span> </span><span>import</span> <span>PCA</span>\n<span>from</span><span> </span><span>pathlib</span><span> </span><span>import</span> <span>Path</span>\n<span>import</span><span> </span><span>numpy</span><span> </span><span>as</span><span> </span><span>np</span>\n<span>from</span><span> </span><span>chemprop</span><span> </span><span>import</span> <span>data</span><span>,</span> <span>featurizers</span><span>,</span> <span>models</span>\n</pre></div>\n<section>\n<h2>Load data<a href=\"#Load-data\">#</a></h2>\n<div><pre><span></span><span>test_path</span> <span>=</span> <span>Path</span><span>(</span><span>\"..\"</span><span>)</span> <span>/</span> <span>\"tests\"</span> <span>/</span> <span>\"data\"</span> <span>/</span> <span>\"smis.csv\"</span>\n<span>smiles_column</span> <span>=</span> <span>\"smiles\"</span>\n<span>df_test</span> <span>=</span> <span>pd</span><span>.</span><span>read_csv</span><span>(</span><span>test_path</span><span>)</span>\n</pre></div>\n<div><pre><span></span><span>df_test</span> <span>=</span> <span>pd</span><span>.</span><span>read_csv</span><span>(</span><span>test_path</span><span>)</span>\n<span>smis</span> <span>=</span> <span>df_test</span><span>[</span><span>smiles_column</span><span>]</span>\n<span>test_data</span> <span>=</span> <span>[</span><span>data</span><span>.</span><span>MoleculeDatapoint</span><span>.</span><span>from_smi</span><span>(</span><span>smi</span><span>)</span> <span>for</span> <span>smi</span> <span>in</span> <span>smis</span><span>]</span>\n<span>test_data</span><span>[:</span><span>5</span><span>]</span>\n</pre></div>\n<div><pre>[MoleculeDatapoint(mol=&lt;rdkit.Chem.rdchem.Mol object at 0x7ec2273a1fc0&gt;, y=None, weight=1.0, gt_mask=None, lt_mask=None, x_d=None, x_phase=None, name='Cn1c(CN2CCN(CC2)c3ccc(Cl)cc3)nc4ccccc14', V_f=None, E_f=None, V_d=None),\n MoleculeDatapoint(mol=&lt;rdkit.Chem.rdchem.Mol object at 0x7ec2273a1ee0&gt;, y=None, weight=1.0, gt_mask=None, lt_mask=None, x_d=None, x_phase=None, name='COc1cc(OC)c(cc1NC(=O)CSCC(=O)O)S(=O)(=O)N2C(C)CCc3ccccc23', V_f=None, E_f=None, V_d=None),\n MoleculeDatapoint(mol=&lt;rdkit.Chem.rdchem.Mol object at 0x7ec2273a1e00&gt;, y=None, weight=1.0, gt_mask=None, lt_mask=None, x_d=None, x_phase=None, name='COC(=O)[C@@H](N1CCc2sccc2C1)c3ccccc3Cl', V_f=None, E_f=None, V_d=None),\n MoleculeDatapoint(mol=&lt;rdkit.Chem.rdchem.Mol object at 0x7ec2273a1d20&gt;, y=None, weight=1.0, gt_mask=None, lt_mask=None, x_d=None, x_phase=None, name='OC[C@H](O)CN1C(=O)C(Cc2ccccc12)NC(=O)c3cc4cc(Cl)sc4[nH]3', V_f=None, E_f=None, V_d=None),\n MoleculeDatapoint(mol=&lt;rdkit.Chem.rdchem.Mol object at 0x7ec2273a1c40&gt;, y=None, weight=1.0, gt_mask=None, lt_mask=None, x_d=None, x_phase=None, name='Cc1cccc(C[C@H](NC(=O)c2cc(nn2C)C(C)(C)C)C(=O)NCC#N)c1', V_f=None, E_f=None, V_d=None)]\n</pre></div>\n<section>\n<h3>Featurize molecules<a href=\"#Featurize-molecules\">#</a></h3>\n<div><pre><span></span><span>featurizer</span> <span>=</span> <span>featurizers</span><span>.</span><span>SimpleMoleculeMolGraphFeaturizer</span><span>()</span>\n<span>molgraphs</span> <span>=</span> <span>[</span><span>featurizer</span><span>(</span><span>data</span><span>.</span><span>mol</span><span>)</span> <span>for</span> <span>data</span> <span>in</span> <span>test_data</span><span>]</span>\n</pre></div>\n</section>\n</section>\n</section>\n<section>\n<h2>Use Chemprop featurizer with DGL<a href=\"#Use-Chemprop-featurizer-with-DGL\">#</a></h2>\n<div><pre><span></span><span># Install DGL separately if not already installed</span>\n<span># see https://www.dgl.ai/pages/start.html</span>\n<span>import</span><span> </span><span>dgl</span>\n<span>import</span><span> </span><span>networkx</span><span> </span><span>as</span><span> </span><span>nx</span>\n</pre></div>\n<div><pre><span></span><span>def</span><span> </span><span>convert_molgraph_to_dgl_graph</span><span>(</span><span>mg</span><span>):</span>\n<span> </span><span>\"\"\"</span>\n<span> Takes a Chemprop molgraph from featurizer and converts it to a DGL graph object.</span>\n<span> Atom features are saved in 'n' and edge features in 'e'</span>\n<span> \"\"\"</span>\n <span># Instantiate a graph from the edges</span>\n <span>g</span> <span>=</span> <span>dgl</span><span>.</span><span>graph</span><span>((</span><span>mg</span><span>.</span><span>edge_index</span><span>[</span><span>0</span><span>],</span> <span>mg</span><span>.</span><span>edge_index</span><span>[</span><span>1</span><span>]),</span> <span>num_nodes</span><span>=</span><span>mg</span><span>.</span><span>V</span><span>.</span><span>shape</span><span>[</span><span>0</span><span>])</span>\n <span># Assign features</span>\n <span>g</span><span>.</span><span>ndata</span><span>[</span><span>\"n\"</span><span>]</span> <span>=</span> <span>torch</span><span>.</span><span>tensor</span><span>(</span><span>mg</span><span>.</span><span>V</span><span>)</span>\n <span>g</span><span>.</span><span>edata</span><span>[</span><span>\"e\"</span><span>]</span> <span>=</span> <span>torch</span><span>.</span><span>tensor</span><span>(</span><span>mg</span><span>.</span><span>E</span><span>)</span>\n <span>return</span> <span>g</span>\n<span>def</span><span> </span><span>visualize_dgl_graph</span><span>(</span><span>g</span><span>):</span>\n<span> </span><span>\"\"\"</span>\n<span> Visualize a DGL graph object.</span>\n<span> Adapted from https://docs.dgl.ai/en/0.2.x/tutorials/basics/1_first.html</span>\n<span> \"\"\"</span>\n <span>nx_G</span> <span>=</span> <span>g</span><span>.</span><span>to_networkx</span><span>()</span>\n <span>pos</span> <span>=</span> <span>nx</span><span>.</span><span>kamada_kawai_layout</span><span>(</span><span>nx_G</span><span>)</span>\n <span>nx</span><span>.</span><span>draw</span><span>(</span><span>nx_G</span><span>,</span> <span>pos</span><span>,</span> <span>with_labels</span><span>=</span><span>True</span><span>,</span> <span>node_color</span><span>=</span><span>[[</span><span>0.5</span><span>,</span> <span>0.5</span><span>,</span> <span>0.5</span><span>]])</span>\n</pre></div>\n<div><pre><span></span><span># Convert the molgraphs to DGL graphs</span>\n<span>gs</span> <span>=</span>...",
      "url": "https://chemprop.readthedocs.io/en/latest/use_featurizer_with_other_libraries.html"
    },
    {
      "title": "Transfer Learning / Pretraining",
      "text": "Transfer Learning / Pretraining &#8212; Chemprop 2.2.1 documentation\n[Skip to main content](#main-content)\n**Back to top\n**Ctrl+K\n[\nChemprop 2.2.1 documentation\n](index.html)\n**\n* [**.nblink](_sources/transfer_learning.nblink)\n* **.pdf\n**\n# Transfer Learning / Pretraining\n## Contents\n# Transfer Learning / Pretraining[#](#Transfer-Learning-/-Pretraining)\nTransfer learning (or pretraining) leverages knowledge from a pre-trained model on a related task to enhance performance on a new task. In Chemprop, we can use pre-trained model checkpoints to initialize a new model and freeze components of the new model during training, as demonstrated in this notebook.\n[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/chemprop/chemprop/blob/main/examples/transfer_learning.ipynb)\n```\n[1]:\n```\n```\n# Install chemprop from GitHub if running in Google Colabimportosifos.getenv(&quot;&quot;COLAB\\_RELEASE\\_TAG&quot;&quot;):try:importchempropexceptImportError:!gitclonehttps://github.com/chemprop/chemprop.git%cdchemprop!pipinstall.%cdexamples\n```\n# Import packages[#](#Import-packages)\n```\n[2]:\n```\n```\nimportpandasaspdfrompathlibimportPathfromlightningimportpytorchasplfromsklearn.preprocessingimportStandardScalerimporttorchfromchempropimportdata,featurizers,models\n```\n# Change data inputs here[#](#Change-data-inputs-here)\n```\n[3]:\n```\n```\nchemprop\\_dir=Path.cwd().parentinput\\_path=chemprop\\_dir/&quot;tests&quot;/&quot;data&quot;/&quot;regression&quot;/&quot;mol&quot;/&quot;mol.csv&quot;# path to your data .csv filenum\\_workers=0# number of workers for dataloader. 0 means using main process for data loadingsmiles\\_column=&#39;smiles&#39;# name of the column containing SMILES stringstarget\\_columns=[&#39;lipo&#39;]# list of names of the columns containing targets\n```\n## Load data[#](#Load-data)\n```\n[4]:\n```\n```\ndf\\_input=pd.read\\_csv(input\\_path)df\\_input\n```\n```\n[4]:\n```\n||smiles|lipo|\n0|Cn1c(CN2CCN(CC2)c3ccc(Cl)cc3)nc4ccccc14|3.54|\n1|COc1cc(OC)c(cc1NC(=O)CSCC(=O)O)S(=O)(=O)N2C(C)...|-1.18|\n2|COC(=O)[C@@H](N1CCc2sccc2C1)c3ccccc3Cl|3.69|\n3|OC[C@H](O)CN1C(=O)C(Cc2ccccc12)NC(=O)c3cc4cc(C...|3.37|\n4|Cc1cccc(C[C@H](NC(=O)c2cc(nn2C)C(C)(C)C)C(=O)N...|3.10|\n...|...|...|\n95|CC(C)N(CCCNC(=O)Nc1ccc(cc1)C(C)(C)C)C[C@H]2O[C...|2.20|\n96|CCN(CC)CCCCNc1ncc2CN(C(=O)N(Cc3cccc(NC(=O)C=C)...|2.04|\n97|CCSc1c(Cc2ccccc2C(F)(F)F)sc3N(CC(C)C)C(=O)N(C)...|4.49|\n98|COc1ccc(Cc2c(N)n[nH]c2N)cc1|0.20|\n99|CCN(CCN(C)C)S(=O)(=O)c1ccc(cc1)c2cnc(N)c(n2)C(...|2.00|\n100 rows \u00d72 columns\n## Get SMILES and targets[#](#Get-SMILES-and-targets)\n```\n[5]:\n```\n```\nsmis=df\\_input.loc[:,smiles\\_column].valuesys=df\\_input.loc[:,target\\_columns].values\n```\n```\n[6]:\n```\n```\nsmis[:5]# show first 5 SMILES strings\n```\n```\n[6]:\n```\n```\narray([&#39;Cn1c(CN2CCN(CC2)c3ccc(Cl)cc3)nc4ccccc14&#39;,\n&#39;COc1cc(OC)c(cc1NC(=O)CSCC(=O)O)S(=O)(=O)N2C(C)CCc3ccccc23&#39;,\n&#39;COC(=O)[C@@H](N1CCc2sccc2C1)c3ccccc3Cl&#39;,\n&#39;OC[C@H](O)CN1C(=O)C(Cc2ccccc12)NC(=O)c3cc4cc(Cl)sc4[nH]3&#39;,\n&#39;Cc1cccc(C[C@H](NC(=O)c2cc(nn2C)C(C)(C)C)C(=O)NCC#N)c1&#39;],\ndtype=object)\n```\n```\n[7]:\n```\n```\nys[:5]# show first 5 targets\n```\n```\n[7]:\n```\n```\narray([[ 3.54],\n[-1.18],\n[ 3.69],\n[ 3.37],\n[ 3.1 ]])\n```\n## Get molecule datapoints[#](#Get-molecule-datapoints)\n```\n[8]:\n```\n```\nall\\_data=[data.MoleculeDatapoint.from\\_smi(smi,y)forsmi,yinzip(smis,ys)]\n```\n## Perform data splitting for training, validation, and testing[#](#Perform-data-splitting-for-training,-validation,-and-testing)\n```\n[9]:\n```\n```\n# available split typeslist(data.SplitType.keys())\n```\n```\n[9]:\n```\n```\n[&#39;&#39;SCAFFOLD\\_BALANCED&#39;&#39;,\n&#39;&#39;RANDOM\\_WITH\\_REPEATED\\_SMILES&#39;&#39;,\n&#39;&#39;RANDOM&#39;&#39;,\n&#39;&#39;KENNARD\\_STONE&#39;&#39;,\n&#39;&#39;KMEANS&#39;&#39;]\n```\n```\n[10]:\n```\n```\nmols=[d.molfordinall\\_data]# RDkit Mol objects are use for structure based splitstrain\\_indices,val\\_indices,test\\_indices=data.make\\_split\\_indices(mols,&quot;random&quot;,(0.8,0.1,0.1))train\\_data,val\\_data,test\\_data=data.split\\_data\\_by\\_indices(all\\_data,train\\_indices,val\\_indices,test\\_indices)\n```\n```\nThe return type of make\\_split\\_indices has changed in v2.1 - see help(make\\_split\\_indices)\n```\n# Change checkpoint model inputs here[#](#Change-checkpoint-model-inputs-here)\nBoth message-passing neural networks (MPNNs) and multi-component MPNNs can have their weights initialized from a checkpoint file.\n```\n[11]:\n```\n```\nchemprop\\_dir=Path.cwd().parentcheckpoint\\_path=chemprop\\_dir/&quot;tests&quot;/&quot;data&quot;/&quot;&quot;example\\_model\\_v2\\_regression\\_mol.ckpt&quot;&quot;# path to the checkpoint file.# If the checkpoint file is generated using the training notebook, it will be in the `checkpoints` folder with name similar to `checkpoints/epoch=19-step=180.ckpt`.\n```\n```\n[12]:\n```\n```\nmpnn\\_cls=models.MPNN\n```\n```\n[13]:\n```\n```\nmpnn=mpnn\\_cls.load\\_from\\_file(checkpoint\\_path)mpnn\n```\n```\n[13]:\n```\n```\nMPNN(\n(message\\_passing): BondMessagePassing(\n(W\\_i): Linear(in\\_features=86, out\\_features=300, bias=False)\n(W\\_h): Linear(in\\_features=300, out\\_features=300, bias=False)\n(W\\_o): Linear(in\\_features=372, out\\_features=300, bias=True)\n(dropout): Dropout(p=0.0, inplace=False)\n(tau): ReLU()\n(V\\_d\\_transform): Identity()\n(graph\\_transform): GraphTransform(\n(V\\_transform): Identity()\n(E\\_transform): Identity()\n)\n)\n(agg): MeanAggregation()\n(bn): BatchNorm1d(300, eps=1e-05, momentum=0.1, affine=True, track\\_running\\_stats=True)\n(predictor): RegressionFFN(\n(ffn): MLP(\n(0): Sequential(\n(0): Linear(in\\_features=300, out\\_features=300, bias=True)\n)\n(1): Sequential(\n(0): ReLU()\n(1): Dropout(p=0.0, inplace=False)\n(2): Linear(in\\_features=300, out\\_features=1, bias=True)\n)\n)\n(criterion): MSE(task\\_weights=[[1.0]])\n(output\\_transform): UnscaleTransform()\n)\n(X\\_d\\_transform): Identity()\n(metrics): ModuleList(\n(0-1): 2 x MSE(task\\_weights=[[1.0]])\n)\n)\n```\n# Scale fine-tuning data with the model\u2019s target scaler[#](#Scale-fine-tuning-data-with-the-model's-target-scaler)\nIf the pre-trained model was a regression model, it probably was trained on a scaled dataset. The scaler is saved as part of the model and used during prediction. For furthur training, we need to scale the fine-tuning data with the same target scaler.\n```\n[14]:\n```\n```\npretraining\\_scaler=StandardScaler()pretraining\\_scaler.mean\\_=mpnn.predictor.output\\_transform.mean.numpy()pretraining\\_scaler.scale\\_=mpnn.predictor.output\\_transform.scale.numpy()\n```\n## Get MoleculeDataset[#](#Get-MoleculeDataset)\n```\n[15]:\n```\n```\nfeaturizer=featurizers.SimpleMoleculeMolGraphFeaturizer()train\\_dset=data.MoleculeDataset(train\\_data[0],featurizer)train\\_dset.normalize\\_targets(pretraining\\_scaler)val\\_dset=data.MoleculeDataset(val\\_data[0],featurizer)val\\_dset.normalize\\_targets(pretraining\\_scaler)test\\_dset=data.MoleculeDataset(test\\_data[0],featurizer)\n```\n## Get DataLoader[#](#Get-DataLoader)\n```\n[16]:\n```\n```\ntrain\\_loader=data.build\\_dataloader(train\\_dset,num\\_workers=num\\_workers)val\\_loader=data.build\\_dataloader(val\\_dset,num\\_workers=num\\_workers,shuffle=False)test\\_loader=data.build\\_dataloader(test\\_dset,num\\_workers=num\\_workers,shuffle=False)\n```\n# Freezing MPNN and FFN layers[#](#Freezing-MPNN-and-FFN-layers)\nCertain layers of a pre-trained model can be kept unchanged during further training on a new task.\n## Freezing the MPNN[#](#Freezing-the-MPNN)\n```\n[17]:\n```\n```\nmpnn.message\\_passing.apply(lambdamodule:module.requires\\_grad\\_(False))mpnn.message\\_passing.eval()mpnn.bn.apply(lambdamodule:module.requires\\_grad\\_(False))mpnn.bn.eval()# Set batch norm layers to eval mode to freeze running mean and running var.\n```\n```\n[17]:\n```\n```\nBatchNorm1d(300, eps=1e-05, momentum=0.1, affine=True, track\\_running\\_stats=True)\n```\n## Freezing FFN layers[#](#Freezing-FFN-layers)\n```\n[18]:\n```\n```\nfrzn\\_ffn\\_layers=1# the number of consecutive FFN layers to freeze.\n```\n```\n[19]:\n```\n```\nforidxinrange(frzn\\_ffn\\_layers):mpnn.predictor.ffn[idx].requires\\_grad\\_(False)mpnn.predi...",
      "url": "https://chemprop.readthedocs.io/en/latest/transfer_learning.html"
    },
    {
      "title": "chemprop.models",
      "text": "chemprop.models &#8212; Chemprop 2.2.1 documentation\n[Skip to main content](#main-content)\n**Back to top\n**Ctrl+K\n[\nChemprop 2.2.1 documentation\n](../../../index.html)\n**\n* [**.rst](../../../_sources/autoapi/chemprop/models/index.rst)\n* **.pdf\n**\n# chemprop.models\n## Contents\n# chemprop.models[#](#module-chemprop.models)\n## Submodules[#](#submodules)\n* [chemprop.models.model](model/index.html)\n* [chemprop.models.mol\\_atom\\_bond](mol_atom_bond/index.html)\n* [chemprop.models.multi](multi/index.html)\n* [chemprop.models.utils](utils/index.html)\n## Classes[#](#classes)\n[`MPNN`](#chemprop.models.MPNN)\n|\nAn[`MPNN`](#chemprop.models.MPNN)is a sequence of message passing layers, an aggregation routine, and a\n|\n[`MolAtomBondMPNN`](#chemprop.models.MolAtomBondMPNN)\n|\nAn[`MolAtomBondMPNN`](#chemprop.models.MolAtomBondMPNN)is a sequence of message passing layers, an aggregation routine,\n|\n[`MulticomponentMPNN`](#chemprop.models.MulticomponentMPNN)\n|\nAn[`MPNN`](#chemprop.models.MPNN)is a sequence of message passing layers, an aggregation routine, and a\n|\n## Functions[#](#functions)\n[`load\\_model`](#chemprop.models.load_model)(path[,\u00a0multicomponent,\u00a0mol\\_atom\\_bond])\n|\n|\n[`save\\_model`](#chemprop.models.save_model)(path,\u00a0model[,\u00a0output\\_columns])\n|\n|\n## Package Contents[#](#package-contents)\nclasschemprop.models.MPNN(*message\\_passing*,*agg*,*predictor*,*batch\\_norm=False*,*metrics=None*,*warmup\\_epochs=2*,*init\\_lr=0.0001*,*max\\_lr=0.001*,*final\\_lr=0.0001*,*X\\_d\\_transform=None*)[[source]](../../../_modules/chemprop/models/model.html#MPNN)[#](#chemprop.models.MPNN)\nBases:`lightning.pytorch.LightningModule`\nAn[`MPNN`](#chemprop.models.MPNN)is a sequence of message passing layers, an aggregation routine, and a\npredictor routine.\nThe first two modules calculate learned fingerprints from an input molecule or\nreaction graph, and the final module takes these learned fingerprints as input to calculate a\nfinal prediction. I.e., the following operation:\n\\\\[\\\\mathtt{MPNN}(\\\\mathcal{G}) =\n\\\\mathtt{predictor}(\\\\mathtt{agg}(\\\\mathtt{message\\\\\\_passing}(\\\\mathcal{G})))\\\\]\nThe full model is trained end-to-end.\nParameters:\n* **message\\_passing**([*MessagePassing*](../nn/index.html#chemprop.nn.MessagePassing)) \u2013the message passing block to use to calculate learned fingerprints\n* **agg**([*Aggregation*](../nn/agg/index.html#chemprop.nn.agg.Aggregation)) \u2013the aggregation operation to use during molecule-level prediction\n* **predictor**([*Predictor*](../nn/index.html#chemprop.nn.Predictor)) \u2013the function to use to calculate the final prediction\n* **batch\\_norm**(*bool**,**default=False*) \u2013if> True\n, apply batch normalization to the output of the aggregation operation\n* **metrics**(*Iterable**[**Metric**]**|**None**,**default=None*) \u2013the metrics to use to evaluate the model during training and evaluation\n* **warmup\\_epochs**(*int**,**default=2*) \u2013the number of epochs to use for the learning rate warmup\n* **init\\_lr**(*int**,**default=1e-4*) \u2013the initial learning rate\n* **max\\_lr**(*float**,**default=1e-3*) \u2013the maximum learning rate\n* **final\\_lr**(*float**,**default=1e-4*) \u2013the final learning rate\n* **X\\_d\\_transform**([*chemprop.nn.transforms.ScaleTransform*](../nn/transforms/index.html#chemprop.nn.transforms.ScaleTransform)*|**None*)\nRaises:\n**ValueError**\u2013 if the output dimension of the message passing block does not match the input dimension of\nthe predictor function\nmessage\\_passing[#](#chemprop.models.MPNN.message_passing)agg[#](#chemprop.models.MPNN.agg)bn[#](#chemprop.models.MPNN.bn)predictor[#](#chemprop.models.MPNN.predictor)X\\_d\\_transform=None[#](#chemprop.models.MPNN.X_d_transform)metrics[#](#chemprop.models.MPNN.metrics)warmup\\_epochs=2[#](#chemprop.models.MPNN.warmup_epochs)init\\_lr=0.0001[#](#chemprop.models.MPNN.init_lr)max\\_lr=0.001[#](#chemprop.models.MPNN.max_lr)final\\_lr=0.0001[#](#chemprop.models.MPNN.final_lr)propertyoutput\\_dim:int[#](#chemprop.models.MPNN.output_dim)Return type:\nint\npropertyn\\_tasks:int[#](#chemprop.models.MPNN.n_tasks)Return type:\nint\npropertyn\\_targets:int[#](#chemprop.models.MPNN.n_targets)Return type:\nint\npropertycriterion:[chemprop.nn.ChempropMetric](../nn/index.html#chemprop.nn.ChempropMetric)[#](#chemprop.models.MPNN.criterion)Return type:\n[chemprop.nn.ChempropMetric](../nn/index.html#chemprop.nn.ChempropMetric)\nfingerprint(*bmg*,*V\\_d=None*,*X\\_d=None*)[[source]](../../../_modules/chemprop/models/model.html#MPNN.fingerprint)[#](#chemprop.models.MPNN.fingerprint)\nthe learned fingerprints for the input molecules\nParameters:\n* **bmg**([*chemprop.data.BatchMolGraph*](../data/index.html#chemprop.data.BatchMolGraph))\n* **V\\_d**(*torch.Tensor**|**None*)\n* **X\\_d**(*torch.Tensor**|**None*)\nReturn type:\ntorch.Tensor\nencoding(*bmg*,*V\\_d=None*,*X\\_d=None*,*i=-1*)[[source]](../../../_modules/chemprop/models/model.html#MPNN.encoding)[#](#chemprop.models.MPNN.encoding)\nCalculate the`i`-th hidden representation\nParameters:\n* **bmg**([*chemprop.data.BatchMolGraph*](../data/index.html#chemprop.data.BatchMolGraph))\n* **V\\_d**(*torch.Tensor**|**None*)\n* **X\\_d**(*torch.Tensor**|**None*)\n* **i**(*int*)\nReturn type:\ntorch.Tensor\nforward(*bmg*,*V\\_d=None*,*X\\_d=None*)[[source]](../../../_modules/chemprop/models/model.html#MPNN.forward)[#](#chemprop.models.MPNN.forward)\nGenerate predictions for the input molecules/reactions\nParameters:\n* **bmg**([*chemprop.data.BatchMolGraph*](../data/index.html#chemprop.data.BatchMolGraph))\n* **V\\_d**(*torch.Tensor**|**None*)\n* **X\\_d**(*torch.Tensor**|**None*)\nReturn type:\ntorch.Tensor\ntraining\\_step(*batch*,*batch\\_idx*)[[source]](../../../_modules/chemprop/models/model.html#MPNN.training_step)[#](#chemprop.models.MPNN.training_step)\nHere you compute and return the training loss and some additional metrics for e.g. the progress bar or\nlogger.\nParameters:\n* **batch**([*BatchType*](model/index.html#chemprop.models.model.BatchType)) \u2013The output of your data iterable, normally a`DataLoader`.\n* **batch\\_idx**\u2013 The index of this batch.\n* **dataloader\\_idx**\u2013 The index of the dataloader that produced this batch.\n(only if multiple dataloaders used)\nReturns:\n* `Tensor`- The loss tensor\n* `dict`- A dictionary which can include any keys, but must include the key`'loss'`in the case of\nautomatic optimization.\n* `None`- In automatic optimization, this will skip to the next batch (but is not supported for\nmulti-GPU, TPU, or DeepSpeed). For manual optimization, this has no special meaning, as returning\nthe loss is not required.\nIn this step you\u2019d normally do the forward pass and calculate the loss for a batch.\nYou can also do fancier things like multiple forward passes or something model specific.\nExample:\n```\ndeftraining\\_step(self,batch,batch\\_idx):x,y,z=batchout=self.encoder(x)loss=self.loss(out,x)returnloss\n```\nTo use multiple optimizers, you can switch to \u2018manual optimization\u2019 and control their stepping:\n```\ndef\\_\\_init\\_\\_(self):super().\\_\\_init\\_\\_()self.automatic\\_optimization=False# Multiple optimizers (e.g.: GANs)deftraining\\_step(self,batch,batch\\_idx):opt1,opt2=self.optimizers()# do training\\_step with encoder...opt1.step()# do training\\_step with decoder...opt2.step()\n```\nNote\nWhen`accumulate\\_grad\\_batches`&gt; 1, the loss returned here will be automatically\nnormalized by`accumulate\\_grad\\_batches`internally.\non\\_validation\\_model\\_eval()[[source]](../../../_modules/chemprop/models/model.html#MPNN.on_validation_model_eval)[#](#chemprop.models.MPNN.on_validation_model_eval)\nCalled when the validation loop starts.\nThe validation loop by default calls`.eval()`on the LightningModule before it starts. Override this hook\nto change the behavior. See also`on\\_validation\\_model\\_train()`.\nReturn type:\nNone\nvalidation\\_step(*batch*,*batch\\_idx=0*)[[source]](../../../_modules/chemprop/models/model.html#MPNN.validation_step)[#](#chemprop.models.MPNN.validation_step)\nOperates on a single batch of data from the validation set. In this step you\u2019d might generate examples or\ncalculate anything of interest like accuracy.\nParameters:\n* *...",
      "url": "https://chemprop.readthedocs.io/en/latest/autoapi/chemprop/models/index.html"
    },
    {
      "title": "Molecule MolGraph featurizers \u2014 Chemprop 2.1.2 documentation",
      "text": "[Skip to main content](https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/molgraph_molecule_featurizer.html#main-content)\n\nBack to top\n\n`Ctrl` + `K`\n\n[Chemprop 2.1.2 documentation](https://chemprop.readthedocs.io/en/latest/index.html)\n\n- [.ipynb](https://chemprop.readthedocs.io/en/latest/_sources/tutorial/python/featurizers/molgraph_molecule_featurizer.ipynb)\n- .pdf\n\n# Molecule MolGraph featurizers\n\n## Contents\n\n# Molecule MolGraph featurizers [\\#](https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/molgraph_molecule_featurizer.html\\#Molecule-MolGraph-featurizers)\n\n```\n[1]:\n\n```\n\n```\nfromchemprop.featurizers.molgraph.moleculeimport SimpleMoleculeMolGraphFeaturizer\n\n```\n\nThis is an example molecule to featurize.\n\n```\n[2]:\n\n```\n\n```\nfromrdkitimport Chem\n\nmol_to_featurize = Chem.MolFromSmiles(\"CC\")\n\n```\n\n## Simple molgraph featurizer [\\#](https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/molgraph_molecule_featurizer.html\\#Simple-molgraph-featurizer)\n\nA `MolGraph` represents the graph featurization of a molecule. It is made of atom features ( `V`), bond features ( `E`), and a mapping between atoms and bonds ( `edge_index` and `rev_edge_index`). It is created by `SimpleMoleculeMolGraphFeaturizer`.\n\n```\n[3]:\n\n```\n\n```\nfeaturizer = SimpleMoleculeMolGraphFeaturizer()\nfeaturizer(mol_to_featurize)\n\n```\n\n```\n[3]:\n\n```\n\n```\nMolGraph(V=array([[0.     , 0.     , 0.     , 0.     , 0.     , 1.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        1.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        1.     , 0.     , 1.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 1.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 1.     , 0.     , 0.     , 0.     ,\n        0.     , 0.12011],\n       [0.     , 0.     , 0.     , 0.     , 0.     , 1.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        1.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        1.     , 0.     , 1.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 1.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 1.     , 0.     , 0.     , 0.     ,\n        0.     , 0.12011]], dtype=float32), E=array([[0., 1., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0.],\n       [0., 1., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0.]]), edge_index=array([[0, 1],\n       [1, 0]]), rev_edge_index=array([1, 0]))\n\n```\n\n## Custom [\\#](https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/molgraph_molecule_featurizer.html\\#Custom)\n\nThe [atom](https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/atom_featurizers.html) and [bond](https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/bond_featurizers.html) featurizers used by the molgraph featurizer are customizable.\n\n```\n[4]:\n\n```\n\n```\nfromchemprop.featurizersimport MultiHotAtomFeaturizer, MultiHotBondFeaturizer\n\natom_featurizer = MultiHotAtomFeaturizer.organic()\nbond_featurizer = MultiHotBondFeaturizer(stereos=[0, 1, 2, 3, 4])\nfeaturizer = SimpleMoleculeMolGraphFeaturizer(\n    atom_featurizer=atom_featurizer, bond_featurizer=bond_featurizer\n)\nfeaturizer(mol_to_featurize)\n\n```\n\n```\n[4]:\n\n```\n\n```\nMolGraph(V=array([[0.     , 0.     , 1.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 1.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 1.     , 0.     , 1.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 1.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 1.     , 0.     ,\n        0.     , 0.12011],\n       [0.     , 0.     , 1.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 1.     , 0.     , 0.     , 0.     ,\n        0.     , 0.     , 0.     , 1.     , 0.     , 1.     , 0.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 0.     , 1.     ,\n        0.     , 0.     , 0.     , 0.     , 0.     , 1.     , 0.     ,\n        0.     , 0.12011]], dtype=float32), E=array([[0., 1., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0.],\n       [0., 1., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0.]]), edge_index=array([[0, 1],\n       [1, 0]]), rev_edge_index=array([1, 0]))\n\n```\n\n## Extra atom and bond features [\\#](https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/molgraph_molecule_featurizer.html\\#Extra-atom-and-bond-features)\n\nIf your [datapoints](https://chemprop.readthedocs.io/en/latest/tutorial/python/data/datapoints.html) have extra atom or bond features, the molgraph featurizer needs to know the length of the extra features when it is created so that molecules without heavy atoms (molecular hydrogen) are featurized correctly and so that the bond feature array is the correct shape.\n\n```\n[5]:\n\n```\n\n```\nn_extra_atom_features = 3\nn_extra_bond_features = 4\nfeaturizer = SimpleMoleculeMolGraphFeaturizer(\n    extra_atom_fdim=n_extra_atom_features, extra_bond_fdim=n_extra_bond_features\n)\n\n```\n\nThe [dataset](https://chemprop.readthedocs.io/en/latest/tutorial/python/data/datasets.html) is given this custom featurizer and automatically handles the featurization including passing extra atom and bond features for each datapoint.\n\nContents",
      "url": "https://chemprop.readthedocs.io/en/latest/tutorial/python/featurizers/molgraph_molecule_featurizer.html"
    },
    {
      "title": "Search code, repositories, users, issues, pull requests...",
      "text": "GitHub - chemprop/chemprop: Message Passing Neural Networks for Molecule Property Prediction\n[Skip to content](#start-of-content)\n## Navigation Menu\nToggle navigation\n[](https://github.com/)\n[Sign in](https://github.com/login?return_to=https://github.com/chemprop/chemprop)\nAppearance settings\nSearch or jump to...\n# Search code, repositories, users, issues, pull requests...\n</option></form>\nSearch\nClear\n[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)\n# Provide feedback\n</option></form>\nWe read every piece of feedback, and take your input very seriously.\nInclude my email address so I can be contacted\nCancelSubmit feedback\n# Saved searches\n## Use saved searches to filter your results more quickly\n</option></form>\nName\nQuery\nTo see all available qualifiers, see our[documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).\nCancelCreate saved search\n[Sign in](https://github.com/login?return_to=https://github.com/chemprop/chemprop)\n[Sign up](https://github.com/signup?ref_cta=Sign+up&amp;ref_loc=header+logged+out&amp;ref_page=/%3Cuser-name%3E/%3Crepo-name%3E&amp;source=header-repo&amp;source_repo=chemprop/chemprop)\nAppearance settings\nResetting focus\nYou signed in with another tab or window.[Reload]()to refresh your session.You signed out in another tab or window.[Reload]()to refresh your session.You switched accounts on another tab or window.[Reload]()to refresh your session.Dismiss alert\n{{ message }}\n[chemprop](https://github.com/chemprop)/**[chemprop](https://github.com/chemprop/chemprop)**Public\n* [Notifications](https://github.com/login?return_to=/chemprop/chemprop)You must be signed in to change notification settings\n* [Fork713](https://github.com/login?return_to=/chemprop/chemprop)\n* [Star2.2k](https://github.com/login?return_to=/chemprop/chemprop)\nMessage Passing Neural Networks for Molecule Property Prediction\n[chemprop.csail.mit.edu](https://chemprop.csail.mit.edu)\n### License\n[View license](https://github.com/chemprop/chemprop/blob/main/LICENSE.txt)\n[2.2kstars](https://github.com/chemprop/chemprop/stargazers)[713forks](https://github.com/chemprop/chemprop/forks)[Branches](https://github.com/chemprop/chemprop/branches)[Tags](https://github.com/chemprop/chemprop/tags)[Activity](https://github.com/chemprop/chemprop/activity)\n[Star](https://github.com/login?return_to=/chemprop/chemprop)\n[Notifications](https://github.com/login?return_to=/chemprop/chemprop)You must be signed in to change notification settings\n# chemprop/chemprop\nmain\n[Branches](https://github.com/chemprop/chemprop/branches)[Tags](https://github.com/chemprop/chemprop/tags)\n[](https://github.com/chemprop/chemprop/branches)[](https://github.com/chemprop/chemprop/tags)\nGo to file\nCode\nOpen more actions menu\n## Folders and files\n|Name|Name|\nLast commit message\n|\nLast commit date\n|\n## Latest commit\n## History\n[3,623 Commits](https://github.com/chemprop/chemprop/commits/main/)\n[](https://github.com/chemprop/chemprop/commits/main/)\n|\n[.github](https://github.com/chemprop/chemprop/tree/main/.github)\n|\n[.github](https://github.com/chemprop/chemprop/tree/main/.github)\n|\n|\n|\n[chemprop](https://github.com/chemprop/chemprop/tree/main/chemprop)\n|\n[chemprop](https://github.com/chemprop/chemprop/tree/main/chemprop)\n|\n|\n|\n[docs](https://github.com/chemprop/chemprop/tree/main/docs)\n|\n[docs](https://github.com/chemprop/chemprop/tree/main/docs)\n|\n|\n|\n[examples](https://github.com/chemprop/chemprop/tree/main/examples)\n|\n[examples](https://github.com/chemprop/chemprop/tree/main/examples)\n|\n|\n|\n[requirements](https://github.com/chemprop/chemprop/tree/main/requirements)\n|\n[requirements](https://github.com/chemprop/chemprop/tree/main/requirements)\n|\n|\n|\n[tests](https://github.com/chemprop/chemprop/tree/main/tests)\n|\n[tests](https://github.com/chemprop/chemprop/tree/main/tests)\n|\n|\n|\n[.bumpversion.cfg](https://github.com/chemprop/chemprop/blob/main/.bumpversion.cfg)\n|\n[.bumpversion.cfg](https://github.com/chemprop/chemprop/blob/main/.bumpversion.cfg)\n|\n|\n|\n[.dockerignore](https://github.com/chemprop/chemprop/blob/main/.dockerignore)\n|\n[.dockerignore](https://github.com/chemprop/chemprop/blob/main/.dockerignore)\n|\n|\n|\n[.flake8](https://github.com/chemprop/chemprop/blob/main/.flake8)\n|\n[.flake8](https://github.com/chemprop/chemprop/blob/main/.flake8)\n|\n|\n|\n[.gitignore](https://github.com/chemprop/chemprop/blob/main/.gitignore)\n|\n[.gitignore](https://github.com/chemprop/chemprop/blob/main/.gitignore)\n|\n|\n|\n[.readthedocs.yml](https://github.com/chemprop/chemprop/blob/main/.readthedocs.yml)\n|\n[.readthedocs.yml](https://github.com/chemprop/chemprop/blob/main/.readthedocs.yml)\n|\n|\n|\n[CITATIONS.bib](https://github.com/chemprop/chemprop/blob/main/CITATIONS.bib)\n|\n[CITATIONS.bib](https://github.com/chemprop/chemprop/blob/main/CITATIONS.bib)\n|\n|\n|\n[CONTRIBUTING.md](https://github.com/chemprop/chemprop/blob/main/CONTRIBUTING.md)\n|\n[CONTRIBUTING.md](https://github.com/chemprop/chemprop/blob/main/CONTRIBUTING.md)\n|\n|\n|\n[Dockerfile](https://github.com/chemprop/chemprop/blob/main/Dockerfile)\n|\n[Dockerfile](https://github.com/chemprop/chemprop/blob/main/Dockerfile)\n|\n|\n|\n[LICENSE.txt](https://github.com/chemprop/chemprop/blob/main/LICENSE.txt)\n|\n[LICENSE.txt](https://github.com/chemprop/chemprop/blob/main/LICENSE.txt)\n|\n|\n|\n[MANIFEST.in](https://github.com/chemprop/chemprop/blob/main/MANIFEST.in)\n|\n[MANIFEST.in](https://github.com/chemprop/chemprop/blob/main/MANIFEST.in)\n|\n|\n|\n[README.md](https://github.com/chemprop/chemprop/blob/main/README.md)\n|\n[README.md](https://github.com/chemprop/chemprop/blob/main/README.md)\n|\n|\n|\n[environment.yml](https://github.com/chemprop/chemprop/blob/main/environment.yml)\n|\n[environment.yml](https://github.com/chemprop/chemprop/blob/main/environment.yml)\n|\n|\n|\n[pyproject.toml](https://github.com/chemprop/chemprop/blob/main/pyproject.toml)\n|\n[pyproject.toml](https://github.com/chemprop/chemprop/blob/main/pyproject.toml)\n|\n|\n|\n[testing.ipynb](https://github.com/chemprop/chemprop/blob/main/testing.ipynb)\n|\n[testing.ipynb](https://github.com/chemprop/chemprop/blob/main/testing.ipynb)\n|\n|\n|\n[third\\_party.txt](https://github.com/chemprop/chemprop/blob/main/third_party.txt)\n|\n[third\\_party.txt](https://github.com/chemprop/chemprop/blob/main/third_party.txt)\n|\n|\n|\nView all files\n|\n## Repository files navigation\n![Chemprop Logo](https://github.com/chemprop/chemprop/raw/main/docs/source/_static/images/logo/chemprop_logo.svg)\n# Chemprop\n[](#chemprop)\n[![PyPI - Python Version](https://camo.githubusercontent.com/2f184357d9afc5d85d3f3f3bec28db649dbb75264bb29c686cef890adae8c132/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f6368656d70726f70)](https://badge.fury.io/py/chemprop)[![PyPI version](https://camo.githubusercontent.com/28b1510b0846a9b28c8aa3d5898d0b841e663b5247bebc46e8d12655ab127b12/68747470733a2f2f62616467652e667572792e696f2f70792f6368656d70726f702e737667)](https://badge.fury.io/py/chemprop)[![Anaconda-Server Badge](https://camo.githubusercontent.com/756bfcdb92060f54e6b134b1b11b4ec228c4545fe741bef1820a9aab676fe253/68747470733a2f2f616e61636f6e64612e6f72672f636f6e64612d666f7267652f6368656d70726f702f6261646765732f76657273696f6e2e737667)](https://anaconda.org/conda-forge/chemprop)[![Build Status](https://github.com/chemprop/chemprop/workflows/tests/badge.svg)](https://github.com/chemprop/chemprop/actions/workflows/tests.yml)[![Documentation Status](https://camo.githubusercontent.com/57d62918a35dd30ad7b7d6aab6fdc2052481cbcb91031cd5985a1bbe81466d75/68747470733a2f2f72656164746865646f63732e6f72672f70726f6a656374732f6368656d70726f702f62616467652f3f76657273696f6e3d6d61696e)](https://chemprop.readthedocs.io/en/main/?badge=main)[![License: MIT](https://camo.githubusercontent.com/fdf2982b9f5d7489dcf44570e714e3a15fce6253e0cc6b5aa61a075aac2ff71b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d79656c6c6f772e737667)](https://open...",
      "url": "https://github.com/chemprop/chemprop"
    },
    {
      "title": "Search code, repositories, users, issues, pull requests...",
      "text": "chemprop \u00b7GitHub\n[Skip to content](#start-of-content)\n## Navigation Menu\nToggle navigation\n[](https://github.com/)\n[Sign in](https://github.com/login?return_to=https://github.com/chemprop)\nAppearance settings\n[chemprop](https://github.com/chemprop)\nSearch or jump to...\n# Search code, repositories, users, issues, pull requests...\n</option></form>\nSearch\nClear\n[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)\n# Provide feedback\n</option></form>\nWe read every piece of feedback, and take your input very seriously.\nInclude my email address so I can be contacted\nCancelSubmit feedback\n# Saved searches\n## Use saved searches to filter your results more quickly\n</option></form>\nName\nQuery\nTo see all available qualifiers, see our[documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).\nCancelCreate saved search\n[Sign in](https://github.com/login?return_to=https://github.com/chemprop)\n[Sign up](https://github.com/signup?ref_cta=Sign+up&amp;ref_loc=header+logged+out&amp;ref_page=/%3Corg-login%3E&amp;source=header)\nAppearance settings\nResetting focus\nYou signed in with another tab or window.[Reload]()to refresh your session.You signed out in another tab or window.[Reload]()to refresh your session.You switched accounts on another tab or window.[Reload]()to refresh your session.Dismiss alert\n{{ message }}\n![@chemprop](https://avatars.githubusercontent.com/u/60978260?s=200&amp;v=4)\n# chemprop\nHome of the official chemprop project\n* * [126followers](https://github.com/orgs/chemprop/followers)\n* MIT\n## Popular repositoriesLoading\n1. [chemprop](https://github.com/chemprop/chemprop)chempropPublic\nMessage Passing Neural Networks for Molecule Property Prediction\nPython[2.2k](https://github.com/chemprop/chemprop/stargazers)[713](https://github.com/chemprop/chemprop/forks)\n2. [chemprop\\_benchmark](https://github.com/chemprop/chemprop_benchmark)chemprop\\_benchmarkPublic\nChemprop benchmarking scripts and data for v1\nShell[30](https://github.com/chemprop/chemprop_benchmark/stargazers)[8](https://github.com/chemprop/chemprop_benchmark/forks)\n3. [chemprop-contrib](https://github.com/chemprop/chemprop-contrib)chemprop-contribPublic\nCommunity-contributed extensions to the Chemprop machine learning package\nPython[16](https://github.com/chemprop/chemprop-contrib/stargazers)[4](https://github.com/chemprop/chemprop-contrib/forks)\n4. [chemprop-workshop-acs-fall2023](https://github.com/chemprop/chemprop-workshop-acs-fall2023)chemprop-workshop-acs-fall2023Public\nNotebooks and datasets for ACS Fall 2023 CATL workshop\nJupyter Notebook[8](https://github.com/chemprop/chemprop-workshop-acs-fall2023/stargazers)\n5. [chemprop\\_benchmark\\_v2](https://github.com/chemprop/chemprop_benchmark_v2)chemprop\\_benchmark\\_v2Public\nChemprop benchmarking scripts and data for v2\nShell[7](https://github.com/chemprop/chemprop_benchmark_v2/stargazers)\n6. [chemprop-v1-old-branches](https://github.com/chemprop/chemprop-v1-old-branches)chemprop-v1-old-branchesPublic archive\nOld branches based on old versions of Chemprop prior to v2.0.0\nPython[1](https://github.com/chemprop/chemprop-v1-old-branches/stargazers)\n### Repositories\n</option></form>\nLoading\nType\nSelect type\nAllPublicSourcesForksArchivedMirrorsTemplates\nLanguage\nSelect language\nAllJupyter NotebookPythonShell\nSort\nSelect order\nLast updatedNameStars\nShowing 6 of 6 repositories\n* [chemprop](https://github.com/chemprop/chemprop)Public\nMessage Passing Neural Networks for Molecule Property Prediction\n[\n](https://github.com/chemprop/chemprop/graphs/commit-activity)chemprop/chemprop\u2019s past year of commit activity\nPython[2,221](https://github.com/chemprop/chemprop/stargazers)[713](https://github.com/chemprop/chemprop/forks)[43](https://github.com/chemprop/chemprop/issues)[22](https://github.com/chemprop/chemprop/pulls)UpdatedJan 6, 2026\n* [chemprop-contrib](https://github.com/chemprop/chemprop-contrib)Public\nCommunity-contributed extensions to the Chemprop machine learning package\n[\n### Uh oh!\nThere was an error while loading.[Please reload this page]().\n](https://github.com/chemprop/chemprop-contrib/graphs/commit-activity)chemprop/chemprop-contrib\u2019s past year of commit activity\nPython[16](https://github.com/chemprop/chemprop-contrib/stargazers)[4](https://github.com/chemprop/chemprop-contrib/forks)[0](https://github.com/chemprop/chemprop-contrib/issues)[1](https://github.com/chemprop/chemprop-contrib/pulls)UpdatedNov 30, 2025\n* [chemprop\\_benchmark\\_v2](https://github.com/chemprop/chemprop_benchmark_v2)Public\nChemprop benchmarking scripts and data for v2\n[\n### Uh oh!\nThere was an error while loading.[Please reload this page]().\n](https://github.com/chemprop/chemprop_benchmark_v2/graphs/commit-activity)chemprop/chemprop\\_benchmark\\_v2\u2019s past year of commit activity\nShell[7](https://github.com/chemprop/chemprop_benchmark_v2/stargazers)MIT0[0](https://github.com/chemprop/chemprop_benchmark_v2/issues)[0](https://github.com/chemprop/chemprop_benchmark_v2/pulls)UpdatedJul 22, 2025\n* [chemprop\\_benchmark](https://github.com/chemprop/chemprop_benchmark)Public\nChemprop benchmarking scripts and data for v1\n[\n](https://github.com/chemprop/chemprop_benchmark/graphs/commit-activity)chemprop/chemprop\\_benchmark\u2019s past year of commit activity\nShell[30](https://github.com/chemprop/chemprop_benchmark/stargazers)MIT[8](https://github.com/chemprop/chemprop_benchmark/forks)[1](https://github.com/chemprop/chemprop_benchmark/issues)[0](https://github.com/chemprop/chemprop_benchmark/pulls)UpdatedJun 4, 2024\n* [chemprop-v1-old-branches](https://github.com/chemprop/chemprop-v1-old-branches)Public archive\nOld branches based on old versions of Chemprop prior to v2.0.0\n[\n### Uh oh!\nThere was an error while loading.[Please reload this page]().\n](https://github.com/chemprop/chemprop-v1-old-branches/graphs/commit-activity)chemprop/chemprop-v1-old-branches\u2019s past year of commit activity\nPython[1](https://github.com/chemprop/chemprop-v1-old-branches/stargazers)0[0](https://github.com/chemprop/chemprop-v1-old-branches/issues)[0](https://github.com/chemprop/chemprop-v1-old-branches/pulls)UpdatedApr 9, 2024\n* [chemprop-workshop-acs-fall2023](https://github.com/chemprop/chemprop-workshop-acs-fall2023)Public\nNotebooks and datasets for ACS Fall 2023 CATL workshop\n[\n### Uh oh!\nThere was an error while loading.[Please reload this page]().\n](https://github.com/chemprop/chemprop-workshop-acs-fall2023/graphs/commit-activity)chemprop/chemprop-workshop-acs-fall2023\u2019s past year of commit activity\nJupyter Notebook[8](https://github.com/chemprop/chemprop-workshop-acs-fall2023/stargazers)MIT0[0](https://github.com/chemprop/chemprop-workshop-acs-fall2023/issues)[0](https://github.com/chemprop/chemprop-workshop-acs-fall2023/pulls)UpdatedAug 21, 2023\n[#### People\n](https://github.com/orgs/chemprop/people)\n[![@JacksonBurns](https://avatars.githubusercontent.com/u/33505528?s=70&amp;v=4)](https://github.com/JacksonBurns)[![@kevingreenman](https://avatars.githubusercontent.com/u/35846516?s=70&amp;v=4)](https://github.com/kevingreenman)[![@akshatzalte](https://avatars.githubusercontent.com/u/56800291?s=70&amp;v=4)](https://github.com/akshatzalte)[![@KnathanM](https://avatars.githubusercontent.com/u/88562463?s=70&amp;v=4)](https://github.com/KnathanM)\n#### Top languages\nLoading\u2026\n### Uh oh!\nThere was an error while loading.[Please reload this page]().\n#### Most used topics\nLoading\u2026\n### Uh oh!\nThere was an error while loading.[Please reload this page]().\nYou can\u2019t perform that action at this time.",
      "url": "https://github.com/chemprop"
    },
    {
      "title": "Shapley value analysis for Chemprop models",
      "text": "Shapley value analysis for Chemprop models &#8212; Chemprop 2.2.1 documentation\n[Skip to main content](#main-content)\n**Back to top\n**Ctrl+K\n[\nChemprop 2.2.1 documentation\n](index.html)\n**\n* [**.nblink](_sources/shapley_value_with_customized_featurizers.nblink)\n* **.pdf\n**\n# Shapley value analysis for Chemprop models\n## Contents\n# Shapley value analysis for Chemprop models[#](#Shapley-value-analysis-for-Chemprop-models)\nThis notebook demonstrates how to perform Shapley (SHAP) value analysis for a chemprop model. In addition, it also serves as an example on how to customize chemprop featurizers.\n* Example 1: Shapley value analysis to explain importance of default chemprop atom and bond features\n* Example 2: Shapley value analysis to explain importance of particular atom/node and bond/edge\n* Example 3: Shapley value analysis to explain importance of extra features (not yet implemented, will be done in the future release, this is likely eaiser to be achieved by modifying MoleculeDatapoint and dataloader functions)\nDisclaimer: This notebook is for feature demonstration purposes only. The models used in this notebook are not trained models, and the computed Shapley values are provided solely for illustrative purposes.\nNote: This notebook is developed for Chemprop v2.\nFor Chemprop v1 SHAP implementation checkout:[oscarwumit/chemprop\\_developing](https://github.com/oscarwumit/chemprop_developing/tree/shap_v1)\nThis notebook requires the SHAP package, do \u201cpip install shap\u201d if you don\u2019t have it installed.\n[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/chemprop/chemprop/blob/main/examples/shapley_value_with_customized_featurizers.ipynb)\n```\n[1]:\n```\n```\n# Install chemprop from GitHub if running in Google Colabimportosifos.getenv(&quot;&quot;COLAB\\_RELEASE\\_TAG&quot;&quot;):try:importchempropexceptImportError:!gitclonehttps://github.com/chemprop/chemprop.git%cdchemprop!pipinstall.!pipinstallshap%cdexamples\n```\n## Citation for SHAP implementation in Chemprop[#](#Citation-for-SHAP-implementation-in-Chemprop)\nLi &amp; Wu, et al. \u201cWhen Do Quantum Mechanical Descriptors Help Graph Neural Networks to Predict Chemical Properties?\u201d Journal of the American Chemical Society, vol. 146, no. 33, Aug. 2024, pp. 23103\u201320.[https://doi.org/10.1021/jacs.4c04670](https://doi.org/10.1021/jacs.4c04670).\nBibtex format\n```\n@article{li\\_and\\_wu\\_qm\\_des\\_2024,\ntitle = {When {Do} {Quantum} {Mechanical} {Descriptors} {Help} {Graph} {Neural} {Networks} to {Predict} {Chemical} {Properties}?},\nvolume = {146},\ncopyright = {https://doi.org/10.15223/policy-029},\nissn = {0002-7863, 1520-5126},\nurl = {https://pubs.acs.org/doi/10.1021/jacs.4c04670},\ndoi = {10.1021/jacs.4c04670},\nlanguage = {en},\nnumber = {33},\nurldate = {2025-01-13},\njournal = {Journal of the American Chemical Society},\nauthor = {Li, Shih-Cheng and Wu, Haoyang and Menon, Angiras and Spiekermann, Kevin A. and Li, Yi-Pei and Green, William H.},\nmonth = aug,\nyear = {2024},\npages = {23103--23120},\n}\n```\n## Customize Chemprop featurizers for SHAP analysis[#](#Customize-Chemprop-featurizers-for-SHAP-analysis)\n```\n[2]:\n```\n```\n# Import dependencies and classesimportsysfromcopyimportdeepcopyfromlightningimportpytorchasplfrompathlibimportPathimportpandasaspdimportnumpyasnpimporttorchfromdataclassesimportInitVar,dataclassfromtypingimportList,Sequence,Tuple,Union,OptionalfromrdkitimportChemfromrdkit.ChemimportMol,Drawfromrdkit.Chem.rdchemimportAtom,Bond,BondTypefromchemprop.featurizers.atomimportMultiHotAtomFeaturizerfromchemprop.featurizers.bondimportMultiHotBondFeaturizerfromchemprop.featurizers.molgraph.moleculeimportSimpleMoleculeMolGraphFeaturizerfromchemprop.data.molgraphimportMolGraphfromchemprop.featurizers.baseimportGraphFeaturizerfromchemprop.featurizers.molgraph.mixinsimport\\_MolGraphFeaturizerMixinfromchempropimportdata,featurizers,modelsimportshap# do &quot;pip install shap&quot; if you don&#39;t have it installedimportlogging# Set logging level to WARNING to suppress INFO logslogging.getLogger(&quot;&quot;lightning.pytorch.utilities.rank\\_zero&quot;&quot;).setLevel(logging.WARNING)\n```\n### CustomMultiHotAtomFeaturizer[#](#CustomMultiHotAtomFeaturizer)\n```\n[3]:\n```\n```\nclassCustomMultiHotAtomFeaturizer(MultiHotAtomFeaturizer):&quot;&quot;&quot;A custom MultiHotAtomFeaturizer that allows for selective feature ablation.Parameters----------keep\\_features : List[bool], optionala list of booleans to indicate which atom features to keep. If None, all features are kept. For any element that is False, the corresponding feature&#39;s encoding is set to all zeros. Useful for ablation and SHAP analysis.&quot;&quot;&quot;def\\_\\_init\\_\\_(self,atomic\\_nums:Sequence[int],degrees:Sequence[int],formal\\_charges:Sequence[int],chiral\\_tags:Sequence[int],num\\_Hs:Sequence[int],hybridizations:Sequence[int],keep\\_features:List[bool]=None):super().\\_\\_init\\_\\_(atomic\\_nums,degrees,formal\\_charges,chiral\\_tags,num\\_Hs,hybridizations)ifkeep\\_featuresisNone:keep\\_features=[True]\\*(len(self.\\_subfeats)+2)self.keep\\_features=keep\\_featuresdef\\_\\_call\\_\\_(self,a:Atom|None)-&gt;np.ndarray:x=np.zeros(self.\\_MultiHotAtomFeaturizer\\_\\_size)ifaisNone:returnxfeats=[a.GetAtomicNum(),a.GetTotalDegree(),a.GetFormalCharge(),int(a.GetChiralTag()),int(a.GetTotalNumHs()),a.GetHybridization(),]i=0forfeat,choices,keepinzip(feats,self.\\_subfeats,self.keep\\_features[:len(feats)]):j=choices.get(feat,len(choices))ifkeep:x[i+j]=1i+=len(choices)+1ifself.keep\\_features[len(feats)]:x[i]=int(a.GetIsAromatic())ifself.keep\\_features[len(feats)+1]:x[i+1]=0.01\\*a.GetMass()returnxdefzero\\_mask(self)-&gt;np.ndarray:&quot;&quot;&quot;Featurize the atom by setting all bits to zero.&quot;&quot;&quot;returnnp.zeros(len(self))\n```\n```\n[4]:\n```\n```\n# Example usageatomic\\_nums=[6,7,8]degrees=[1,2,3]formal\\_charges=[-1,0,1]chiral\\_tags=[0,1,2]num\\_Hs=[0,1,2]hybridizations=[1,2,3]keep\\_features\\_all=[True]\\*8keep\\_features\\_some=[True,True,False,True,False,True,True,False]keep\\_features\\_none=[False]\\*8featurizer\\_all=CustomMultiHotAtomFeaturizer(atomic\\_nums=atomic\\_nums,degrees=degrees,formal\\_charges=formal\\_charges,chiral\\_tags=chiral\\_tags,num\\_Hs=num\\_Hs,hybridizations=hybridizations,keep\\_features=keep\\_features\\_all)featurizer\\_some=CustomMultiHotAtomFeaturizer(atomic\\_nums=atomic\\_nums,degrees=degrees,formal\\_charges=formal\\_charges,chiral\\_tags=chiral\\_tags,num\\_Hs=num\\_Hs,hybridizations=hybridizations,keep\\_features=keep\\_features\\_some)featurizer\\_none=CustomMultiHotAtomFeaturizer(atomic\\_nums=atomic\\_nums,degrees=degrees,formal\\_charges=formal\\_charges,chiral\\_tags=chiral\\_tags,num\\_Hs=num\\_Hs,hybridizations=hybridizations,keep\\_features=keep\\_features\\_none)mol=Chem.MolFromSmiles(&#39;CCO&#39;)atom=mol.GetAtomWithIdx(0)# Get the first atomfeatures=featurizer\\_all(atom)print(&quot;Atom features all:&quot;,features)features=featurizer\\_some(atom)print(&quot;Atom features some:&quot;,features)features=featurizer\\_none(atom)print(&quot;Atom features none:&quot;,features)\n```\n```\nAtom features all: [1. 0. 0. 0. 0. 0. 0. 1. 0.\n1. 0. 0. 1. 0. 0. 0. 0. 0.\n0. 1. 0. 0. 0. 1. 0. 0.12011]\nAtom features some: [1. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1.\n0. 0.]\nAtom features none: [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.\n0. 0.]\n```\n### CustomMultiHotBondFeaturizer[#](#CustomMultiHotBondFeaturizer)\n```\n[5]:\n```\n```\nclassCustomMultiHotBondFeaturizer(MultiHotBondFeaturizer):&quot;&quot;&quot;A custom MultiHotBondFeaturizer that allows for selective feature ablation.Parameters----------keep\\_features : List[bool], optionala list of booleans to indicate which bond features to keep except for nullity. If None, all features are kept. For any element that is False, the corresponding feature&#39;s encoding is set to all zeros. Useful for ablation and SHAP analysis.&quot;&quot;&quot;def\\_\\_init\\_\\_(self,bond\\_types:Sequence[BondType]|None=None,stereos:Sequence[int]|None=None,...",
      "url": "https://chemprop.readthedocs.io/en/latest/shapley_value_with_customized_featurizers.html"
    },
    {
      "title": "CLI Reference \u2014 Chemprop 2.1.2 documentation",
      "text": "[Skip to main content](https://chemprop.readthedocs.io/chemprop.readthedocs.io#main-content)\n\nBack to top\n\n`Ctrl` + `K`\n\n[Chemprop 2.2.1 documentation](https://chemprop.readthedocs.io/index.html)\n\n- [.rst](https://chemprop.readthedocs.io/_sources/cmd.rst)\n- .pdf\n\n# CLI Reference\n\n## Contents\n\n# CLI Reference [\\#](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#cli-reference)\n\n```\nusage: chemprop [-h] {train,predict,convert,fingerprint,hpopt} ...\n```\n\n## [mode](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#id1) [\\#](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#chemprop.cli.main-construct_parser-mode)\n\n`mode`\n\nPossible choices: train, predict, convert, fingerprint, hpopt\n\n## [Sub-commands](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#id2) [\\#](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#Sub-commands)\n\n### [train](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#id3) [\\#](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#train)\n\nTrain a Chemprop model.\n\n```\nchemprop train [-h] [--logfile [LOGFILE]] [-v] [-q]\n               [-s SMILES_COLUMNS [SMILES_COLUMNS ...]]\n               [-r REACTION_COLUMNS [REACTION_COLUMNS ...]] [--no-header-row]\n               [-n NUM_WORKERS] [-b BATCH_SIZE] [--accelerator ACCELERATOR]\n               [--devices DEVICES]\n               [--rxn-mode {REAC_PROD,REAC_PROD_BALANCE,REAC_DIFF,REAC_DIFF_BALANCE,PROD_DIFF,PROD_DIFF_BALANCE}]\n               [--multi-hot-atom-featurizer-mode {V1,V2,ORGANIC,RIGR}]\n               [--keep-h] [--add-h] [--ignore-stereo] [--reorder-atoms]\n               [--molecule-featurizers {morgan_binary,morgan_count,rdkit_2d,v1_rdkit_2d,v1_rdkit_2d_normalized,charge} [{morgan_binary,morgan_count,rdkit_2d,v1_rdkit_2d,v1_rdkit_2d_normalized,charge} ...]]\n               [--descriptors-path DESCRIPTORS_PATH]\n               [--descriptors-columns DESCRIPTORS_COLUMNS [DESCRIPTORS_COLUMNS ...]]\n               [--no-descriptor-scaling] [--no-atom-feature-scaling]\n               [--no-atom-descriptor-scaling] [--no-bond-feature-scaling]\n               [--no-bond-descriptor-scaling]\n               [--atom-features-path ATOM_FEATURES_PATH [ATOM_FEATURES_PATH ...]]\n               [--atom-descriptors-path ATOM_DESCRIPTORS_PATH [ATOM_DESCRIPTORS_PATH ...]]\n               [--bond-features-path BOND_FEATURES_PATH [BOND_FEATURES_PATH ...]]\n               [--bond-descriptors-path BOND_DESCRIPTORS_PATH [BOND_DESCRIPTORS_PATH ...]]\n               [--constraints-path CONSTRAINTS_PATH]\n               [--constraints-to-targets CONSTRAINTS_TO_TARGETS [CONSTRAINTS_TO_TARGETS ...]]\n               [--use-cuikmolmaker-featurization] [--config-path CONFIG_PATH]\n               [-i DATA_PATH] [-o OUTPUT_DIR] [--remove-checkpoints]\n               [--checkpoint CHECKPOINT [CHECKPOINT ...]] [--freeze-encoder]\n               [--model-frzn MODEL_FRZN] [--frzn-ffn-layers FRZN_FFN_LAYERS]\n               [--from-foundation FROM_FOUNDATION]\n               [--ensemble-size ENSEMBLE_SIZE]\n               [--message-hidden-dim MESSAGE_HIDDEN_DIM] [--message-bias]\n               [--depth DEPTH] [--undirected] [--dropout DROPOUT]\n               [--mpn-shared] [--aggregation {mean,sum,norm}]\n               [--aggregation-norm AGGREGATION_NORM] [--atom-messages]\n               [--activation {RELU,CELU,ELU,GELU,GLU,HARDSHRINK,HARDSIGMOID,HARDSWISH,HARDTANH,LEAKYRELU,LOGSIGMOID,LOGSOFTMAX,MISH,MULTIHEADATTENTION,PRELU,RRELU,RELU6,SILU,SIGMOID,SOFTMAX,SOFTMAX2D,SOFTMIN,SOFTPLUS,SOFTSHRINK,SOFTSIGN,TANH,TANHSHRINK,THRESHOLD}]\n               [--activation-args [ACTIVATION_ARGS ...]]\n               [--ffn-hidden-dim FFN_HIDDEN_DIM]\n               [--ffn-num-layers FFN_NUM_LAYERS] [--batch-norm]\n               [--multiclass-num-classes MULTICLASS_NUM_CLASSES]\n               [--atom-task-weights ATOM_TASK_WEIGHTS [ATOM_TASK_WEIGHTS ...]]\n               [--atom-ffn-hidden-dim ATOM_FFN_HIDDEN_DIM]\n               [--atom-ffn-num-layers ATOM_FFN_NUM_LAYERS]\n               [--atom-multiclass-num-classes ATOM_MULTICLASS_NUM_CLASSES]\n               [--bond-task-weights BOND_TASK_WEIGHTS [BOND_TASK_WEIGHTS ...]]\n               [--bond-ffn-hidden-dim BOND_FFN_HIDDEN_DIM]\n               [--bond-ffn-num-layers BOND_FFN_NUM_LAYERS]\n               [--bond-multiclass-num-classes BOND_MULTICLASS_NUM_CLASSES]\n               [--atom-constrainer-ffn-hidden-dim ATOM_CONSTRAINER_FFN_HIDDEN_DIM]\n               [--atom-constrainer-ffn-num-layers ATOM_CONSTRAINER_FFN_NUM_LAYERS]\n               [--bond-constrainer-ffn-hidden-dim BOND_CONSTRAINER_FFN_HIDDEN_DIM]\n               [--bond-constrainer-ffn-num-layers BOND_CONSTRAINER_FFN_NUM_LAYERS]\n               [-w WEIGHT_COLUMN]\n               [--target-columns TARGET_COLUMNS [TARGET_COLUMNS ...]]\n               [--mol-target-columns MOL_TARGET_COLUMNS [MOL_TARGET_COLUMNS ...]]\n               [--atom-target-columns ATOM_TARGET_COLUMNS [ATOM_TARGET_COLUMNS ...]]\n               [--bond-target-columns BOND_TARGET_COLUMNS [BOND_TARGET_COLUMNS ...]]\n               [--ignore-columns IGNORE_COLUMNS [IGNORE_COLUMNS ...]]\n               [--no-cache] [--splits-column SPLITS_COLUMN]\n               [-t {regression,regression-mve,regression-evidential,regression-quantile,classification,classification-dirichlet,multiclass,multiclass-dirichlet,spectral}]\n               [-l {mse,mae,rmse,bounded-mse,bounded-mae,bounded-rmse,mve,evidential,bce,ce,binary-mcc,multiclass-mcc,dirichlet,sid,earthmovers,wasserstein,quantile,pinball}]\n               [--v-kl V_KL] [--eps EPS] [--alpha ALPHA]\n               [--metrics {mse,mae,rmse,bounded-mse,bounded-mae,bounded-rmse,r2,binary-mcc,multiclass-mcc,roc,prc,accuracy,f1} [{mse,mae,rmse,bounded-mse,bounded-mae,bounded-rmse,r2,binary-mcc,multiclass-mcc,roc,prc,accuracy,f1} ...]]\n               [--tracking-metric TRACKING_METRIC] [--show-individual-scores]\n               [--task-weights TASK_WEIGHTS [TASK_WEIGHTS ...]]\n               [--warmup-epochs WARMUP_EPOCHS] [--init-lr INIT_LR]\n               [--max-lr MAX_LR] [--final-lr FINAL_LR] [--epochs EPOCHS]\n               [--patience PATIENCE] [--grad-clip GRAD_CLIP] [--class-balance]\n               [--split {SCAFFOLD_BALANCED,RANDOM_WITH_REPEATED_SMILES,RANDOM,KENNARD_STONE,KMEANS}]\n               [--split-sizes SPLIT_SIZES SPLIT_SIZES SPLIT_SIZES]\n               [--split-key-molecule SPLIT_KEY_MOLECULE]\n               [--num-replicates NUM_REPLICATES] [-k NUM_FOLDS]\n               [--save-smiles-splits] [--splits-file SPLITS_FILE]\n               [--data-seed DATA_SEED] [--pytorch-seed PYTORCH_SEED]\n```\n\n#### [Named Arguments](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#id4) [\\#](https://chemprop.readthedocs.io/chemprop.readthedocs.io\\#named-arguments)\n\n`--logfile, --log`\n\nPath to which the log file should be written (specifying just the flag alone will automatically log to a file `chemprop_logs/MODE/TIMESTAMP.log` , where \u2018MODE\u2019 is the CLI mode chosen, e.g., `chemprop_logs/MODE/2025-08-22T22-32-20.log`)\n\n`-v`\n\nIncrease verbosity level to DEBUG\n\nDefault: `False`\n\n`-q`\n\nDecrease verbosity level to WARNING or ERROR if specified twice\n\nDefault: `0`\n\n`--accelerator`\n\nPassed directly to the lightning `Trainer()`\n\nDefault: `'auto'`\n\n`--devices`\n\nPassed directly to the lightning `Trainer()` (must be a single string of comma separated devices, e.g. \u20181, 2\u2019 if specifying multiple devices)\n\nDefault: `'auto'`\n\n`--constraints-path`\n\nPath to a CSV file containing the constraints for atomic/bond properties prediction. The file should have one column for each property being constrained with no SMILES column. The order of the rows should match the order of the SMILES in the input CSV. See also \u2013constraints-to-targets for how to specify which constraint applies to which prediction.\n\n`--constraints-to-targets`\n\nThe column names of the atom or bond targets that correspond to each constraint column in the constraints CSV.\n\n`--config-path`\n\nPath to a configuration file (command line arguments override v...",
      "url": "https://chemprop.readthedocs.io/en/latest/cmd.html"
    }
  ]
}