## Current Status
- Best CV score: 0.008194 from exp_032 (GP 0.15 + MLP 0.55 + LGBM 0.3)
- Best LB score: 0.0877 from exp_030
- CV-LB gap: LB = 4.23×CV + 0.0533 (R²=0.98)
- Target: 0.0347 (2.53x away from best LB)
- Submissions remaining: 3

## Response to Evaluator
- Technical verdict was TRUSTWORTHY. The per-target optimization experiment was executed correctly.
- Evaluator's top priority: Try approaches that could change the CV-LB relationship. I AGREE.
- Key concerns raised:
  1. Per-target models are 21.38% WORSE than joint models - CONFIRMED, multi-task learning is beneficial
  2. CV-LB gap remains the core challenge - AGREED, intercept (0.0533) > target (0.0347)
  3. Per-Solvent-Type Models are the most promising unexplored approach - AGREED, explicitly allowed by competition rules
  4. Only 3 submissions remaining - AGREED, must be strategic

## Data Understanding
- Reference notebooks: See `exploration/evolver_loop52_analysis.ipynb` for full analysis
- Key patterns:
  1. CV-LB relationship is highly linear (R²=0.98) with intercept 0.0533
  2. Even with CV=0, predicted LB would be 0.0533 > target 0.0347
  3. Per-target models HURT performance (21.38% worse) - multi-task learning helps
  4. Joint models learn shared representations across targets
  5. SM (starting material) is hardest to predict, Product 2 is easiest

## CRITICAL INSIGHT
The CV-LB relationship has an intercept (0.0533) that is ABOVE the target (0.0347).
This means we CANNOT reach the target by improving CV alone.
We need to CHANGE the relationship - reduce the intercept or find a different approach.

## Competition Rules - IMPORTANT
The competition EXPLICITLY ALLOWS:
1. "Using a different model for alcohols vs esters is allowed"
2. "Different hyper-parameters for different tasks (single vs full) is allowed"
3. "Different hyper-parameters for different objectives (SM vs Products) is allowed"

These are UNEXPLORED approaches that could change the CV-LB relationship!

## Recommended Approaches (Priority Order)

### PRIORITY 1: Per-Solvent-Type Models (EXPLICITLY ALLOWED)
**Rationale**: The competition rules explicitly allow "using a different model for alcohols vs esters". This is the most promising unexplored approach.
- Classify solvents into types based on chemical properties:
  - Alcohols: Methanol, Ethanol, IPA, tert-Butanol, etc.
  - Ethers: THF, 2-MeTHF, MTBE, Diethyl Ether, etc.
  - Esters: Ethyl Acetate, etc.
  - Nitriles: Acetonitrile, etc.
  - Fluorinated: HFIP, TFE, etc.
  - Amides: DMA, etc.
  - Others: Cyclohexane, Cyrene, etc.
- Train separate GP + MLP + LGBM ensembles for each solvent type
- Use the appropriate model based on solvent type during prediction
- For mixtures: use model based on dominant solvent type (or average predictions)

**Why this might work**:
- Different solvent types have fundamentally different physicochemical properties
- The CV-LB gap might be driven by certain solvent types being harder to predict
- Per-type models could capture type-specific patterns that a global model misses
- This is EXPLICITLY ALLOWED by competition rules

### PRIORITY 2: Task-Specific Models (Single vs Full)
**Rationale**: Competition allows different hyperparameters for different tasks.
- Train separate models for single solvent data vs mixture data
- The CV-LB gap might be different for these two tasks
- Single solvent: 24 solvents, 656 samples
- Full/mixture: 13 ramps, 1227 samples

### PRIORITY 3: Uncertainty-Weighted Predictions
**Rationale**: GP provides uncertainty estimates that could improve generalization.
- Use GP uncertainty to weight predictions
- Down-weight predictions where model is uncertain
- Could improve generalization to unseen solvents

### PRIORITY 4: Simpler Features Only
**Rationale**: Complex features may overfit to training solvents.
- Try using ONLY Spange descriptors (13 features) + Arrhenius kinetics (5 features)
- Remove DRFP and ACS PCA features
- The best models have been simpler (Ridge, GP)

## What NOT to Try
- Per-target models (21.38% worse - multi-task learning is beneficial)
- ChemBERTa or any pre-trained molecular embeddings (137-309% worse)
- GNN models (71% worse)
- Deep residual networks (5x worse)
- Large ensembles with many models (marginal improvement, high variance)
- Any approach that increases CV without changing the CV-LB relationship

## Validation Notes
- CV scheme: Leave-One-Solvent-Out for single solvent (24 folds), Leave-One-Ramp-Out for full data (13 folds)
- CV-LB relationship: LB = 4.23×CV + 0.0533 (R²=0.98)
- The intercept (0.0533) is the "floor" - we need to reduce this
- DO NOT SUBMIT any model with CV > 0.010 (will only make LB worse)

## Submission Strategy
With only 3 submissions remaining:
1. Save at least 1 submission for the final model
2. Only submit if we have a hypothesis about changing the CV-LB relationship
3. Per-Solvent-Type Models is the most promising approach to test
4. Do NOT submit just to "see what happens" - each submission must test a specific hypothesis

## Implementation Notes for Per-Solvent-Type Models
```python
# Solvent type classification (based on chemical properties)
SOLVENT_TYPES = {
    'Alcohols': ['Methanol', 'Ethanol', 'IPA [Propan-2-ol]', 'tert-Butanol [2-Methylpropan-2-ol]', 
                 'Ethylene Glycol [1,2-Ethanediol]', 'Decanol'],
    'Ethers': ['THF [Tetrahydrofuran]', '2-Methyltetrahydrofuran [2-MeTHF]', 
               'MTBE [tert-Butylmethylether]', 'Diethyl Ether [Ether]'],
    'Esters': ['Ethyl Acetate', 'Ethyl Lactate', 'Methyl Propionate', 'Dimethyl Carbonate'],
    'Ketones': ['Butanone [MEK]'],
    'Nitriles': ['Acetonitrile', 'Water.Acetonitrile', 'Acetonitrile.Acetic Acid'],
    'Fluorinated': ['1,1,1,3,3,3-Hexafluoropropan-2-ol', '2,2,2-Trifluoroethanol', 
                    'Water.2,2,2-Trifluoroethanol'],
    'Amides': ['DMA [N,N-Dimethylacetamide]'],
    'Others': ['Cyclohexane', 'Dihydrolevoglucosenone (Cyrene)'],
}

def get_solvent_type(solvent_name):
    for stype, solvents in SOLVENT_TYPES.items():
        if solvent_name in solvents:
            return stype
    return 'Others'  # Default for unknown solvents
```

## Competition-Specific Notes
- Submissions must follow the template structure (last 3 cells unchanged except model definition)
- Same hyperparameters must be used across all folds (no per-fold tuning)
- Different hyperparameters for different tasks (single vs full) is allowed
- Different hyperparameters for different targets (SM vs Products) is allowed
- Different models for different solvent types (alcohols vs esters) is EXPLICITLY ALLOWED
