# Catechol Reaction Yield Prediction - Strategy Guide (Loop 4)

## Current Status
- Best CV score: 0.010298 (exp_003 - Stacking Ensemble)
- Best LB score: 0.0998 (exp_000 - MLP)
- CV-LB gap: CV MSE 0.010 → LB 0.0998 (CV RMSE ~0.101 matches LB!)
- Target: 0.017270

## CRITICAL METRIC INSIGHT
**The LB metric is likely RMSE, not MSE!**
- CV MSE 0.010298 → CV RMSE 0.1015
- LB score: 0.0998 (very close to CV RMSE!)

**Target Interpretation:**
- If target 0.017270 is RMSE: Need 5.8x improvement (very challenging)
- If target 0.017270 is MSE: Our LB MSE (0.0998² = 0.00996) is ALREADY BETTER than target!

## Response to Evaluator
- Technical verdict was TRUSTWORTHY - the stacking ensemble implementation is solid
- Evaluator's top priority: SUBMIT exp_003 to verify CV-LB correlation
- Key concerns: CV-LB gap unexplained, target requires breakthrough
- **AGREED**: Submitting exp_003 is the highest priority action

## Data Understanding
- Reference notebooks: `exploration/eda.ipynb`, `exploration/evolver_loop4_analysis.ipynb`
- Single solvent: 656 samples, 24 solvents, leave-one-solvent-out CV
- Full data: 1227 samples, 13 ramps, leave-one-ramp-out CV
- SM target has highest variance (std ~0.36) - main source of error

## What's Working
1. **Stacking Ensemble** (exp_003): Best CV 0.010298
   - MLP + Trees (50/50 weight)
   - 6-9% improvement over individual models
   - Diversity is helping

2. **Arrhenius Kinetics Features**: inv_temp, log_time, interaction
3. **Symmetry TTA**: For mixed solvents, predict both (A,B) and (B,A)
4. **Data Augmentation**: Train on both symmetries for mixed solvents

## Recommended Approaches (Priority Order)

### 1. SUBMIT exp_003 (IMMEDIATE)
- CV MSE: 0.010298 (best so far)
- Expected LB: ~0.101 (if metric is RMSE)
- This will verify if CV improvements translate to LB

### 2. If LB Improves: Ensemble Optimization
- Try different ensemble weights (60/40, 70/30, etc.)
- Add more diverse models (LightGBM, XGBoost)
- Try learned weights via CV optimization

### 3. If LB Doesn't Improve: Feature Engineering
- High-dimensional features: drfps (2048), fragprints (2133)
- Per-target feature selection
- Regressor chains for correlated targets

### 4. SM Target Focus
- SM has highest variance (std ~0.36)
- Consider separate model for SM
- Physics-informed constraints (SM + Products should be ~0.8)

## What NOT to Try
- Gaussian Processes (exp_002 showed worse results: CV 0.017921)
- Simple MLP without Arrhenius features (baseline is weaker)
- Normalizing targets to sum to 1 (they don't - mass loss in reaction)

## Validation Notes
- CV scheme: Leave-one-solvent-out (24 folds) + Leave-one-ramp-out (13 folds)
- LB metric appears to be RMSE (CV RMSE matches LB closely)
- Target may be MSE - if so, we may have already beaten it!

## MANDATORY SUBMISSION STRUCTURE
- Last three cells MUST match template exactly
- Only change: `model = StackingEnsembleModel(...)` line
- Both single solvent and full data tasks must be handled
