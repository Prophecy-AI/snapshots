# Titanic Survival Prediction - Evolved Strategy (Loop 3)

## Current Status
- Best CV score: 0.8384 from RF without Age (analysis in loop 2)
- Best LB score: 0.7799 from exp_000 (baseline RF with Age)
- Latest LB: 0.7727 from exp_001 (stacking with fixed leakage) - WORSE
- CV-LB gap: ~5.4% (consistent across both submissions)
- **Submissions used: 2/10 (3 remaining)**

## Response to Evaluator
- Technical verdict was TRUSTWORTHY. Execution was sound.
- Evaluator's top priority was to submit exp_001 - DONE. Result: LB 0.7727 (WORSE than 0.7799)
- Key insight: **Fixing data leakage did NOT improve LB**. The problem is distribution shift, not leakage.
- Evaluator suggested SVC alone might be better - I AGREE, will prioritize this.
- Evaluator noted stacking underperformed - CONFIRMED by LB result.

## Critical Learning from Loop 2
**The hypothesis that fixing Age imputation leakage would improve LB was WRONG.**
- exp_000 (with leakage): CV 0.8339 → LB 0.7799 (gap: 5.4%)
- exp_001 (fixed leakage): CV 0.8271 → LB 0.7727 (gap: 5.4%)
- The CV-LB gap is IDENTICAL - leakage was not the cause
- **The real problem is distribution shift, specifically Age (56.9% importance in adversarial validation)**

## Data Understanding
Reference notebooks:
- `exploration/eda.ipynb` - Full EDA with survival rates
- `exploration/evolver_loop1_lb_feedback.ipynb` - Adversarial validation (Age = 56.9% shift)
- `exploration/evolver_loop2_lb_feedback.ipynb` - RF without Age improved CV to 0.8384

Key findings:
1. **RF WITHOUT Age achieved 0.8384 CV** - HIGHER than with Age (0.8339)
2. **SVC without Age achieved 0.8305 CV** - slightly lower than with Age (0.8361)
3. **Removing Age may improve LB** by eliminating distribution shift
4. **Title is the most predictive feature** - captures age/gender info indirectly
5. **Sex, Pclass, Embarked distributions are similar** between train/test - stable features

## Recommended Approaches (Priority Order)

### Priority 1: RF without Age (HIGHEST CONFIDENCE)
**Rationale**: RF without Age achieved 0.8384 CV (best so far). Removing Age eliminates the primary source of distribution shift. This should narrow the CV-LB gap.

Features to use:
- Pclass, Sex, SibSp, Parch, Fare, Embarked
- Title, FamilySize, IsAlone, Has_Cabin
- NO Age, NO Age_Bin, NO IsChild

Expected outcome: CV ~0.838, LB potentially ~0.79+ (narrower gap)

### Priority 2: SVC without Age
**Rationale**: SVC was the best individual model with Age (83.6%). Without Age, it's 83.05%. Still competitive and may generalize better.

Use same features as Priority 1, with StandardScaler.

### Priority 3: Add Deck feature (if Priority 1 works)
**Rationale**: Deck D/E/B have 75%+ survival. Only 23% have Cabin info, but it's predictive.
- Extract first character of Cabin
- Missing → 'Unknown'
- May add signal without adding distribution shift

### Priority 4: Voting ensemble of RF + SVC (both without Age)
**Rationale**: If both models perform well individually, a simple voting ensemble may help.
- Hard voting (majority vote)
- No complex stacking (already shown to hurt)

## What NOT to Try
- **Stacking** - Already shown to underperform (exp_001)
- **Raw Age as feature** - Primary source of distribution shift (56.9%)
- **Age_Bin** - Still derived from Age, may carry shift
- **IsChild** - Derived from Age
- **Complex feature engineering** - Simple features are working
- **More submissions without significant changes** - Only 3 left

## Validation Notes
- Use Stratified 5-Fold CV (consistent with previous)
- CV-LB gap of 5.4% is consistent - expect LB = CV - 0.054
- If RF without Age achieves 0.838 CV, expect LB ~0.784 (improvement!)
- **Only submit if CV improves significantly** - we have limited submissions

## Target Reality Check
**The target of 1.0 (100% accuracy) is IMPOSSIBLE for Titanic.**
- Best realistic LB scores are 80-82%
- Current best LB: 0.7799
- Realistic goal: Get to 0.79-0.80 range
- Focus on incremental improvements

## Experiment Priority Queue
1. **exp_002: RF without Age** - Highest priority, best CV so far
2. **exp_003: SVC without Age** - Alternative approach
3. **exp_004: RF without Age + Deck** - If exp_002 works
4. **exp_005: Voting (RF + SVC)** - If both work individually

## Code Pattern for RF without Age

```python
def engineer_features_no_age(df):
    df = df.copy()
    
    # Title extraction
    df['Title'] = df['Name'].str.extract(' ([A-Za-z]+)\.', expand=False)
    df['Title'] = df['Title'].replace(['Lady', 'Countess','Capt', 'Col','Don', 'Dr', 'Major', 'Rev', 'Sir', 'Jonkheer', 'Dona'], 'Rare')
    df['Title'] = df['Title'].replace(['Mlle', 'Ms'], 'Miss')
    df['Title'] = df['Title'].replace('Mme', 'Mrs')
    
    # Family features
    df['FamilySize'] = df['SibSp'] + df['Parch'] + 1
    df['IsAlone'] = (df['FamilySize'] == 1).astype(int)
    
    # Cabin features
    df['Has_Cabin'] = df['Cabin'].notna().astype(int)
    
    # Fill missing values
    df['Embarked'] = df['Embarked'].fillna('S')
    df['Fare'] = df['Fare'].fillna(df['Fare'].median())
    
    return df

# Features WITHOUT Age
features = ['Pclass', 'Sex', 'SibSp', 'Parch', 'Fare', 'Embarked',
            'Title', 'FamilySize', 'IsAlone', 'Has_Cabin']

# Model
rf = RandomForestClassifier(n_estimators=200, max_depth=6, min_samples_split=4, random_state=42)
```

## Key Insight for Executor
**The winning strategy is SIMPLIFICATION, not complexity.**
- Remove Age (the problematic feature)
- Use simple RF (not stacking)
- Focus on stable features (Sex, Pclass, Title, FamilySize)
- The CV-LB gap should narrow when we remove Age
