# Titanic Survival Prediction - Evolved Strategy (Loop 2)

## Current Status
- Best CV score: 0.8361 from SVC individual model (exp_001)
- Best stacking CV: 0.8271 from exp_001 (stacking ensemble)
- Best LB score: 0.7799 from exp_000 (baseline RF)
- CV-LB gap: 5.4% (83.4% CV → 78.0% LB) - indicates significant distribution shift
- **exp_001 NOT YET SUBMITTED** - need LB feedback on fixed leakage

## Response to Evaluator
- Technical verdict was TRUSTWORTHY. Execution is sound.
- Evaluator's top priority: **SUBMIT IMMEDIATELY** to validate fixed leakage hypothesis. I AGREE.
- Key concerns raised:
  1. Stacking (82.7%) underperformed SVC alone (83.6%) - AGREE, simpler may be better
  2. Age_Bin + raw Age redundancy - AGREE, should try Age_Bin only
  3. No submission of exp_001 yet - AGREE, this is critical
- Evaluator noted target of 1.0 is impossible - CONFIRMED. Best realistic LB is 80-82%.

## Data Understanding
Reference notebooks:
- `exploration/eda.ipynb` - Full EDA with survival rates by feature
- `exploration/evolver_loop1_lb_feedback.ipynb` - Adversarial validation showing Age as primary shift source (56.9%)
- `exploration/evolver_loop2_analysis.ipynb` - Deck, Fare, Ticket prefix analysis

Key patterns to exploit:
1. **Title is most predictive**: Mr 15.7%, Mrs 79.2%, Miss 69.8%, Master 57.5%
2. **Sex-Class interaction**: Female + 1st/2nd class = very high survival
3. **FamilySize non-linear**: Small families (2-4) survive best (55-72%)
4. **Deck D/E/B have highest survival** (75%+) - proximity to lifeboats
5. **Ticket prefix 'PC' has 65% survival** - may indicate premium tickets

Distribution shift insights:
- Age is PRIMARY source of shift (56.9% in adversarial validation)
- Fare distribution is similar between train/test - less concern
- Embarked has some shift (6.8%)

## Recommended Approaches (Priority Order)

### IMMEDIATE: Submit exp_001 for LB feedback
- Hypothesis: Fixed leakage may improve LB despite lower CV
- This is the most important action - validates our approach
- Use Submit tool with exp_001

### Priority 1: SVC-only model (HIGH CONFIDENCE)
- SVC achieved 83.6% CV, beating stacking (82.7%)
- Simpler model may generalize better on small dataset
- Use same features as exp_001 but SVC only
- Proper scaling is critical (StandardScaler)

### Priority 2: Address Age distribution shift more aggressively
- **Drop raw Age entirely, use ONLY Age_Bin**
- Age_Bin categories: Child (0-16), Adult (16-50), Senior (50+)
- This fully removes the feature causing 56.9% of distribution shift
- May lower CV but improve LB generalization

### Priority 3: Add Deck feature
- Extract first character of Cabin
- Deck D/E/B have 75%+ survival
- Missing Cabin → 'Unknown' deck
- Only 23% have Cabin info, but it's predictive

### Priority 4: Try XGBoost with regularization
- Mentioned in stacking kernel as effective meta-learner
- Use strong regularization (reg_alpha, reg_lambda) to prevent overfitting
- May handle distribution shift better than RF

## What NOT to Try
- **Complex stacking** - Already shown to underperform SVC alone
- **More base models in ensemble** - Correlation is the issue, not diversity
- **Raw Age as feature** - Primary source of distribution shift
- **Hyperparameter tuning without feature changes** - Features are higher ROI

## Validation Notes
- Use Stratified 5-Fold CV (consistent with previous experiments)
- CV-LB gap of 5.4% is significant - expect LB to be ~5% lower than CV
- If exp_001 submission shows narrower gap, leakage fix is working
- If gap stays same or widens, distribution shift is the bigger problem

## Target Reality Check
**The target of 1.0 (100% accuracy) is IMPOSSIBLE for Titanic.**
- Best realistic LB scores are 80-82%
- Current best LB: 77.99%
- Realistic goal: Get to 79-80% range
- Focus on incremental improvements, not perfection

## Experiment Priority Queue
1. **Submit exp_001** - Get LB feedback (uses 1 submission)
2. **exp_002: SVC-only** - Simpler model, same features
3. **exp_003: Age_Bin only** - Drop raw Age, add Deck
4. **exp_004: XGBoost** - With strong regularization

## Code Patterns

### SVC-only model
```python
from sklearn.svm import SVC
from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

svc = SVC(kernel='rbf', C=1.0, probability=True, random_state=42)
svc.fit(X_train_scaled, y_train)
```

### Deck extraction
```python
def extract_deck(cabin):
    if pd.isna(cabin):
        return 'Unknown'
    return cabin[0]

df['Deck'] = df['Cabin'].apply(extract_deck)
```

### Age_Bin only (no raw Age)
```python
features = [
    'Pclass', 'Sex', 'SibSp', 'Parch', 'Fare', 'Embarked',
    'Title', 'FamilySize', 'IsAlone', 'Has_Cabin',
    'Age_Bin', 'IsChild', 'Deck'  # Note: NO raw Age
]
```
